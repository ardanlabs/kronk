Benchmarks
================================================================================

Purpose: Detect performance regressions and provide profiling baselines.

Models:
    Dense              : Qwen3-8B-Q8_0
    Dense (Non-Det)    : gpt-oss-20b-Q8_0
    Dense (Draft)      : Qwen3-0.6B-Q8_0
    MoE                : Qwen3-VL-30B-A3B-Instruct-Q8_0
    MoE (Speculative)  : cerebras_Qwen3-Coder-REAP-25B-A3B-Q8_0
    Hybrid             : Qwen_Qwen3.5-35B-A3B-Q8_0

Shared Configuration:
    ContextWindow      : 32768
    NBatch             : 2048
    NUBatch            : 2048
    CacheTypeK         : F16
    CacheTypeV         : F16
    NSeqMax            : 1 (unless noted)
    max_tokens         : 128
    temperature        : 0.0
    System prompt      : ~8k tokens (~39k chars)
    Total conversation : ~23k tokens (~108k chars, 38 messages)

Benchmark Matrix:

    Model Type | Cache Mode | IMC Strategy      | Speculative | Benchmark Name                               | What It Catches
    -----------|------------|-------------------|-------------|----------------------------------------------|----------------------------------------
    Dense      | NonCaching | â€”                 | No          | BenchmarkDense_NonCaching                    | Full prefill baseline (no caching)
    Dense      | SPC        | â€”                 | No          | BenchmarkDense_SPC                           | System prompt cached, rest prefilled
    Dense      | IMC        | Deterministic     | No          | BenchmarkDense_IMCDeterministic              | All-but-last cached (hash matching)
    Dense      | IMC        | Non-Deterministic | No          | BenchmarkDense_IMCNonDeterministic           | Token prefix fallback (gpt-oss-20b)
    Dense      | IMC        | Deterministic     | Yes         | BenchmarkDense_IMCDeterministic_Speculative  | IMC + draft model (Qwen3-0.6B)
    MoE        | IMC        | Deterministic     | No          | BenchmarkMoE_IMCDeterministic                | MoE expert routing + IMC
    MoE        | IMC        | Deterministic     | No          | BenchmarkMoE_Speculative_Baseline            | MoE without draft (cerebras REAP)
    MoE        | IMC        | Deterministic     | Yes         | BenchmarkMoE_Speculative_WithDraft           | MoE with draft (cerebras REAP + 0.6B)
    Hybrid     | IMC        | Deterministic     | No          | BenchmarkHybrid_IMCDeterministic             | Snapshot/restore state management
    Dense      | IMC        | Deterministic     | No          | BenchmarkDense_IMCDeterministic_MultiSlot    | NSeqMax=4, 4 concurrent goroutines
    Dense      | IMC        | Deterministic     | No          | BenchmarkDense_IMC_PrefillOnly               | max_tokens=1, isolates prefill from decode
    Dense      | IMC        | Deterministic     | No          | BenchmarkDense_IMC_ColdBuild                 | First request without warmup

================================================================================

ðŸŸ¢ Better   ðŸ”´ Worse   âšª Neutral

2026-03-01     : dev
llama.cpp      : b8183
--------------------------------------------------------------------------------
goos: darwin
goarch: arm64
cpu: Apple M4 Max

Dense NonCaching        : 53051136569 ns/op ðŸŸ¢ -26.57%    1169093 B/op âšª +0.34%     9090 allocs/op âšª +0.43%
Dense SPC               : 39989411639 ns/op ðŸŸ¢ -13.70%     992549 B/op âšª +1.58%     8964 allocs/op âšª +0.18%
Dense IMC-Det           :  3536834056 ns/op ðŸŸ¢ -5.60%      152725 B/op ðŸ”´ +12.03%    3951 allocs/op âšª +0.71%
Dense IMC-NonDet (GPT)  :  1797955431 ns/op ðŸŸ¢ -3.71%      142538 B/op ðŸŸ¢ -9.16%     4071 allocs/op âšª -0.05%
Dense IMC-Det+Spec      :  6526932542 ns/op ðŸŸ¢ -5.09%      297861 B/op ðŸ”´ +16.68%    9027 allocs/op âšª +0.34%
Dense IMC-Det MultiSlot : 13677127555 ns/op ðŸŸ¢ -12.16%     550312 B/op âšª -0.04%    15756 allocs/op âšª +0.04%
Dense IMC Prefill       :   141049250 ns/op âšª -0.98%       84192 B/op ðŸ”´ +19.78%     626 allocs/op âšª +0.48%
Dense IMC Cold          : 55518052500 ns/op âšª -1.09%     4110416 B/op âšª +0.19%    30160 allocs/op âšª +0.37%

MoE IMC-Det             :  2478966820 ns/op ðŸŸ¢ -11.85%     122285 B/op ðŸŸ¢ -7.46%     3357 allocs/op ðŸ”´ +4.84%
MoE Spec-Baseline       :  2364147806 ns/op ðŸ”´ +4.24%      138072 B/op ðŸ”´ +32.89%    3312 allocs/op ðŸ”´ +4.15%
MoE Spec+Draft          :  7650007375 ns/op ðŸ”´ +18.58%     301381 B/op ðŸ”´ +11.65%    9683 allocs/op ðŸ”´ +14.15%

Hybrid IMC-Det          :  2857374153 ns/op ðŸŸ¢ -20.02%     147522 B/op ðŸŸ¢ -8.10%     3268 allocs/op ðŸŸ¢ -13.91%

--------------------------------------------------------------------------------
Dense NonCaching             Dense SPC                   Dense IMC-Det               Dense IMC-NonDet (GPT)    
36.71 tok/s    ðŸŸ¢ +14.72%    39.02 tok/s    ðŸŸ¢ +13.69%    37.76 tok/s    ðŸŸ¢ +6.37%    77.67 tok/s    ðŸŸ¢ +3.16%
50102 ttft-ms  ðŸŸ¢ -16.96%    36647 ttft-ms  ðŸŸ¢ -11.38%      194 ttft-ms  ðŸŸ¢ -12.22%     225 ttft-ms  ðŸŸ¢ -3.43%
53509 total-ms ðŸŸ¢ -16.71%    39850 total-ms ðŸŸ¢ -11.44%     3505 total-ms ðŸŸ¢ -6.36%     1823 total-ms ðŸŸ¢ -3.13%

Dense IMC-Det+Spec           Dense IMC-Det MultiSlot      Dense IMC Prefill          Dense IMC Cold            
19.37 tok/s    ðŸ”´ -9.53%     38.48 tok/s    ðŸŸ¢ +18.47%     0.00 tok/s    âšª           37.48 tok/s    âšª -0.64%
  253 ttft-ms  ðŸŸ¢ -6.64%      5311 ttft-ms  ðŸŸ¢ -15.30%        0 ttft-ms  âšª           48169 ttft-ms  âšª -0.77%
 6676 total-ms ðŸ”´ +10.17%     8559 total-ms ðŸŸ¢ -15.45%      137 total-ms âšª -0.72%    51505 total-ms âšª -0.68%

MoE IMC-Det                  MoE Spec-Baseline           MoE Spec+Draft            
48.10 tok/s    ðŸŸ¢ +27.89%    48.28 tok/s    âšª +0.44%     13.90 tok/s    âšª -1.91%
  198 ttft-ms  ðŸ”´ +7.61%       200 ttft-ms  âšª +0.50%       189 ttft-ms  âšª +1.07%
 2839 total-ms âšª -0.49%      2830 total-ms ðŸ”´ +40.87%     9326 total-ms ðŸ”´ +42.60%

Hybrid IMC-Det            
37.77 tok/s    ðŸŸ¢ +6.82%
  179 ttft-ms  ðŸ”´ +64.22%
 3128 total-ms ðŸŸ¢ -7.04%

================================================================================

2026-02-28     : v1.20.5
llama.cpp      : b8182
--------------------------------------------------------------------------------
goos: darwin
goarch: arm64
cpu: Apple M4 Max

Dense NonCaching        :    72243831375 ns/op âšª  new    1165186 B/op âšª  new    9051 allocs/op âšª  new
Dense SPC               :    46337689306 ns/op âšª  new     977157 B/op âšª  new    8948 allocs/op âšª  new
Dense IMC-Det           :     3746844667 ns/op âšª  new     136330 B/op âšª  new    3923 allocs/op âšª  new
Dense IMC-NonDet (GPT)  :     1867268431 ns/op âšª  new     156914 B/op âšª  new    4073 allocs/op âšª  new
Dense IMC-Det+Spec      :     6877000986 ns/op âšª  new     255290 B/op âšª  new    8996 allocs/op âšª  new
Dense IMC-Det MultiSlot :    15569891250 ns/op âšª  new     550530 B/op âšª  new   15749 allocs/op âšª  new
Dense IMC Prefill       :      142438167 ns/op âšª  new      70290 B/op âšª  new     623 allocs/op âšª  new
Dense IMC Cold          :    56130372222 ns/op âšª  new    4102754 B/op âšª  new   30048 allocs/op âšª  new

MoE IMC-Det             :     2812153833 ns/op âšª  new     132136 B/op âšª  new    3202 allocs/op âšª  new
MoE Spec-Baseline       :     2268022583 ns/op âšª  new     103896 B/op âšª  new    3180 allocs/op âšª  new
MoE Spec+Draft          :     6451414278 ns/op âšª  new     269930 B/op âšª  new    8483 allocs/op âšª  new

Hybrid IMC-Det          :     3572737889 ns/op âšª  new     160530 B/op âšª  new    3796 allocs/op âšª  new

--------------------------------------------------------------------------------
Dense NonCaching          Dense SPC                 Dense IMC-Det             Dense IMC-NonDet (GPT)    
32.00 tok/s    âšª  new    34.32 tok/s    âšª  new    35.50 tok/s    âšª  new    75.29 tok/s    âšª  new
60335 ttft-ms  âšª  new    41351 ttft-ms  âšª  new      221 ttft-ms  âšª  new      233 ttft-ms  âšª  new
64245 total-ms âšª  new    44997 total-ms âšª  new     3743 total-ms âšª  new     1882 total-ms âšª  new

Dense IMC-Det+Spec        Dense IMC-Det MultiSlot   Dense IMC Prefill         Dense IMC Cold            
21.41 tok/s    âšª  new    32.48 tok/s    âšª  new     0.00 tok/s    âšª  new    37.72 tok/s    âšª  new
  271 ttft-ms  âšª  new     6270 ttft-ms  âšª  new        0 ttft-ms  âšª  new    48544 ttft-ms  âšª  new
 6060 total-ms âšª  new    10123 total-ms âšª  new      138 total-ms âšª  new    51858 total-ms âšª  new

MoE IMC-Det               MoE Spec-Baseline         MoE Spec+Draft            
37.61 tok/s    âšª  new    48.07 tok/s    âšª  new    14.17 tok/s    âšª  new
  184 ttft-ms  âšª  new      199 ttft-ms  âšª  new      187 ttft-ms  âšª  new
 2853 total-ms âšª  new     2009 total-ms âšª  new     6540 total-ms âšª  new

Hybrid IMC-Det            
35.36 tok/s    âšª  new
  109 ttft-ms  âšª  new
 3365 total-ms âšª  new


================================================================================

