Test Matrix
===============================================================================

Maps every test combination across model architecture, cache mode, and
modality. Each row shows what exists and what is missing.


Models
===============================================================================

ID   Model                              Architecture   Template            Modality
---  ---------------------------------  -------------  ------------------  --------
M1   Qwen3-8B-Q8_0                      Dense          Deterministic       Text
M2   gpt-oss-20b-Q8_0                   MoE            Non-Deterministic   Text

M3   Qwen2.5-VL-3B-Instruct-Q8_0        Dense          Deterministic       Vision
M4   Qwen3-VL-30B-A3B-Instruct-Q8_0     MoE            Deterministic       Vision
M5   Qwen_Qwen3.5-35B-A3B-Q8_0          Hybrid         Deterministic       Vision

M6   Qwen2-Audio-7B.Q8_0                Dense          Deterministic       Audio
M7   embeddinggemma-300m-qat-Q8_0       Dense          —                   Embedding
M8   bge-reranker-v2-m3-Q8_0            Dense          —                   Rerank


IMC Architecture x Template Combinations
===============================================================================

Only the combinations that exist in the real world and exercise unique code
paths. Dense+Det and MoE+Det text-only are covered by their vision
counterparts, which test the same hash-based IMC path with added media
complexity.

Combination               Model                              IMC Code Path
------------------------  ---------------------------------  ------------------------------------
Dense + Vision            M3 Qwen2.5-VL-3B-Instruct-Q8_0     Hash matching + media build/extend
MoE + Vision              M4 Qwen3-VL-30B-A3B-Instruct-Q8_0  Hash matching + media build/extend
Hybrid + Vision           M5 Qwen_Qwen3.5-35B-A3B-Q8_0       Hash matching + media build/extend + snapshot/restore
MoE + Non-Deterministic   M2 gpt-oss-20b-Q8_0                Token prefix fallback


No-Cache Baseline (M1 Qwen3-8B-Q8_0, text)
===============================================================================

Test                              Package
--------------------------------  -------
ThinkChat                         qwen3/
ThinkStreamingChat                qwen3/
ToolChat                          qwen3/
ToolStreamingChat                 qwen3/
Tokenize                          qwen3/
TokenizeWithTemplate              qwen3/
ArrayFormatChat                   qwen3/
ArrayFormatStreamingChat          qwen3/
ThinkResponse                     qwen3/
ThinkStreamingResponse            qwen3/
ToolResponse                      qwen3/
ToolStreamingResponse             qwen3/
GrammarJSON                       qwen3/
GrammarJSONStreaming              qwen3/
BatchChatConcurrent               qwen3/
UsageCounting                     qwen3/
UsageAccumulation                 qwen3/
UsageWithToolCalls                qwen3/
UsageDeltaNil                     qwen3/
UsageConsistencyAcrossRequests    qwen3/
ConTest1 (cancel before loop)     qwen3/
ConTest2 (cancel inside loop)     qwen3/
ConTest3 (break + unload)         qwen3/


No-Cache Vision (M3 Qwen2.5-VL-3B-Instruct-Q8_0)
===============================================================================

Test                              Package
--------------------------------  -------
SimpleMedia                       vision/
SimpleMediaStreaming              vision/
SimpleMediaResponse               vision/
SimpleMediaResponseStreaming      vision/
ArrayFormatMedia                  vision/
ArrayFormatMediaStreaming         vision/
PooledVision                      vision/


No-Cache Audio (M6 Qwen2-Audio-7B.Q8_0)
===============================================================================

Test                              Package
--------------------------------  -------
AudioChat                         audio/ 
AudioStreamingChat                audio/ 


No-Cache Embedding (M7 embeddinggemma-300m-qat-Q8_0)
===============================================================================

Test                              Package
--------------------------------  -------
Embedding                         embed/ 
PooledEmbeddings                  embed/ 


No-Cache Rerank (M8 bge-reranker-v2-m3-Q8_0)
===============================================================================

Test                              Package
--------------------------------  -------
Rerank                            rerank/
PooledRerank                      rerank/


SPC Caching (M1 Qwen3-8B-Q8_0)
===============================================================================

Test                              Package
--------------------------------  -------
CacheSPC (multi-turn)             qwen3/ 


IMC -- Dense + Vision (M3 Qwen2.5-VL-3B-Instruct-Q8_0)
===============================================================================

Exercises: hash-based slot matching, media build, media text extend.

Test                              Package    
--------------------------------  -----------
IMCMediaBuild                     vision_imc/
IMCMediaTextExtend                vision_imc/
IMCTextThenMediaExtend            vision_imc/


IMC -- MoE + Vision (M4 Qwen3-VL-30B-A3B-Instruct-Q8_0)
===============================================================================

Exercises: hash-based slot matching, media build, media text extend,
MoE expert routing.

Test                              Package        
--------------------------------  ---------------
IMCMediaBuild                     moe_vision_imc/
IMCMediaTextExtend                moe_vision_imc/


IMC -- MoE + Non-Deterministic (M2 gpt-oss-20b-Q8_0)
===============================================================================

Exercises: token prefix fallback when hash matching fails.

Test                              Package
--------------------------------  -------
CacheIMCNonDeterministic          gpt/   


IMC -- Hybrid + Vision (M5 Qwen_Qwen3.5-35B-A3B-Q8_0)
===============================================================================

Exercises: hash-based slot matching, media build, media text extend,
snapshot/restore state management.

Test                              Package           
--------------------------------  ------------------
IMCMediaBuild                     hybrid_vision_imc/
IMCMediaTextExtend                hybrid_vision_imc/
IMCTextThenMediaExtend            hybrid_vision_imc/
CacheIMCHybrid (3-turn)           hybrid/
CacheIMCHybridMultiSlot           hybrid/


IMC -- Redundant (candidates for removal)
===============================================================================

These test the same hash-based IMC code path already covered by the vision
IMC tests above, without adding media complexity.

Test                              Package   Model                   Covered By
--------------------------------  --------  ----------------------- ----------------------------
CacheIMCDeterministic             qwen3/    M1 Qwen3-8B-Q8_0        Dense + Vision IMC (vision_imc/)
CacheIMCDeterministicMultiSlot    qwen3/    M1 Qwen3-8B-Q8_0        Dense + Vision IMC (vision_imc/)
CacheIMC                          moe/      M4 Qwen3-VL-30B-A3B     MoE + Vision IMC (moe_vision_imc/)
CacheIMCMultiSlot                 moe/      M4 Qwen3-VL-30B-A3B     MoE + Vision IMC (moe_vision_imc/)


No-Cache -- Additional Model Coverage
===============================================================================

These suites run without caching on non-Dense architectures. They verify
basic inference correctness per architecture, not caching.

Package   Model                              Tests
--------  ---------------------------------  -------------------------------------------
hybrid/   M5 Qwen_Qwen3.5-35B-A3B-Q8_0       TestSuite (10), BatchChatConcurrent, UsageCountingHybrid
moe/      M4 Qwen3-VL-30B-A3B-Instruct-Q8_0  TestSuite (10), BatchChatConcurrent, UsageCounting
gpt/      M2 gpt-oss-20b-Q8_0                TestSuite (4)


Summary
===============================================================================

Category               Total   Have   Missing
---------------------  -----   ----   -------
No-Cache Text             23     23         0
No-Cache Vision            7      7         0
No-Cache Audio             2      2         0
No-Cache Embedding         2      2         0
No-Cache Rerank            2      2         0
SPC                        1      1         0
IMC Dense + Vision         3      3         0
IMC MoE + Vision           2      2         0
IMC MoE + Non-Det          1      1         0
IMC Hybrid + Vision        5      5         0
---------------------  -----   ----   -------
Total                     48     48         0
