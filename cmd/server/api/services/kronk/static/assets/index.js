var Cy=Object.defineProperty;var Py=(t,n,r)=>n in t?Cy(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r;var Su=(t,n,r)=>Py(t,typeof n!="symbol"?n+"":n,r);function Ey(t,n){for(var r=0;r<n.length;r++){const s=n[r];if(typeof s!="string"&&!Array.isArray(s)){for(const i in s)if(i!=="default"&&!(i in t)){const l=Object.getOwnPropertyDescriptor(s,i);l&&Object.defineProperty(t,i,l.get?l:{enumerable:!0,get:()=>s[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(i){if(i.ep)return;i.ep=!0;const l=r(i);fetch(i.href,l)}})();var Ws=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ma(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ax={exports:{}},pa={},cx={exports:{}},Ie={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _l=Symbol.for("react.element"),Ry=Symbol.for("react.portal"),My=Symbol.for("react.fragment"),Iy=Symbol.for("react.strict_mode"),Ay=Symbol.for("react.profiler"),Dy=Symbol.for("react.provider"),Ly=Symbol.for("react.context"),Fy=Symbol.for("react.forward_ref"),Oy=Symbol.for("react.suspense"),qy=Symbol.for("react.memo"),By=Symbol.for("react.lazy"),_u=Symbol.iterator;function Uy(t){return t===null||typeof t!="object"?null:(t=_u&&t[_u]||t["@@iterator"],typeof t=="function"?t:null)}var dx={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},hx=Object.assign,ux={};function ii(t,n,r){this.props=t,this.context=n,this.refs=ux,this.updater=r||dx}ii.prototype.isReactComponent={};ii.prototype.setState=function(t,n){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,n,"setState")};ii.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function mx(){}mx.prototype=ii.prototype;function th(t,n,r){this.props=t,this.context=n,this.refs=ux,this.updater=r||dx}var nh=th.prototype=new mx;nh.constructor=th;hx(nh,ii.prototype);nh.isPureReactComponent=!0;var Tu=Array.isArray,px=Object.prototype.hasOwnProperty,rh={current:null},xx={key:!0,ref:!0,__self:!0,__source:!0};function fx(t,n,r){var s,i={},l=null,o=null;if(n!=null)for(s in n.ref!==void 0&&(o=n.ref),n.key!==void 0&&(l=""+n.key),n)px.call(n,s)&&!xx.hasOwnProperty(s)&&(i[s]=n[s]);var a=arguments.length-2;if(a===1)i.children=r;else if(1<a){for(var c=Array(a),d=0;d<a;d++)c[d]=arguments[d+2];i.children=c}if(t&&t.defaultProps)for(s in a=t.defaultProps,a)i[s]===void 0&&(i[s]=a[s]);return{$$typeof:_l,type:t,key:l,ref:o,props:i,_owner:rh.current}}function Ky(t,n){return{$$typeof:_l,type:t.type,key:n,ref:t.ref,props:t.props,_owner:t._owner}}function sh(t){return typeof t=="object"&&t!==null&&t.$$typeof===_l}function zy(t){var n={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return n[r]})}var Cu=/\/+/g;function Wa(t,n){return typeof t=="object"&&t!==null&&t.key!=null?zy(""+t.key):n.toString(36)}function bo(t,n,r,s,i){var l=typeof t;(l==="undefined"||l==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(l){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case _l:case Ry:o=!0}}if(o)return o=t,i=i(o),t=s===""?"."+Wa(o,0):s,Tu(i)?(r="",t!=null&&(r=t.replace(Cu,"$&/")+"/"),bo(i,n,r,"",function(d){return d})):i!=null&&(sh(i)&&(i=Ky(i,r+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Cu,"$&/")+"/")+t)),n.push(i)),1;if(o=0,s=s===""?".":s+":",Tu(t))for(var a=0;a<t.length;a++){l=t[a];var c=s+Wa(l,a);o+=bo(l,n,r,c,i)}else if(c=Uy(t),typeof c=="function")for(t=c.call(t),a=0;!(l=t.next()).done;)l=l.value,c=s+Wa(l,a++),o+=bo(l,n,r,c,i);else if(l==="object")throw n=String(t),Error("Objects are not valid as a React child (found: "+(n==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return o}function Hl(t,n,r){if(t==null)return t;var s=[],i=0;return bo(t,s,"","",function(l){return n.call(r,l,i++)}),s}function Gy(t){if(t._status===-1){var n=t._result;n=n(),n.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=n)}if(t._status===1)return t._result.default;throw t._result}var Yt={current:null},ko={transition:null},Vy={ReactCurrentDispatcher:Yt,ReactCurrentBatchConfig:ko,ReactCurrentOwner:rh};function gx(){throw Error("act(...) is not supported in production builds of React.")}Ie.Children={map:Hl,forEach:function(t,n,r){Hl(t,function(){n.apply(this,arguments)},r)},count:function(t){var n=0;return Hl(t,function(){n++}),n},toArray:function(t){return Hl(t,function(n){return n})||[]},only:function(t){if(!sh(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Ie.Component=ii;Ie.Fragment=My;Ie.Profiler=Ay;Ie.PureComponent=th;Ie.StrictMode=Iy;Ie.Suspense=Oy;Ie.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Vy;Ie.act=gx;Ie.cloneElement=function(t,n,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var s=hx({},t.props),i=t.key,l=t.ref,o=t._owner;if(n!=null){if(n.ref!==void 0&&(l=n.ref,o=rh.current),n.key!==void 0&&(i=""+n.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in n)px.call(n,c)&&!xx.hasOwnProperty(c)&&(s[c]=n[c]===void 0&&a!==void 0?a[c]:n[c])}var c=arguments.length-2;if(c===1)s.children=r;else if(1<c){a=Array(c);for(var d=0;d<c;d++)a[d]=arguments[d+2];s.children=a}return{$$typeof:_l,type:t.type,key:i,ref:l,props:s,_owner:o}};Ie.createContext=function(t){return t={$$typeof:Ly,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Dy,_context:t},t.Consumer=t};Ie.createElement=fx;Ie.createFactory=function(t){var n=fx.bind(null,t);return n.type=t,n};Ie.createRef=function(){return{current:null}};Ie.forwardRef=function(t){return{$$typeof:Fy,render:t}};Ie.isValidElement=sh;Ie.lazy=function(t){return{$$typeof:By,_payload:{_status:-1,_result:t},_init:Gy}};Ie.memo=function(t,n){return{$$typeof:qy,type:t,compare:n===void 0?null:n}};Ie.startTransition=function(t){var n=ko.transition;ko.transition={};try{t()}finally{ko.transition=n}};Ie.unstable_act=gx;Ie.useCallback=function(t,n){return Yt.current.useCallback(t,n)};Ie.useContext=function(t){return Yt.current.useContext(t)};Ie.useDebugValue=function(){};Ie.useDeferredValue=function(t){return Yt.current.useDeferredValue(t)};Ie.useEffect=function(t,n){return Yt.current.useEffect(t,n)};Ie.useId=function(){return Yt.current.useId()};Ie.useImperativeHandle=function(t,n,r){return Yt.current.useImperativeHandle(t,n,r)};Ie.useInsertionEffect=function(t,n){return Yt.current.useInsertionEffect(t,n)};Ie.useLayoutEffect=function(t,n){return Yt.current.useLayoutEffect(t,n)};Ie.useMemo=function(t,n){return Yt.current.useMemo(t,n)};Ie.useReducer=function(t,n,r){return Yt.current.useReducer(t,n,r)};Ie.useRef=function(t){return Yt.current.useRef(t)};Ie.useState=function(t){return Yt.current.useState(t)};Ie.useSyncExternalStore=function(t,n,r){return Yt.current.useSyncExternalStore(t,n,r)};Ie.useTransition=function(){return Yt.current.useTransition()};Ie.version="18.3.1";cx.exports=Ie;var y=cx.exports;const xa=ma(y),Hy=Ey({__proto__:null,default:xa},[y]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $y=y,Wy=Symbol.for("react.element"),Qy=Symbol.for("react.fragment"),Yy=Object.prototype.hasOwnProperty,Xy=$y.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Jy={key:!0,ref:!0,__self:!0,__source:!0};function jx(t,n,r){var s,i={},l=null,o=null;r!==void 0&&(l=""+r),n.key!==void 0&&(l=""+n.key),n.ref!==void 0&&(o=n.ref);for(s in n)Yy.call(n,s)&&!Jy.hasOwnProperty(s)&&(i[s]=n[s]);if(t&&t.defaultProps)for(s in n=t.defaultProps,n)i[s]===void 0&&(i[s]=n[s]);return{$$typeof:Wy,type:t,key:l,ref:o,props:i,_owner:Xy.current}}pa.Fragment=Qy;pa.jsx=jx;pa.jsxs=jx;ax.exports=pa;var e=ax.exports,Uc={},yx={exports:{}},jn={},bx={exports:{}},kx={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function n(A,B){var v=A.length;A.push(B);e:for(;0<v;){var F=v-1>>>1,z=A[F];if(0<i(z,B))A[F]=B,A[v]=z,v=F;else break e}}function r(A){return A.length===0?null:A[0]}function s(A){if(A.length===0)return null;var B=A[0],v=A.pop();if(v!==B){A[0]=v;e:for(var F=0,z=A.length,w=z>>>1;F<w;){var Z=2*(F+1)-1,K=A[Z],Q=Z+1,Y=A[Q];if(0>i(K,v))Q<z&&0>i(Y,K)?(A[F]=Y,A[Q]=v,F=Q):(A[F]=K,A[Z]=v,F=Z);else if(Q<z&&0>i(Y,v))A[F]=Y,A[Q]=v,F=Q;else break e}}return B}function i(A,B){var v=A.sortIndex-B.sortIndex;return v!==0?v:A.id-B.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;t.unstable_now=function(){return l.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],d=[],u=1,h=null,m=3,x=!1,j=!1,b=!1,N=typeof setTimeout=="function"?setTimeout:null,f=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function g(A){for(var B=r(d);B!==null;){if(B.callback===null)s(d);else if(B.startTime<=A)s(d),B.sortIndex=B.expirationTime,n(c,B);else break;B=r(d)}}function k(A){if(b=!1,g(A),!j)if(r(c)!==null)j=!0,re(S);else{var B=r(d);B!==null&&ne(k,B.startTime-A)}}function S(A,B){j=!1,b&&(b=!1,f(D),D=-1),x=!0;var v=m;try{for(g(B),h=r(c);h!==null&&(!(h.expirationTime>B)||A&&!P());){var F=h.callback;if(typeof F=="function"){h.callback=null,m=h.priorityLevel;var z=F(h.expirationTime<=B);B=t.unstable_now(),typeof z=="function"?h.callback=z:h===r(c)&&s(c),g(B)}else s(c);h=r(c)}if(h!==null)var w=!0;else{var Z=r(d);Z!==null&&ne(k,Z.startTime-B),w=!1}return w}finally{h=null,m=v,x=!1}}var _=!1,E=null,D=-1,L=5,T=-1;function P(){return!(t.unstable_now()-T<L)}function I(){if(E!==null){var A=t.unstable_now();T=A;var B=!0;try{B=E(!0,A)}finally{B?O():(_=!1,E=null)}}else _=!1}var O;if(typeof p=="function")O=function(){p(I)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,J=X.port2;X.port1.onmessage=I,O=function(){J.postMessage(null)}}else O=function(){N(I,0)};function re(A){E=A,_||(_=!0,O())}function ne(A,B){D=N(function(){A(t.unstable_now())},B)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(A){A.callback=null},t.unstable_continueExecution=function(){j||x||(j=!0,re(S))},t.unstable_forceFrameRate=function(A){0>A||125<A?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<A?Math.floor(1e3/A):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(A){switch(m){case 1:case 2:case 3:var B=3;break;default:B=m}var v=m;m=B;try{return A()}finally{m=v}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(A,B){switch(A){case 1:case 2:case 3:case 4:case 5:break;default:A=3}var v=m;m=A;try{return B()}finally{m=v}},t.unstable_scheduleCallback=function(A,B,v){var F=t.unstable_now();switch(typeof v=="object"&&v!==null?(v=v.delay,v=typeof v=="number"&&0<v?F+v:F):v=F,A){case 1:var z=-1;break;case 2:z=250;break;case 5:z=1073741823;break;case 4:z=1e4;break;default:z=5e3}return z=v+z,A={id:u++,callback:B,priorityLevel:A,startTime:v,expirationTime:z,sortIndex:-1},v>F?(A.sortIndex=v,n(d,A),r(c)===null&&A===r(d)&&(b?(f(D),D=-1):b=!0,ne(k,v-F))):(A.sortIndex=z,n(c,A),j||x||(j=!0,re(S))),A},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(A){var B=m;return function(){var v=m;m=B;try{return A.apply(this,arguments)}finally{m=v}}}})(kx);bx.exports=kx;var Zy=bx.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eb=y,fn=Zy;function oe(t){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)n+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var vx=new Set,rl={};function us(t,n){Qs(t,n),Qs(t+"Capture",n)}function Qs(t,n){for(rl[t]=n,t=0;t<n.length;t++)vx.add(n[t])}var sr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Kc=Object.prototype.hasOwnProperty,tb=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Pu={},Eu={};function nb(t){return Kc.call(Eu,t)?!0:Kc.call(Pu,t)?!1:tb.test(t)?Eu[t]=!0:(Pu[t]=!0,!1)}function rb(t,n,r,s){if(r!==null&&r.type===0)return!1;switch(typeof n){case"function":case"symbol":return!0;case"boolean":return s?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function sb(t,n,r,s){if(n===null||typeof n>"u"||rb(t,n,r,s))return!0;if(s)return!1;if(r!==null)switch(r.type){case 3:return!n;case 4:return n===!1;case 5:return isNaN(n);case 6:return isNaN(n)||1>n}return!1}function Xt(t,n,r,s,i,l,o){this.acceptsBooleans=n===2||n===3||n===4,this.attributeName=s,this.attributeNamespace=i,this.mustUseProperty=r,this.propertyName=t,this.type=n,this.sanitizeURL=l,this.removeEmptyString=o}var At={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){At[t]=new Xt(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var n=t[0];At[n]=new Xt(n,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){At[t]=new Xt(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){At[t]=new Xt(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){At[t]=new Xt(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){At[t]=new Xt(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){At[t]=new Xt(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){At[t]=new Xt(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){At[t]=new Xt(t,5,!1,t.toLowerCase(),null,!1,!1)});var ih=/[\-:]([a-z])/g;function lh(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var n=t.replace(ih,lh);At[n]=new Xt(n,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var n=t.replace(ih,lh);At[n]=new Xt(n,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var n=t.replace(ih,lh);At[n]=new Xt(n,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){At[t]=new Xt(t,1,!1,t.toLowerCase(),null,!1,!1)});At.xlinkHref=new Xt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){At[t]=new Xt(t,1,!1,t.toLowerCase(),null,!0,!0)});function oh(t,n,r,s){var i=At.hasOwnProperty(n)?At[n]:null;(i!==null?i.type!==0:s||!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(sb(n,r,i,s)&&(r=null),s||i===null?nb(n)&&(r===null?t.removeAttribute(n):t.setAttribute(n,""+r)):i.mustUseProperty?t[i.propertyName]=r===null?i.type===3?!1:"":r:(n=i.attributeName,s=i.attributeNamespace,r===null?t.removeAttribute(n):(i=i.type,r=i===3||i===4&&r===!0?"":""+r,s?t.setAttributeNS(s,n,r):t.setAttribute(n,r))))}var ar=eb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,$l=Symbol.for("react.element"),Ts=Symbol.for("react.portal"),Cs=Symbol.for("react.fragment"),ah=Symbol.for("react.strict_mode"),zc=Symbol.for("react.profiler"),wx=Symbol.for("react.provider"),Nx=Symbol.for("react.context"),ch=Symbol.for("react.forward_ref"),Gc=Symbol.for("react.suspense"),Vc=Symbol.for("react.suspense_list"),dh=Symbol.for("react.memo"),fr=Symbol.for("react.lazy"),Sx=Symbol.for("react.offscreen"),Ru=Symbol.iterator;function bi(t){return t===null||typeof t!="object"?null:(t=Ru&&t[Ru]||t["@@iterator"],typeof t=="function"?t:null)}var ot=Object.assign,Qa;function Fi(t){if(Qa===void 0)try{throw Error()}catch(r){var n=r.stack.trim().match(/\n( *(at )?)/);Qa=n&&n[1]||""}return`
`+Qa+t}var Ya=!1;function Xa(t,n){if(!t||Ya)return"";Ya=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(n)if(n=function(){throw Error()},Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(n,[])}catch(d){var s=d}Reflect.construct(t,[],n)}else{try{n.call()}catch(d){s=d}t.call(n.prototype)}else{try{throw Error()}catch(d){s=d}t()}}catch(d){if(d&&s&&typeof d.stack=="string"){for(var i=d.stack.split(`
`),l=s.stack.split(`
`),o=i.length-1,a=l.length-1;1<=o&&0<=a&&i[o]!==l[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==l[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==l[a]){var c=`
`+i[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=a);break}}}finally{Ya=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?Fi(t):""}function ib(t){switch(t.tag){case 5:return Fi(t.type);case 16:return Fi("Lazy");case 13:return Fi("Suspense");case 19:return Fi("SuspenseList");case 0:case 2:case 15:return t=Xa(t.type,!1),t;case 11:return t=Xa(t.type.render,!1),t;case 1:return t=Xa(t.type,!0),t;default:return""}}function Hc(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Cs:return"Fragment";case Ts:return"Portal";case zc:return"Profiler";case ah:return"StrictMode";case Gc:return"Suspense";case Vc:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Nx:return(t.displayName||"Context")+".Consumer";case wx:return(t._context.displayName||"Context")+".Provider";case ch:var n=t.render;return t=t.displayName,t||(t=n.displayName||n.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case dh:return n=t.displayName||null,n!==null?n:Hc(t.type)||"Memo";case fr:n=t._payload,t=t._init;try{return Hc(t(n))}catch{}}return null}function lb(t){var n=t.type;switch(t.tag){case 24:return"Cache";case 9:return(n.displayName||"Context")+".Consumer";case 10:return(n._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=n.render,t=t.displayName||t.name||"",n.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return n;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Hc(n);case 8:return n===ah?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n}return null}function Dr(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function _x(t){var n=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function ob(t){var n=_x(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,n),s=""+t[n];if(!t.hasOwnProperty(n)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var i=r.get,l=r.set;return Object.defineProperty(t,n,{configurable:!0,get:function(){return i.call(this)},set:function(o){s=""+o,l.call(this,o)}}),Object.defineProperty(t,n,{enumerable:r.enumerable}),{getValue:function(){return s},setValue:function(o){s=""+o},stopTracking:function(){t._valueTracker=null,delete t[n]}}}}function Wl(t){t._valueTracker||(t._valueTracker=ob(t))}function Tx(t){if(!t)return!1;var n=t._valueTracker;if(!n)return!0;var r=n.getValue(),s="";return t&&(s=_x(t)?t.checked?"true":"false":t.value),t=s,t!==r?(n.setValue(t),!0):!1}function Ao(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function $c(t,n){var r=n.checked;return ot({},n,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function Mu(t,n){var r=n.defaultValue==null?"":n.defaultValue,s=n.checked!=null?n.checked:n.defaultChecked;r=Dr(n.value!=null?n.value:r),t._wrapperState={initialChecked:s,initialValue:r,controlled:n.type==="checkbox"||n.type==="radio"?n.checked!=null:n.value!=null}}function Cx(t,n){n=n.checked,n!=null&&oh(t,"checked",n,!1)}function Wc(t,n){Cx(t,n);var r=Dr(n.value),s=n.type;if(r!=null)s==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(s==="submit"||s==="reset"){t.removeAttribute("value");return}n.hasOwnProperty("value")?Qc(t,n.type,r):n.hasOwnProperty("defaultValue")&&Qc(t,n.type,Dr(n.defaultValue)),n.checked==null&&n.defaultChecked!=null&&(t.defaultChecked=!!n.defaultChecked)}function Iu(t,n,r){if(n.hasOwnProperty("value")||n.hasOwnProperty("defaultValue")){var s=n.type;if(!(s!=="submit"&&s!=="reset"||n.value!==void 0&&n.value!==null))return;n=""+t._wrapperState.initialValue,r||n===t.value||(t.value=n),t.defaultValue=n}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function Qc(t,n,r){(n!=="number"||Ao(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var Oi=Array.isArray;function Bs(t,n,r,s){if(t=t.options,n){n={};for(var i=0;i<r.length;i++)n["$"+r[i]]=!0;for(r=0;r<t.length;r++)i=n.hasOwnProperty("$"+t[r].value),t[r].selected!==i&&(t[r].selected=i),i&&s&&(t[r].defaultSelected=!0)}else{for(r=""+Dr(r),n=null,i=0;i<t.length;i++){if(t[i].value===r){t[i].selected=!0,s&&(t[i].defaultSelected=!0);return}n!==null||t[i].disabled||(n=t[i])}n!==null&&(n.selected=!0)}}function Yc(t,n){if(n.dangerouslySetInnerHTML!=null)throw Error(oe(91));return ot({},n,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Au(t,n){var r=n.value;if(r==null){if(r=n.children,n=n.defaultValue,r!=null){if(n!=null)throw Error(oe(92));if(Oi(r)){if(1<r.length)throw Error(oe(93));r=r[0]}n=r}n==null&&(n=""),r=n}t._wrapperState={initialValue:Dr(r)}}function Px(t,n){var r=Dr(n.value),s=Dr(n.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),n.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),s!=null&&(t.defaultValue=""+s)}function Du(t){var n=t.textContent;n===t._wrapperState.initialValue&&n!==""&&n!==null&&(t.value=n)}function Ex(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Xc(t,n){return t==null||t==="http://www.w3.org/1999/xhtml"?Ex(n):t==="http://www.w3.org/2000/svg"&&n==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ql,Rx=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(n,r,s,i){MSApp.execUnsafeLocalFunction(function(){return t(n,r,s,i)})}:t}(function(t,n){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=n;else{for(Ql=Ql||document.createElement("div"),Ql.innerHTML="<svg>"+n.valueOf().toString()+"</svg>",n=Ql.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;n.firstChild;)t.appendChild(n.firstChild)}});function sl(t,n){if(n){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=n;return}}t.textContent=n}var zi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ab=["Webkit","ms","Moz","O"];Object.keys(zi).forEach(function(t){ab.forEach(function(n){n=n+t.charAt(0).toUpperCase()+t.substring(1),zi[n]=zi[t]})});function Mx(t,n,r){return n==null||typeof n=="boolean"||n===""?"":r||typeof n!="number"||n===0||zi.hasOwnProperty(t)&&zi[t]?(""+n).trim():n+"px"}function Ix(t,n){t=t.style;for(var r in n)if(n.hasOwnProperty(r)){var s=r.indexOf("--")===0,i=Mx(r,n[r],s);r==="float"&&(r="cssFloat"),s?t.setProperty(r,i):t[r]=i}}var cb=ot({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Jc(t,n){if(n){if(cb[t]&&(n.children!=null||n.dangerouslySetInnerHTML!=null))throw Error(oe(137,t));if(n.dangerouslySetInnerHTML!=null){if(n.children!=null)throw Error(oe(60));if(typeof n.dangerouslySetInnerHTML!="object"||!("__html"in n.dangerouslySetInnerHTML))throw Error(oe(61))}if(n.style!=null&&typeof n.style!="object")throw Error(oe(62))}}function Zc(t,n){if(t.indexOf("-")===-1)return typeof n.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ed=null;function hh(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var td=null,Us=null,Ks=null;function Lu(t){if(t=Pl(t)){if(typeof td!="function")throw Error(oe(280));var n=t.stateNode;n&&(n=ba(n),td(t.stateNode,t.type,n))}}function Ax(t){Us?Ks?Ks.push(t):Ks=[t]:Us=t}function Dx(){if(Us){var t=Us,n=Ks;if(Ks=Us=null,Lu(t),n)for(t=0;t<n.length;t++)Lu(n[t])}}function Lx(t,n){return t(n)}function Fx(){}var Ja=!1;function Ox(t,n,r){if(Ja)return t(n,r);Ja=!0;try{return Lx(t,n,r)}finally{Ja=!1,(Us!==null||Ks!==null)&&(Fx(),Dx())}}function il(t,n){var r=t.stateNode;if(r===null)return null;var s=ba(r);if(s===null)return null;r=s[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(t=t.type,s=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!s;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(oe(231,n,typeof r));return r}var nd=!1;if(sr)try{var ki={};Object.defineProperty(ki,"passive",{get:function(){nd=!0}}),window.addEventListener("test",ki,ki),window.removeEventListener("test",ki,ki)}catch{nd=!1}function db(t,n,r,s,i,l,o,a,c){var d=Array.prototype.slice.call(arguments,3);try{n.apply(r,d)}catch(u){this.onError(u)}}var Gi=!1,Do=null,Lo=!1,rd=null,hb={onError:function(t){Gi=!0,Do=t}};function ub(t,n,r,s,i,l,o,a,c){Gi=!1,Do=null,db.apply(hb,arguments)}function mb(t,n,r,s,i,l,o,a,c){if(ub.apply(this,arguments),Gi){if(Gi){var d=Do;Gi=!1,Do=null}else throw Error(oe(198));Lo||(Lo=!0,rd=d)}}function ms(t){var n=t,r=t;if(t.alternate)for(;n.return;)n=n.return;else{t=n;do n=t,n.flags&4098&&(r=n.return),t=n.return;while(t)}return n.tag===3?r:null}function qx(t){if(t.tag===13){var n=t.memoizedState;if(n===null&&(t=t.alternate,t!==null&&(n=t.memoizedState)),n!==null)return n.dehydrated}return null}function Fu(t){if(ms(t)!==t)throw Error(oe(188))}function pb(t){var n=t.alternate;if(!n){if(n=ms(t),n===null)throw Error(oe(188));return n!==t?null:t}for(var r=t,s=n;;){var i=r.return;if(i===null)break;var l=i.alternate;if(l===null){if(s=i.return,s!==null){r=s;continue}break}if(i.child===l.child){for(l=i.child;l;){if(l===r)return Fu(i),t;if(l===s)return Fu(i),n;l=l.sibling}throw Error(oe(188))}if(r.return!==s.return)r=i,s=l;else{for(var o=!1,a=i.child;a;){if(a===r){o=!0,r=i,s=l;break}if(a===s){o=!0,s=i,r=l;break}a=a.sibling}if(!o){for(a=l.child;a;){if(a===r){o=!0,r=l,s=i;break}if(a===s){o=!0,s=l,r=i;break}a=a.sibling}if(!o)throw Error(oe(189))}}if(r.alternate!==s)throw Error(oe(190))}if(r.tag!==3)throw Error(oe(188));return r.stateNode.current===r?t:n}function Bx(t){return t=pb(t),t!==null?Ux(t):null}function Ux(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var n=Ux(t);if(n!==null)return n;t=t.sibling}return null}var Kx=fn.unstable_scheduleCallback,Ou=fn.unstable_cancelCallback,xb=fn.unstable_shouldYield,fb=fn.unstable_requestPaint,ut=fn.unstable_now,gb=fn.unstable_getCurrentPriorityLevel,uh=fn.unstable_ImmediatePriority,zx=fn.unstable_UserBlockingPriority,Fo=fn.unstable_NormalPriority,jb=fn.unstable_LowPriority,Gx=fn.unstable_IdlePriority,fa=null,$n=null;function yb(t){if($n&&typeof $n.onCommitFiberRoot=="function")try{$n.onCommitFiberRoot(fa,t,void 0,(t.current.flags&128)===128)}catch{}}var Ln=Math.clz32?Math.clz32:vb,bb=Math.log,kb=Math.LN2;function vb(t){return t>>>=0,t===0?32:31-(bb(t)/kb|0)|0}var Yl=64,Xl=4194304;function qi(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Oo(t,n){var r=t.pendingLanes;if(r===0)return 0;var s=0,i=t.suspendedLanes,l=t.pingedLanes,o=r&268435455;if(o!==0){var a=o&~i;a!==0?s=qi(a):(l&=o,l!==0&&(s=qi(l)))}else o=r&~i,o!==0?s=qi(o):l!==0&&(s=qi(l));if(s===0)return 0;if(n!==0&&n!==s&&!(n&i)&&(i=s&-s,l=n&-n,i>=l||i===16&&(l&4194240)!==0))return n;if(s&4&&(s|=r&16),n=t.entangledLanes,n!==0)for(t=t.entanglements,n&=s;0<n;)r=31-Ln(n),i=1<<r,s|=t[r],n&=~i;return s}function wb(t,n){switch(t){case 1:case 2:case 4:return n+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Nb(t,n){for(var r=t.suspendedLanes,s=t.pingedLanes,i=t.expirationTimes,l=t.pendingLanes;0<l;){var o=31-Ln(l),a=1<<o,c=i[o];c===-1?(!(a&r)||a&s)&&(i[o]=wb(a,n)):c<=n&&(t.expiredLanes|=a),l&=~a}}function sd(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Vx(){var t=Yl;return Yl<<=1,!(Yl&4194240)&&(Yl=64),t}function Za(t){for(var n=[],r=0;31>r;r++)n.push(t);return n}function Tl(t,n,r){t.pendingLanes|=n,n!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,n=31-Ln(n),t[n]=r}function Sb(t,n){var r=t.pendingLanes&~n;t.pendingLanes=n,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=n,t.mutableReadLanes&=n,t.entangledLanes&=n,n=t.entanglements;var s=t.eventTimes;for(t=t.expirationTimes;0<r;){var i=31-Ln(r),l=1<<i;n[i]=0,s[i]=-1,t[i]=-1,r&=~l}}function mh(t,n){var r=t.entangledLanes|=n;for(t=t.entanglements;r;){var s=31-Ln(r),i=1<<s;i&n|t[s]&n&&(t[s]|=n),r&=~i}}var Ve=0;function Hx(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var $x,ph,Wx,Qx,Yx,id=!1,Jl=[],Sr=null,_r=null,Tr=null,ll=new Map,ol=new Map,yr=[],_b="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function qu(t,n){switch(t){case"focusin":case"focusout":Sr=null;break;case"dragenter":case"dragleave":_r=null;break;case"mouseover":case"mouseout":Tr=null;break;case"pointerover":case"pointerout":ll.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":ol.delete(n.pointerId)}}function vi(t,n,r,s,i,l){return t===null||t.nativeEvent!==l?(t={blockedOn:n,domEventName:r,eventSystemFlags:s,nativeEvent:l,targetContainers:[i]},n!==null&&(n=Pl(n),n!==null&&ph(n)),t):(t.eventSystemFlags|=s,n=t.targetContainers,i!==null&&n.indexOf(i)===-1&&n.push(i),t)}function Tb(t,n,r,s,i){switch(n){case"focusin":return Sr=vi(Sr,t,n,r,s,i),!0;case"dragenter":return _r=vi(_r,t,n,r,s,i),!0;case"mouseover":return Tr=vi(Tr,t,n,r,s,i),!0;case"pointerover":var l=i.pointerId;return ll.set(l,vi(ll.get(l)||null,t,n,r,s,i)),!0;case"gotpointercapture":return l=i.pointerId,ol.set(l,vi(ol.get(l)||null,t,n,r,s,i)),!0}return!1}function Xx(t){var n=Zr(t.target);if(n!==null){var r=ms(n);if(r!==null){if(n=r.tag,n===13){if(n=qx(r),n!==null){t.blockedOn=n,Yx(t.priority,function(){Wx(r)});return}}else if(n===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function vo(t){if(t.blockedOn!==null)return!1;for(var n=t.targetContainers;0<n.length;){var r=ld(t.domEventName,t.eventSystemFlags,n[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var s=new r.constructor(r.type,r);ed=s,r.target.dispatchEvent(s),ed=null}else return n=Pl(r),n!==null&&ph(n),t.blockedOn=r,!1;n.shift()}return!0}function Bu(t,n,r){vo(t)&&r.delete(n)}function Cb(){id=!1,Sr!==null&&vo(Sr)&&(Sr=null),_r!==null&&vo(_r)&&(_r=null),Tr!==null&&vo(Tr)&&(Tr=null),ll.forEach(Bu),ol.forEach(Bu)}function wi(t,n){t.blockedOn===n&&(t.blockedOn=null,id||(id=!0,fn.unstable_scheduleCallback(fn.unstable_NormalPriority,Cb)))}function al(t){function n(i){return wi(i,t)}if(0<Jl.length){wi(Jl[0],t);for(var r=1;r<Jl.length;r++){var s=Jl[r];s.blockedOn===t&&(s.blockedOn=null)}}for(Sr!==null&&wi(Sr,t),_r!==null&&wi(_r,t),Tr!==null&&wi(Tr,t),ll.forEach(n),ol.forEach(n),r=0;r<yr.length;r++)s=yr[r],s.blockedOn===t&&(s.blockedOn=null);for(;0<yr.length&&(r=yr[0],r.blockedOn===null);)Xx(r),r.blockedOn===null&&yr.shift()}var zs=ar.ReactCurrentBatchConfig,qo=!0;function Pb(t,n,r,s){var i=Ve,l=zs.transition;zs.transition=null;try{Ve=1,xh(t,n,r,s)}finally{Ve=i,zs.transition=l}}function Eb(t,n,r,s){var i=Ve,l=zs.transition;zs.transition=null;try{Ve=4,xh(t,n,r,s)}finally{Ve=i,zs.transition=l}}function xh(t,n,r,s){if(qo){var i=ld(t,n,r,s);if(i===null)cc(t,n,s,Bo,r),qu(t,s);else if(Tb(i,t,n,r,s))s.stopPropagation();else if(qu(t,s),n&4&&-1<_b.indexOf(t)){for(;i!==null;){var l=Pl(i);if(l!==null&&$x(l),l=ld(t,n,r,s),l===null&&cc(t,n,s,Bo,r),l===i)break;i=l}i!==null&&s.stopPropagation()}else cc(t,n,s,null,r)}}var Bo=null;function ld(t,n,r,s){if(Bo=null,t=hh(s),t=Zr(t),t!==null)if(n=ms(t),n===null)t=null;else if(r=n.tag,r===13){if(t=qx(n),t!==null)return t;t=null}else if(r===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;t=null}else n!==t&&(t=null);return Bo=t,null}function Jx(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(gb()){case uh:return 1;case zx:return 4;case Fo:case jb:return 16;case Gx:return 536870912;default:return 16}default:return 16}}var kr=null,fh=null,wo=null;function Zx(){if(wo)return wo;var t,n=fh,r=n.length,s,i="value"in kr?kr.value:kr.textContent,l=i.length;for(t=0;t<r&&n[t]===i[t];t++);var o=r-t;for(s=1;s<=o&&n[r-s]===i[l-s];s++);return wo=i.slice(t,1<s?1-s:void 0)}function No(t){var n=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&n===13&&(t=13)):t=n,t===10&&(t=13),32<=t||t===13?t:0}function Zl(){return!0}function Uu(){return!1}function yn(t){function n(r,s,i,l,o){this._reactName=r,this._targetInst=i,this.type=s,this.nativeEvent=l,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(r=t[a],this[a]=r?r(l):l[a]);return this.isDefaultPrevented=(l.defaultPrevented!=null?l.defaultPrevented:l.returnValue===!1)?Zl:Uu,this.isPropagationStopped=Uu,this}return ot(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=Zl)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=Zl)},persist:function(){},isPersistent:Zl}),n}var li={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},gh=yn(li),Cl=ot({},li,{view:0,detail:0}),Rb=yn(Cl),ec,tc,Ni,ga=ot({},Cl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:jh,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ni&&(Ni&&t.type==="mousemove"?(ec=t.screenX-Ni.screenX,tc=t.screenY-Ni.screenY):tc=ec=0,Ni=t),ec)},movementY:function(t){return"movementY"in t?t.movementY:tc}}),Ku=yn(ga),Mb=ot({},ga,{dataTransfer:0}),Ib=yn(Mb),Ab=ot({},Cl,{relatedTarget:0}),nc=yn(Ab),Db=ot({},li,{animationName:0,elapsedTime:0,pseudoElement:0}),Lb=yn(Db),Fb=ot({},li,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Ob=yn(Fb),qb=ot({},li,{data:0}),zu=yn(qb),Bb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ub={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Kb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zb(t){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(t):(t=Kb[t])?!!n[t]:!1}function jh(){return zb}var Gb=ot({},Cl,{key:function(t){if(t.key){var n=Bb[t.key]||t.key;if(n!=="Unidentified")return n}return t.type==="keypress"?(t=No(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Ub[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:jh,charCode:function(t){return t.type==="keypress"?No(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?No(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Vb=yn(Gb),Hb=ot({},ga,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Gu=yn(Hb),$b=ot({},Cl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:jh}),Wb=yn($b),Qb=ot({},li,{propertyName:0,elapsedTime:0,pseudoElement:0}),Yb=yn(Qb),Xb=ot({},ga,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Jb=yn(Xb),Zb=[9,13,27,32],yh=sr&&"CompositionEvent"in window,Vi=null;sr&&"documentMode"in document&&(Vi=document.documentMode);var ek=sr&&"TextEvent"in window&&!Vi,ef=sr&&(!yh||Vi&&8<Vi&&11>=Vi),Vu=" ",Hu=!1;function tf(t,n){switch(t){case"keyup":return Zb.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function nf(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Ps=!1;function tk(t,n){switch(t){case"compositionend":return nf(n);case"keypress":return n.which!==32?null:(Hu=!0,Vu);case"textInput":return t=n.data,t===Vu&&Hu?null:t;default:return null}}function nk(t,n){if(Ps)return t==="compositionend"||!yh&&tf(t,n)?(t=Zx(),wo=fh=kr=null,Ps=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return ef&&n.locale!=="ko"?null:n.data;default:return null}}var rk={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $u(t){var n=t&&t.nodeName&&t.nodeName.toLowerCase();return n==="input"?!!rk[t.type]:n==="textarea"}function rf(t,n,r,s){Ax(s),n=Uo(n,"onChange"),0<n.length&&(r=new gh("onChange","change",null,r,s),t.push({event:r,listeners:n}))}var Hi=null,cl=null;function sk(t){xf(t,0)}function ja(t){var n=Ms(t);if(Tx(n))return t}function ik(t,n){if(t==="change")return n}var sf=!1;if(sr){var rc;if(sr){var sc="oninput"in document;if(!sc){var Wu=document.createElement("div");Wu.setAttribute("oninput","return;"),sc=typeof Wu.oninput=="function"}rc=sc}else rc=!1;sf=rc&&(!document.documentMode||9<document.documentMode)}function Qu(){Hi&&(Hi.detachEvent("onpropertychange",lf),cl=Hi=null)}function lf(t){if(t.propertyName==="value"&&ja(cl)){var n=[];rf(n,cl,t,hh(t)),Ox(sk,n)}}function lk(t,n,r){t==="focusin"?(Qu(),Hi=n,cl=r,Hi.attachEvent("onpropertychange",lf)):t==="focusout"&&Qu()}function ok(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return ja(cl)}function ak(t,n){if(t==="click")return ja(n)}function ck(t,n){if(t==="input"||t==="change")return ja(n)}function dk(t,n){return t===n&&(t!==0||1/t===1/n)||t!==t&&n!==n}var qn=typeof Object.is=="function"?Object.is:dk;function dl(t,n){if(qn(t,n))return!0;if(typeof t!="object"||t===null||typeof n!="object"||n===null)return!1;var r=Object.keys(t),s=Object.keys(n);if(r.length!==s.length)return!1;for(s=0;s<r.length;s++){var i=r[s];if(!Kc.call(n,i)||!qn(t[i],n[i]))return!1}return!0}function Yu(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Xu(t,n){var r=Yu(t);t=0;for(var s;r;){if(r.nodeType===3){if(s=t+r.textContent.length,t<=n&&s>=n)return{node:r,offset:n-t};t=s}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Yu(r)}}function of(t,n){return t&&n?t===n?!0:t&&t.nodeType===3?!1:n&&n.nodeType===3?of(t,n.parentNode):"contains"in t?t.contains(n):t.compareDocumentPosition?!!(t.compareDocumentPosition(n)&16):!1:!1}function af(){for(var t=window,n=Ao();n instanceof t.HTMLIFrameElement;){try{var r=typeof n.contentWindow.location.href=="string"}catch{r=!1}if(r)t=n.contentWindow;else break;n=Ao(t.document)}return n}function bh(t){var n=t&&t.nodeName&&t.nodeName.toLowerCase();return n&&(n==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||n==="textarea"||t.contentEditable==="true")}function hk(t){var n=af(),r=t.focusedElem,s=t.selectionRange;if(n!==r&&r&&r.ownerDocument&&of(r.ownerDocument.documentElement,r)){if(s!==null&&bh(r)){if(n=s.start,t=s.end,t===void 0&&(t=n),"selectionStart"in r)r.selectionStart=n,r.selectionEnd=Math.min(t,r.value.length);else if(t=(n=r.ownerDocument||document)&&n.defaultView||window,t.getSelection){t=t.getSelection();var i=r.textContent.length,l=Math.min(s.start,i);s=s.end===void 0?l:Math.min(s.end,i),!t.extend&&l>s&&(i=s,s=l,l=i),i=Xu(r,l);var o=Xu(r,s);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(n=n.createRange(),n.setStart(i.node,i.offset),t.removeAllRanges(),l>s?(t.addRange(n),t.extend(o.node,o.offset)):(n.setEnd(o.node,o.offset),t.addRange(n)))}}for(n=[],t=r;t=t.parentNode;)t.nodeType===1&&n.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<n.length;r++)t=n[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var uk=sr&&"documentMode"in document&&11>=document.documentMode,Es=null,od=null,$i=null,ad=!1;function Ju(t,n,r){var s=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;ad||Es==null||Es!==Ao(s)||(s=Es,"selectionStart"in s&&bh(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),$i&&dl($i,s)||($i=s,s=Uo(od,"onSelect"),0<s.length&&(n=new gh("onSelect","select",null,n,r),t.push({event:n,listeners:s}),n.target=Es)))}function eo(t,n){var r={};return r[t.toLowerCase()]=n.toLowerCase(),r["Webkit"+t]="webkit"+n,r["Moz"+t]="moz"+n,r}var Rs={animationend:eo("Animation","AnimationEnd"),animationiteration:eo("Animation","AnimationIteration"),animationstart:eo("Animation","AnimationStart"),transitionend:eo("Transition","TransitionEnd")},ic={},cf={};sr&&(cf=document.createElement("div").style,"AnimationEvent"in window||(delete Rs.animationend.animation,delete Rs.animationiteration.animation,delete Rs.animationstart.animation),"TransitionEvent"in window||delete Rs.transitionend.transition);function ya(t){if(ic[t])return ic[t];if(!Rs[t])return t;var n=Rs[t],r;for(r in n)if(n.hasOwnProperty(r)&&r in cf)return ic[t]=n[r];return t}var df=ya("animationend"),hf=ya("animationiteration"),uf=ya("animationstart"),mf=ya("transitionend"),pf=new Map,Zu="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Fr(t,n){pf.set(t,n),us(n,[t])}for(var lc=0;lc<Zu.length;lc++){var oc=Zu[lc],mk=oc.toLowerCase(),pk=oc[0].toUpperCase()+oc.slice(1);Fr(mk,"on"+pk)}Fr(df,"onAnimationEnd");Fr(hf,"onAnimationIteration");Fr(uf,"onAnimationStart");Fr("dblclick","onDoubleClick");Fr("focusin","onFocus");Fr("focusout","onBlur");Fr(mf,"onTransitionEnd");Qs("onMouseEnter",["mouseout","mouseover"]);Qs("onMouseLeave",["mouseout","mouseover"]);Qs("onPointerEnter",["pointerout","pointerover"]);Qs("onPointerLeave",["pointerout","pointerover"]);us("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));us("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));us("onBeforeInput",["compositionend","keypress","textInput","paste"]);us("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));us("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));us("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Bi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),xk=new Set("cancel close invalid load scroll toggle".split(" ").concat(Bi));function em(t,n,r){var s=t.type||"unknown-event";t.currentTarget=r,mb(s,n,void 0,t),t.currentTarget=null}function xf(t,n){n=(n&4)!==0;for(var r=0;r<t.length;r++){var s=t[r],i=s.event;s=s.listeners;e:{var l=void 0;if(n)for(var o=s.length-1;0<=o;o--){var a=s[o],c=a.instance,d=a.currentTarget;if(a=a.listener,c!==l&&i.isPropagationStopped())break e;em(i,a,d),l=c}else for(o=0;o<s.length;o++){if(a=s[o],c=a.instance,d=a.currentTarget,a=a.listener,c!==l&&i.isPropagationStopped())break e;em(i,a,d),l=c}}}if(Lo)throw t=rd,Lo=!1,rd=null,t}function Xe(t,n){var r=n[md];r===void 0&&(r=n[md]=new Set);var s=t+"__bubble";r.has(s)||(ff(n,t,2,!1),r.add(s))}function ac(t,n,r){var s=0;n&&(s|=4),ff(r,t,s,n)}var to="_reactListening"+Math.random().toString(36).slice(2);function hl(t){if(!t[to]){t[to]=!0,vx.forEach(function(r){r!=="selectionchange"&&(xk.has(r)||ac(r,!1,t),ac(r,!0,t))});var n=t.nodeType===9?t:t.ownerDocument;n===null||n[to]||(n[to]=!0,ac("selectionchange",!1,n))}}function ff(t,n,r,s){switch(Jx(n)){case 1:var i=Pb;break;case 4:i=Eb;break;default:i=xh}r=i.bind(null,n,r,t),i=void 0,!nd||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(i=!0),s?i!==void 0?t.addEventListener(n,r,{capture:!0,passive:i}):t.addEventListener(n,r,!0):i!==void 0?t.addEventListener(n,r,{passive:i}):t.addEventListener(n,r,!1)}function cc(t,n,r,s,i){var l=s;if(!(n&1)&&!(n&2)&&s!==null)e:for(;;){if(s===null)return;var o=s.tag;if(o===3||o===4){var a=s.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=s.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;o=o.return}for(;a!==null;){if(o=Zr(a),o===null)return;if(c=o.tag,c===5||c===6){s=l=o;continue e}a=a.parentNode}}s=s.return}Ox(function(){var d=l,u=hh(r),h=[];e:{var m=pf.get(t);if(m!==void 0){var x=gh,j=t;switch(t){case"keypress":if(No(r)===0)break e;case"keydown":case"keyup":x=Vb;break;case"focusin":j="focus",x=nc;break;case"focusout":j="blur",x=nc;break;case"beforeblur":case"afterblur":x=nc;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":x=Ku;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":x=Ib;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":x=Wb;break;case df:case hf:case uf:x=Lb;break;case mf:x=Yb;break;case"scroll":x=Rb;break;case"wheel":x=Jb;break;case"copy":case"cut":case"paste":x=Ob;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":x=Gu}var b=(n&4)!==0,N=!b&&t==="scroll",f=b?m!==null?m+"Capture":null:m;b=[];for(var p=d,g;p!==null;){g=p;var k=g.stateNode;if(g.tag===5&&k!==null&&(g=k,f!==null&&(k=il(p,f),k!=null&&b.push(ul(p,k,g)))),N)break;p=p.return}0<b.length&&(m=new x(m,j,null,r,u),h.push({event:m,listeners:b}))}}if(!(n&7)){e:{if(m=t==="mouseover"||t==="pointerover",x=t==="mouseout"||t==="pointerout",m&&r!==ed&&(j=r.relatedTarget||r.fromElement)&&(Zr(j)||j[ir]))break e;if((x||m)&&(m=u.window===u?u:(m=u.ownerDocument)?m.defaultView||m.parentWindow:window,x?(j=r.relatedTarget||r.toElement,x=d,j=j?Zr(j):null,j!==null&&(N=ms(j),j!==N||j.tag!==5&&j.tag!==6)&&(j=null)):(x=null,j=d),x!==j)){if(b=Ku,k="onMouseLeave",f="onMouseEnter",p="mouse",(t==="pointerout"||t==="pointerover")&&(b=Gu,k="onPointerLeave",f="onPointerEnter",p="pointer"),N=x==null?m:Ms(x),g=j==null?m:Ms(j),m=new b(k,p+"leave",x,r,u),m.target=N,m.relatedTarget=g,k=null,Zr(u)===d&&(b=new b(f,p+"enter",j,r,u),b.target=g,b.relatedTarget=N,k=b),N=k,x&&j)t:{for(b=x,f=j,p=0,g=b;g;g=bs(g))p++;for(g=0,k=f;k;k=bs(k))g++;for(;0<p-g;)b=bs(b),p--;for(;0<g-p;)f=bs(f),g--;for(;p--;){if(b===f||f!==null&&b===f.alternate)break t;b=bs(b),f=bs(f)}b=null}else b=null;x!==null&&tm(h,m,x,b,!1),j!==null&&N!==null&&tm(h,N,j,b,!0)}}e:{if(m=d?Ms(d):window,x=m.nodeName&&m.nodeName.toLowerCase(),x==="select"||x==="input"&&m.type==="file")var S=ik;else if($u(m))if(sf)S=ck;else{S=ok;var _=lk}else(x=m.nodeName)&&x.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(S=ak);if(S&&(S=S(t,d))){rf(h,S,r,u);break e}_&&_(t,m,d),t==="focusout"&&(_=m._wrapperState)&&_.controlled&&m.type==="number"&&Qc(m,"number",m.value)}switch(_=d?Ms(d):window,t){case"focusin":($u(_)||_.contentEditable==="true")&&(Es=_,od=d,$i=null);break;case"focusout":$i=od=Es=null;break;case"mousedown":ad=!0;break;case"contextmenu":case"mouseup":case"dragend":ad=!1,Ju(h,r,u);break;case"selectionchange":if(uk)break;case"keydown":case"keyup":Ju(h,r,u)}var E;if(yh)e:{switch(t){case"compositionstart":var D="onCompositionStart";break e;case"compositionend":D="onCompositionEnd";break e;case"compositionupdate":D="onCompositionUpdate";break e}D=void 0}else Ps?tf(t,r)&&(D="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(D="onCompositionStart");D&&(ef&&r.locale!=="ko"&&(Ps||D!=="onCompositionStart"?D==="onCompositionEnd"&&Ps&&(E=Zx()):(kr=u,fh="value"in kr?kr.value:kr.textContent,Ps=!0)),_=Uo(d,D),0<_.length&&(D=new zu(D,t,null,r,u),h.push({event:D,listeners:_}),E?D.data=E:(E=nf(r),E!==null&&(D.data=E)))),(E=ek?tk(t,r):nk(t,r))&&(d=Uo(d,"onBeforeInput"),0<d.length&&(u=new zu("onBeforeInput","beforeinput",null,r,u),h.push({event:u,listeners:d}),u.data=E))}xf(h,n)})}function ul(t,n,r){return{instance:t,listener:n,currentTarget:r}}function Uo(t,n){for(var r=n+"Capture",s=[];t!==null;){var i=t,l=i.stateNode;i.tag===5&&l!==null&&(i=l,l=il(t,r),l!=null&&s.unshift(ul(t,l,i)),l=il(t,n),l!=null&&s.push(ul(t,l,i))),t=t.return}return s}function bs(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function tm(t,n,r,s,i){for(var l=n._reactName,o=[];r!==null&&r!==s;){var a=r,c=a.alternate,d=a.stateNode;if(c!==null&&c===s)break;a.tag===5&&d!==null&&(a=d,i?(c=il(r,l),c!=null&&o.unshift(ul(r,c,a))):i||(c=il(r,l),c!=null&&o.push(ul(r,c,a)))),r=r.return}o.length!==0&&t.push({event:n,listeners:o})}var fk=/\r\n?/g,gk=/\u0000|\uFFFD/g;function nm(t){return(typeof t=="string"?t:""+t).replace(fk,`
`).replace(gk,"")}function no(t,n,r){if(n=nm(n),nm(t)!==n&&r)throw Error(oe(425))}function Ko(){}var cd=null,dd=null;function hd(t,n){return t==="textarea"||t==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var ud=typeof setTimeout=="function"?setTimeout:void 0,jk=typeof clearTimeout=="function"?clearTimeout:void 0,rm=typeof Promise=="function"?Promise:void 0,yk=typeof queueMicrotask=="function"?queueMicrotask:typeof rm<"u"?function(t){return rm.resolve(null).then(t).catch(bk)}:ud;function bk(t){setTimeout(function(){throw t})}function dc(t,n){var r=n,s=0;do{var i=r.nextSibling;if(t.removeChild(r),i&&i.nodeType===8)if(r=i.data,r==="/$"){if(s===0){t.removeChild(i),al(n);return}s--}else r!=="$"&&r!=="$?"&&r!=="$!"||s++;r=i}while(r);al(n)}function Cr(t){for(;t!=null;t=t.nextSibling){var n=t.nodeType;if(n===1||n===3)break;if(n===8){if(n=t.data,n==="$"||n==="$!"||n==="$?")break;if(n==="/$")return null}}return t}function sm(t){t=t.previousSibling;for(var n=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(n===0)return t;n--}else r==="/$"&&n++}t=t.previousSibling}return null}var oi=Math.random().toString(36).slice(2),Hn="__reactFiber$"+oi,ml="__reactProps$"+oi,ir="__reactContainer$"+oi,md="__reactEvents$"+oi,kk="__reactListeners$"+oi,vk="__reactHandles$"+oi;function Zr(t){var n=t[Hn];if(n)return n;for(var r=t.parentNode;r;){if(n=r[ir]||r[Hn]){if(r=n.alternate,n.child!==null||r!==null&&r.child!==null)for(t=sm(t);t!==null;){if(r=t[Hn])return r;t=sm(t)}return n}t=r,r=t.parentNode}return null}function Pl(t){return t=t[Hn]||t[ir],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ms(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(oe(33))}function ba(t){return t[ml]||null}var pd=[],Is=-1;function Or(t){return{current:t}}function Je(t){0>Is||(t.current=pd[Is],pd[Is]=null,Is--)}function Ye(t,n){Is++,pd[Is]=t.current,t.current=n}var Lr={},zt=Or(Lr),nn=Or(!1),is=Lr;function Ys(t,n){var r=t.type.contextTypes;if(!r)return Lr;var s=t.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===n)return s.__reactInternalMemoizedMaskedChildContext;var i={},l;for(l in r)i[l]=n[l];return s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=n,t.__reactInternalMemoizedMaskedChildContext=i),i}function rn(t){return t=t.childContextTypes,t!=null}function zo(){Je(nn),Je(zt)}function im(t,n,r){if(zt.current!==Lr)throw Error(oe(168));Ye(zt,n),Ye(nn,r)}function gf(t,n,r){var s=t.stateNode;if(n=n.childContextTypes,typeof s.getChildContext!="function")return r;s=s.getChildContext();for(var i in s)if(!(i in n))throw Error(oe(108,lb(t)||"Unknown",i));return ot({},r,s)}function Go(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Lr,is=zt.current,Ye(zt,t),Ye(nn,nn.current),!0}function lm(t,n,r){var s=t.stateNode;if(!s)throw Error(oe(169));r?(t=gf(t,n,is),s.__reactInternalMemoizedMergedChildContext=t,Je(nn),Je(zt),Ye(zt,t)):Je(nn),Ye(nn,r)}var Zn=null,ka=!1,hc=!1;function jf(t){Zn===null?Zn=[t]:Zn.push(t)}function wk(t){ka=!0,jf(t)}function qr(){if(!hc&&Zn!==null){hc=!0;var t=0,n=Ve;try{var r=Zn;for(Ve=1;t<r.length;t++){var s=r[t];do s=s(!0);while(s!==null)}Zn=null,ka=!1}catch(i){throw Zn!==null&&(Zn=Zn.slice(t+1)),Kx(uh,qr),i}finally{Ve=n,hc=!1}}return null}var As=[],Ds=0,Vo=null,Ho=0,bn=[],kn=0,ls=null,er=1,tr="";function Yr(t,n){As[Ds++]=Ho,As[Ds++]=Vo,Vo=t,Ho=n}function yf(t,n,r){bn[kn++]=er,bn[kn++]=tr,bn[kn++]=ls,ls=t;var s=er;t=tr;var i=32-Ln(s)-1;s&=~(1<<i),r+=1;var l=32-Ln(n)+i;if(30<l){var o=i-i%5;l=(s&(1<<o)-1).toString(32),s>>=o,i-=o,er=1<<32-Ln(n)+i|r<<i|s,tr=l+t}else er=1<<l|r<<i|s,tr=t}function kh(t){t.return!==null&&(Yr(t,1),yf(t,1,0))}function vh(t){for(;t===Vo;)Vo=As[--Ds],As[Ds]=null,Ho=As[--Ds],As[Ds]=null;for(;t===ls;)ls=bn[--kn],bn[kn]=null,tr=bn[--kn],bn[kn]=null,er=bn[--kn],bn[kn]=null}var pn=null,mn=null,rt=!1,An=null;function bf(t,n){var r=wn(5,null,null,0);r.elementType="DELETED",r.stateNode=n,r.return=t,n=t.deletions,n===null?(t.deletions=[r],t.flags|=16):n.push(r)}function om(t,n){switch(t.tag){case 5:var r=t.type;return n=n.nodeType!==1||r.toLowerCase()!==n.nodeName.toLowerCase()?null:n,n!==null?(t.stateNode=n,pn=t,mn=Cr(n.firstChild),!0):!1;case 6:return n=t.pendingProps===""||n.nodeType!==3?null:n,n!==null?(t.stateNode=n,pn=t,mn=null,!0):!1;case 13:return n=n.nodeType!==8?null:n,n!==null?(r=ls!==null?{id:er,overflow:tr}:null,t.memoizedState={dehydrated:n,treeContext:r,retryLane:1073741824},r=wn(18,null,null,0),r.stateNode=n,r.return=t,t.child=r,pn=t,mn=null,!0):!1;default:return!1}}function xd(t){return(t.mode&1)!==0&&(t.flags&128)===0}function fd(t){if(rt){var n=mn;if(n){var r=n;if(!om(t,n)){if(xd(t))throw Error(oe(418));n=Cr(r.nextSibling);var s=pn;n&&om(t,n)?bf(s,r):(t.flags=t.flags&-4097|2,rt=!1,pn=t)}}else{if(xd(t))throw Error(oe(418));t.flags=t.flags&-4097|2,rt=!1,pn=t}}}function am(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;pn=t}function ro(t){if(t!==pn)return!1;if(!rt)return am(t),rt=!0,!1;var n;if((n=t.tag!==3)&&!(n=t.tag!==5)&&(n=t.type,n=n!=="head"&&n!=="body"&&!hd(t.type,t.memoizedProps)),n&&(n=mn)){if(xd(t))throw kf(),Error(oe(418));for(;n;)bf(t,n),n=Cr(n.nextSibling)}if(am(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(oe(317));e:{for(t=t.nextSibling,n=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(n===0){mn=Cr(t.nextSibling);break e}n--}else r!=="$"&&r!=="$!"&&r!=="$?"||n++}t=t.nextSibling}mn=null}}else mn=pn?Cr(t.stateNode.nextSibling):null;return!0}function kf(){for(var t=mn;t;)t=Cr(t.nextSibling)}function Xs(){mn=pn=null,rt=!1}function wh(t){An===null?An=[t]:An.push(t)}var Nk=ar.ReactCurrentBatchConfig;function Si(t,n,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(oe(309));var s=r.stateNode}if(!s)throw Error(oe(147,t));var i=s,l=""+t;return n!==null&&n.ref!==null&&typeof n.ref=="function"&&n.ref._stringRef===l?n.ref:(n=function(o){var a=i.refs;o===null?delete a[l]:a[l]=o},n._stringRef=l,n)}if(typeof t!="string")throw Error(oe(284));if(!r._owner)throw Error(oe(290,t))}return t}function so(t,n){throw t=Object.prototype.toString.call(n),Error(oe(31,t==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":t))}function cm(t){var n=t._init;return n(t._payload)}function vf(t){function n(f,p){if(t){var g=f.deletions;g===null?(f.deletions=[p],f.flags|=16):g.push(p)}}function r(f,p){if(!t)return null;for(;p!==null;)n(f,p),p=p.sibling;return null}function s(f,p){for(f=new Map;p!==null;)p.key!==null?f.set(p.key,p):f.set(p.index,p),p=p.sibling;return f}function i(f,p){return f=Mr(f,p),f.index=0,f.sibling=null,f}function l(f,p,g){return f.index=g,t?(g=f.alternate,g!==null?(g=g.index,g<p?(f.flags|=2,p):g):(f.flags|=2,p)):(f.flags|=1048576,p)}function o(f){return t&&f.alternate===null&&(f.flags|=2),f}function a(f,p,g,k){return p===null||p.tag!==6?(p=jc(g,f.mode,k),p.return=f,p):(p=i(p,g),p.return=f,p)}function c(f,p,g,k){var S=g.type;return S===Cs?u(f,p,g.props.children,k,g.key):p!==null&&(p.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===fr&&cm(S)===p.type)?(k=i(p,g.props),k.ref=Si(f,p,g),k.return=f,k):(k=Ro(g.type,g.key,g.props,null,f.mode,k),k.ref=Si(f,p,g),k.return=f,k)}function d(f,p,g,k){return p===null||p.tag!==4||p.stateNode.containerInfo!==g.containerInfo||p.stateNode.implementation!==g.implementation?(p=yc(g,f.mode,k),p.return=f,p):(p=i(p,g.children||[]),p.return=f,p)}function u(f,p,g,k,S){return p===null||p.tag!==7?(p=rs(g,f.mode,k,S),p.return=f,p):(p=i(p,g),p.return=f,p)}function h(f,p,g){if(typeof p=="string"&&p!==""||typeof p=="number")return p=jc(""+p,f.mode,g),p.return=f,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case $l:return g=Ro(p.type,p.key,p.props,null,f.mode,g),g.ref=Si(f,null,p),g.return=f,g;case Ts:return p=yc(p,f.mode,g),p.return=f,p;case fr:var k=p._init;return h(f,k(p._payload),g)}if(Oi(p)||bi(p))return p=rs(p,f.mode,g,null),p.return=f,p;so(f,p)}return null}function m(f,p,g,k){var S=p!==null?p.key:null;if(typeof g=="string"&&g!==""||typeof g=="number")return S!==null?null:a(f,p,""+g,k);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case $l:return g.key===S?c(f,p,g,k):null;case Ts:return g.key===S?d(f,p,g,k):null;case fr:return S=g._init,m(f,p,S(g._payload),k)}if(Oi(g)||bi(g))return S!==null?null:u(f,p,g,k,null);so(f,g)}return null}function x(f,p,g,k,S){if(typeof k=="string"&&k!==""||typeof k=="number")return f=f.get(g)||null,a(p,f,""+k,S);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case $l:return f=f.get(k.key===null?g:k.key)||null,c(p,f,k,S);case Ts:return f=f.get(k.key===null?g:k.key)||null,d(p,f,k,S);case fr:var _=k._init;return x(f,p,g,_(k._payload),S)}if(Oi(k)||bi(k))return f=f.get(g)||null,u(p,f,k,S,null);so(p,k)}return null}function j(f,p,g,k){for(var S=null,_=null,E=p,D=p=0,L=null;E!==null&&D<g.length;D++){E.index>D?(L=E,E=null):L=E.sibling;var T=m(f,E,g[D],k);if(T===null){E===null&&(E=L);break}t&&E&&T.alternate===null&&n(f,E),p=l(T,p,D),_===null?S=T:_.sibling=T,_=T,E=L}if(D===g.length)return r(f,E),rt&&Yr(f,D),S;if(E===null){for(;D<g.length;D++)E=h(f,g[D],k),E!==null&&(p=l(E,p,D),_===null?S=E:_.sibling=E,_=E);return rt&&Yr(f,D),S}for(E=s(f,E);D<g.length;D++)L=x(E,f,D,g[D],k),L!==null&&(t&&L.alternate!==null&&E.delete(L.key===null?D:L.key),p=l(L,p,D),_===null?S=L:_.sibling=L,_=L);return t&&E.forEach(function(P){return n(f,P)}),rt&&Yr(f,D),S}function b(f,p,g,k){var S=bi(g);if(typeof S!="function")throw Error(oe(150));if(g=S.call(g),g==null)throw Error(oe(151));for(var _=S=null,E=p,D=p=0,L=null,T=g.next();E!==null&&!T.done;D++,T=g.next()){E.index>D?(L=E,E=null):L=E.sibling;var P=m(f,E,T.value,k);if(P===null){E===null&&(E=L);break}t&&E&&P.alternate===null&&n(f,E),p=l(P,p,D),_===null?S=P:_.sibling=P,_=P,E=L}if(T.done)return r(f,E),rt&&Yr(f,D),S;if(E===null){for(;!T.done;D++,T=g.next())T=h(f,T.value,k),T!==null&&(p=l(T,p,D),_===null?S=T:_.sibling=T,_=T);return rt&&Yr(f,D),S}for(E=s(f,E);!T.done;D++,T=g.next())T=x(E,f,D,T.value,k),T!==null&&(t&&T.alternate!==null&&E.delete(T.key===null?D:T.key),p=l(T,p,D),_===null?S=T:_.sibling=T,_=T);return t&&E.forEach(function(I){return n(f,I)}),rt&&Yr(f,D),S}function N(f,p,g,k){if(typeof g=="object"&&g!==null&&g.type===Cs&&g.key===null&&(g=g.props.children),typeof g=="object"&&g!==null){switch(g.$$typeof){case $l:e:{for(var S=g.key,_=p;_!==null;){if(_.key===S){if(S=g.type,S===Cs){if(_.tag===7){r(f,_.sibling),p=i(_,g.props.children),p.return=f,f=p;break e}}else if(_.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===fr&&cm(S)===_.type){r(f,_.sibling),p=i(_,g.props),p.ref=Si(f,_,g),p.return=f,f=p;break e}r(f,_);break}else n(f,_);_=_.sibling}g.type===Cs?(p=rs(g.props.children,f.mode,k,g.key),p.return=f,f=p):(k=Ro(g.type,g.key,g.props,null,f.mode,k),k.ref=Si(f,p,g),k.return=f,f=k)}return o(f);case Ts:e:{for(_=g.key;p!==null;){if(p.key===_)if(p.tag===4&&p.stateNode.containerInfo===g.containerInfo&&p.stateNode.implementation===g.implementation){r(f,p.sibling),p=i(p,g.children||[]),p.return=f,f=p;break e}else{r(f,p);break}else n(f,p);p=p.sibling}p=yc(g,f.mode,k),p.return=f,f=p}return o(f);case fr:return _=g._init,N(f,p,_(g._payload),k)}if(Oi(g))return j(f,p,g,k);if(bi(g))return b(f,p,g,k);so(f,g)}return typeof g=="string"&&g!==""||typeof g=="number"?(g=""+g,p!==null&&p.tag===6?(r(f,p.sibling),p=i(p,g),p.return=f,f=p):(r(f,p),p=jc(g,f.mode,k),p.return=f,f=p),o(f)):r(f,p)}return N}var Js=vf(!0),wf=vf(!1),$o=Or(null),Wo=null,Ls=null,Nh=null;function Sh(){Nh=Ls=Wo=null}function _h(t){var n=$o.current;Je($o),t._currentValue=n}function gd(t,n,r){for(;t!==null;){var s=t.alternate;if((t.childLanes&n)!==n?(t.childLanes|=n,s!==null&&(s.childLanes|=n)):s!==null&&(s.childLanes&n)!==n&&(s.childLanes|=n),t===r)break;t=t.return}}function Gs(t,n){Wo=t,Nh=Ls=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&n&&(en=!0),t.firstContext=null)}function Sn(t){var n=t._currentValue;if(Nh!==t)if(t={context:t,memoizedValue:n,next:null},Ls===null){if(Wo===null)throw Error(oe(308));Ls=t,Wo.dependencies={lanes:0,firstContext:t}}else Ls=Ls.next=t;return n}var es=null;function Th(t){es===null?es=[t]:es.push(t)}function Nf(t,n,r,s){var i=n.interleaved;return i===null?(r.next=r,Th(n)):(r.next=i.next,i.next=r),n.interleaved=r,lr(t,s)}function lr(t,n){t.lanes|=n;var r=t.alternate;for(r!==null&&(r.lanes|=n),r=t,t=t.return;t!==null;)t.childLanes|=n,r=t.alternate,r!==null&&(r.childLanes|=n),r=t,t=t.return;return r.tag===3?r.stateNode:null}var gr=!1;function Ch(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Sf(t,n){t=t.updateQueue,n.updateQueue===t&&(n.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function nr(t,n){return{eventTime:t,lane:n,tag:0,payload:null,callback:null,next:null}}function Pr(t,n,r){var s=t.updateQueue;if(s===null)return null;if(s=s.shared,Oe&2){var i=s.pending;return i===null?n.next=n:(n.next=i.next,i.next=n),s.pending=n,lr(t,r)}return i=s.interleaved,i===null?(n.next=n,Th(s)):(n.next=i.next,i.next=n),s.interleaved=n,lr(t,r)}function So(t,n,r){if(n=n.updateQueue,n!==null&&(n=n.shared,(r&4194240)!==0)){var s=n.lanes;s&=t.pendingLanes,r|=s,n.lanes=r,mh(t,r)}}function dm(t,n){var r=t.updateQueue,s=t.alternate;if(s!==null&&(s=s.updateQueue,r===s)){var i=null,l=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};l===null?i=l=o:l=l.next=o,r=r.next}while(r!==null);l===null?i=l=n:l=l.next=n}else i=l=n;r={baseState:s.baseState,firstBaseUpdate:i,lastBaseUpdate:l,shared:s.shared,effects:s.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=n:t.next=n,r.lastBaseUpdate=n}function Qo(t,n,r,s){var i=t.updateQueue;gr=!1;var l=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var c=a,d=c.next;c.next=null,o===null?l=d:o.next=d,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=d:a.next=d,u.lastBaseUpdate=c))}if(l!==null){var h=i.baseState;o=0,u=d=c=null,a=l;do{var m=a.lane,x=a.eventTime;if((s&m)===m){u!==null&&(u=u.next={eventTime:x,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var j=t,b=a;switch(m=n,x=r,b.tag){case 1:if(j=b.payload,typeof j=="function"){h=j.call(x,h,m);break e}h=j;break e;case 3:j.flags=j.flags&-65537|128;case 0:if(j=b.payload,m=typeof j=="function"?j.call(x,h,m):j,m==null)break e;h=ot({},h,m);break e;case 2:gr=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,m=i.effects,m===null?i.effects=[a]:m.push(a))}else x={eventTime:x,lane:m,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(d=u=x,c=h):u=u.next=x,o|=m;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;m=a,a=m.next,m.next=null,i.lastBaseUpdate=m,i.shared.pending=null}}while(!0);if(u===null&&(c=h),i.baseState=c,i.firstBaseUpdate=d,i.lastBaseUpdate=u,n=i.shared.interleaved,n!==null){i=n;do o|=i.lane,i=i.next;while(i!==n)}else l===null&&(i.shared.lanes=0);as|=o,t.lanes=o,t.memoizedState=h}}function hm(t,n,r){if(t=n.effects,n.effects=null,t!==null)for(n=0;n<t.length;n++){var s=t[n],i=s.callback;if(i!==null){if(s.callback=null,s=r,typeof i!="function")throw Error(oe(191,i));i.call(s)}}}var El={},Wn=Or(El),pl=Or(El),xl=Or(El);function ts(t){if(t===El)throw Error(oe(174));return t}function Ph(t,n){switch(Ye(xl,n),Ye(pl,t),Ye(Wn,El),t=n.nodeType,t){case 9:case 11:n=(n=n.documentElement)?n.namespaceURI:Xc(null,"");break;default:t=t===8?n.parentNode:n,n=t.namespaceURI||null,t=t.tagName,n=Xc(n,t)}Je(Wn),Ye(Wn,n)}function Zs(){Je(Wn),Je(pl),Je(xl)}function _f(t){ts(xl.current);var n=ts(Wn.current),r=Xc(n,t.type);n!==r&&(Ye(pl,t),Ye(Wn,r))}function Eh(t){pl.current===t&&(Je(Wn),Je(pl))}var it=Or(0);function Yo(t){for(var n=t;n!==null;){if(n.tag===13){var r=n.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if(n.flags&128)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var uc=[];function Rh(){for(var t=0;t<uc.length;t++)uc[t]._workInProgressVersionPrimary=null;uc.length=0}var _o=ar.ReactCurrentDispatcher,mc=ar.ReactCurrentBatchConfig,os=0,lt=null,vt=null,_t=null,Xo=!1,Wi=!1,fl=0,Sk=0;function qt(){throw Error(oe(321))}function Mh(t,n){if(n===null)return!1;for(var r=0;r<n.length&&r<t.length;r++)if(!qn(t[r],n[r]))return!1;return!0}function Ih(t,n,r,s,i,l){if(os=l,lt=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,_o.current=t===null||t.memoizedState===null?Pk:Ek,t=r(s,i),Wi){l=0;do{if(Wi=!1,fl=0,25<=l)throw Error(oe(301));l+=1,_t=vt=null,n.updateQueue=null,_o.current=Rk,t=r(s,i)}while(Wi)}if(_o.current=Jo,n=vt!==null&&vt.next!==null,os=0,_t=vt=lt=null,Xo=!1,n)throw Error(oe(300));return t}function Ah(){var t=fl!==0;return fl=0,t}function Kn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return _t===null?lt.memoizedState=_t=t:_t=_t.next=t,_t}function _n(){if(vt===null){var t=lt.alternate;t=t!==null?t.memoizedState:null}else t=vt.next;var n=_t===null?lt.memoizedState:_t.next;if(n!==null)_t=n,vt=t;else{if(t===null)throw Error(oe(310));vt=t,t={memoizedState:vt.memoizedState,baseState:vt.baseState,baseQueue:vt.baseQueue,queue:vt.queue,next:null},_t===null?lt.memoizedState=_t=t:_t=_t.next=t}return _t}function gl(t,n){return typeof n=="function"?n(t):n}function pc(t){var n=_n(),r=n.queue;if(r===null)throw Error(oe(311));r.lastRenderedReducer=t;var s=vt,i=s.baseQueue,l=r.pending;if(l!==null){if(i!==null){var o=i.next;i.next=l.next,l.next=o}s.baseQueue=i=l,r.pending=null}if(i!==null){l=i.next,s=s.baseState;var a=o=null,c=null,d=l;do{var u=d.lane;if((os&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),s=d.hasEagerState?d.eagerState:t(s,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(a=c=h,o=s):c=c.next=h,lt.lanes|=u,as|=u}d=d.next}while(d!==null&&d!==l);c===null?o=s:c.next=a,qn(s,n.memoizedState)||(en=!0),n.memoizedState=s,n.baseState=o,n.baseQueue=c,r.lastRenderedState=s}if(t=r.interleaved,t!==null){i=t;do l=i.lane,lt.lanes|=l,as|=l,i=i.next;while(i!==t)}else i===null&&(r.lanes=0);return[n.memoizedState,r.dispatch]}function xc(t){var n=_n(),r=n.queue;if(r===null)throw Error(oe(311));r.lastRenderedReducer=t;var s=r.dispatch,i=r.pending,l=n.memoizedState;if(i!==null){r.pending=null;var o=i=i.next;do l=t(l,o.action),o=o.next;while(o!==i);qn(l,n.memoizedState)||(en=!0),n.memoizedState=l,n.baseQueue===null&&(n.baseState=l),r.lastRenderedState=l}return[l,s]}function Tf(){}function Cf(t,n){var r=lt,s=_n(),i=n(),l=!qn(s.memoizedState,i);if(l&&(s.memoizedState=i,en=!0),s=s.queue,Dh(Rf.bind(null,r,s,t),[t]),s.getSnapshot!==n||l||_t!==null&&_t.memoizedState.tag&1){if(r.flags|=2048,jl(9,Ef.bind(null,r,s,i,n),void 0,null),Tt===null)throw Error(oe(349));os&30||Pf(r,n,i)}return i}function Pf(t,n,r){t.flags|=16384,t={getSnapshot:n,value:r},n=lt.updateQueue,n===null?(n={lastEffect:null,stores:null},lt.updateQueue=n,n.stores=[t]):(r=n.stores,r===null?n.stores=[t]:r.push(t))}function Ef(t,n,r,s){n.value=r,n.getSnapshot=s,Mf(n)&&If(t)}function Rf(t,n,r){return r(function(){Mf(n)&&If(t)})}function Mf(t){var n=t.getSnapshot;t=t.value;try{var r=n();return!qn(t,r)}catch{return!0}}function If(t){var n=lr(t,1);n!==null&&Fn(n,t,1,-1)}function um(t){var n=Kn();return typeof t=="function"&&(t=t()),n.memoizedState=n.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:gl,lastRenderedState:t},n.queue=t,t=t.dispatch=Ck.bind(null,lt,t),[n.memoizedState,t]}function jl(t,n,r,s){return t={tag:t,create:n,destroy:r,deps:s,next:null},n=lt.updateQueue,n===null?(n={lastEffect:null,stores:null},lt.updateQueue=n,n.lastEffect=t.next=t):(r=n.lastEffect,r===null?n.lastEffect=t.next=t:(s=r.next,r.next=t,t.next=s,n.lastEffect=t)),t}function Af(){return _n().memoizedState}function To(t,n,r,s){var i=Kn();lt.flags|=t,i.memoizedState=jl(1|n,r,void 0,s===void 0?null:s)}function va(t,n,r,s){var i=_n();s=s===void 0?null:s;var l=void 0;if(vt!==null){var o=vt.memoizedState;if(l=o.destroy,s!==null&&Mh(s,o.deps)){i.memoizedState=jl(n,r,l,s);return}}lt.flags|=t,i.memoizedState=jl(1|n,r,l,s)}function mm(t,n){return To(8390656,8,t,n)}function Dh(t,n){return va(2048,8,t,n)}function Df(t,n){return va(4,2,t,n)}function Lf(t,n){return va(4,4,t,n)}function Ff(t,n){if(typeof n=="function")return t=t(),n(t),function(){n(null)};if(n!=null)return t=t(),n.current=t,function(){n.current=null}}function Of(t,n,r){return r=r!=null?r.concat([t]):null,va(4,4,Ff.bind(null,n,t),r)}function Lh(){}function qf(t,n){var r=_n();n=n===void 0?null:n;var s=r.memoizedState;return s!==null&&n!==null&&Mh(n,s[1])?s[0]:(r.memoizedState=[t,n],t)}function Bf(t,n){var r=_n();n=n===void 0?null:n;var s=r.memoizedState;return s!==null&&n!==null&&Mh(n,s[1])?s[0]:(t=t(),r.memoizedState=[t,n],t)}function Uf(t,n,r){return os&21?(qn(r,n)||(r=Vx(),lt.lanes|=r,as|=r,t.baseState=!0),n):(t.baseState&&(t.baseState=!1,en=!0),t.memoizedState=r)}function _k(t,n){var r=Ve;Ve=r!==0&&4>r?r:4,t(!0);var s=mc.transition;mc.transition={};try{t(!1),n()}finally{Ve=r,mc.transition=s}}function Kf(){return _n().memoizedState}function Tk(t,n,r){var s=Rr(t);if(r={lane:s,action:r,hasEagerState:!1,eagerState:null,next:null},zf(t))Gf(n,r);else if(r=Nf(t,n,r,s),r!==null){var i=Qt();Fn(r,t,s,i),Vf(r,n,s)}}function Ck(t,n,r){var s=Rr(t),i={lane:s,action:r,hasEagerState:!1,eagerState:null,next:null};if(zf(t))Gf(n,i);else{var l=t.alternate;if(t.lanes===0&&(l===null||l.lanes===0)&&(l=n.lastRenderedReducer,l!==null))try{var o=n.lastRenderedState,a=l(o,r);if(i.hasEagerState=!0,i.eagerState=a,qn(a,o)){var c=n.interleaved;c===null?(i.next=i,Th(n)):(i.next=c.next,c.next=i),n.interleaved=i;return}}catch{}finally{}r=Nf(t,n,i,s),r!==null&&(i=Qt(),Fn(r,t,s,i),Vf(r,n,s))}}function zf(t){var n=t.alternate;return t===lt||n!==null&&n===lt}function Gf(t,n){Wi=Xo=!0;var r=t.pending;r===null?n.next=n:(n.next=r.next,r.next=n),t.pending=n}function Vf(t,n,r){if(r&4194240){var s=n.lanes;s&=t.pendingLanes,r|=s,n.lanes=r,mh(t,r)}}var Jo={readContext:Sn,useCallback:qt,useContext:qt,useEffect:qt,useImperativeHandle:qt,useInsertionEffect:qt,useLayoutEffect:qt,useMemo:qt,useReducer:qt,useRef:qt,useState:qt,useDebugValue:qt,useDeferredValue:qt,useTransition:qt,useMutableSource:qt,useSyncExternalStore:qt,useId:qt,unstable_isNewReconciler:!1},Pk={readContext:Sn,useCallback:function(t,n){return Kn().memoizedState=[t,n===void 0?null:n],t},useContext:Sn,useEffect:mm,useImperativeHandle:function(t,n,r){return r=r!=null?r.concat([t]):null,To(4194308,4,Ff.bind(null,n,t),r)},useLayoutEffect:function(t,n){return To(4194308,4,t,n)},useInsertionEffect:function(t,n){return To(4,2,t,n)},useMemo:function(t,n){var r=Kn();return n=n===void 0?null:n,t=t(),r.memoizedState=[t,n],t},useReducer:function(t,n,r){var s=Kn();return n=r!==void 0?r(n):n,s.memoizedState=s.baseState=n,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:n},s.queue=t,t=t.dispatch=Tk.bind(null,lt,t),[s.memoizedState,t]},useRef:function(t){var n=Kn();return t={current:t},n.memoizedState=t},useState:um,useDebugValue:Lh,useDeferredValue:function(t){return Kn().memoizedState=t},useTransition:function(){var t=um(!1),n=t[0];return t=_k.bind(null,t[1]),Kn().memoizedState=t,[n,t]},useMutableSource:function(){},useSyncExternalStore:function(t,n,r){var s=lt,i=Kn();if(rt){if(r===void 0)throw Error(oe(407));r=r()}else{if(r=n(),Tt===null)throw Error(oe(349));os&30||Pf(s,n,r)}i.memoizedState=r;var l={value:r,getSnapshot:n};return i.queue=l,mm(Rf.bind(null,s,l,t),[t]),s.flags|=2048,jl(9,Ef.bind(null,s,l,r,n),void 0,null),r},useId:function(){var t=Kn(),n=Tt.identifierPrefix;if(rt){var r=tr,s=er;r=(s&~(1<<32-Ln(s)-1)).toString(32)+r,n=":"+n+"R"+r,r=fl++,0<r&&(n+="H"+r.toString(32)),n+=":"}else r=Sk++,n=":"+n+"r"+r.toString(32)+":";return t.memoizedState=n},unstable_isNewReconciler:!1},Ek={readContext:Sn,useCallback:qf,useContext:Sn,useEffect:Dh,useImperativeHandle:Of,useInsertionEffect:Df,useLayoutEffect:Lf,useMemo:Bf,useReducer:pc,useRef:Af,useState:function(){return pc(gl)},useDebugValue:Lh,useDeferredValue:function(t){var n=_n();return Uf(n,vt.memoizedState,t)},useTransition:function(){var t=pc(gl)[0],n=_n().memoizedState;return[t,n]},useMutableSource:Tf,useSyncExternalStore:Cf,useId:Kf,unstable_isNewReconciler:!1},Rk={readContext:Sn,useCallback:qf,useContext:Sn,useEffect:Dh,useImperativeHandle:Of,useInsertionEffect:Df,useLayoutEffect:Lf,useMemo:Bf,useReducer:xc,useRef:Af,useState:function(){return xc(gl)},useDebugValue:Lh,useDeferredValue:function(t){var n=_n();return vt===null?n.memoizedState=t:Uf(n,vt.memoizedState,t)},useTransition:function(){var t=xc(gl)[0],n=_n().memoizedState;return[t,n]},useMutableSource:Tf,useSyncExternalStore:Cf,useId:Kf,unstable_isNewReconciler:!1};function Mn(t,n){if(t&&t.defaultProps){n=ot({},n),t=t.defaultProps;for(var r in t)n[r]===void 0&&(n[r]=t[r]);return n}return n}function jd(t,n,r,s){n=t.memoizedState,r=r(s,n),r=r==null?n:ot({},n,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var wa={isMounted:function(t){return(t=t._reactInternals)?ms(t)===t:!1},enqueueSetState:function(t,n,r){t=t._reactInternals;var s=Qt(),i=Rr(t),l=nr(s,i);l.payload=n,r!=null&&(l.callback=r),n=Pr(t,l,i),n!==null&&(Fn(n,t,i,s),So(n,t,i))},enqueueReplaceState:function(t,n,r){t=t._reactInternals;var s=Qt(),i=Rr(t),l=nr(s,i);l.tag=1,l.payload=n,r!=null&&(l.callback=r),n=Pr(t,l,i),n!==null&&(Fn(n,t,i,s),So(n,t,i))},enqueueForceUpdate:function(t,n){t=t._reactInternals;var r=Qt(),s=Rr(t),i=nr(r,s);i.tag=2,n!=null&&(i.callback=n),n=Pr(t,i,s),n!==null&&(Fn(n,t,s,r),So(n,t,s))}};function pm(t,n,r,s,i,l,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(s,l,o):n.prototype&&n.prototype.isPureReactComponent?!dl(r,s)||!dl(i,l):!0}function Hf(t,n,r){var s=!1,i=Lr,l=n.contextType;return typeof l=="object"&&l!==null?l=Sn(l):(i=rn(n)?is:zt.current,s=n.contextTypes,l=(s=s!=null)?Ys(t,i):Lr),n=new n(r,l),t.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,n.updater=wa,t.stateNode=n,n._reactInternals=t,s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=l),n}function xm(t,n,r,s){t=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(r,s),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(r,s),n.state!==t&&wa.enqueueReplaceState(n,n.state,null)}function yd(t,n,r,s){var i=t.stateNode;i.props=r,i.state=t.memoizedState,i.refs={},Ch(t);var l=n.contextType;typeof l=="object"&&l!==null?i.context=Sn(l):(l=rn(n)?is:zt.current,i.context=Ys(t,l)),i.state=t.memoizedState,l=n.getDerivedStateFromProps,typeof l=="function"&&(jd(t,n,l,r),i.state=t.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(n=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),n!==i.state&&wa.enqueueReplaceState(i,i.state,null),Qo(t,r,i,s),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function ei(t,n){try{var r="",s=n;do r+=ib(s),s=s.return;while(s);var i=r}catch(l){i=`
Error generating stack: `+l.message+`
`+l.stack}return{value:t,source:n,stack:i,digest:null}}function fc(t,n,r){return{value:t,source:null,stack:r??null,digest:n??null}}function bd(t,n){try{console.error(n.value)}catch(r){setTimeout(function(){throw r})}}var Mk=typeof WeakMap=="function"?WeakMap:Map;function $f(t,n,r){r=nr(-1,r),r.tag=3,r.payload={element:null};var s=n.value;return r.callback=function(){ea||(ea=!0,Ed=s),bd(t,n)},r}function Wf(t,n,r){r=nr(-1,r),r.tag=3;var s=t.type.getDerivedStateFromError;if(typeof s=="function"){var i=n.value;r.payload=function(){return s(i)},r.callback=function(){bd(t,n)}}var l=t.stateNode;return l!==null&&typeof l.componentDidCatch=="function"&&(r.callback=function(){bd(t,n),typeof s!="function"&&(Er===null?Er=new Set([this]):Er.add(this));var o=n.stack;this.componentDidCatch(n.value,{componentStack:o!==null?o:""})}),r}function fm(t,n,r){var s=t.pingCache;if(s===null){s=t.pingCache=new Mk;var i=new Set;s.set(n,i)}else i=s.get(n),i===void 0&&(i=new Set,s.set(n,i));i.has(r)||(i.add(r),t=Hk.bind(null,t,n,r),n.then(t,t))}function gm(t){do{var n;if((n=t.tag===13)&&(n=t.memoizedState,n=n!==null?n.dehydrated!==null:!0),n)return t;t=t.return}while(t!==null);return null}function jm(t,n,r,s,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===n?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(n=nr(-1,1),n.tag=2,Pr(r,n,1))),r.lanes|=1),t)}var Ik=ar.ReactCurrentOwner,en=!1;function $t(t,n,r,s){n.child=t===null?wf(n,null,r,s):Js(n,t.child,r,s)}function ym(t,n,r,s,i){r=r.render;var l=n.ref;return Gs(n,i),s=Ih(t,n,r,s,l,i),r=Ah(),t!==null&&!en?(n.updateQueue=t.updateQueue,n.flags&=-2053,t.lanes&=~i,or(t,n,i)):(rt&&r&&kh(n),n.flags|=1,$t(t,n,s,i),n.child)}function bm(t,n,r,s,i){if(t===null){var l=r.type;return typeof l=="function"&&!Gh(l)&&l.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(n.tag=15,n.type=l,Qf(t,n,l,s,i)):(t=Ro(r.type,null,s,n,n.mode,i),t.ref=n.ref,t.return=n,n.child=t)}if(l=t.child,!(t.lanes&i)){var o=l.memoizedProps;if(r=r.compare,r=r!==null?r:dl,r(o,s)&&t.ref===n.ref)return or(t,n,i)}return n.flags|=1,t=Mr(l,s),t.ref=n.ref,t.return=n,n.child=t}function Qf(t,n,r,s,i){if(t!==null){var l=t.memoizedProps;if(dl(l,s)&&t.ref===n.ref)if(en=!1,n.pendingProps=s=l,(t.lanes&i)!==0)t.flags&131072&&(en=!0);else return n.lanes=t.lanes,or(t,n,i)}return kd(t,n,r,s,i)}function Yf(t,n,r){var s=n.pendingProps,i=s.children,l=t!==null?t.memoizedState:null;if(s.mode==="hidden")if(!(n.mode&1))n.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ye(Os,un),un|=r;else{if(!(r&1073741824))return t=l!==null?l.baseLanes|r:r,n.lanes=n.childLanes=1073741824,n.memoizedState={baseLanes:t,cachePool:null,transitions:null},n.updateQueue=null,Ye(Os,un),un|=t,null;n.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=l!==null?l.baseLanes:r,Ye(Os,un),un|=s}else l!==null?(s=l.baseLanes|r,n.memoizedState=null):s=r,Ye(Os,un),un|=s;return $t(t,n,i,r),n.child}function Xf(t,n){var r=n.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(n.flags|=512,n.flags|=2097152)}function kd(t,n,r,s,i){var l=rn(r)?is:zt.current;return l=Ys(n,l),Gs(n,i),r=Ih(t,n,r,s,l,i),s=Ah(),t!==null&&!en?(n.updateQueue=t.updateQueue,n.flags&=-2053,t.lanes&=~i,or(t,n,i)):(rt&&s&&kh(n),n.flags|=1,$t(t,n,r,i),n.child)}function km(t,n,r,s,i){if(rn(r)){var l=!0;Go(n)}else l=!1;if(Gs(n,i),n.stateNode===null)Co(t,n),Hf(n,r,s),yd(n,r,s,i),s=!0;else if(t===null){var o=n.stateNode,a=n.memoizedProps;o.props=a;var c=o.context,d=r.contextType;typeof d=="object"&&d!==null?d=Sn(d):(d=rn(r)?is:zt.current,d=Ys(n,d));var u=r.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==s||c!==d)&&xm(n,o,s,d),gr=!1;var m=n.memoizedState;o.state=m,Qo(n,s,o,i),c=n.memoizedState,a!==s||m!==c||nn.current||gr?(typeof u=="function"&&(jd(n,r,u,s),c=n.memoizedState),(a=gr||pm(n,r,a,s,m,c,d))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(n.flags|=4194308)):(typeof o.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=s,n.memoizedState=c),o.props=s,o.state=c,o.context=d,s=a):(typeof o.componentDidMount=="function"&&(n.flags|=4194308),s=!1)}else{o=n.stateNode,Sf(t,n),a=n.memoizedProps,d=n.type===n.elementType?a:Mn(n.type,a),o.props=d,h=n.pendingProps,m=o.context,c=r.contextType,typeof c=="object"&&c!==null?c=Sn(c):(c=rn(r)?is:zt.current,c=Ys(n,c));var x=r.getDerivedStateFromProps;(u=typeof x=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||m!==c)&&xm(n,o,s,c),gr=!1,m=n.memoizedState,o.state=m,Qo(n,s,o,i);var j=n.memoizedState;a!==h||m!==j||nn.current||gr?(typeof x=="function"&&(jd(n,r,x,s),j=n.memoizedState),(d=gr||pm(n,r,d,s,m,j,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(s,j,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(s,j,c)),typeof o.componentDidUpdate=="function"&&(n.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&m===t.memoizedState||(n.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&m===t.memoizedState||(n.flags|=1024),n.memoizedProps=s,n.memoizedState=j),o.props=s,o.state=j,o.context=c,s=d):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&m===t.memoizedState||(n.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&m===t.memoizedState||(n.flags|=1024),s=!1)}return vd(t,n,r,s,l,i)}function vd(t,n,r,s,i,l){Xf(t,n);var o=(n.flags&128)!==0;if(!s&&!o)return i&&lm(n,r,!1),or(t,n,l);s=n.stateNode,Ik.current=n;var a=o&&typeof r.getDerivedStateFromError!="function"?null:s.render();return n.flags|=1,t!==null&&o?(n.child=Js(n,t.child,null,l),n.child=Js(n,null,a,l)):$t(t,n,a,l),n.memoizedState=s.state,i&&lm(n,r,!0),n.child}function Jf(t){var n=t.stateNode;n.pendingContext?im(t,n.pendingContext,n.pendingContext!==n.context):n.context&&im(t,n.context,!1),Ph(t,n.containerInfo)}function vm(t,n,r,s,i){return Xs(),wh(i),n.flags|=256,$t(t,n,r,s),n.child}var wd={dehydrated:null,treeContext:null,retryLane:0};function Nd(t){return{baseLanes:t,cachePool:null,transitions:null}}function Zf(t,n,r){var s=n.pendingProps,i=it.current,l=!1,o=(n.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(l=!0,n.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),Ye(it,i&1),t===null)return fd(n),t=n.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(n.mode&1?t.data==="$!"?n.lanes=8:n.lanes=1073741824:n.lanes=1,null):(o=s.children,t=s.fallback,l?(s=n.mode,l=n.child,o={mode:"hidden",children:o},!(s&1)&&l!==null?(l.childLanes=0,l.pendingProps=o):l=_a(o,s,0,null),t=rs(t,s,r,null),l.return=n,t.return=n,l.sibling=t,n.child=l,n.child.memoizedState=Nd(r),n.memoizedState=wd,t):Fh(n,o));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return Ak(t,n,o,s,a,i,r);if(l){l=s.fallback,o=n.mode,i=t.child,a=i.sibling;var c={mode:"hidden",children:s.children};return!(o&1)&&n.child!==i?(s=n.child,s.childLanes=0,s.pendingProps=c,n.deletions=null):(s=Mr(i,c),s.subtreeFlags=i.subtreeFlags&14680064),a!==null?l=Mr(a,l):(l=rs(l,o,r,null),l.flags|=2),l.return=n,s.return=n,s.sibling=l,n.child=s,s=l,l=n.child,o=t.child.memoizedState,o=o===null?Nd(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},l.memoizedState=o,l.childLanes=t.childLanes&~r,n.memoizedState=wd,s}return l=t.child,t=l.sibling,s=Mr(l,{mode:"visible",children:s.children}),!(n.mode&1)&&(s.lanes=r),s.return=n,s.sibling=null,t!==null&&(r=n.deletions,r===null?(n.deletions=[t],n.flags|=16):r.push(t)),n.child=s,n.memoizedState=null,s}function Fh(t,n){return n=_a({mode:"visible",children:n},t.mode,0,null),n.return=t,t.child=n}function io(t,n,r,s){return s!==null&&wh(s),Js(n,t.child,null,r),t=Fh(n,n.pendingProps.children),t.flags|=2,n.memoizedState=null,t}function Ak(t,n,r,s,i,l,o){if(r)return n.flags&256?(n.flags&=-257,s=fc(Error(oe(422))),io(t,n,o,s)):n.memoizedState!==null?(n.child=t.child,n.flags|=128,null):(l=s.fallback,i=n.mode,s=_a({mode:"visible",children:s.children},i,0,null),l=rs(l,i,o,null),l.flags|=2,s.return=n,l.return=n,s.sibling=l,n.child=s,n.mode&1&&Js(n,t.child,null,o),n.child.memoizedState=Nd(o),n.memoizedState=wd,l);if(!(n.mode&1))return io(t,n,o,null);if(i.data==="$!"){if(s=i.nextSibling&&i.nextSibling.dataset,s)var a=s.dgst;return s=a,l=Error(oe(419)),s=fc(l,s,void 0),io(t,n,o,s)}if(a=(o&t.childLanes)!==0,en||a){if(s=Tt,s!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(s.suspendedLanes|o)?0:i,i!==0&&i!==l.retryLane&&(l.retryLane=i,lr(t,i),Fn(s,t,i,-1))}return zh(),s=fc(Error(oe(421))),io(t,n,o,s)}return i.data==="$?"?(n.flags|=128,n.child=t.child,n=$k.bind(null,t),i._reactRetry=n,null):(t=l.treeContext,mn=Cr(i.nextSibling),pn=n,rt=!0,An=null,t!==null&&(bn[kn++]=er,bn[kn++]=tr,bn[kn++]=ls,er=t.id,tr=t.overflow,ls=n),n=Fh(n,s.children),n.flags|=4096,n)}function wm(t,n,r){t.lanes|=n;var s=t.alternate;s!==null&&(s.lanes|=n),gd(t.return,n,r)}function gc(t,n,r,s,i){var l=t.memoizedState;l===null?t.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:s,tail:r,tailMode:i}:(l.isBackwards=n,l.rendering=null,l.renderingStartTime=0,l.last=s,l.tail=r,l.tailMode=i)}function eg(t,n,r){var s=n.pendingProps,i=s.revealOrder,l=s.tail;if($t(t,n,s.children,r),s=it.current,s&2)s=s&1|2,n.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=n.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&wm(t,r,n);else if(t.tag===19)wm(t,r,n);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===n)break e;for(;t.sibling===null;){if(t.return===null||t.return===n)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}s&=1}if(Ye(it,s),!(n.mode&1))n.memoizedState=null;else switch(i){case"forwards":for(r=n.child,i=null;r!==null;)t=r.alternate,t!==null&&Yo(t)===null&&(i=r),r=r.sibling;r=i,r===null?(i=n.child,n.child=null):(i=r.sibling,r.sibling=null),gc(n,!1,i,r,l);break;case"backwards":for(r=null,i=n.child,n.child=null;i!==null;){if(t=i.alternate,t!==null&&Yo(t)===null){n.child=i;break}t=i.sibling,i.sibling=r,r=i,i=t}gc(n,!0,r,null,l);break;case"together":gc(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function Co(t,n){!(n.mode&1)&&t!==null&&(t.alternate=null,n.alternate=null,n.flags|=2)}function or(t,n,r){if(t!==null&&(n.dependencies=t.dependencies),as|=n.lanes,!(r&n.childLanes))return null;if(t!==null&&n.child!==t.child)throw Error(oe(153));if(n.child!==null){for(t=n.child,r=Mr(t,t.pendingProps),n.child=r,r.return=n;t.sibling!==null;)t=t.sibling,r=r.sibling=Mr(t,t.pendingProps),r.return=n;r.sibling=null}return n.child}function Dk(t,n,r){switch(n.tag){case 3:Jf(n),Xs();break;case 5:_f(n);break;case 1:rn(n.type)&&Go(n);break;case 4:Ph(n,n.stateNode.containerInfo);break;case 10:var s=n.type._context,i=n.memoizedProps.value;Ye($o,s._currentValue),s._currentValue=i;break;case 13:if(s=n.memoizedState,s!==null)return s.dehydrated!==null?(Ye(it,it.current&1),n.flags|=128,null):r&n.child.childLanes?Zf(t,n,r):(Ye(it,it.current&1),t=or(t,n,r),t!==null?t.sibling:null);Ye(it,it.current&1);break;case 19:if(s=(r&n.childLanes)!==0,t.flags&128){if(s)return eg(t,n,r);n.flags|=128}if(i=n.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ye(it,it.current),s)break;return null;case 22:case 23:return n.lanes=0,Yf(t,n,r)}return or(t,n,r)}var tg,Sd,ng,rg;tg=function(t,n){for(var r=n.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};Sd=function(){};ng=function(t,n,r,s){var i=t.memoizedProps;if(i!==s){t=n.stateNode,ts(Wn.current);var l=null;switch(r){case"input":i=$c(t,i),s=$c(t,s),l=[];break;case"select":i=ot({},i,{value:void 0}),s=ot({},s,{value:void 0}),l=[];break;case"textarea":i=Yc(t,i),s=Yc(t,s),l=[];break;default:typeof i.onClick!="function"&&typeof s.onClick=="function"&&(t.onclick=Ko)}Jc(r,s);var o;r=null;for(d in i)if(!s.hasOwnProperty(d)&&i.hasOwnProperty(d)&&i[d]!=null)if(d==="style"){var a=i[d];for(o in a)a.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(rl.hasOwnProperty(d)?l||(l=[]):(l=l||[]).push(d,null));for(d in s){var c=s[d];if(a=i!=null?i[d]:void 0,s.hasOwnProperty(d)&&c!==a&&(c!=null||a!=null))if(d==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(r||(r={}),r[o]=c[o])}else r||(l||(l=[]),l.push(d,r)),r=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(l=l||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(l=l||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(rl.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Xe("scroll",t),l||a===c||(l=[])):(l=l||[]).push(d,c))}r&&(l=l||[]).push("style",r);var d=l;(n.updateQueue=d)&&(n.flags|=4)}};rg=function(t,n,r,s){r!==s&&(n.flags|=4)};function _i(t,n){if(!rt)switch(t.tailMode){case"hidden":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var s=null;r!==null;)r.alternate!==null&&(s=r),r=r.sibling;s===null?n||t.tail===null?t.tail=null:t.tail.sibling=null:s.sibling=null}}function Bt(t){var n=t.alternate!==null&&t.alternate.child===t.child,r=0,s=0;if(n)for(var i=t.child;i!==null;)r|=i.lanes|i.childLanes,s|=i.subtreeFlags&14680064,s|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)r|=i.lanes|i.childLanes,s|=i.subtreeFlags,s|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=s,t.childLanes=r,n}function Lk(t,n,r){var s=n.pendingProps;switch(vh(n),n.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Bt(n),null;case 1:return rn(n.type)&&zo(),Bt(n),null;case 3:return s=n.stateNode,Zs(),Je(nn),Je(zt),Rh(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(ro(n)?n.flags|=4:t===null||t.memoizedState.isDehydrated&&!(n.flags&256)||(n.flags|=1024,An!==null&&(Id(An),An=null))),Sd(t,n),Bt(n),null;case 5:Eh(n);var i=ts(xl.current);if(r=n.type,t!==null&&n.stateNode!=null)ng(t,n,r,s,i),t.ref!==n.ref&&(n.flags|=512,n.flags|=2097152);else{if(!s){if(n.stateNode===null)throw Error(oe(166));return Bt(n),null}if(t=ts(Wn.current),ro(n)){s=n.stateNode,r=n.type;var l=n.memoizedProps;switch(s[Hn]=n,s[ml]=l,t=(n.mode&1)!==0,r){case"dialog":Xe("cancel",s),Xe("close",s);break;case"iframe":case"object":case"embed":Xe("load",s);break;case"video":case"audio":for(i=0;i<Bi.length;i++)Xe(Bi[i],s);break;case"source":Xe("error",s);break;case"img":case"image":case"link":Xe("error",s),Xe("load",s);break;case"details":Xe("toggle",s);break;case"input":Mu(s,l),Xe("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!l.multiple},Xe("invalid",s);break;case"textarea":Au(s,l),Xe("invalid",s)}Jc(r,l),i=null;for(var o in l)if(l.hasOwnProperty(o)){var a=l[o];o==="children"?typeof a=="string"?s.textContent!==a&&(l.suppressHydrationWarning!==!0&&no(s.textContent,a,t),i=["children",a]):typeof a=="number"&&s.textContent!==""+a&&(l.suppressHydrationWarning!==!0&&no(s.textContent,a,t),i=["children",""+a]):rl.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Xe("scroll",s)}switch(r){case"input":Wl(s),Iu(s,l,!0);break;case"textarea":Wl(s),Du(s);break;case"select":case"option":break;default:typeof l.onClick=="function"&&(s.onclick=Ko)}s=i,n.updateQueue=s,s!==null&&(n.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Ex(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof s.is=="string"?t=o.createElement(r,{is:s.is}):(t=o.createElement(r),r==="select"&&(o=t,s.multiple?o.multiple=!0:s.size&&(o.size=s.size))):t=o.createElementNS(t,r),t[Hn]=n,t[ml]=s,tg(t,n,!1,!1),n.stateNode=t;e:{switch(o=Zc(r,s),r){case"dialog":Xe("cancel",t),Xe("close",t),i=s;break;case"iframe":case"object":case"embed":Xe("load",t),i=s;break;case"video":case"audio":for(i=0;i<Bi.length;i++)Xe(Bi[i],t);i=s;break;case"source":Xe("error",t),i=s;break;case"img":case"image":case"link":Xe("error",t),Xe("load",t),i=s;break;case"details":Xe("toggle",t),i=s;break;case"input":Mu(t,s),i=$c(t,s),Xe("invalid",t);break;case"option":i=s;break;case"select":t._wrapperState={wasMultiple:!!s.multiple},i=ot({},s,{value:void 0}),Xe("invalid",t);break;case"textarea":Au(t,s),i=Yc(t,s),Xe("invalid",t);break;default:i=s}Jc(r,i),a=i;for(l in a)if(a.hasOwnProperty(l)){var c=a[l];l==="style"?Ix(t,c):l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Rx(t,c)):l==="children"?typeof c=="string"?(r!=="textarea"||c!=="")&&sl(t,c):typeof c=="number"&&sl(t,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(rl.hasOwnProperty(l)?c!=null&&l==="onScroll"&&Xe("scroll",t):c!=null&&oh(t,l,c,o))}switch(r){case"input":Wl(t),Iu(t,s,!1);break;case"textarea":Wl(t),Du(t);break;case"option":s.value!=null&&t.setAttribute("value",""+Dr(s.value));break;case"select":t.multiple=!!s.multiple,l=s.value,l!=null?Bs(t,!!s.multiple,l,!1):s.defaultValue!=null&&Bs(t,!!s.multiple,s.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Ko)}switch(r){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(n.flags|=4)}n.ref!==null&&(n.flags|=512,n.flags|=2097152)}return Bt(n),null;case 6:if(t&&n.stateNode!=null)rg(t,n,t.memoizedProps,s);else{if(typeof s!="string"&&n.stateNode===null)throw Error(oe(166));if(r=ts(xl.current),ts(Wn.current),ro(n)){if(s=n.stateNode,r=n.memoizedProps,s[Hn]=n,(l=s.nodeValue!==r)&&(t=pn,t!==null))switch(t.tag){case 3:no(s.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&no(s.nodeValue,r,(t.mode&1)!==0)}l&&(n.flags|=4)}else s=(r.nodeType===9?r:r.ownerDocument).createTextNode(s),s[Hn]=n,n.stateNode=s}return Bt(n),null;case 13:if(Je(it),s=n.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(rt&&mn!==null&&n.mode&1&&!(n.flags&128))kf(),Xs(),n.flags|=98560,l=!1;else if(l=ro(n),s!==null&&s.dehydrated!==null){if(t===null){if(!l)throw Error(oe(318));if(l=n.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(oe(317));l[Hn]=n}else Xs(),!(n.flags&128)&&(n.memoizedState=null),n.flags|=4;Bt(n),l=!1}else An!==null&&(Id(An),An=null),l=!0;if(!l)return n.flags&65536?n:null}return n.flags&128?(n.lanes=r,n):(s=s!==null,s!==(t!==null&&t.memoizedState!==null)&&s&&(n.child.flags|=8192,n.mode&1&&(t===null||it.current&1?wt===0&&(wt=3):zh())),n.updateQueue!==null&&(n.flags|=4),Bt(n),null);case 4:return Zs(),Sd(t,n),t===null&&hl(n.stateNode.containerInfo),Bt(n),null;case 10:return _h(n.type._context),Bt(n),null;case 17:return rn(n.type)&&zo(),Bt(n),null;case 19:if(Je(it),l=n.memoizedState,l===null)return Bt(n),null;if(s=(n.flags&128)!==0,o=l.rendering,o===null)if(s)_i(l,!1);else{if(wt!==0||t!==null&&t.flags&128)for(t=n.child;t!==null;){if(o=Yo(t),o!==null){for(n.flags|=128,_i(l,!1),s=o.updateQueue,s!==null&&(n.updateQueue=s,n.flags|=4),n.subtreeFlags=0,s=r,r=n.child;r!==null;)l=r,t=s,l.flags&=14680066,o=l.alternate,o===null?(l.childLanes=0,l.lanes=t,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=o.childLanes,l.lanes=o.lanes,l.child=o.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=o.memoizedProps,l.memoizedState=o.memoizedState,l.updateQueue=o.updateQueue,l.type=o.type,t=o.dependencies,l.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return Ye(it,it.current&1|2),n.child}t=t.sibling}l.tail!==null&&ut()>ti&&(n.flags|=128,s=!0,_i(l,!1),n.lanes=4194304)}else{if(!s)if(t=Yo(o),t!==null){if(n.flags|=128,s=!0,r=t.updateQueue,r!==null&&(n.updateQueue=r,n.flags|=4),_i(l,!0),l.tail===null&&l.tailMode==="hidden"&&!o.alternate&&!rt)return Bt(n),null}else 2*ut()-l.renderingStartTime>ti&&r!==1073741824&&(n.flags|=128,s=!0,_i(l,!1),n.lanes=4194304);l.isBackwards?(o.sibling=n.child,n.child=o):(r=l.last,r!==null?r.sibling=o:n.child=o,l.last=o)}return l.tail!==null?(n=l.tail,l.rendering=n,l.tail=n.sibling,l.renderingStartTime=ut(),n.sibling=null,r=it.current,Ye(it,s?r&1|2:r&1),n):(Bt(n),null);case 22:case 23:return Kh(),s=n.memoizedState!==null,t!==null&&t.memoizedState!==null!==s&&(n.flags|=8192),s&&n.mode&1?un&1073741824&&(Bt(n),n.subtreeFlags&6&&(n.flags|=8192)):Bt(n),null;case 24:return null;case 25:return null}throw Error(oe(156,n.tag))}function Fk(t,n){switch(vh(n),n.tag){case 1:return rn(n.type)&&zo(),t=n.flags,t&65536?(n.flags=t&-65537|128,n):null;case 3:return Zs(),Je(nn),Je(zt),Rh(),t=n.flags,t&65536&&!(t&128)?(n.flags=t&-65537|128,n):null;case 5:return Eh(n),null;case 13:if(Je(it),t=n.memoizedState,t!==null&&t.dehydrated!==null){if(n.alternate===null)throw Error(oe(340));Xs()}return t=n.flags,t&65536?(n.flags=t&-65537|128,n):null;case 19:return Je(it),null;case 4:return Zs(),null;case 10:return _h(n.type._context),null;case 22:case 23:return Kh(),null;case 24:return null;default:return null}}var lo=!1,Ut=!1,Ok=typeof WeakSet=="function"?WeakSet:Set,ue=null;function Fs(t,n){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(s){dt(t,n,s)}else r.current=null}function _d(t,n,r){try{r()}catch(s){dt(t,n,s)}}var Nm=!1;function qk(t,n){if(cd=qo,t=af(),bh(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var s=r.getSelection&&r.getSelection();if(s&&s.rangeCount!==0){r=s.anchorNode;var i=s.anchorOffset,l=s.focusNode;s=s.focusOffset;try{r.nodeType,l.nodeType}catch{r=null;break e}var o=0,a=-1,c=-1,d=0,u=0,h=t,m=null;t:for(;;){for(var x;h!==r||i!==0&&h.nodeType!==3||(a=o+i),h!==l||s!==0&&h.nodeType!==3||(c=o+s),h.nodeType===3&&(o+=h.nodeValue.length),(x=h.firstChild)!==null;)m=h,h=x;for(;;){if(h===t)break t;if(m===r&&++d===i&&(a=o),m===l&&++u===s&&(c=o),(x=h.nextSibling)!==null)break;h=m,m=h.parentNode}h=x}r=a===-1||c===-1?null:{start:a,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(dd={focusedElem:t,selectionRange:r},qo=!1,ue=n;ue!==null;)if(n=ue,t=n.child,(n.subtreeFlags&1028)!==0&&t!==null)t.return=n,ue=t;else for(;ue!==null;){n=ue;try{var j=n.alternate;if(n.flags&1024)switch(n.tag){case 0:case 11:case 15:break;case 1:if(j!==null){var b=j.memoizedProps,N=j.memoizedState,f=n.stateNode,p=f.getSnapshotBeforeUpdate(n.elementType===n.type?b:Mn(n.type,b),N);f.__reactInternalSnapshotBeforeUpdate=p}break;case 3:var g=n.stateNode.containerInfo;g.nodeType===1?g.textContent="":g.nodeType===9&&g.documentElement&&g.removeChild(g.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(oe(163))}}catch(k){dt(n,n.return,k)}if(t=n.sibling,t!==null){t.return=n.return,ue=t;break}ue=n.return}return j=Nm,Nm=!1,j}function Qi(t,n,r){var s=n.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var i=s=s.next;do{if((i.tag&t)===t){var l=i.destroy;i.destroy=void 0,l!==void 0&&_d(n,r,l)}i=i.next}while(i!==s)}}function Na(t,n){if(n=n.updateQueue,n=n!==null?n.lastEffect:null,n!==null){var r=n=n.next;do{if((r.tag&t)===t){var s=r.create;r.destroy=s()}r=r.next}while(r!==n)}}function Td(t){var n=t.ref;if(n!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof n=="function"?n(t):n.current=t}}function sg(t){var n=t.alternate;n!==null&&(t.alternate=null,sg(n)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(n=t.stateNode,n!==null&&(delete n[Hn],delete n[ml],delete n[md],delete n[kk],delete n[vk])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function ig(t){return t.tag===5||t.tag===3||t.tag===4}function Sm(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||ig(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Cd(t,n,r){var s=t.tag;if(s===5||s===6)t=t.stateNode,n?r.nodeType===8?r.parentNode.insertBefore(t,n):r.insertBefore(t,n):(r.nodeType===8?(n=r.parentNode,n.insertBefore(t,r)):(n=r,n.appendChild(t)),r=r._reactRootContainer,r!=null||n.onclick!==null||(n.onclick=Ko));else if(s!==4&&(t=t.child,t!==null))for(Cd(t,n,r),t=t.sibling;t!==null;)Cd(t,n,r),t=t.sibling}function Pd(t,n,r){var s=t.tag;if(s===5||s===6)t=t.stateNode,n?r.insertBefore(t,n):r.appendChild(t);else if(s!==4&&(t=t.child,t!==null))for(Pd(t,n,r),t=t.sibling;t!==null;)Pd(t,n,r),t=t.sibling}var Mt=null,In=!1;function pr(t,n,r){for(r=r.child;r!==null;)lg(t,n,r),r=r.sibling}function lg(t,n,r){if($n&&typeof $n.onCommitFiberUnmount=="function")try{$n.onCommitFiberUnmount(fa,r)}catch{}switch(r.tag){case 5:Ut||Fs(r,n);case 6:var s=Mt,i=In;Mt=null,pr(t,n,r),Mt=s,In=i,Mt!==null&&(In?(t=Mt,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):Mt.removeChild(r.stateNode));break;case 18:Mt!==null&&(In?(t=Mt,r=r.stateNode,t.nodeType===8?dc(t.parentNode,r):t.nodeType===1&&dc(t,r),al(t)):dc(Mt,r.stateNode));break;case 4:s=Mt,i=In,Mt=r.stateNode.containerInfo,In=!0,pr(t,n,r),Mt=s,In=i;break;case 0:case 11:case 14:case 15:if(!Ut&&(s=r.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){i=s=s.next;do{var l=i,o=l.destroy;l=l.tag,o!==void 0&&(l&2||l&4)&&_d(r,n,o),i=i.next}while(i!==s)}pr(t,n,r);break;case 1:if(!Ut&&(Fs(r,n),s=r.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=r.memoizedProps,s.state=r.memoizedState,s.componentWillUnmount()}catch(a){dt(r,n,a)}pr(t,n,r);break;case 21:pr(t,n,r);break;case 22:r.mode&1?(Ut=(s=Ut)||r.memoizedState!==null,pr(t,n,r),Ut=s):pr(t,n,r);break;default:pr(t,n,r)}}function _m(t){var n=t.updateQueue;if(n!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new Ok),n.forEach(function(s){var i=Wk.bind(null,t,s);r.has(s)||(r.add(s),s.then(i,i))})}}function Rn(t,n){var r=n.deletions;if(r!==null)for(var s=0;s<r.length;s++){var i=r[s];try{var l=t,o=n,a=o;e:for(;a!==null;){switch(a.tag){case 5:Mt=a.stateNode,In=!1;break e;case 3:Mt=a.stateNode.containerInfo,In=!0;break e;case 4:Mt=a.stateNode.containerInfo,In=!0;break e}a=a.return}if(Mt===null)throw Error(oe(160));lg(l,o,i),Mt=null,In=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(d){dt(i,n,d)}}if(n.subtreeFlags&12854)for(n=n.child;n!==null;)og(n,t),n=n.sibling}function og(t,n){var r=t.alternate,s=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Rn(n,t),Un(t),s&4){try{Qi(3,t,t.return),Na(3,t)}catch(b){dt(t,t.return,b)}try{Qi(5,t,t.return)}catch(b){dt(t,t.return,b)}}break;case 1:Rn(n,t),Un(t),s&512&&r!==null&&Fs(r,r.return);break;case 5:if(Rn(n,t),Un(t),s&512&&r!==null&&Fs(r,r.return),t.flags&32){var i=t.stateNode;try{sl(i,"")}catch(b){dt(t,t.return,b)}}if(s&4&&(i=t.stateNode,i!=null)){var l=t.memoizedProps,o=r!==null?r.memoizedProps:l,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&l.type==="radio"&&l.name!=null&&Cx(i,l),Zc(a,o);var d=Zc(a,l);for(o=0;o<c.length;o+=2){var u=c[o],h=c[o+1];u==="style"?Ix(i,h):u==="dangerouslySetInnerHTML"?Rx(i,h):u==="children"?sl(i,h):oh(i,u,h,d)}switch(a){case"input":Wc(i,l);break;case"textarea":Px(i,l);break;case"select":var m=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!l.multiple;var x=l.value;x!=null?Bs(i,!!l.multiple,x,!1):m!==!!l.multiple&&(l.defaultValue!=null?Bs(i,!!l.multiple,l.defaultValue,!0):Bs(i,!!l.multiple,l.multiple?[]:"",!1))}i[ml]=l}catch(b){dt(t,t.return,b)}}break;case 6:if(Rn(n,t),Un(t),s&4){if(t.stateNode===null)throw Error(oe(162));i=t.stateNode,l=t.memoizedProps;try{i.nodeValue=l}catch(b){dt(t,t.return,b)}}break;case 3:if(Rn(n,t),Un(t),s&4&&r!==null&&r.memoizedState.isDehydrated)try{al(n.containerInfo)}catch(b){dt(t,t.return,b)}break;case 4:Rn(n,t),Un(t);break;case 13:Rn(n,t),Un(t),i=t.child,i.flags&8192&&(l=i.memoizedState!==null,i.stateNode.isHidden=l,!l||i.alternate!==null&&i.alternate.memoizedState!==null||(Bh=ut())),s&4&&_m(t);break;case 22:if(u=r!==null&&r.memoizedState!==null,t.mode&1?(Ut=(d=Ut)||u,Rn(n,t),Ut=d):Rn(n,t),Un(t),s&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!u&&t.mode&1)for(ue=t,u=t.child;u!==null;){for(h=ue=u;ue!==null;){switch(m=ue,x=m.child,m.tag){case 0:case 11:case 14:case 15:Qi(4,m,m.return);break;case 1:Fs(m,m.return);var j=m.stateNode;if(typeof j.componentWillUnmount=="function"){s=m,r=m.return;try{n=s,j.props=n.memoizedProps,j.state=n.memoizedState,j.componentWillUnmount()}catch(b){dt(s,r,b)}}break;case 5:Fs(m,m.return);break;case 22:if(m.memoizedState!==null){Cm(h);continue}}x!==null?(x.return=m,ue=x):Cm(h)}u=u.sibling}e:for(u=null,h=t;;){if(h.tag===5){if(u===null){u=h;try{i=h.stateNode,d?(l=i.style,typeof l.setProperty=="function"?l.setProperty("display","none","important"):l.display="none"):(a=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=Mx("display",o))}catch(b){dt(t,t.return,b)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(b){dt(t,t.return,b)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Rn(n,t),Un(t),s&4&&_m(t);break;case 21:break;default:Rn(n,t),Un(t)}}function Un(t){var n=t.flags;if(n&2){try{e:{for(var r=t.return;r!==null;){if(ig(r)){var s=r;break e}r=r.return}throw Error(oe(160))}switch(s.tag){case 5:var i=s.stateNode;s.flags&32&&(sl(i,""),s.flags&=-33);var l=Sm(t);Pd(t,l,i);break;case 3:case 4:var o=s.stateNode.containerInfo,a=Sm(t);Cd(t,a,o);break;default:throw Error(oe(161))}}catch(c){dt(t,t.return,c)}t.flags&=-3}n&4096&&(t.flags&=-4097)}function Bk(t,n,r){ue=t,ag(t)}function ag(t,n,r){for(var s=(t.mode&1)!==0;ue!==null;){var i=ue,l=i.child;if(i.tag===22&&s){var o=i.memoizedState!==null||lo;if(!o){var a=i.alternate,c=a!==null&&a.memoizedState!==null||Ut;a=lo;var d=Ut;if(lo=o,(Ut=c)&&!d)for(ue=i;ue!==null;)o=ue,c=o.child,o.tag===22&&o.memoizedState!==null?Pm(i):c!==null?(c.return=o,ue=c):Pm(i);for(;l!==null;)ue=l,ag(l),l=l.sibling;ue=i,lo=a,Ut=d}Tm(t)}else i.subtreeFlags&8772&&l!==null?(l.return=i,ue=l):Tm(t)}}function Tm(t){for(;ue!==null;){var n=ue;if(n.flags&8772){var r=n.alternate;try{if(n.flags&8772)switch(n.tag){case 0:case 11:case 15:Ut||Na(5,n);break;case 1:var s=n.stateNode;if(n.flags&4&&!Ut)if(r===null)s.componentDidMount();else{var i=n.elementType===n.type?r.memoizedProps:Mn(n.type,r.memoizedProps);s.componentDidUpdate(i,r.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var l=n.updateQueue;l!==null&&hm(n,l,s);break;case 3:var o=n.updateQueue;if(o!==null){if(r=null,n.child!==null)switch(n.child.tag){case 5:r=n.child.stateNode;break;case 1:r=n.child.stateNode}hm(n,o,r)}break;case 5:var a=n.stateNode;if(r===null&&n.flags&4){r=a;var c=n.memoizedProps;switch(n.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&r.focus();break;case"img":c.src&&(r.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(n.memoizedState===null){var d=n.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&al(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(oe(163))}Ut||n.flags&512&&Td(n)}catch(m){dt(n,n.return,m)}}if(n===t){ue=null;break}if(r=n.sibling,r!==null){r.return=n.return,ue=r;break}ue=n.return}}function Cm(t){for(;ue!==null;){var n=ue;if(n===t){ue=null;break}var r=n.sibling;if(r!==null){r.return=n.return,ue=r;break}ue=n.return}}function Pm(t){for(;ue!==null;){var n=ue;try{switch(n.tag){case 0:case 11:case 15:var r=n.return;try{Na(4,n)}catch(c){dt(n,r,c)}break;case 1:var s=n.stateNode;if(typeof s.componentDidMount=="function"){var i=n.return;try{s.componentDidMount()}catch(c){dt(n,i,c)}}var l=n.return;try{Td(n)}catch(c){dt(n,l,c)}break;case 5:var o=n.return;try{Td(n)}catch(c){dt(n,o,c)}}}catch(c){dt(n,n.return,c)}if(n===t){ue=null;break}var a=n.sibling;if(a!==null){a.return=n.return,ue=a;break}ue=n.return}}var Uk=Math.ceil,Zo=ar.ReactCurrentDispatcher,Oh=ar.ReactCurrentOwner,Nn=ar.ReactCurrentBatchConfig,Oe=0,Tt=null,ft=null,It=0,un=0,Os=Or(0),wt=0,yl=null,as=0,Sa=0,qh=0,Yi=null,Zt=null,Bh=0,ti=1/0,Jn=null,ea=!1,Ed=null,Er=null,oo=!1,vr=null,ta=0,Xi=0,Rd=null,Po=-1,Eo=0;function Qt(){return Oe&6?ut():Po!==-1?Po:Po=ut()}function Rr(t){return t.mode&1?Oe&2&&It!==0?It&-It:Nk.transition!==null?(Eo===0&&(Eo=Vx()),Eo):(t=Ve,t!==0||(t=window.event,t=t===void 0?16:Jx(t.type)),t):1}function Fn(t,n,r,s){if(50<Xi)throw Xi=0,Rd=null,Error(oe(185));Tl(t,r,s),(!(Oe&2)||t!==Tt)&&(t===Tt&&(!(Oe&2)&&(Sa|=r),wt===4&&br(t,It)),sn(t,s),r===1&&Oe===0&&!(n.mode&1)&&(ti=ut()+500,ka&&qr()))}function sn(t,n){var r=t.callbackNode;Nb(t,n);var s=Oo(t,t===Tt?It:0);if(s===0)r!==null&&Ou(r),t.callbackNode=null,t.callbackPriority=0;else if(n=s&-s,t.callbackPriority!==n){if(r!=null&&Ou(r),n===1)t.tag===0?wk(Em.bind(null,t)):jf(Em.bind(null,t)),yk(function(){!(Oe&6)&&qr()}),r=null;else{switch(Hx(s)){case 1:r=uh;break;case 4:r=zx;break;case 16:r=Fo;break;case 536870912:r=Gx;break;default:r=Fo}r=fg(r,cg.bind(null,t))}t.callbackPriority=n,t.callbackNode=r}}function cg(t,n){if(Po=-1,Eo=0,Oe&6)throw Error(oe(327));var r=t.callbackNode;if(Vs()&&t.callbackNode!==r)return null;var s=Oo(t,t===Tt?It:0);if(s===0)return null;if(s&30||s&t.expiredLanes||n)n=na(t,s);else{n=s;var i=Oe;Oe|=2;var l=hg();(Tt!==t||It!==n)&&(Jn=null,ti=ut()+500,ns(t,n));do try{Gk();break}catch(a){dg(t,a)}while(!0);Sh(),Zo.current=l,Oe=i,ft!==null?n=0:(Tt=null,It=0,n=wt)}if(n!==0){if(n===2&&(i=sd(t),i!==0&&(s=i,n=Md(t,i))),n===1)throw r=yl,ns(t,0),br(t,s),sn(t,ut()),r;if(n===6)br(t,s);else{if(i=t.current.alternate,!(s&30)&&!Kk(i)&&(n=na(t,s),n===2&&(l=sd(t),l!==0&&(s=l,n=Md(t,l))),n===1))throw r=yl,ns(t,0),br(t,s),sn(t,ut()),r;switch(t.finishedWork=i,t.finishedLanes=s,n){case 0:case 1:throw Error(oe(345));case 2:Xr(t,Zt,Jn);break;case 3:if(br(t,s),(s&130023424)===s&&(n=Bh+500-ut(),10<n)){if(Oo(t,0)!==0)break;if(i=t.suspendedLanes,(i&s)!==s){Qt(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=ud(Xr.bind(null,t,Zt,Jn),n);break}Xr(t,Zt,Jn);break;case 4:if(br(t,s),(s&4194240)===s)break;for(n=t.eventTimes,i=-1;0<s;){var o=31-Ln(s);l=1<<o,o=n[o],o>i&&(i=o),s&=~l}if(s=i,s=ut()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*Uk(s/1960))-s,10<s){t.timeoutHandle=ud(Xr.bind(null,t,Zt,Jn),s);break}Xr(t,Zt,Jn);break;case 5:Xr(t,Zt,Jn);break;default:throw Error(oe(329))}}}return sn(t,ut()),t.callbackNode===r?cg.bind(null,t):null}function Md(t,n){var r=Yi;return t.current.memoizedState.isDehydrated&&(ns(t,n).flags|=256),t=na(t,n),t!==2&&(n=Zt,Zt=r,n!==null&&Id(n)),t}function Id(t){Zt===null?Zt=t:Zt.push.apply(Zt,t)}function Kk(t){for(var n=t;;){if(n.flags&16384){var r=n.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var s=0;s<r.length;s++){var i=r[s],l=i.getSnapshot;i=i.value;try{if(!qn(l(),i))return!1}catch{return!1}}}if(r=n.child,n.subtreeFlags&16384&&r!==null)r.return=n,n=r;else{if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function br(t,n){for(n&=~qh,n&=~Sa,t.suspendedLanes|=n,t.pingedLanes&=~n,t=t.expirationTimes;0<n;){var r=31-Ln(n),s=1<<r;t[r]=-1,n&=~s}}function Em(t){if(Oe&6)throw Error(oe(327));Vs();var n=Oo(t,0);if(!(n&1))return sn(t,ut()),null;var r=na(t,n);if(t.tag!==0&&r===2){var s=sd(t);s!==0&&(n=s,r=Md(t,s))}if(r===1)throw r=yl,ns(t,0),br(t,n),sn(t,ut()),r;if(r===6)throw Error(oe(345));return t.finishedWork=t.current.alternate,t.finishedLanes=n,Xr(t,Zt,Jn),sn(t,ut()),null}function Uh(t,n){var r=Oe;Oe|=1;try{return t(n)}finally{Oe=r,Oe===0&&(ti=ut()+500,ka&&qr())}}function cs(t){vr!==null&&vr.tag===0&&!(Oe&6)&&Vs();var n=Oe;Oe|=1;var r=Nn.transition,s=Ve;try{if(Nn.transition=null,Ve=1,t)return t()}finally{Ve=s,Nn.transition=r,Oe=n,!(Oe&6)&&qr()}}function Kh(){un=Os.current,Je(Os)}function ns(t,n){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,jk(r)),ft!==null)for(r=ft.return;r!==null;){var s=r;switch(vh(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&zo();break;case 3:Zs(),Je(nn),Je(zt),Rh();break;case 5:Eh(s);break;case 4:Zs();break;case 13:Je(it);break;case 19:Je(it);break;case 10:_h(s.type._context);break;case 22:case 23:Kh()}r=r.return}if(Tt=t,ft=t=Mr(t.current,null),It=un=n,wt=0,yl=null,qh=Sa=as=0,Zt=Yi=null,es!==null){for(n=0;n<es.length;n++)if(r=es[n],s=r.interleaved,s!==null){r.interleaved=null;var i=s.next,l=r.pending;if(l!==null){var o=l.next;l.next=i,s.next=o}r.pending=s}es=null}return t}function dg(t,n){do{var r=ft;try{if(Sh(),_o.current=Jo,Xo){for(var s=lt.memoizedState;s!==null;){var i=s.queue;i!==null&&(i.pending=null),s=s.next}Xo=!1}if(os=0,_t=vt=lt=null,Wi=!1,fl=0,Oh.current=null,r===null||r.return===null){wt=1,yl=n,ft=null;break}e:{var l=t,o=r.return,a=r,c=n;if(n=It,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var m=u.alternate;m?(u.updateQueue=m.updateQueue,u.memoizedState=m.memoizedState,u.lanes=m.lanes):(u.updateQueue=null,u.memoizedState=null)}var x=gm(o);if(x!==null){x.flags&=-257,jm(x,o,a,l,n),x.mode&1&&fm(l,d,n),n=x,c=d;var j=n.updateQueue;if(j===null){var b=new Set;b.add(c),n.updateQueue=b}else j.add(c);break e}else{if(!(n&1)){fm(l,d,n),zh();break e}c=Error(oe(426))}}else if(rt&&a.mode&1){var N=gm(o);if(N!==null){!(N.flags&65536)&&(N.flags|=256),jm(N,o,a,l,n),wh(ei(c,a));break e}}l=c=ei(c,a),wt!==4&&(wt=2),Yi===null?Yi=[l]:Yi.push(l),l=o;do{switch(l.tag){case 3:l.flags|=65536,n&=-n,l.lanes|=n;var f=$f(l,c,n);dm(l,f);break e;case 1:a=c;var p=l.type,g=l.stateNode;if(!(l.flags&128)&&(typeof p.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(Er===null||!Er.has(g)))){l.flags|=65536,n&=-n,l.lanes|=n;var k=Wf(l,a,n);dm(l,k);break e}}l=l.return}while(l!==null)}mg(r)}catch(S){n=S,ft===r&&r!==null&&(ft=r=r.return);continue}break}while(!0)}function hg(){var t=Zo.current;return Zo.current=Jo,t===null?Jo:t}function zh(){(wt===0||wt===3||wt===2)&&(wt=4),Tt===null||!(as&268435455)&&!(Sa&268435455)||br(Tt,It)}function na(t,n){var r=Oe;Oe|=2;var s=hg();(Tt!==t||It!==n)&&(Jn=null,ns(t,n));do try{zk();break}catch(i){dg(t,i)}while(!0);if(Sh(),Oe=r,Zo.current=s,ft!==null)throw Error(oe(261));return Tt=null,It=0,wt}function zk(){for(;ft!==null;)ug(ft)}function Gk(){for(;ft!==null&&!xb();)ug(ft)}function ug(t){var n=xg(t.alternate,t,un);t.memoizedProps=t.pendingProps,n===null?mg(t):ft=n,Oh.current=null}function mg(t){var n=t;do{var r=n.alternate;if(t=n.return,n.flags&32768){if(r=Fk(r,n),r!==null){r.flags&=32767,ft=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{wt=6,ft=null;return}}else if(r=Lk(r,n,un),r!==null){ft=r;return}if(n=n.sibling,n!==null){ft=n;return}ft=n=t}while(n!==null);wt===0&&(wt=5)}function Xr(t,n,r){var s=Ve,i=Nn.transition;try{Nn.transition=null,Ve=1,Vk(t,n,r,s)}finally{Nn.transition=i,Ve=s}return null}function Vk(t,n,r,s){do Vs();while(vr!==null);if(Oe&6)throw Error(oe(327));r=t.finishedWork;var i=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(oe(177));t.callbackNode=null,t.callbackPriority=0;var l=r.lanes|r.childLanes;if(Sb(t,l),t===Tt&&(ft=Tt=null,It=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||oo||(oo=!0,fg(Fo,function(){return Vs(),null})),l=(r.flags&15990)!==0,r.subtreeFlags&15990||l){l=Nn.transition,Nn.transition=null;var o=Ve;Ve=1;var a=Oe;Oe|=4,Oh.current=null,qk(t,r),og(r,t),hk(dd),qo=!!cd,dd=cd=null,t.current=r,Bk(r),fb(),Oe=a,Ve=o,Nn.transition=l}else t.current=r;if(oo&&(oo=!1,vr=t,ta=i),l=t.pendingLanes,l===0&&(Er=null),yb(r.stateNode),sn(t,ut()),n!==null)for(s=t.onRecoverableError,r=0;r<n.length;r++)i=n[r],s(i.value,{componentStack:i.stack,digest:i.digest});if(ea)throw ea=!1,t=Ed,Ed=null,t;return ta&1&&t.tag!==0&&Vs(),l=t.pendingLanes,l&1?t===Rd?Xi++:(Xi=0,Rd=t):Xi=0,qr(),null}function Vs(){if(vr!==null){var t=Hx(ta),n=Nn.transition,r=Ve;try{if(Nn.transition=null,Ve=16>t?16:t,vr===null)var s=!1;else{if(t=vr,vr=null,ta=0,Oe&6)throw Error(oe(331));var i=Oe;for(Oe|=4,ue=t.current;ue!==null;){var l=ue,o=l.child;if(ue.flags&16){var a=l.deletions;if(a!==null){for(var c=0;c<a.length;c++){var d=a[c];for(ue=d;ue!==null;){var u=ue;switch(u.tag){case 0:case 11:case 15:Qi(8,u,l)}var h=u.child;if(h!==null)h.return=u,ue=h;else for(;ue!==null;){u=ue;var m=u.sibling,x=u.return;if(sg(u),u===d){ue=null;break}if(m!==null){m.return=x,ue=m;break}ue=x}}}var j=l.alternate;if(j!==null){var b=j.child;if(b!==null){j.child=null;do{var N=b.sibling;b.sibling=null,b=N}while(b!==null)}}ue=l}}if(l.subtreeFlags&2064&&o!==null)o.return=l,ue=o;else e:for(;ue!==null;){if(l=ue,l.flags&2048)switch(l.tag){case 0:case 11:case 15:Qi(9,l,l.return)}var f=l.sibling;if(f!==null){f.return=l.return,ue=f;break e}ue=l.return}}var p=t.current;for(ue=p;ue!==null;){o=ue;var g=o.child;if(o.subtreeFlags&2064&&g!==null)g.return=o,ue=g;else e:for(o=p;ue!==null;){if(a=ue,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Na(9,a)}}catch(S){dt(a,a.return,S)}if(a===o){ue=null;break e}var k=a.sibling;if(k!==null){k.return=a.return,ue=k;break e}ue=a.return}}if(Oe=i,qr(),$n&&typeof $n.onPostCommitFiberRoot=="function")try{$n.onPostCommitFiberRoot(fa,t)}catch{}s=!0}return s}finally{Ve=r,Nn.transition=n}}return!1}function Rm(t,n,r){n=ei(r,n),n=$f(t,n,1),t=Pr(t,n,1),n=Qt(),t!==null&&(Tl(t,1,n),sn(t,n))}function dt(t,n,r){if(t.tag===3)Rm(t,t,r);else for(;n!==null;){if(n.tag===3){Rm(n,t,r);break}else if(n.tag===1){var s=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Er===null||!Er.has(s))){t=ei(r,t),t=Wf(n,t,1),n=Pr(n,t,1),t=Qt(),n!==null&&(Tl(n,1,t),sn(n,t));break}}n=n.return}}function Hk(t,n,r){var s=t.pingCache;s!==null&&s.delete(n),n=Qt(),t.pingedLanes|=t.suspendedLanes&r,Tt===t&&(It&r)===r&&(wt===4||wt===3&&(It&130023424)===It&&500>ut()-Bh?ns(t,0):qh|=r),sn(t,n)}function pg(t,n){n===0&&(t.mode&1?(n=Xl,Xl<<=1,!(Xl&130023424)&&(Xl=4194304)):n=1);var r=Qt();t=lr(t,n),t!==null&&(Tl(t,n,r),sn(t,r))}function $k(t){var n=t.memoizedState,r=0;n!==null&&(r=n.retryLane),pg(t,r)}function Wk(t,n){var r=0;switch(t.tag){case 13:var s=t.stateNode,i=t.memoizedState;i!==null&&(r=i.retryLane);break;case 19:s=t.stateNode;break;default:throw Error(oe(314))}s!==null&&s.delete(n),pg(t,r)}var xg;xg=function(t,n,r){if(t!==null)if(t.memoizedProps!==n.pendingProps||nn.current)en=!0;else{if(!(t.lanes&r)&&!(n.flags&128))return en=!1,Dk(t,n,r);en=!!(t.flags&131072)}else en=!1,rt&&n.flags&1048576&&yf(n,Ho,n.index);switch(n.lanes=0,n.tag){case 2:var s=n.type;Co(t,n),t=n.pendingProps;var i=Ys(n,zt.current);Gs(n,r),i=Ih(null,n,s,t,i,r);var l=Ah();return n.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(n.tag=1,n.memoizedState=null,n.updateQueue=null,rn(s)?(l=!0,Go(n)):l=!1,n.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Ch(n),i.updater=wa,n.stateNode=i,i._reactInternals=n,yd(n,s,t,r),n=vd(null,n,s,!0,l,r)):(n.tag=0,rt&&l&&kh(n),$t(null,n,i,r),n=n.child),n;case 16:s=n.elementType;e:{switch(Co(t,n),t=n.pendingProps,i=s._init,s=i(s._payload),n.type=s,i=n.tag=Yk(s),t=Mn(s,t),i){case 0:n=kd(null,n,s,t,r);break e;case 1:n=km(null,n,s,t,r);break e;case 11:n=ym(null,n,s,t,r);break e;case 14:n=bm(null,n,s,Mn(s.type,t),r);break e}throw Error(oe(306,s,""))}return n;case 0:return s=n.type,i=n.pendingProps,i=n.elementType===s?i:Mn(s,i),kd(t,n,s,i,r);case 1:return s=n.type,i=n.pendingProps,i=n.elementType===s?i:Mn(s,i),km(t,n,s,i,r);case 3:e:{if(Jf(n),t===null)throw Error(oe(387));s=n.pendingProps,l=n.memoizedState,i=l.element,Sf(t,n),Qo(n,s,null,r);var o=n.memoizedState;if(s=o.element,l.isDehydrated)if(l={element:s,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},n.updateQueue.baseState=l,n.memoizedState=l,n.flags&256){i=ei(Error(oe(423)),n),n=vm(t,n,s,r,i);break e}else if(s!==i){i=ei(Error(oe(424)),n),n=vm(t,n,s,r,i);break e}else for(mn=Cr(n.stateNode.containerInfo.firstChild),pn=n,rt=!0,An=null,r=wf(n,null,s,r),n.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(Xs(),s===i){n=or(t,n,r);break e}$t(t,n,s,r)}n=n.child}return n;case 5:return _f(n),t===null&&fd(n),s=n.type,i=n.pendingProps,l=t!==null?t.memoizedProps:null,o=i.children,hd(s,i)?o=null:l!==null&&hd(s,l)&&(n.flags|=32),Xf(t,n),$t(t,n,o,r),n.child;case 6:return t===null&&fd(n),null;case 13:return Zf(t,n,r);case 4:return Ph(n,n.stateNode.containerInfo),s=n.pendingProps,t===null?n.child=Js(n,null,s,r):$t(t,n,s,r),n.child;case 11:return s=n.type,i=n.pendingProps,i=n.elementType===s?i:Mn(s,i),ym(t,n,s,i,r);case 7:return $t(t,n,n.pendingProps,r),n.child;case 8:return $t(t,n,n.pendingProps.children,r),n.child;case 12:return $t(t,n,n.pendingProps.children,r),n.child;case 10:e:{if(s=n.type._context,i=n.pendingProps,l=n.memoizedProps,o=i.value,Ye($o,s._currentValue),s._currentValue=o,l!==null)if(qn(l.value,o)){if(l.children===i.children&&!nn.current){n=or(t,n,r);break e}}else for(l=n.child,l!==null&&(l.return=n);l!==null;){var a=l.dependencies;if(a!==null){o=l.child;for(var c=a.firstContext;c!==null;){if(c.context===s){if(l.tag===1){c=nr(-1,r&-r),c.tag=2;var d=l.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}l.lanes|=r,c=l.alternate,c!==null&&(c.lanes|=r),gd(l.return,r,n),a.lanes|=r;break}c=c.next}}else if(l.tag===10)o=l.type===n.type?null:l.child;else if(l.tag===18){if(o=l.return,o===null)throw Error(oe(341));o.lanes|=r,a=o.alternate,a!==null&&(a.lanes|=r),gd(o,r,n),o=l.sibling}else o=l.child;if(o!==null)o.return=l;else for(o=l;o!==null;){if(o===n){o=null;break}if(l=o.sibling,l!==null){l.return=o.return,o=l;break}o=o.return}l=o}$t(t,n,i.children,r),n=n.child}return n;case 9:return i=n.type,s=n.pendingProps.children,Gs(n,r),i=Sn(i),s=s(i),n.flags|=1,$t(t,n,s,r),n.child;case 14:return s=n.type,i=Mn(s,n.pendingProps),i=Mn(s.type,i),bm(t,n,s,i,r);case 15:return Qf(t,n,n.type,n.pendingProps,r);case 17:return s=n.type,i=n.pendingProps,i=n.elementType===s?i:Mn(s,i),Co(t,n),n.tag=1,rn(s)?(t=!0,Go(n)):t=!1,Gs(n,r),Hf(n,s,i),yd(n,s,i,r),vd(null,n,s,!0,t,r);case 19:return eg(t,n,r);case 22:return Yf(t,n,r)}throw Error(oe(156,n.tag))};function fg(t,n){return Kx(t,n)}function Qk(t,n,r,s){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wn(t,n,r,s){return new Qk(t,n,r,s)}function Gh(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Yk(t){if(typeof t=="function")return Gh(t)?1:0;if(t!=null){if(t=t.$$typeof,t===ch)return 11;if(t===dh)return 14}return 2}function Mr(t,n){var r=t.alternate;return r===null?(r=wn(t.tag,n,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=n,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,n=t.dependencies,r.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function Ro(t,n,r,s,i,l){var o=2;if(s=t,typeof t=="function")Gh(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Cs:return rs(r.children,i,l,n);case ah:o=8,i|=8;break;case zc:return t=wn(12,r,n,i|2),t.elementType=zc,t.lanes=l,t;case Gc:return t=wn(13,r,n,i),t.elementType=Gc,t.lanes=l,t;case Vc:return t=wn(19,r,n,i),t.elementType=Vc,t.lanes=l,t;case Sx:return _a(r,i,l,n);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case wx:o=10;break e;case Nx:o=9;break e;case ch:o=11;break e;case dh:o=14;break e;case fr:o=16,s=null;break e}throw Error(oe(130,t==null?t:typeof t,""))}return n=wn(o,r,n,i),n.elementType=t,n.type=s,n.lanes=l,n}function rs(t,n,r,s){return t=wn(7,t,s,n),t.lanes=r,t}function _a(t,n,r,s){return t=wn(22,t,s,n),t.elementType=Sx,t.lanes=r,t.stateNode={isHidden:!1},t}function jc(t,n,r){return t=wn(6,t,null,n),t.lanes=r,t}function yc(t,n,r){return n=wn(4,t.children!==null?t.children:[],t.key,n),n.lanes=r,n.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},n}function Xk(t,n,r,s,i){this.tag=n,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Za(0),this.expirationTimes=Za(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Za(0),this.identifierPrefix=s,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Vh(t,n,r,s,i,l,o,a,c){return t=new Xk(t,n,r,a,c),n===1?(n=1,l===!0&&(n|=8)):n=0,l=wn(3,null,null,n),t.current=l,l.stateNode=t,l.memoizedState={element:s,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ch(l),t}function Jk(t,n,r){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ts,key:s==null?null:""+s,children:t,containerInfo:n,implementation:r}}function gg(t){if(!t)return Lr;t=t._reactInternals;e:{if(ms(t)!==t||t.tag!==1)throw Error(oe(170));var n=t;do{switch(n.tag){case 3:n=n.stateNode.context;break e;case 1:if(rn(n.type)){n=n.stateNode.__reactInternalMemoizedMergedChildContext;break e}}n=n.return}while(n!==null);throw Error(oe(171))}if(t.tag===1){var r=t.type;if(rn(r))return gf(t,r,n)}return n}function jg(t,n,r,s,i,l,o,a,c){return t=Vh(r,s,!0,t,i,l,o,a,c),t.context=gg(null),r=t.current,s=Qt(),i=Rr(r),l=nr(s,i),l.callback=n??null,Pr(r,l,i),t.current.lanes=i,Tl(t,i,s),sn(t,s),t}function Ta(t,n,r,s){var i=n.current,l=Qt(),o=Rr(i);return r=gg(r),n.context===null?n.context=r:n.pendingContext=r,n=nr(l,o),n.payload={element:t},s=s===void 0?null:s,s!==null&&(n.callback=s),t=Pr(i,n,o),t!==null&&(Fn(t,i,o,l),So(t,i,o)),o}function ra(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Mm(t,n){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<n?r:n}}function Hh(t,n){Mm(t,n),(t=t.alternate)&&Mm(t,n)}function Zk(){return null}var yg=typeof reportError=="function"?reportError:function(t){console.error(t)};function $h(t){this._internalRoot=t}Ca.prototype.render=$h.prototype.render=function(t){var n=this._internalRoot;if(n===null)throw Error(oe(409));Ta(t,n,null,null)};Ca.prototype.unmount=$h.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var n=t.containerInfo;cs(function(){Ta(null,t,null,null)}),n[ir]=null}};function Ca(t){this._internalRoot=t}Ca.prototype.unstable_scheduleHydration=function(t){if(t){var n=Qx();t={blockedOn:null,target:t,priority:n};for(var r=0;r<yr.length&&n!==0&&n<yr[r].priority;r++);yr.splice(r,0,t),r===0&&Xx(t)}};function Wh(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Pa(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Im(){}function ev(t,n,r,s,i){if(i){if(typeof s=="function"){var l=s;s=function(){var d=ra(o);l.call(d)}}var o=jg(n,s,t,0,null,!1,!1,"",Im);return t._reactRootContainer=o,t[ir]=o.current,hl(t.nodeType===8?t.parentNode:t),cs(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof s=="function"){var a=s;s=function(){var d=ra(c);a.call(d)}}var c=Vh(t,0,!1,null,null,!1,!1,"",Im);return t._reactRootContainer=c,t[ir]=c.current,hl(t.nodeType===8?t.parentNode:t),cs(function(){Ta(n,c,r,s)}),c}function Ea(t,n,r,s,i){var l=r._reactRootContainer;if(l){var o=l;if(typeof i=="function"){var a=i;i=function(){var c=ra(o);a.call(c)}}Ta(n,o,t,i)}else o=ev(r,n,t,i,s);return ra(o)}$x=function(t){switch(t.tag){case 3:var n=t.stateNode;if(n.current.memoizedState.isDehydrated){var r=qi(n.pendingLanes);r!==0&&(mh(n,r|1),sn(n,ut()),!(Oe&6)&&(ti=ut()+500,qr()))}break;case 13:cs(function(){var s=lr(t,1);if(s!==null){var i=Qt();Fn(s,t,1,i)}}),Hh(t,1)}};ph=function(t){if(t.tag===13){var n=lr(t,134217728);if(n!==null){var r=Qt();Fn(n,t,134217728,r)}Hh(t,134217728)}};Wx=function(t){if(t.tag===13){var n=Rr(t),r=lr(t,n);if(r!==null){var s=Qt();Fn(r,t,n,s)}Hh(t,n)}};Qx=function(){return Ve};Yx=function(t,n){var r=Ve;try{return Ve=t,n()}finally{Ve=r}};td=function(t,n,r){switch(n){case"input":if(Wc(t,r),n=r.name,r.type==="radio"&&n!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),n=0;n<r.length;n++){var s=r[n];if(s!==t&&s.form===t.form){var i=ba(s);if(!i)throw Error(oe(90));Tx(s),Wc(s,i)}}}break;case"textarea":Px(t,r);break;case"select":n=r.value,n!=null&&Bs(t,!!r.multiple,n,!1)}};Lx=Uh;Fx=cs;var tv={usingClientEntryPoint:!1,Events:[Pl,Ms,ba,Ax,Dx,Uh]},Ti={findFiberByHostInstance:Zr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nv={bundleType:Ti.bundleType,version:Ti.version,rendererPackageName:Ti.rendererPackageName,rendererConfig:Ti.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ar.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Bx(t),t===null?null:t.stateNode},findFiberByHostInstance:Ti.findFiberByHostInstance||Zk,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ao=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ao.isDisabled&&ao.supportsFiber)try{fa=ao.inject(nv),$n=ao}catch{}}jn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tv;jn.createPortal=function(t,n){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Wh(n))throw Error(oe(200));return Jk(t,n,null,r)};jn.createRoot=function(t,n){if(!Wh(t))throw Error(oe(299));var r=!1,s="",i=yg;return n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(i=n.onRecoverableError)),n=Vh(t,1,!1,null,null,r,!1,s,i),t[ir]=n.current,hl(t.nodeType===8?t.parentNode:t),new $h(n)};jn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var n=t._reactInternals;if(n===void 0)throw typeof t.render=="function"?Error(oe(188)):(t=Object.keys(t).join(","),Error(oe(268,t)));return t=Bx(n),t=t===null?null:t.stateNode,t};jn.flushSync=function(t){return cs(t)};jn.hydrate=function(t,n,r){if(!Pa(n))throw Error(oe(200));return Ea(null,t,n,!0,r)};jn.hydrateRoot=function(t,n,r){if(!Wh(t))throw Error(oe(405));var s=r!=null&&r.hydratedSources||null,i=!1,l="",o=yg;if(r!=null&&(r.unstable_strictMode===!0&&(i=!0),r.identifierPrefix!==void 0&&(l=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),n=jg(n,null,t,1,r??null,i,!1,l,o),t[ir]=n.current,hl(t),s)for(t=0;t<s.length;t++)r=s[t],i=r._getVersion,i=i(r._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[r,i]:n.mutableSourceEagerHydrationData.push(r,i);return new Ca(n)};jn.render=function(t,n,r){if(!Pa(n))throw Error(oe(200));return Ea(null,t,n,!1,r)};jn.unmountComponentAtNode=function(t){if(!Pa(t))throw Error(oe(40));return t._reactRootContainer?(cs(function(){Ea(null,null,t,!1,function(){t._reactRootContainer=null,t[ir]=null})}),!0):!1};jn.unstable_batchedUpdates=Uh;jn.unstable_renderSubtreeIntoContainer=function(t,n,r,s){if(!Pa(r))throw Error(oe(200));if(t==null||t._reactInternals===void 0)throw Error(oe(38));return Ea(t,n,r,!1,s)};jn.version="18.3.1-next-f1338f8080-20240426";function bg(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(bg)}catch(t){console.error(t)}}bg(),yx.exports=jn;var rv=yx.exports,Am=rv;Uc.createRoot=Am.createRoot,Uc.hydrateRoot=Am.hydrateRoot;/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function bl(){return bl=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},bl.apply(this,arguments)}var wr;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(wr||(wr={}));const Dm="popstate";function sv(t){t===void 0&&(t={});function n(s,i){let{pathname:l,search:o,hash:a}=s.location;return Ad("",{pathname:l,search:o,hash:a},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function r(s,i){return typeof i=="string"?i:sa(i)}return lv(n,r,null,t)}function gt(t,n){if(t===!1||t===null||typeof t>"u")throw new Error(n)}function Qh(t,n){if(!t){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function iv(){return Math.random().toString(36).substr(2,8)}function Lm(t,n){return{usr:t.state,key:t.key,idx:n}}function Ad(t,n,r,s){return r===void 0&&(r=null),bl({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof n=="string"?ai(n):n,{state:r,key:n&&n.key||s||iv()})}function sa(t){let{pathname:n="/",search:r="",hash:s=""}=t;return r&&r!=="?"&&(n+=r.charAt(0)==="?"?r:"?"+r),s&&s!=="#"&&(n+=s.charAt(0)==="#"?s:"#"+s),n}function ai(t){let n={};if(t){let r=t.indexOf("#");r>=0&&(n.hash=t.substr(r),t=t.substr(0,r));let s=t.indexOf("?");s>=0&&(n.search=t.substr(s),t=t.substr(0,s)),t&&(n.pathname=t)}return n}function lv(t,n,r,s){s===void 0&&(s={});let{window:i=document.defaultView,v5Compat:l=!1}=s,o=i.history,a=wr.Pop,c=null,d=u();d==null&&(d=0,o.replaceState(bl({},o.state,{idx:d}),""));function u(){return(o.state||{idx:null}).idx}function h(){a=wr.Pop;let N=u(),f=N==null?null:N-d;d=N,c&&c({action:a,location:b.location,delta:f})}function m(N,f){a=wr.Push;let p=Ad(b.location,N,f);d=u()+1;let g=Lm(p,d),k=b.createHref(p);try{o.pushState(g,"",k)}catch(S){if(S instanceof DOMException&&S.name==="DataCloneError")throw S;i.location.assign(k)}l&&c&&c({action:a,location:b.location,delta:1})}function x(N,f){a=wr.Replace;let p=Ad(b.location,N,f);d=u();let g=Lm(p,d),k=b.createHref(p);o.replaceState(g,"",k),l&&c&&c({action:a,location:b.location,delta:0})}function j(N){let f=i.location.origin!=="null"?i.location.origin:i.location.href,p=typeof N=="string"?N:sa(N);return p=p.replace(/ $/,"%20"),gt(f,"No window.location.(origin|href) available to create URL for href: "+p),new URL(p,f)}let b={get action(){return a},get location(){return t(i,o)},listen(N){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(Dm,h),c=N,()=>{i.removeEventListener(Dm,h),c=null}},createHref(N){return n(i,N)},createURL:j,encodeLocation(N){let f=j(N);return{pathname:f.pathname,search:f.search,hash:f.hash}},push:m,replace:x,go(N){return o.go(N)}};return b}var Fm;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Fm||(Fm={}));function ov(t,n,r){return r===void 0&&(r="/"),av(t,n,r)}function av(t,n,r,s){let i=typeof n=="string"?ai(n):n,l=Yh(i.pathname||"/",r);if(l==null)return null;let o=kg(t);cv(o);let a=null;for(let c=0;a==null&&c<o.length;++c){let d=kv(l);a=jv(o[c],d)}return a}function kg(t,n,r,s){n===void 0&&(n=[]),r===void 0&&(r=[]),s===void 0&&(s="");let i=(l,o,a)=>{let c={relativePath:a===void 0?l.path||"":a,caseSensitive:l.caseSensitive===!0,childrenIndex:o,route:l};c.relativePath.startsWith("/")&&(gt(c.relativePath.startsWith(s),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(s.length));let d=Ir([s,c.relativePath]),u=r.concat(c);l.children&&l.children.length>0&&(gt(l.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),kg(l.children,n,u,d)),!(l.path==null&&!l.index)&&n.push({path:d,score:fv(d,l.index),routesMeta:u})};return t.forEach((l,o)=>{var a;if(l.path===""||!((a=l.path)!=null&&a.includes("?")))i(l,o);else for(let c of vg(l.path))i(l,o,c)}),n}function vg(t){let n=t.split("/");if(n.length===0)return[];let[r,...s]=n,i=r.endsWith("?"),l=r.replace(/\?$/,"");if(s.length===0)return i?[l,""]:[l];let o=vg(s.join("/")),a=[];return a.push(...o.map(c=>c===""?l:[l,c].join("/"))),i&&a.push(...o),a.map(c=>t.startsWith("/")&&c===""?"/":c)}function cv(t){t.sort((n,r)=>n.score!==r.score?r.score-n.score:gv(n.routesMeta.map(s=>s.childrenIndex),r.routesMeta.map(s=>s.childrenIndex)))}const dv=/^:[\w-]+$/,hv=3,uv=2,mv=1,pv=10,xv=-2,Om=t=>t==="*";function fv(t,n){let r=t.split("/"),s=r.length;return r.some(Om)&&(s+=xv),n&&(s+=uv),r.filter(i=>!Om(i)).reduce((i,l)=>i+(dv.test(l)?hv:l===""?mv:pv),s)}function gv(t,n){return t.length===n.length&&t.slice(0,-1).every((s,i)=>s===n[i])?t[t.length-1]-n[n.length-1]:0}function jv(t,n,r){let{routesMeta:s}=t,i={},l="/",o=[];for(let a=0;a<s.length;++a){let c=s[a],d=a===s.length-1,u=l==="/"?n:n.slice(l.length)||"/",h=yv({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},u),m=c.route;if(!h)return null;Object.assign(i,h.params),o.push({params:i,pathname:Ir([l,h.pathname]),pathnameBase:_v(Ir([l,h.pathnameBase])),route:m}),h.pathnameBase!=="/"&&(l=Ir([l,h.pathnameBase]))}return o}function yv(t,n){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,s]=bv(t.path,t.caseSensitive,t.end),i=n.match(r);if(!i)return null;let l=i[0],o=l.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:s.reduce((d,u,h)=>{let{paramName:m,isOptional:x}=u;if(m==="*"){let b=a[h]||"";o=l.slice(0,l.length-b.length).replace(/(.)\/+$/,"$1")}const j=a[h];return x&&!j?d[m]=void 0:d[m]=(j||"").replace(/%2F/g,"/"),d},{}),pathname:l,pathnameBase:o,pattern:t}}function bv(t,n,r){n===void 0&&(n=!1),r===void 0&&(r=!0),Qh(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let s=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,c)=>(s.push({paramName:a,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(s.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,n?void 0:"i"),s]}function kv(t){try{return t.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return Qh(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+n+").")),t}}function Yh(t,n){if(n==="/")return t;if(!t.toLowerCase().startsWith(n.toLowerCase()))return null;let r=n.endsWith("/")?n.length-1:n.length,s=t.charAt(r);return s&&s!=="/"?null:t.slice(r)||"/"}const vv=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,wv=t=>vv.test(t);function Nv(t,n){n===void 0&&(n="/");let{pathname:r,search:s="",hash:i=""}=typeof t=="string"?ai(t):t,l;if(r)if(wv(r))l=r;else{if(r.includes("//")){let o=r;r=r.replace(/\/\/+/g,"/"),Qh(!1,"Pathnames cannot have embedded double slashes - normalizing "+(o+" -> "+r))}r.startsWith("/")?l=qm(r.substring(1),"/"):l=qm(r,n)}else l=n;return{pathname:l,search:Tv(s),hash:Cv(i)}}function qm(t,n){let r=n.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?r.length>1&&r.pop():i!=="."&&r.push(i)}),r.length>1?r.join("/"):"/"}function bc(t,n,r,s){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+n+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Sv(t){return t.filter((n,r)=>r===0||n.route.path&&n.route.path.length>0)}function wg(t,n){let r=Sv(t);return n?r.map((s,i)=>i===r.length-1?s.pathname:s.pathnameBase):r.map(s=>s.pathnameBase)}function Ng(t,n,r,s){s===void 0&&(s=!1);let i;typeof t=="string"?i=ai(t):(i=bl({},t),gt(!i.pathname||!i.pathname.includes("?"),bc("?","pathname","search",i)),gt(!i.pathname||!i.pathname.includes("#"),bc("#","pathname","hash",i)),gt(!i.search||!i.search.includes("#"),bc("#","search","hash",i)));let l=t===""||i.pathname==="",o=l?"/":i.pathname,a;if(o==null)a=r;else{let h=n.length-1;if(!s&&o.startsWith("..")){let m=o.split("/");for(;m[0]==="..";)m.shift(),h-=1;i.pathname=m.join("/")}a=h>=0?n[h]:"/"}let c=Nv(i,a),d=o&&o!=="/"&&o.endsWith("/"),u=(l||o===".")&&r.endsWith("/");return!c.pathname.endsWith("/")&&(d||u)&&(c.pathname+="/"),c}const Ir=t=>t.join("/").replace(/\/\/+/g,"/"),_v=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Tv=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,Cv=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function Pv(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const Sg=["post","put","patch","delete"];new Set(Sg);const Ev=["get",...Sg];new Set(Ev);/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function kl(){return kl=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},kl.apply(this,arguments)}const Xh=y.createContext(null),Rv=y.createContext(null),ps=y.createContext(null),Ra=y.createContext(null),xs=y.createContext({outlet:null,matches:[],isDataRoute:!1}),_g=y.createContext(null);function Mv(t,n){let{relative:r}=n===void 0?{}:n;Rl()||gt(!1);let{basename:s,navigator:i}=y.useContext(ps),{hash:l,pathname:o,search:a}=Cg(t,{relative:r}),c=o;return s!=="/"&&(c=o==="/"?s:Ir([s,o])),i.createHref({pathname:c,search:a,hash:l})}function Rl(){return y.useContext(Ra)!=null}function fs(){return Rl()||gt(!1),y.useContext(Ra).location}function Tg(t){y.useContext(ps).static||y.useLayoutEffect(t)}function Ml(){let{isDataRoute:t}=y.useContext(xs);return t?Vv():Iv()}function Iv(){Rl()||gt(!1);let t=y.useContext(Xh),{basename:n,future:r,navigator:s}=y.useContext(ps),{matches:i}=y.useContext(xs),{pathname:l}=fs(),o=JSON.stringify(wg(i,r.v7_relativeSplatPath)),a=y.useRef(!1);return Tg(()=>{a.current=!0}),y.useCallback(function(d,u){if(u===void 0&&(u={}),!a.current)return;if(typeof d=="number"){s.go(d);return}let h=Ng(d,JSON.parse(o),l,u.relative==="path");t==null&&n!=="/"&&(h.pathname=h.pathname==="/"?n:Ir([n,h.pathname])),(u.replace?s.replace:s.push)(h,u.state,u)},[n,s,o,l,t])}function Cg(t,n){let{relative:r}=n===void 0?{}:n,{future:s}=y.useContext(ps),{matches:i}=y.useContext(xs),{pathname:l}=fs(),o=JSON.stringify(wg(i,s.v7_relativeSplatPath));return y.useMemo(()=>Ng(t,JSON.parse(o),l,r==="path"),[t,o,l,r])}function Av(t,n){return Dv(t,n)}function Dv(t,n,r,s){Rl()||gt(!1);let{navigator:i}=y.useContext(ps),{matches:l}=y.useContext(xs),o=l[l.length-1],a=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let d=fs(),u;if(n){var h;let N=typeof n=="string"?ai(n):n;c==="/"||(h=N.pathname)!=null&&h.startsWith(c)||gt(!1),u=N}else u=d;let m=u.pathname||"/",x=m;if(c!=="/"){let N=c.replace(/^\//,"").split("/");x="/"+m.replace(/^\//,"").split("/").slice(N.length).join("/")}let j=ov(t,{pathname:x}),b=Bv(j&&j.map(N=>Object.assign({},N,{params:Object.assign({},a,N.params),pathname:Ir([c,i.encodeLocation?i.encodeLocation(N.pathname).pathname:N.pathname]),pathnameBase:N.pathnameBase==="/"?c:Ir([c,i.encodeLocation?i.encodeLocation(N.pathnameBase).pathname:N.pathnameBase])})),l,r,s);return n&&b?y.createElement(Ra.Provider,{value:{location:kl({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:wr.Pop}},b):b}function Lv(){let t=Gv(),n=Pv(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return y.createElement(y.Fragment,null,y.createElement("h2",null,"Unexpected Application Error!"),y.createElement("h3",{style:{fontStyle:"italic"}},n),r?y.createElement("pre",{style:i},r):null,null)}const Fv=y.createElement(Lv,null);class Ov extends y.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,r){return r.location!==n.location||r.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:r.error,location:r.location,revalidation:n.revalidation||r.revalidation}}componentDidCatch(n,r){console.error("React Router caught the following error during render",n,r)}render(){return this.state.error!==void 0?y.createElement(xs.Provider,{value:this.props.routeContext},y.createElement(_g.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function qv(t){let{routeContext:n,match:r,children:s}=t,i=y.useContext(Xh);return i&&i.static&&i.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=r.route.id),y.createElement(xs.Provider,{value:n},s)}function Bv(t,n,r,s){var i;if(n===void 0&&(n=[]),r===void 0&&(r=null),s===void 0&&(s=null),t==null){var l;if(!r)return null;if(r.errors)t=r.matches;else if((l=s)!=null&&l.v7_partialHydration&&n.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let o=t,a=(i=r)==null?void 0:i.errors;if(a!=null){let u=o.findIndex(h=>h.route.id&&(a==null?void 0:a[h.route.id])!==void 0);u>=0||gt(!1),o=o.slice(0,Math.min(o.length,u+1))}let c=!1,d=-1;if(r&&s&&s.v7_partialHydration)for(let u=0;u<o.length;u++){let h=o[u];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(d=u),h.route.id){let{loaderData:m,errors:x}=r,j=h.route.loader&&m[h.route.id]===void 0&&(!x||x[h.route.id]===void 0);if(h.route.lazy||j){c=!0,d>=0?o=o.slice(0,d+1):o=[o[0]];break}}}return o.reduceRight((u,h,m)=>{let x,j=!1,b=null,N=null;r&&(x=a&&h.route.id?a[h.route.id]:void 0,b=h.route.errorElement||Fv,c&&(d<0&&m===0?(Hv("route-fallback"),j=!0,N=null):d===m&&(j=!0,N=h.route.hydrateFallbackElement||null)));let f=n.concat(o.slice(0,m+1)),p=()=>{let g;return x?g=b:j?g=N:h.route.Component?g=y.createElement(h.route.Component,null):h.route.element?g=h.route.element:g=u,y.createElement(qv,{match:h,routeContext:{outlet:u,matches:f,isDataRoute:r!=null},children:g})};return r&&(h.route.ErrorBoundary||h.route.errorElement||m===0)?y.createElement(Ov,{location:r.location,revalidation:r.revalidation,component:b,error:x,children:p(),routeContext:{outlet:null,matches:f,isDataRoute:!0}}):p()},null)}var Pg=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(Pg||{}),Eg=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(Eg||{});function Uv(t){let n=y.useContext(Xh);return n||gt(!1),n}function Kv(t){let n=y.useContext(Rv);return n||gt(!1),n}function zv(t){let n=y.useContext(xs);return n||gt(!1),n}function Rg(t){let n=zv(),r=n.matches[n.matches.length-1];return r.route.id||gt(!1),r.route.id}function Gv(){var t;let n=y.useContext(_g),r=Kv(),s=Rg();return n!==void 0?n:(t=r.errors)==null?void 0:t[s]}function Vv(){let{router:t}=Uv(Pg.UseNavigateStable),n=Rg(Eg.UseNavigateStable),r=y.useRef(!1);return Tg(()=>{r.current=!0}),y.useCallback(function(i,l){l===void 0&&(l={}),r.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,kl({fromRouteId:n},l)))},[t,n])}const Bm={};function Hv(t,n,r){Bm[t]||(Bm[t]=!0)}function $v(t,n){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function Ae(t){gt(!1)}function Wv(t){let{basename:n="/",children:r=null,location:s,navigationType:i=wr.Pop,navigator:l,static:o=!1,future:a}=t;Rl()&&gt(!1);let c=n.replace(/^\/*/,"/"),d=y.useMemo(()=>({basename:c,navigator:l,static:o,future:kl({v7_relativeSplatPath:!1},a)}),[c,a,l,o]);typeof s=="string"&&(s=ai(s));let{pathname:u="/",search:h="",hash:m="",state:x=null,key:j="default"}=s,b=y.useMemo(()=>{let N=Yh(u,c);return N==null?null:{location:{pathname:N,search:h,hash:m,state:x,key:j},navigationType:i}},[c,u,h,m,x,j,i]);return b==null?null:y.createElement(ps.Provider,{value:d},y.createElement(Ra.Provider,{children:r,value:b}))}function Qv(t){let{children:n,location:r}=t;return Av(Dd(n),r)}new Promise(()=>{});function Dd(t,n){n===void 0&&(n=[]);let r=[];return y.Children.forEach(t,(s,i)=>{if(!y.isValidElement(s))return;let l=[...n,i];if(s.type===y.Fragment){r.push.apply(r,Dd(s.props.children,l));return}s.type!==Ae&&gt(!1),!s.props.index||!s.props.children||gt(!1);let o={id:s.props.id||l.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(o.children=Dd(s.props.children,l)),r.push(o)}),r}/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ld(){return Ld=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},Ld.apply(this,arguments)}function Yv(t,n){if(t==null)return{};var r={},s=Object.keys(t),i,l;for(l=0;l<s.length;l++)i=s[l],!(n.indexOf(i)>=0)&&(r[i]=t[i]);return r}function Xv(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function Jv(t,n){return t.button===0&&(!n||n==="_self")&&!Xv(t)}function Fd(t){return t===void 0&&(t=""),new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((n,r)=>{let s=t[r];return n.concat(Array.isArray(s)?s.map(i=>[r,i]):[[r,s]])},[]))}function Zv(t,n){let r=Fd(t);return n&&n.forEach((s,i)=>{r.has(i)||n.getAll(i).forEach(l=>{r.append(i,l)})}),r}const ew=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],tw="6";try{window.__reactRouterVersion=tw}catch{}const nw="startTransition",Um=Hy[nw];function rw(t){let{basename:n,children:r,future:s,window:i}=t,l=y.useRef();l.current==null&&(l.current=sv({window:i,v5Compat:!0}));let o=l.current,[a,c]=y.useState({action:o.action,location:o.location}),{v7_startTransition:d}=s||{},u=y.useCallback(h=>{d&&Um?Um(()=>c(h)):c(h)},[c,d]);return y.useLayoutEffect(()=>o.listen(u),[o,u]),y.useEffect(()=>$v(s),[s]),y.createElement(Wv,{basename:n,children:r,location:a.location,navigationType:a.action,navigator:o,future:s})}const sw=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",iw=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Nr=y.forwardRef(function(n,r){let{onClick:s,relative:i,reloadDocument:l,replace:o,state:a,target:c,to:d,preventScrollReset:u,viewTransition:h}=n,m=Yv(n,ew),{basename:x}=y.useContext(ps),j,b=!1;if(typeof d=="string"&&iw.test(d)&&(j=d,sw))try{let g=new URL(window.location.href),k=d.startsWith("//")?new URL(g.protocol+d):new URL(d),S=Yh(k.pathname,x);k.origin===g.origin&&S!=null?d=S+k.search+k.hash:b=!0}catch{}let N=Mv(d,{relative:i}),f=lw(d,{replace:o,state:a,target:c,preventScrollReset:u,relative:i,viewTransition:h});function p(g){s&&s(g),g.defaultPrevented||f(g)}return y.createElement("a",Ld({},m,{href:j||N,onClick:b||l?s:p,ref:r,target:c}))});var Km;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(Km||(Km={}));var zm;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(zm||(zm={}));function lw(t,n){let{target:r,replace:s,state:i,preventScrollReset:l,relative:o,viewTransition:a}=n===void 0?{}:n,c=Ml(),d=fs(),u=Cg(t,{relative:o});return y.useCallback(h=>{if(Jv(h,r)){h.preventDefault();let m=s!==void 0?s:sa(d)===sa(u);c(t,{replace:m,state:i,preventScrollReset:l,relative:o,viewTransition:a})}},[d,c,u,s,i,r,t,l,o,a])}function ow(t){let n=y.useRef(Fd(t)),r=y.useRef(!1),s=fs(),i=y.useMemo(()=>Zv(s.search,r.current?null:n.current),[s.search]),l=Ml(),o=y.useCallback((a,c)=>{const d=Fd(typeof a=="function"?a(i):a);r.current=!0,l("?"+d,c)},[l,i]);return[i,o]}var Mg={exports:{}};(function(t){var n=typeof window<"u"?window:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:{};/**
 * Prism: Lightweight, robust, elegant syntax highlighting
 *
 * @license MIT <https://opensource.org/licenses/MIT>
 * @author Lea Verou <https://lea.verou.me>
 * @namespace
 * @public
 */var r=function(s){var i=/(?:^|\s)lang(?:uage)?-([\w-]+)(?=\s|$)/i,l=0,o={},a={manual:s.Prism&&s.Prism.manual,disableWorkerMessageHandler:s.Prism&&s.Prism.disableWorkerMessageHandler,util:{encode:function p(g){return g instanceof c?new c(g.type,p(g.content),g.alias):Array.isArray(g)?g.map(p):g.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(p){return Object.prototype.toString.call(p).slice(8,-1)},objId:function(p){return p.__id||Object.defineProperty(p,"__id",{value:++l}),p.__id},clone:function p(g,k){k=k||{};var S,_;switch(a.util.type(g)){case"Object":if(_=a.util.objId(g),k[_])return k[_];S={},k[_]=S;for(var E in g)g.hasOwnProperty(E)&&(S[E]=p(g[E],k));return S;case"Array":return _=a.util.objId(g),k[_]?k[_]:(S=[],k[_]=S,g.forEach(function(D,L){S[L]=p(D,k)}),S);default:return g}},getLanguage:function(p){for(;p;){var g=i.exec(p.className);if(g)return g[1].toLowerCase();p=p.parentElement}return"none"},setLanguage:function(p,g){p.className=p.className.replace(RegExp(i,"gi"),""),p.classList.add("language-"+g)},currentScript:function(){if(typeof document>"u")return null;if(document.currentScript&&document.currentScript.tagName==="SCRIPT")return document.currentScript;try{throw new Error}catch(S){var p=(/at [^(\r\n]*\((.*):[^:]+:[^:]+\)$/i.exec(S.stack)||[])[1];if(p){var g=document.getElementsByTagName("script");for(var k in g)if(g[k].src==p)return g[k]}return null}},isActive:function(p,g,k){for(var S="no-"+g;p;){var _=p.classList;if(_.contains(g))return!0;if(_.contains(S))return!1;p=p.parentElement}return!!k}},languages:{plain:o,plaintext:o,text:o,txt:o,extend:function(p,g){var k=a.util.clone(a.languages[p]);for(var S in g)k[S]=g[S];return k},insertBefore:function(p,g,k,S){S=S||a.languages;var _=S[p],E={};for(var D in _)if(_.hasOwnProperty(D)){if(D==g)for(var L in k)k.hasOwnProperty(L)&&(E[L]=k[L]);k.hasOwnProperty(D)||(E[D]=_[D])}var T=S[p];return S[p]=E,a.languages.DFS(a.languages,function(P,I){I===T&&P!=p&&(this[P]=E)}),E},DFS:function p(g,k,S,_){_=_||{};var E=a.util.objId;for(var D in g)if(g.hasOwnProperty(D)){k.call(g,D,g[D],S||D);var L=g[D],T=a.util.type(L);T==="Object"&&!_[E(L)]?(_[E(L)]=!0,p(L,k,null,_)):T==="Array"&&!_[E(L)]&&(_[E(L)]=!0,p(L,k,D,_))}}},plugins:{},highlightAll:function(p,g){a.highlightAllUnder(document,p,g)},highlightAllUnder:function(p,g,k){var S={callback:k,container:p,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};a.hooks.run("before-highlightall",S),S.elements=Array.prototype.slice.apply(S.container.querySelectorAll(S.selector)),a.hooks.run("before-all-elements-highlight",S);for(var _=0,E;E=S.elements[_++];)a.highlightElement(E,g===!0,S.callback)},highlightElement:function(p,g,k){var S=a.util.getLanguage(p),_=a.languages[S];a.util.setLanguage(p,S);var E=p.parentElement;E&&E.nodeName.toLowerCase()==="pre"&&a.util.setLanguage(E,S);var D=p.textContent,L={element:p,language:S,grammar:_,code:D};function T(I){L.highlightedCode=I,a.hooks.run("before-insert",L),L.element.innerHTML=L.highlightedCode,a.hooks.run("after-highlight",L),a.hooks.run("complete",L),k&&k.call(L.element)}if(a.hooks.run("before-sanity-check",L),E=L.element.parentElement,E&&E.nodeName.toLowerCase()==="pre"&&!E.hasAttribute("tabindex")&&E.setAttribute("tabindex","0"),!L.code){a.hooks.run("complete",L),k&&k.call(L.element);return}if(a.hooks.run("before-highlight",L),!L.grammar){T(a.util.encode(L.code));return}if(g&&s.Worker){var P=new Worker(a.filename);P.onmessage=function(I){T(I.data)},P.postMessage(JSON.stringify({language:L.language,code:L.code,immediateClose:!0}))}else T(a.highlight(L.code,L.grammar,L.language))},highlight:function(p,g,k){var S={code:p,grammar:g,language:k};if(a.hooks.run("before-tokenize",S),!S.grammar)throw new Error('The language "'+S.language+'" has no grammar.');return S.tokens=a.tokenize(S.code,S.grammar),a.hooks.run("after-tokenize",S),c.stringify(a.util.encode(S.tokens),S.language)},tokenize:function(p,g){var k=g.rest;if(k){for(var S in k)g[S]=k[S];delete g.rest}var _=new h;return m(_,_.head,p),u(p,_,g,_.head,0),j(_)},hooks:{all:{},add:function(p,g){var k=a.hooks.all;k[p]=k[p]||[],k[p].push(g)},run:function(p,g){var k=a.hooks.all[p];if(!(!k||!k.length))for(var S=0,_;_=k[S++];)_(g)}},Token:c};s.Prism=a;function c(p,g,k,S){this.type=p,this.content=g,this.alias=k,this.length=(S||"").length|0}c.stringify=function p(g,k){if(typeof g=="string")return g;if(Array.isArray(g)){var S="";return g.forEach(function(T){S+=p(T,k)}),S}var _={type:g.type,content:p(g.content,k),tag:"span",classes:["token",g.type],attributes:{},language:k},E=g.alias;E&&(Array.isArray(E)?Array.prototype.push.apply(_.classes,E):_.classes.push(E)),a.hooks.run("wrap",_);var D="";for(var L in _.attributes)D+=" "+L+'="'+(_.attributes[L]||"").replace(/"/g,"&quot;")+'"';return"<"+_.tag+' class="'+_.classes.join(" ")+'"'+D+">"+_.content+"</"+_.tag+">"};function d(p,g,k,S){p.lastIndex=g;var _=p.exec(k);if(_&&S&&_[1]){var E=_[1].length;_.index+=E,_[0]=_[0].slice(E)}return _}function u(p,g,k,S,_,E){for(var D in k)if(!(!k.hasOwnProperty(D)||!k[D])){var L=k[D];L=Array.isArray(L)?L:[L];for(var T=0;T<L.length;++T){if(E&&E.cause==D+","+T)return;var P=L[T],I=P.inside,O=!!P.lookbehind,X=!!P.greedy,J=P.alias;if(X&&!P.pattern.global){var re=P.pattern.toString().match(/[imsuy]*$/)[0];P.pattern=RegExp(P.pattern.source,re+"g")}for(var ne=P.pattern||P,A=S.next,B=_;A!==g.tail&&!(E&&B>=E.reach);B+=A.value.length,A=A.next){var v=A.value;if(g.length>p.length)return;if(!(v instanceof c)){var F=1,z;if(X){if(z=d(ne,B,p,O),!z||z.index>=p.length)break;var Q=z.index,w=z.index+z[0].length,Z=B;for(Z+=A.value.length;Q>=Z;)A=A.next,Z+=A.value.length;if(Z-=A.value.length,B=Z,A.value instanceof c)continue;for(var K=A;K!==g.tail&&(Z<w||typeof K.value=="string");K=K.next)F++,Z+=K.value.length;F--,v=p.slice(B,Z),z.index-=B}else if(z=d(ne,0,v,O),!z)continue;var Q=z.index,Y=z[0],ee=v.slice(0,Q),C=v.slice(Q+Y.length),R=B+v.length;E&&R>E.reach&&(E.reach=R);var $=A.prev;ee&&($=m(g,$,ee),B+=ee.length),x(g,$,F);var ie=new c(D,I?a.tokenize(Y,I):Y,J,Y);if(A=m(g,$,ie),C&&m(g,A,C),F>1){var ce={cause:D+","+T,reach:R};u(p,g,k,A.prev,B,ce),E&&ce.reach>E.reach&&(E.reach=ce.reach)}}}}}}function h(){var p={value:null,prev:null,next:null},g={value:null,prev:p,next:null};p.next=g,this.head=p,this.tail=g,this.length=0}function m(p,g,k){var S=g.next,_={value:k,prev:g,next:S};return g.next=_,S.prev=_,p.length++,_}function x(p,g,k){for(var S=g.next,_=0;_<k&&S!==p.tail;_++)S=S.next;g.next=S,S.prev=g,p.length-=_}function j(p){for(var g=[],k=p.head.next;k!==p.tail;)g.push(k.value),k=k.next;return g}if(!s.document)return s.addEventListener&&(a.disableWorkerMessageHandler||s.addEventListener("message",function(p){var g=JSON.parse(p.data),k=g.language,S=g.code,_=g.immediateClose;s.postMessage(a.highlight(S,a.languages[k],k)),_&&s.close()},!1)),a;var b=a.util.currentScript();b&&(a.filename=b.src,b.hasAttribute("data-manual")&&(a.manual=!0));function N(){a.manual||a.highlightAll()}if(!a.manual){var f=document.readyState;f==="loading"||f==="interactive"&&b&&b.defer?document.addEventListener("DOMContentLoaded",N):window.requestAnimationFrame?window.requestAnimationFrame(N):window.setTimeout(N,16)}return a}(n);t.exports&&(t.exports=r),typeof Ws<"u"&&(Ws.Prism=r),r.languages.markup={comment:{pattern:/<!--(?:(?!<!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},r.languages.markup.tag.inside["attr-value"].inside.entity=r.languages.markup.entity,r.languages.markup.doctype.inside["internal-subset"].inside=r.languages.markup,r.hooks.add("wrap",function(s){s.type==="entity"&&(s.attributes.title=s.content.replace(/&amp;/,"&"))}),Object.defineProperty(r.languages.markup.tag,"addInlined",{value:function(i,l){var o={};o["language-"+l]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:r.languages[l]},o.cdata=/^<!\[CDATA\[|\]\]>$/i;var a={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:o}};a["language-"+l]={pattern:/[\s\S]+/,inside:r.languages[l]};var c={};c[i]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,function(){return i}),"i"),lookbehind:!0,greedy:!0,inside:a},r.languages.insertBefore("markup","cdata",c)}}),Object.defineProperty(r.languages.markup.tag,"addAttribute",{value:function(s,i){r.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+s+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[i,"language-"+i],inside:r.languages[i]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}}),r.languages.html=r.languages.markup,r.languages.mathml=r.languages.markup,r.languages.svg=r.languages.markup,r.languages.xml=r.languages.extend("markup",{}),r.languages.ssml=r.languages.xml,r.languages.atom=r.languages.xml,r.languages.rss=r.languages.xml,function(s){var i=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;s.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:"+/[^;{\s"']|\s+(?!\s)/.source+"|"+i.source+")*?"+/(?:;|(?=\s*\{))/.source),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+i.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+i.source+"$"),alias:"url"}}},selector:{pattern:RegExp(`(^|[{}\\s])[^{}\\s](?:[^{};"'\\s]|\\s+(?![\\s{])|`+i.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:i,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},s.languages.css.atrule.inside.rest=s.languages.css;var l=s.languages.markup;l&&(l.tag.addInlined("style","css"),l.tag.addAttribute("style","css"))}(r),r.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/},r.languages.javascript=r.languages.extend("clike",{"class-name":[r.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+(/NaN|Infinity/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source)+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/}),r.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/,r.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:r.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:r.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:r.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:r.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:r.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),r.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:r.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}}),r.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}}),r.languages.markup&&(r.languages.markup.tag.addInlined("script","javascript"),r.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript")),r.languages.js=r.languages.javascript,function(){if(typeof r>"u"||typeof document>"u")return;Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);var s="Loading",i=function(b,N){return" Error "+b+" while fetching file: "+N},l=" Error: File does not exist or is empty",o={js:"javascript",py:"python",rb:"ruby",ps1:"powershell",psm1:"powershell",sh:"bash",bat:"batch",h:"c",tex:"latex"},a="data-src-status",c="loading",d="loaded",u="failed",h="pre[data-src]:not(["+a+'="'+d+'"]):not(['+a+'="'+c+'"])';function m(b,N,f){var p=new XMLHttpRequest;p.open("GET",b,!0),p.onreadystatechange=function(){p.readyState==4&&(p.status<400&&p.responseText?N(p.responseText):p.status>=400?f(i(p.status,p.statusText)):f(l))},p.send(null)}function x(b){var N=/^\s*(\d+)\s*(?:(,)\s*(?:(\d+)\s*)?)?$/.exec(b||"");if(N){var f=Number(N[1]),p=N[2],g=N[3];return p?g?[f,Number(g)]:[f,void 0]:[f,f]}}r.hooks.add("before-highlightall",function(b){b.selector+=", "+h}),r.hooks.add("before-sanity-check",function(b){var N=b.element;if(N.matches(h)){b.code="",N.setAttribute(a,c);var f=N.appendChild(document.createElement("CODE"));f.textContent=s;var p=N.getAttribute("data-src"),g=b.language;if(g==="none"){var k=(/\.(\w+)$/.exec(p)||[,"none"])[1];g=o[k]||k}r.util.setLanguage(f,g),r.util.setLanguage(N,g);var S=r.plugins.autoloader;S&&S.loadLanguages(g),m(p,function(_){N.setAttribute(a,d);var E=x(N.getAttribute("data-range"));if(E){var D=_.split(/\r\n?|\n/g),L=E[0],T=E[1]==null?D.length:E[1];L<0&&(L+=D.length),L=Math.max(0,Math.min(L-1,D.length)),T<0&&(T+=D.length),T=Math.max(0,Math.min(T,D.length)),_=D.slice(L,T).join(`
`),N.hasAttribute("data-start")||N.setAttribute("data-start",String(L+1))}f.textContent=_,r.highlightElement(f)},function(_){N.setAttribute(a,u),f.textContent=_})}}),r.plugins.fileHighlight={highlight:function(N){for(var f=(N||document).querySelectorAll(h),p=0,g;g=f[p++];)r.highlightElement(g)}};var j=!1;r.fileHighlight=function(){j||(console.warn("Prism.fileHighlight is deprecated. Use `Prism.plugins.fileHighlight.highlight` instead."),j=!0),r.plugins.fileHighlight.highlight.apply(this,arguments)}}()})(Mg);var aw=Mg.exports;const qs=ma(aw);class cw{constructor(){Su(this,"baseUrl","/v1")}async parseErrorMessage(n){var s;let r=`HTTP ${n.status}`;try{const i=await n.text();try{const l=JSON.parse(i);r=((s=l==null?void 0:l.error)==null?void 0:s.message)??r}catch{i&&(r=`${r}: ${i.slice(0,200)}`)}}catch{}return r}async request(n,r={}){const s=await fetch(`${this.baseUrl}${n}`,{...r,headers:{"Content-Type":"application/json",...r.headers}});if(!s.ok)throw new Error(await this.parseErrorMessage(s));if(s.status!==204)return s.json()}async listModels(){return this.request("/models")}async listModelsExtended(){return this.request("/models?extended-config=true")}async rebuildModelIndex(){const n=await fetch(`${this.baseUrl}/models/index`,{method:"POST"});if(!n.ok)throw new Error(await this.parseErrorMessage(n))}async listRunningModels(){return this.request("/models/ps")}async unloadModel(n){await this.request("/models/unload",{method:"POST",body:JSON.stringify({id:n})})}async showModel(n){return this.request(`/models/${encodeURIComponent(n)}`)}async getLibsVersion(){return this.request("/libs")}async pullModelAsync(n){const r=await fetch(`${this.baseUrl}/models/pull`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model_url:n,async:!0})});if(!r.ok)throw new Error(await this.parseErrorMessage(r));return r.json()}streamPullSession(n,r,s,i){const l=new AbortController;return fetch(`${this.baseUrl}/models/pull/${encodeURIComponent(n)}`,{method:"GET",signal:l.signal}).then(async o=>{var u;if(o.status===400){s("Session closed");return}if(!o.ok){s(`HTTP ${o.status}`);return}const a=(u=o.body)==null?void 0:u.getReader();if(!a){s("Streaming not supported");return}const c=new TextDecoder;let d="";for(;;){const{done:h,value:m}=await a.read();if(h)break;d+=c.decode(m,{stream:!0});const x=d.split(`
`);d=x.pop()||"";for(const j of x){if(!j.trim())continue;const b=j.startsWith("data: ")?j.slice(6):j;if(b.trim())try{const N=JSON.parse(b);if(r(N),N.status==="downloaded"||N.downloaded){i();return}}catch{s("Failed to parse response")}}}i()}).catch(o=>{o.name!=="AbortError"&&s("Connection error")}),()=>l.abort()}pullModel(n,r,s,i,l){const o=new AbortController,a={model_url:n};return r&&(a.proj_url=r),fetch(`${this.baseUrl}/models/pull`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),signal:o.signal}).then(async c=>{var m;if(!c.ok){i(`HTTP ${c.status}`);return}const d=(m=c.body)==null?void 0:m.getReader();if(!d){i("Streaming not supported");return}const u=new TextDecoder;let h="";for(;;){const{done:x,value:j}=await d.read();if(x)break;h+=u.decode(j,{stream:!0});const b=h.split(`
`);h=b.pop()||"";for(const N of b){if(!N.trim())continue;const f=N.startsWith("data: ")?N.slice(6):N;if(f.trim())try{const p=JSON.parse(f);if(s(p),p.status==="complete"||p.downloaded){l();return}}catch{i("Failed to parse response")}}}l()}).catch(c=>{c.name!=="AbortError"&&i("Connection error")}),()=>o.abort()}async removeModel(n){await this.request(`/models/${encodeURIComponent(n)}`,{method:"DELETE"})}async listCatalog(){return this.request("/catalog")}async showCatalogModel(n){return this.request(`/catalog/${encodeURIComponent(n)}`)}pullCatalogModel(n,r,s,i,l){const o=new AbortController,a={};return l&&(a.download_server=l),fetch(`${this.baseUrl}/catalog/pull/${encodeURIComponent(n)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),signal:o.signal}).then(async c=>{var m;if(!c.ok){s(`HTTP ${c.status}`);return}const d=(m=c.body)==null?void 0:m.getReader();if(!d){s("Streaming not supported");return}const u=new TextDecoder;let h="";for(;;){const{done:x,value:j}=await d.read();if(x)break;h+=u.decode(j,{stream:!0});const b=h.split(`
`);h=b.pop()||"";for(const N of b){if(!N.trim())continue;const f=N.startsWith("data: ")?N.slice(6):N;if(f.trim())try{const p=JSON.parse(f);if(r(p),p.status==="complete"||p.downloaded){i();return}}catch{s("Failed to parse response")}}}i()}).catch(c=>{c.name!=="AbortError"&&s("Connection error")}),()=>o.abort()}pullLibs(n,r,s,i,l){const o=new AbortController,a=new URLSearchParams;i&&a.set("allow-upgrade","true"),l&&a.set("version",l);const c=a.toString(),d=c?`${this.baseUrl}/libs/pull?${c}`:`${this.baseUrl}/libs/pull`;return fetch(d,{method:"POST",signal:o.signal}).then(async u=>{var j;if(!u.ok){r(`HTTP ${u.status}`);return}const h=(j=u.body)==null?void 0:j.getReader();if(!h){r("Streaming not supported");return}const m=new TextDecoder;let x="";for(;;){const{done:b,value:N}=await h.read();if(b)break;x+=m.decode(N,{stream:!0});const f=x.split(`
`);x=f.pop()||"";for(const p of f){if(!p.trim())continue;const g=p.startsWith("data: ")?p.slice(6):p;if(g.trim())try{const k=JSON.parse(g);if(n(k),k.status==="complete"){s();return}}catch{r("Failed to parse response")}}}s()}).catch(u=>{u.name!=="AbortError"&&r("Connection error")}),()=>o.abort()}async listKeys(n){return this.request("/security/keys",{headers:{Authorization:`Bearer ${n}`}})}async createKey(n){return this.request("/security/keys/add",{method:"POST",headers:{Authorization:`Bearer ${n}`}})}async deleteKey(n,r){await this.request(`/security/keys/remove/${encodeURIComponent(r)}`,{method:"POST",headers:{Authorization:`Bearer ${n}`}})}async createToken(n,r){return this.request("/security/token/create",{method:"POST",headers:{Authorization:`Bearer ${n}`},body:JSON.stringify(r)})}streamChat(n,r,s,i,l){const o=new AbortController,a={"Content-Type":"application/json"};return l&&(a.KRONK_CACHE_ID=l),fetch(`${this.baseUrl}/chat/completions`,{method:"POST",headers:a,body:JSON.stringify({...n,stream:!0}),signal:o.signal}).then(async c=>{var m;if(!c.ok){s(await this.parseErrorMessage(c));return}const d=(m=c.body)==null?void 0:m.getReader();if(!d){s("Streaming not supported");return}const u=new TextDecoder;let h="";for(;;){const{done:x,value:j}=await d.read();if(x)break;h+=u.decode(j,{stream:!0});const b=h.split(`
`);h=b.pop()||"";for(const N of b){if(!N.trim()||N==="data: [DONE]")continue;const f=N.startsWith("data: ")?N.slice(6):N;if(f.trim())try{const p=JSON.parse(f);r(p)}catch{}}}i()}).catch(c=>{c.name!=="AbortError"&&s(c.message||"Connection error")}),()=>o.abort()}async lookupHuggingFace(n){return this.request("/catalog/lookup",{method:"POST",body:JSON.stringify({input:n})})}async saveCatalogModel(n){return this.request("/catalog/save",{method:"POST",body:JSON.stringify(n)})}async deleteCatalogModel(n){return this.request(`/catalog/${encodeURIComponent(n)}`,{method:"DELETE"})}async listCatalogFiles(){return this.request("/catalog-files")}async publishCatalogModel(n){return this.request("/catalog/publish",{method:"POST",body:JSON.stringify({catalog_file:n})})}async getCatalogRepoPath(){return this.request("/catalog-repo-path")}async calculateVRAM(n,r){const s={};return r&&(s.Authorization=`Bearer ${r}`),this.request("/models/vram",{method:"POST",headers:s,body:JSON.stringify(n)})}async listGrammars(){return this.request("/grammars")}async getGrammarContent(n){return this.request(`/grammars/${encodeURIComponent(n)}`)}async listTemplates(){return this.request("/templates")}async listPlaygroundTemplates(){return(await this.request("/playground/templates")).templates}async getPlaygroundTemplate(n){return this.request(`/playground/templates/${encodeURIComponent(n)}`)}async savePlaygroundTemplate(n,r){await this.request("/playground/templates/save",{method:"POST",body:JSON.stringify({name:n,script:r})})}async createPlaygroundSession(n){return this.request("/playground/sessions",{method:"POST",body:JSON.stringify(n)})}async deletePlaygroundSession(n){await this.request(`/playground/sessions/${encodeURIComponent(n)}`,{method:"DELETE"})}streamPlaygroundChat(n,r,s,i){const l=new AbortController;return fetch(`${this.baseUrl}/playground/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...n,stream:!0}),signal:l.signal}).then(async o=>{var m;if(!o.ok){s(await this.parseErrorMessage(o));return}const a=(m=o.body)==null?void 0:m.getReader();if(!a){s("Streaming not supported");return}const c=new TextDecoder;let d="",u=!1;const h=x=>{const j=x.trim();if(!j||j.startsWith("event:")||j.startsWith(":"))return;const b=j.startsWith("data:")?j.slice(5).trim():j;if(b){if(b==="[DONE]"){u=!0;return}try{r(JSON.parse(b))}catch{}}};for(;;){const{done:x,value:j}=await a.read();if(x)break;d+=c.decode(j,{stream:!0});const b=d.split(`
`);d=b.pop()||"";for(const N of b)h(N)}d+=c.decode(),d&&h(d),u?i():s("Stream terminated: server closed connection before completion")}).catch(o=>{o.name!=="AbortError"&&s(o.message||"Connection error")}),()=>l.abort()}}const fe=new cw,Ig=y.createContext(null);function dw({children:t}){const[n,r]=y.useState(null),[s,i]=y.useState(!1),[l,o]=y.useState(null),[a,c]=y.useState(!1),d=y.useCallback(async()=>{if(!(a&&n)){i(!0),o(null);try{const h=await fe.listModels();r(h),c(!0)}catch(h){o(h instanceof Error?h.message:"Failed to load models")}finally{i(!1)}}},[a,n]),u=y.useCallback(()=>{c(!1),r(null)},[]);return e.jsx(Ig.Provider,{value:{models:n,loading:s,error:l,loadModels:d,invalidate:u},children:t})}function Ma(){const t=y.useContext(Ig);if(!t)throw new Error("useModelList must be used within a ModelListProvider");return t}const Ag=y.createContext(null);function hw({children:t}){const{invalidate:n}=Ma(),[r,s]=y.useState(null),i=y.useRef(null),l="\r\x1B[K",o=y.useCallback((b,N)=>{s(f=>f&&{...f,messages:[...f.messages,{text:b,type:N}]})},[]),a=y.useCallback((b,N)=>{s(f=>{if(!f)return f;if(f.messages.length===0)return{...f,messages:[{text:b,type:N}]};const p=[...f.messages];return p[p.length-1]={text:b,type:N},{...f,messages:p}})},[]),c=y.useCallback((b,N,f)=>{i.current=fe.pullModel(b,N,p=>{if(p.status)if(p.status.startsWith(l)){const g=p.status.slice(l.length);a(g,"info")}else o(p.status,"info");p.model_file&&o(`Model file: ${p.model_file}`,"info")},p=>{o(p,"error"),s(g=>g&&{...g,status:"error"}),i.current=null},f)},[o,a]),d=y.useCallback((b,N)=>{i.current||(s({kind:"model",modelUrl:b,messages:[],status:"downloading"}),c(b,N,()=>{o("Pull complete!","success"),s(f=>f&&{...f,status:"complete"}),i.current=null,n()}))},[c,o,n]),u=y.useCallback((b,N)=>{if(i.current||b.length===0)return;const f=b.length;s({kind:"model",modelUrl:b[0],modelUrls:b,currentIndex:0,messages:[{text:`Starting pull 1 of ${f}: ${b[0]}`,type:"info"}],status:"downloading"});const p=g=>{const k=g===0?N:void 0;c(b[g],k,()=>{o(`Pull complete for: ${b[g]}`,"success"),i.current=null;const S=g+1;S<f?(o(`Starting pull ${S+1} of ${f}: ${b[S]}`,"info"),s(_=>_&&{..._,modelUrl:b[S],currentIndex:S}),p(S)):(o("All pulls complete!","success"),s(_=>_&&{..._,status:"complete"}),n())})};p(0)},[c,o,n]),h=y.useCallback((b,N)=>{i.current||(s({kind:"catalog",modelUrl:b,catalogId:b,messages:[],status:"downloading"}),i.current=fe.pullCatalogModel(b,f=>{if(f.status)if(f.status.startsWith(l)){const p=f.status.slice(l.length);a(p,"info")}else o(f.status,"info");f.model_file&&o(`Model file: ${f.model_file}`,"info")},f=>{o(f,"error"),s(p=>p&&{...p,status:"error"}),i.current=null},()=>{o("Pull complete!","success"),s(f=>f&&{...f,status:"complete"}),i.current=null,n()},N))},[o,a,n]),m=y.useCallback(()=>{i.current&&(i.current(),i.current=null),s(b=>b&&{...b,messages:[...b.messages,{text:"Cancelled",type:"error"}],status:"error"})},[]),x=y.useCallback(()=>{i.current&&(i.current(),i.current=null),s(null)},[]),j=(r==null?void 0:r.status)==="downloading";return e.jsx(Ag.Provider,{value:{download:r,isDownloading:j,startDownload:d,startBatchDownload:u,startCatalogDownload:h,cancelDownload:m,clearDownload:x},children:t})}function Ia(){const t=y.useContext(Ag);if(!t)throw new Error("useDownload must be used within a DownloadProvider");return t}const Gm=3e3,Dg=1e4,co=1e4;function uw(t,n){return new Promise((r,s)=>{if(n.aborted){s(new DOMException("Aborted","AbortError"));return}const i=setTimeout(()=>{n.removeEventListener("abort",l),r()},t);function l(){clearTimeout(i),s(new DOMException("Aborted","AbortError"))}n.addEventListener("abort",l,{once:!0})})}const te=[{type:"function",function:{name:"get_weather",description:"Get current weather for a city",parameters:{type:"object",properties:{location:{type:"string",description:"City name"},unit:{type:"string",enum:["celsius","fahrenheit"]}},required:["location"]}}},{type:"function",function:{name:"add",description:"Add two numbers",parameters:{type:"object",properties:{a:{type:"number"},b:{type:"number"}},required:["a","b"]}}},{type:"function",function:{name:"search_products",description:"Search for products by name or category",parameters:{type:"object",properties:{query:{type:"string",description:"Search query"},category:{type:"string",description:"Product category"},max_results:{type:"number",description:"Maximum number of results to return"}},required:["query"]}}},{type:"function",function:{name:"send_email",description:"Send an email to a recipient",parameters:{type:"object",properties:{to:{type:"string",description:"Recipient email address"},subject:{type:"string",description:"Email subject line"},body:{type:"string",description:"Email body content"}},required:["to","subject","body"]}}},{type:"function",function:{name:"get_stock_price",description:"Get the current stock price for a ticker symbol",parameters:{type:"object",properties:{symbol:{type:"string",description:"Stock ticker symbol (e.g. AAPL)"}},required:["symbol"]}}},{type:"function",function:{name:"convert_currency",description:"Convert an amount from one currency to another",parameters:{type:"object",properties:{amount:{type:"number",description:"Amount to convert"},from:{type:"string",description:"Source currency code (e.g. USD)"},to:{type:"string",description:"Target currency code (e.g. EUR)"}},required:["amount","from","to"]}}},{type:"function",function:{name:"create_calendar_event",description:"Create a calendar event",parameters:{type:"object",properties:{title:{type:"string",description:"Event title"},date:{type:"string",description:"Event date in YYYY-MM-DD format"},time:{type:"string",description:"Event time in HH:MM format"},duration_minutes:{type:"number",description:"Duration in minutes"}},required:["title","date","time"]}}},{type:"function",function:{name:"translate_text",description:"Translate text from one language to another",parameters:{type:"object",properties:{text:{type:"string",description:"Text to translate"},source_language:{type:"string",description:"Source language code (e.g. en)"},target_language:{type:"string",description:"Target language code (e.g. fr)"}},required:["text","target_language"]}}},{type:"function",function:{name:"get_directions",description:"Get driving directions between two locations",parameters:{type:"object",properties:{origin:{type:"string",description:"Starting location"},destination:{type:"string",description:"Destination location"},mode:{type:"string",enum:["driving","walking","transit"],description:"Travel mode"}},required:["origin","destination"]}}},{type:"function",function:{name:"set_reminder",description:"Set a reminder for a specific time",parameters:{type:"object",properties:{message:{type:"string",description:"Reminder message"},datetime:{type:"string",description:"When to trigger the reminder (ISO 8601)"}},required:["message","datetime"]}}}],W="You are a helpful assistant. You answer concisely and accurately. When asked for numbers, respond with only the number. When asked for lists, use numbered format.",ia={id:"chat",name:"Chat Quality",prompts:[{id:"math-multiply",messages:[{role:"system",content:W},{role:"user",content:"What is 17 * 19? Answer with only the number."}],expected:{type:"exact",value:"323"}},{id:"list-benefits",messages:[{role:"system",content:W},{role:"user",content:"List exactly 3 benefits of exercise. Use a numbered list."}],expected:{type:"regex",value:"^\\s*1[.)]\\s+.+\\n\\s*2[.)]\\s+.+\\n\\s*3[.)]\\s+.+"}},{id:"translate-french",messages:[{role:"system",content:W},{role:"user",content:"Translate 'Good morning' to French. Answer with only the translation."}],expected:{type:"regex",value:"bonjour"}},{id:"multi-turn-2",messages:[{role:"system",content:W},{role:"user",content:"What is the capital of France?"},{role:"assistant",content:"Paris"},{role:"user",content:"What is the population of that city? Answer with only the approximate number."}],expected:{type:"regex",value:"\\d"}},{id:"multi-turn-4",messages:[{role:"system",content:W},{role:"user",content:"What is the capital of France?"},{role:"assistant",content:"Paris"},{role:"user",content:"What is the population of that city? Answer with only the approximate number."},{role:"assistant",content:"Approximately 2.1 million in the city proper."},{role:"user",content:"Name exactly 3 famous landmarks there. Use a numbered list."}],expected:{type:"regex",value:"1[.)]"}},{id:"multi-turn-6",messages:[{role:"system",content:W},{role:"user",content:"What is the capital of France?"},{role:"assistant",content:"Paris"},{role:"user",content:"What is the population of that city? Answer with only the approximate number."},{role:"assistant",content:"Approximately 2.1 million in the city proper."},{role:"user",content:"Name exactly 3 famous landmarks there. Use a numbered list."},{role:"assistant",content:`1. Eiffel Tower
2. Louvre Museum
3. Notre-Dame Cathedral`},{role:"user",content:"When was the first one built? Answer with only the year."}],expected:{type:"regex",value:"18(87|89)"}},{id:"math-addition",messages:[{role:"system",content:W},{role:"user",content:"What is 456 + 789? Answer with only the number."}],expected:{type:"exact",value:"1245"}},{id:"math-division",messages:[{role:"system",content:W},{role:"user",content:"What is 144 / 12? Answer with only the number."}],expected:{type:"exact",value:"12"}},{id:"translate-spanish",messages:[{role:"system",content:W},{role:"user",content:"Translate 'Thank you very much' to Spanish. Answer with only the translation."}],expected:{type:"regex",value:"[Mm]uchas\\s+[Gg]racias"}},{id:"country-capital",messages:[{role:"system",content:W},{role:"user",content:"What is the capital of Japan? Answer with only the city name."}],expected:{type:"exact",value:"Tokyo"}},{id:"list-planets",messages:[{role:"system",content:W},{role:"user",content:"List the 4 inner planets of our solar system. Use a numbered list."}],expected:{type:"regex",value:"1[.)].*[Mm]ercury"}},{id:"acronym",messages:[{role:"system",content:W},{role:"user",content:"What does the acronym HTTP stand for? Answer with only the full form."}],expected:{type:"regex",value:"[Hh]yper[Tt]ext\\s+[Tt]ransfer\\s+[Pp]rotocol"}},{id:"multi-turn-8",messages:[{role:"system",content:W},{role:"user",content:"What is the capital of France?"},{role:"assistant",content:"Paris"},{role:"user",content:"What is the population of that city? Answer with only the approximate number."},{role:"assistant",content:"Approximately 2.1 million in the city proper."},{role:"user",content:"Name exactly 3 famous landmarks there. Use a numbered list."},{role:"assistant",content:`1. Eiffel Tower
2. Louvre Museum
3. Notre-Dame Cathedral`},{role:"user",content:"When was the first one built? Answer with only the year."},{role:"assistant",content:"1889"},{role:"user",content:"How tall is it in meters? Answer with only the number."}],expected:{type:"regex",value:"3(00|30)"}},{id:"multi-turn-10",messages:[{role:"system",content:W},{role:"user",content:"What is the capital of France?"},{role:"assistant",content:"Paris"},{role:"user",content:"What is the population of that city? Answer with only the approximate number."},{role:"assistant",content:"Approximately 2.1 million in the city proper."},{role:"user",content:"Name exactly 3 famous landmarks there. Use a numbered list."},{role:"assistant",content:`1. Eiffel Tower
2. Louvre Museum
3. Notre-Dame Cathedral`},{role:"user",content:"When was the first one built? Answer with only the year."},{role:"assistant",content:"1889"},{role:"user",content:"How tall is it in meters? Answer with only the number."},{role:"assistant",content:"330"},{role:"user",content:"Who designed it? Answer with only the name."}],expected:{type:"regex",value:"[Ee]iffel"}},{id:"math-square-root",messages:[{role:"system",content:W},{role:"user",content:"What is the square root of 256? Answer with only the number."}],expected:{type:"exact",value:"16"}}]},Vm=["The distributed caching layer uses a consistent hashing ring with 256 virtual nodes per physical server. When a node joins or leaves the cluster, only K/N keys need to be redistributed, where K is the total number of keys and N is the number of nodes. The system maintains a replication factor of 3, meaning each key-value pair is stored on three consecutive nodes in the ring. Write operations require acknowledgment from at least two replicas before returning success to the client. Read operations can be configured for either strong consistency (read from all replicas and return the latest version) or eventual consistency (read from the nearest replica). The cache eviction policy uses a combination of LRU and TTL-based expiration. Each entry has a maximum TTL of 24 hours, but frequently accessed entries are kept in a hot tier with faster access times. The system processes approximately 50,000 requests per second per node with a p99 latency of 2.3 milliseconds.","The machine learning pipeline ingests training data from three sources: user interaction logs, content metadata databases, and external knowledge graphs. The preprocessing stage normalizes text using Unicode NFKC normalization, removes HTML entities, and applies language-specific tokenization. For English text, the system uses a SentencePiece BPE tokenizer with a vocabulary of 32,000 tokens. The model architecture is a transformer with 24 layers, 16 attention heads, and a hidden dimension of 1024. Training uses AdamW optimizer with a learning rate of 3e-4, weight decay of 0.01, and a cosine learning rate schedule with 1000 warmup steps. The batch size is 256 sequences of 512 tokens each. Training runs on 8 A100 GPUs using data parallelism with gradient accumulation over 4 steps. A full training run takes approximately 72 hours and produces a model checkpoint of 1.2 GB.","The API gateway handles authentication using JWT tokens with RS256 signing. Each token contains claims for user ID, organization ID, role, and a list of permitted scopes. Tokens expire after 1 hour and can be refreshed using a separate refresh token that expires after 30 days. Rate limiting is implemented at three levels: per-IP (1000 requests/minute), per-user (5000 requests/minute), and per-organization (50000 requests/minute). The gateway routes requests to backend services using a weighted round-robin algorithm with health checking. If a backend service fails three consecutive health checks (sent every 10 seconds), it is removed from the rotation until it passes two consecutive checks. The gateway logs all requests with a unique trace ID that propagates through all downstream services. Request and response bodies are logged only for non-production environments. The system handles approximately 10 million API calls per day across 150 different endpoint paths.","The database schema uses a multi-tenant architecture with row-level security. Each tenant's data is isolated using a tenant_id column present on every table. The primary tables are: users (12 columns, ~2M rows per tenant), documents (18 columns, ~500K rows per tenant), and events (8 columns, ~50M rows per tenant). Indexes are maintained on all foreign keys and commonly queried columns. The events table uses a time-series partitioning scheme with monthly partitions, and partitions older than 12 months are automatically moved to cold storage. The database runs on PostgreSQL 16 with connection pooling via PgBouncer configured for 200 server connections and 2000 client connections. Queries are optimized using materialized views for common aggregation patterns, which are refreshed every 15 minutes. The backup strategy uses continuous WAL archiving to S3 with a recovery point objective of 5 minutes and full base backups taken daily.","The monitoring system collects metrics from all services using a pull-based model with 15-second scrape intervals. Metrics are stored in a time-series database with 90-day retention at full resolution and 2-year retention at 5-minute aggregation. The system tracks four golden signals for each service: latency (histogram with buckets at 10ms, 50ms, 100ms, 250ms, 500ms, 1s, 5s), traffic (requests per second by endpoint and status code), errors (error rate as a percentage of total requests), and saturation (CPU, memory, disk I/O, and network utilization). Alerts are configured using multi-window multi-burn-rate SLO-based rules. For example, the API gateway has an SLO of 99.9% availability measured over a 30-day window, with fast-burn alerts (14.4x burn rate over 1 hour) triggering pages and slow-burn alerts (3x burn rate over 6 hours) creating tickets. Dashboard visualizations use Grafana with templated dashboards that automatically discover new services and endpoints.","The CI/CD pipeline consists of five stages: lint, test, build, deploy-staging, and deploy-production. The lint stage runs ESLint, Prettier, and type checking in parallel, completing in approximately 45 seconds. The test stage runs unit tests (Jest with ~4000 test cases, ~3 minutes), integration tests (against Docker Compose services, ~8 minutes), and end-to-end tests (Playwright against a staging-like environment, ~12 minutes). The build stage creates Docker images using multi-stage builds, produces SBOM manifests, and runs Trivy vulnerability scanning. Images are pushed to a private ECR registry with immutable tags based on the Git commit SHA. Deployment uses a progressive delivery model: staging receives every commit to the main branch automatically, while production deployments require manual approval and use a canary strategy that routes 5% of traffic to the new version for 30 minutes before proceeding to full rollout. Rollbacks are automated if the error rate exceeds 1% during the canary phase.","The search infrastructure uses an inverted index with BM25 scoring enhanced by a learned re-ranking model. Documents are processed through a pipeline that extracts text, splits into passages of approximately 200 tokens, generates embedding vectors using a bi-encoder model, and builds the inverted index. The index supports prefix matching, fuzzy matching with edit distance up to 2, and phrase queries using positional information. At query time, an initial retrieval phase uses the inverted index to find the top 1000 candidate passages by BM25 score. A re-ranking phase then applies a cross-encoder model to score each candidate against the query, producing the final top 20 results. The entire query pipeline completes in under 200 milliseconds for 95% of queries. The index is updated incrementally using a write-ahead log that batches updates every 5 seconds. The system handles approximately 500 queries per second with a corpus of 100 million passages across 10 shards.","The event streaming platform processes messages using a partitioned log architecture. Events are published to topics, each divided into 12 partitions for parallel processing. Producers use a hash-based partitioning strategy on the event key to ensure ordering within a partition. Consumers form groups where each partition is assigned to exactly one consumer in the group. The system guarantees at-least-once delivery with exactly-once processing semantics achieved through idempotent consumers and transactional outbox patterns. Message retention is configured per topic: user events are retained for 30 days, system events for 7 days, and audit events for 365 days. The platform handles approximately 2 million events per second with an average end-to-end latency of 15 milliseconds. Schema evolution is managed using a schema registry that enforces backward compatibility. Each message includes a schema ID in its header, and consumers automatically deserialize using the correct schema version.","The content delivery network caches static and dynamic content across 45 points of presence worldwide. Static assets (images, CSS, JavaScript, fonts) are cached with a TTL of 30 days and use content-based hashing in filenames for cache busting. Dynamic content (API responses, personalized pages) uses surrogate keys for targeted cache invalidation. When a product is updated, the system publishes an invalidation event containing the product's surrogate keys, and all edge nodes purge matching entries within 500 milliseconds. The CDN uses HTTP/2 push for critical assets and supports QUIC/HTTP3 for improved performance on mobile networks. TLS termination occurs at the edge using ECDSA certificates with OCSP stapling. The system serves approximately 500 TB of data per month with a cache hit ratio of 94% for static content and 72% for dynamic content. Origin shield nodes reduce origin load by consolidating cache misses from multiple edge nodes in the same region.","The identity and access management system supports multiple authentication methods: password-based, SSO via SAML 2.0 and OIDC, passwordless via WebAuthn/FIDO2, and API keys for service-to-service communication. Password policies enforce minimum 12 characters with complexity requirements and check against a database of 600 million compromised passwords. Multi-factor authentication supports TOTP, SMS (as fallback only), and hardware security keys. The authorization model uses a hybrid RBAC/ABAC approach. Base permissions are defined through roles (admin, editor, viewer, custom), while fine-grained access rules use attribute-based policies that evaluate request context (time of day, IP geolocation, device trust score) and resource attributes (classification level, owner, creation date). Policy decisions are cached for 5 minutes and re-evaluated on any privilege change. The system processes approximately 100,000 authentication requests and 2 million authorization decisions per minute. Session management uses encrypted, httpOnly, SameSite=Strict cookies with a 15-minute idle timeout and 12-hour absolute timeout."],mw=["Based on the background information provided, identify the three most critical architectural decisions and explain how they impact system reliability and performance. Structure your response with clear headings.","Analyze the background material and describe what would happen if the system needed to scale to 10x its current traffic. What components would become bottlenecks first? Provide a prioritized list.","From the technical details shared above, create a concise executive summary highlighting the key metrics, design patterns, and trade-offs. Focus on what a new team member would need to understand first."];function kc(t,n,r,s=3.5,i=64){const l=Math.floor(r*s),o=`${W} Use the background notes provided in the conversation to inform your answer.`,a=t<=.25?0:t<=.55?1:2,c=mw[a],d=o.length+c.length+200,u=t===0?0:Math.max(200,l-d),h=[{role:"system",content:o}];if(u>0){const m=[];let x=0,j=0;const b=Vm.length,N=2;for(;x<u;){const f=Vm[j%b],p=`--- Section ${j+1} ---
`,g=u-x,k=p.length+(m.length>0?N:0);if(g<=k)break;const S=g-k,_=S>=f.length?f:f.slice(0,S),E=`${p}${_}`;if(m.push(E),x+=E.length+(m.length>1?N:0),j++,j>Math.ceil(u/200)+b)break}h.push({role:"user",content:`BACKGROUND NOTES:

${m.join(`

`)}`})}return h.push({role:"user",content:c}),{id:`ctxfill-${n.replace("%","")}`,messages:h,max_tokens:i,expected:void 0,contextFill:{ratio:t,label:n},includeInScore:!1}}async function Hm(t,n,r){var u;const s=[{ratio:0,label:"0%"},{ratio:.2,label:"20%"},{ratio:.5,label:"50%"},{ratio:.8,label:"80%"}],i=[],l=256,o=64;let a=3.5;const c=1024,d=kc(.5,"50%",c,a,1);try{if(!(r!=null&&r.aborted)){const m=(u=(await Il(t,{...d,max_tokens:1},{},r)).usage)==null?void 0:u.prompt_tokens;m&&m>0&&(a=a*(c/m))}}catch{}for(const{ratio:h,label:m}of s){if(h===0){i.push(kc(0,m,0,a,o));continue}const x=Math.floor(n*h)-l;x<100||i.push(kc(h,m,x,a,o))}return i}function $m(t,n){if(t){const r=t.context_window??t["context-window"];if(typeof r=="number"&&r>0)return r}if(n){const r=n.context_window;if(typeof r=="number"&&r>0)return r}}const vl={id:"tool_call",name:"Tool Calling",prompts:[{id:"weather-tool",messages:[{role:"system",content:W},{role:"user",content:"What's the weather in Boston?"}],tools:te,expected:{type:"tool_call"}},{id:"add-tool",messages:[{role:"system",content:W},{role:"user",content:"What is 15 + 28?"}],tools:te,expected:{type:"tool_call"}},{id:"multi-turn-tool",messages:[{role:"system",content:W},{role:"user",content:"What's the weather in Boston?"},{role:"assistant",content:"",tool_calls:[{id:"tc1",index:0,type:"function",function:{name:"get_weather",arguments:'{"location":"Boston"}'}}]},{role:"user",content:"Now check the weather in London too."}],tools:te,expected:{type:"tool_call"}},{id:"weather-tokyo",messages:[{role:"system",content:W},{role:"user",content:"What's the weather like in Tokyo right now?"}],tools:te,expected:{type:"tool_call"}},{id:"weather-celsius",messages:[{role:"system",content:W},{role:"user",content:"Tell me the weather in Paris in celsius."}],tools:te,expected:{type:"tool_call"}},{id:"add-large",messages:[{role:"system",content:W},{role:"user",content:"Calculate 1234 + 5678 for me."}],tools:te,expected:{type:"tool_call"}},{id:"add-decimals",messages:[{role:"system",content:W},{role:"user",content:"What is 3.14 + 2.72?"}],tools:te,expected:{type:"tool_call"}},{id:"search-laptop",messages:[{role:"system",content:W},{role:"user",content:"Search for laptops under $1000."}],tools:te,expected:{type:"tool_call"}},{id:"search-headphones",messages:[{role:"system",content:W},{role:"user",content:"Find me wireless headphones in the electronics category."}],tools:te,expected:{type:"tool_call"}},{id:"send-email",messages:[{role:"system",content:W},{role:"user",content:`Send an email to alice@example.com with subject "Meeting Tomorrow" and body "Let's meet at 3pm."`}],tools:te,expected:{type:"tool_call"}},{id:"stock-price-aapl",messages:[{role:"system",content:W},{role:"user",content:"What's Apple's current stock price?"}],tools:te,expected:{type:"tool_call"}},{id:"stock-price-tsla",messages:[{role:"system",content:W},{role:"user",content:"Check the stock price of Tesla."}],tools:te,expected:{type:"tool_call"}},{id:"convert-usd-eur",messages:[{role:"system",content:W},{role:"user",content:"Convert 100 USD to EUR."}],tools:te,expected:{type:"tool_call"}},{id:"convert-gbp-jpy",messages:[{role:"system",content:W},{role:"user",content:"How much is 500 British pounds in Japanese yen?"}],tools:te,expected:{type:"tool_call"}},{id:"calendar-meeting",messages:[{role:"system",content:W},{role:"user",content:"Schedule a team meeting for 2025-03-15 at 10:00 for 60 minutes."}],tools:te,expected:{type:"tool_call"}},{id:"calendar-lunch",messages:[{role:"system",content:W},{role:"user",content:"Create a lunch event on 2025-04-01 at 12:30."}],tools:te,expected:{type:"tool_call"}},{id:"translate-hello-spanish",messages:[{role:"system",content:W},{role:"user",content:"Translate 'Hello, how are you?' to Spanish."}],tools:te,expected:{type:"tool_call"}},{id:"translate-goodbye-german",messages:[{role:"system",content:W},{role:"user",content:"Translate 'Goodbye and thank you' to German."}],tools:te,expected:{type:"tool_call"}},{id:"directions-sf-la",messages:[{role:"system",content:W},{role:"user",content:"Get me driving directions from San Francisco to Los Angeles."}],tools:te,expected:{type:"tool_call"}},{id:"directions-walking",messages:[{role:"system",content:W},{role:"user",content:"How do I walk from Central Park to Times Square?"}],tools:te,expected:{type:"tool_call"}},{id:"reminder-dentist",messages:[{role:"system",content:W},{role:"user",content:"Remind me about my dentist appointment at 2025-03-20T09:00:00."}],tools:te,expected:{type:"tool_call"}},{id:"reminder-groceries",messages:[{role:"system",content:W},{role:"user",content:"Set a reminder to buy groceries tomorrow at 5pm."}],tools:te,expected:{type:"tool_call"}},{id:"multi-turn-tool-add",messages:[{role:"system",content:W},{role:"user",content:"What is 10 + 20?"},{role:"assistant",content:"",tool_calls:[{id:"tc2",index:0,type:"function",function:{name:"add",arguments:'{"a":10,"b":20}'}}]},{role:"user",content:"Now add 30 + 40."}],tools:te,expected:{type:"tool_call"}},{id:"multi-turn-tool-weather-3",messages:[{role:"system",content:W},{role:"user",content:"What's the weather in Boston?"},{role:"assistant",content:"",tool_calls:[{id:"tc3",index:0,type:"function",function:{name:"get_weather",arguments:'{"location":"Boston"}'}}]},{role:"user",content:"Now check the weather in London too."},{role:"assistant",content:"",tool_calls:[{id:"tc4",index:0,type:"function",function:{name:"get_weather",arguments:'{"location":"London"}'}}]},{role:"user",content:"And what about Sydney?"}],tools:te,expected:{type:"tool_call"}},{id:"multi-turn-tool-stock-follow",messages:[{role:"system",content:W},{role:"user",content:"What's Apple's stock price?"},{role:"assistant",content:"",tool_calls:[{id:"tc5",index:0,type:"function",function:{name:"get_stock_price",arguments:'{"symbol":"AAPL"}'}}]},{role:"user",content:"Now check Google too."}],tools:te,expected:{type:"tool_call"}},{id:"search-books",messages:[{role:"system",content:W},{role:"user",content:"Search for science fiction books, show me the top 5 results."}],tools:te,expected:{type:"tool_call"}},{id:"directions-transit",messages:[{role:"system",content:W},{role:"user",content:"How do I get from Brooklyn to Manhattan by transit?"}],tools:te,expected:{type:"tool_call"}},{id:"tc2-weather-fahrenheit-nyc",messages:[{role:"system",content:W},{role:"user",content:"What's the weather in New York in fahrenheit?"}],tools:te,expected:{type:"tool_call"}},{id:"tc2-weather-berlin-celsius",messages:[{role:"system",content:W},{role:"user",content:"Get the weather in Berlin in celsius."}],tools:te,expected:{type:"tool_call"}},{id:"tc2-add-negative",messages:[{role:"system",content:W},{role:"user",content:"What is -15 + 42?"}],tools:te,expected:{type:"tool_call"}},{id:"tc2-add-small",messages:[{role:"system",content:W},{role:"user",content:"Add 7 + 13."}],tools:te,expected:{type:"tool_call"}},{id:"tc2-search-kitchen-max3",messages:[{role:"system",content:W},{role:"user",content:'Search for "coffee mug" in category kitchen and return at most 3 results.'}],tools:te,expected:{type:"tool_call"}},{id:"tc2-search-usbc-max1",messages:[{role:"system",content:W},{role:"user",content:"Search for USB-C cable and limit to 1 result."}],tools:te,expected:{type:"tool_call"}},{id:"tc2-send-email-brief",messages:[{role:"system",content:W},{role:"user",content:'Email bob@example.com with subject "Status" and body "All tests passed."'}],tools:te,expected:{type:"tool_call"}},{id:"tc2-stock-msft",messages:[{role:"system",content:W},{role:"user",content:"Get the stock price for MSFT."}],tools:te,expected:{type:"tool_call"}},{id:"tc2-convert-eur-usd",messages:[{role:"system",content:W},{role:"user",content:"Convert 49.99 EUR to USD."}],tools:te,expected:{type:"tool_call"}},{id:"tc2-calendar-duration-30",messages:[{role:"system",content:W},{role:"user",content:'Create a calendar event titled "1:1" on 2025-05-20 at 09:30 for 30 minutes.'}],tools:te,expected:{type:"tool_call"}},{id:"tc2-translate-en-fr",messages:[{role:"system",content:W},{role:"user",content:'Translate "Where is the train station?" from English to French.'}],tools:te,expected:{type:"tool_call"}},{id:"tc2-directions-transit-mode",messages:[{role:"system",content:W},{role:"user",content:'Get transit directions from "Union Square, San Francisco" to "SFO Airport".'}],tools:te,expected:{type:"tool_call"}},{id:"tc2-mt-weather-unit-followup",messages:[{role:"system",content:W},{role:"user",content:"What's the weather in Boston?"},{role:"assistant",content:"",tool_calls:[{id:"tc2w1",index:0,type:"function",function:{name:"get_weather",arguments:'{"location":"Boston"}'}}]},{role:"user",content:"Same city, but in fahrenheit."}],tools:te,expected:{type:"tool_call"}},{id:"tc2-mt-search-then-email",messages:[{role:"system",content:W},{role:"user",content:"Search for running shoes."},{role:"assistant",content:"",tool_calls:[{id:"tc2se1",index:0,type:"function",function:{name:"search_products",arguments:'{"query":"running shoes"}'}}]},{role:"user",content:'Email those results to alice@example.com with subject "Shoe Options" and body "Here are the running shoes I found."'}],tools:te,expected:{type:"tool_call"}},{id:"tc2-mt-stock-then-reminder",messages:[{role:"system",content:W},{role:"user",content:"What's Apple's stock price?"},{role:"assistant",content:"",tool_calls:[{id:"tc2sr1",index:0,type:"function",function:{name:"get_stock_price",arguments:'{"symbol":"AAPL"}'}}]},{role:"user",content:"Set a reminder at 2025-06-01T09:00:00 to check again."}],tools:te,expected:{type:"tool_call"}},{id:"tc2-mt-currency-then-calendar",messages:[{role:"system",content:W},{role:"user",content:"Convert 100 USD to EUR."},{role:"assistant",content:"",tool_calls:[{id:"tc2cc1",index:0,type:"function",function:{name:"convert_currency",arguments:'{"amount":100,"from":"USD","to":"EUR"}'}}]},{role:"user",content:"Schedule a budget review for 2025-07-10 at 14:00 for 45 minutes."}],tools:te,expected:{type:"tool_call"}},{id:"tc2-mt-directions-then-weather",messages:[{role:"system",content:W},{role:"user",content:"Get me driving directions from Seattle to Portland."},{role:"assistant",content:"",tool_calls:[{id:"tc2dw1",index:0,type:"function",function:{name:"get_directions",arguments:'{"origin":"Seattle","destination":"Portland"}'}}]},{role:"user",content:"What's the weather in Portland in celsius?"}],tools:te,expected:{type:"tool_call"}},{id:"tc2-mt-translate-then-email",messages:[{role:"system",content:W},{role:"user",content:'Translate "Meeting postponed to next week" to Spanish.'},{role:"assistant",content:"",tool_calls:[{id:"tc2te1",index:0,type:"function",function:{name:"translate_text",arguments:'{"text":"Meeting postponed to next week","target_language":"es"}'}}]},{role:"user",content:'Send that translation to carlos@example.com with subject "Update" and body "Reunin pospuesta para la prxima semana."'}],tools:te,expected:{type:"tool_call"}},{id:"tc2-mt-reminder-reschedule",messages:[{role:"system",content:W},{role:"user",content:'Set a reminder for "Submit report" at 2025-04-10T17:00:00.'},{role:"assistant",content:"",tool_calls:[{id:"tc2rr1",index:0,type:"function",function:{name:"set_reminder",arguments:'{"message":"Submit report","datetime":"2025-04-10T17:00:00"}'}}]},{role:"user",content:"Actually set it for 2025-04-11T10:00:00 instead."}],tools:te,expected:{type:"tool_call"}},{id:"tc2-mt-add-then-convert",messages:[{role:"system",content:W},{role:"user",content:"What is 19.99 + 5.00?"},{role:"assistant",content:"",tool_calls:[{id:"tc2ac1",index:0,type:"function",function:{name:"add",arguments:'{"a":19.99,"b":5.00}'}}]},{role:"assistant",content:"The total is 24.99 USD."},{role:"user",content:"Convert 24.99 USD to GBP."}],tools:te,expected:{type:"tool_call"}},{id:"tc2-mt-calendar-then-directions",messages:[{role:"system",content:W},{role:"user",content:`Create a calendar event titled "Dinner at Luigi's" on 2025-08-15 at 19:00.`},{role:"assistant",content:"",tool_calls:[{id:"tc2cd1",index:0,type:"function",function:{name:"create_calendar_event",arguments:`{"title":"Dinner at Luigi's","date":"2025-08-15","time":"19:00"}`}}]},{role:"user",content:"Get me walking directions from home to Luigi's Restaurant."}],tools:te,expected:{type:"tool_call"}},{id:"tc2-mt-trip-planner",messages:[{role:"system",content:W},{role:"user",content:"What's the weather in Rome in celsius?"},{role:"assistant",content:"",tool_calls:[{id:"tc2tp1",index:0,type:"function",function:{name:"get_weather",arguments:'{"location":"Rome","unit":"celsius"}'}}]},{role:"user",content:"Search for travel umbrella in category travel, max 3 results."},{role:"assistant",content:"",tool_calls:[{id:"tc2tp2",index:0,type:"function",function:{name:"search_products",arguments:'{"query":"travel umbrella","category":"travel","max_results":3}'}}]},{role:"user",content:"Convert 200 USD to EUR."},{role:"assistant",content:"",tool_calls:[{id:"tc2tp3",index:0,type:"function",function:{name:"convert_currency",arguments:'{"amount":200,"from":"USD","to":"EUR"}'}}]},{role:"user",content:'Create a calendar event titled "Flight to Rome" on 2025-09-01 at 08:00 for 30 minutes.'},{role:"assistant",content:"",tool_calls:[{id:"tc2tp4",index:0,type:"function",function:{name:"create_calendar_event",arguments:'{"title":"Flight to Rome","date":"2025-09-01","time":"08:00","duration_minutes":30}'}}]},{role:"user",content:'Email me the trip checklist at traveler@example.com with subject "Rome Trip Checklist" and body "Umbrella, euros, and flight booked."'}],tools:te,expected:{type:"tool_call"}},{id:"tc2-mt-meeting-runner",messages:[{role:"system",content:W},{role:"user",content:'Create a calendar event titled "Client Meeting" on 2025-06-15 at 14:00 for 60 minutes.'},{role:"assistant",content:"",tool_calls:[{id:"tc2mr1",index:0,type:"function",function:{name:"create_calendar_event",arguments:'{"title":"Client Meeting","date":"2025-06-15","time":"14:00","duration_minutes":60}'}}]},{role:"user",content:'Get driving directions from "123 Main St" to "456 Oak Ave".'},{role:"assistant",content:"",tool_calls:[{id:"tc2mr2",index:0,type:"function",function:{name:"get_directions",arguments:'{"origin":"123 Main St","destination":"456 Oak Ave","mode":"driving"}'}}]},{role:"user",content:"What's the weather at 456 Oak Ave in fahrenheit?"},{role:"assistant",content:"",tool_calls:[{id:"tc2mr3",index:0,type:"function",function:{name:"get_weather",arguments:'{"location":"456 Oak Ave","unit":"fahrenheit"}'}}]},{role:"user",content:'Translate "Running 10 minutes late" to Spanish.'},{role:"assistant",content:"",tool_calls:[{id:"tc2mr4",index:0,type:"function",function:{name:"translate_text",arguments:'{"text":"Running 10 minutes late","target_language":"es"}'}}]},{role:"user",content:'Send an email to client@example.com with subject "On My Way" and body "Llego 10 minutos tarde."'}],tools:te,expected:{type:"tool_call"}},{id:"tc2-mt-shopping-budget",messages:[{role:"system",content:W},{role:"user",content:"Search for headphones in electronics, max 5 results."},{role:"assistant",content:"",tool_calls:[{id:"tc2sb1",index:0,type:"function",function:{name:"search_products",arguments:'{"query":"headphones","category":"electronics","max_results":5}'}}]},{role:"user",content:"Add 79.99 + 12.50."},{role:"assistant",content:"",tool_calls:[{id:"tc2sb2",index:0,type:"function",function:{name:"add",arguments:'{"a":79.99,"b":12.50}'}}]},{role:"user",content:"Convert 92.49 USD to GBP."},{role:"assistant",content:"",tool_calls:[{id:"tc2sb3",index:0,type:"function",function:{name:"convert_currency",arguments:'{"amount":92.49,"from":"USD","to":"GBP"}'}}]},{role:"user",content:"Set a reminder at 2025-07-01T12:00:00 to check for price drops."},{role:"assistant",content:"",tool_calls:[{id:"tc2sb4",index:0,type:"function",function:{name:"set_reminder",arguments:'{"message":"Check for price drops","datetime":"2025-07-01T12:00:00"}'}}]},{role:"user",content:'Email the budget summary to finance@example.com with subject "Headphone Budget" and body "Total: 92.49 USD / ~73 GBP."'}],tools:te,expected:{type:"tool_call"}},{id:"tc2-mt-multicity-itinerary",messages:[{role:"system",content:W},{role:"user",content:"What's the weather in Seattle?"},{role:"assistant",content:"",tool_calls:[{id:"tc2mi1",index:0,type:"function",function:{name:"get_weather",arguments:'{"location":"Seattle"}'}}]},{role:"user",content:"What's the weather in Vancouver in celsius?"},{role:"assistant",content:"",tool_calls:[{id:"tc2mi2",index:0,type:"function",function:{name:"get_weather",arguments:'{"location":"Vancouver","unit":"celsius"}'}}]},{role:"user",content:"Get transit directions from Seattle to Vancouver."},{role:"assistant",content:"",tool_calls:[{id:"tc2mi3",index:0,type:"function",function:{name:"get_directions",arguments:'{"origin":"Seattle","destination":"Vancouver","mode":"transit"}'}}]},{role:"user",content:"Convert 100 USD to CAD."},{role:"assistant",content:"",tool_calls:[{id:"tc2mi4",index:0,type:"function",function:{name:"convert_currency",arguments:'{"amount":100,"from":"USD","to":"CAD"}'}}]},{role:"user",content:'Create a calendar event titled "Cross-border day trip" on 2025-08-20 at 07:00 for 480 minutes.'}],tools:te,expected:{type:"tool_call"}},{id:"tc2-mt-language-lunch-flow",messages:[{role:"system",content:W},{role:"user",content:'Translate "I would like a table for two, please" to Italian.'},{role:"assistant",content:"",tool_calls:[{id:"tc2ll1",index:0,type:"function",function:{name:"translate_text",arguments:'{"text":"I would like a table for two, please","target_language":"it"}'}}]},{role:"user",content:'Send that phrase to host@example.com with subject "Reservation Request" and body "Vorrei un tavolo per due, per favore."'},{role:"assistant",content:"",tool_calls:[{id:"tc2ll2",index:0,type:"function",function:{name:"send_email",arguments:'{"to":"host@example.com","subject":"Reservation Request","body":"Vorrei un tavolo per due, per favore."}'}}]},{role:"user",content:'Create a calendar event titled "Lunch at Trattoria" on 2025-09-05 at 12:30.'},{role:"assistant",content:"",tool_calls:[{id:"tc2ll3",index:0,type:"function",function:{name:"create_calendar_event",arguments:'{"title":"Lunch at Trattoria","date":"2025-09-05","time":"12:30"}'}}]},{role:"user",content:'Get walking directions from "Hotel Bella Vista" to "Trattoria Roma".'},{role:"assistant",content:"",tool_calls:[{id:"tc2ll4",index:0,type:"function",function:{name:"get_directions",arguments:'{"origin":"Hotel Bella Vista","destination":"Trattoria Roma","mode":"walking"}'}}]},{role:"user",content:"Set a reminder at 2025-09-05T12:00:00 to leave for lunch."}],tools:te,expected:{type:"tool_call"}},{id:"tc3-parallel-weather-2cities",messages:[{role:"system",content:W},{role:"user",content:"What's the weather in Boston and London?"}],tools:te,expected:{type:"tool_call"}},{id:"tc3-parallel-stocks-2",messages:[{role:"system",content:W},{role:"user",content:"Check the current stock prices for AAPL and TSLA."}],tools:te,expected:{type:"tool_call"}},{id:"tc3-parallel-weather-stock",messages:[{role:"system",content:W},{role:"user",content:"What's the weather in Paris and what's the current price of AAPL?"}],tools:te,expected:{type:"tool_call"}},{id:"tc3-parallel-search-convert",messages:[{role:"system",content:W},{role:"user",content:'Search for "wireless headphones" and also convert 199.99 USD to EUR.'}],tools:te,expected:{type:"tool_call"}},{id:"tc3-parallel-calendar-reminder",messages:[{role:"system",content:W},{role:"user",content:'Create a calendar event titled "Dentist" on 2026-03-10 at 09:00 for 30 minutes, and set a reminder for 2026-03-10T08:30:00 saying "Leave for dentist".'}],tools:te,expected:{type:"tool_call"}},{id:"tc3-parallel-convert-2",messages:[{role:"system",content:W},{role:"user",content:"Convert 100 USD to EUR and 500 GBP to JPY."}],tools:te,expected:{type:"tool_call"}},{id:"tc3-parallel-directions-weather",messages:[{role:"system",content:W},{role:"user",content:"Get driving directions from San Francisco to San Jose, and tell me the weather in San Jose."}],tools:te,expected:{type:"tool_call"}},{id:"tc3-weather-unicode",messages:[{role:"system",content:W},{role:"user",content:"What's the weather in So Paulo?"}],tools:te,expected:{type:"tool_call"}},{id:"tc3-weather-unicode-umlaut",messages:[{role:"system",content:W},{role:"user",content:"What's the weather in Zrich?"}],tools:te,expected:{type:"tool_call"}},{id:"tc3-stock-dot-symbol",messages:[{role:"system",content:W},{role:"user",content:"Get the stock price for BRK.B."}],tools:te,expected:{type:"tool_call"}},{id:"tc3-email-plus-address",messages:[{role:"system",content:W},{role:"user",content:'Send an email to alice+test@example.com with subject "Test" and body "Hello from the test suite."'}],tools:te,expected:{type:"tool_call"}},{id:"tc3-translate-quotes",messages:[{role:"system",content:W},{role:"user",content:`Translate the phrase 'He said "hello" and left' to French.`}],tools:te,expected:{type:"tool_call"}},{id:"tc3-calendar-leapday",messages:[{role:"system",content:W},{role:"user",content:'Create a calendar event titled "Leap Day Party" on 2028-02-29 at 20:00.'}],tools:te,expected:{type:"tool_call"}},{id:"tc3-reminder-timezone",messages:[{role:"system",content:W},{role:"user",content:'Set a reminder "Standup" for 2026-02-23T09:30:00-05:00.'}],tools:te,expected:{type:"tool_call"}},{id:"tc3-convert-large-amount",messages:[{role:"system",content:W},{role:"user",content:"Convert 1000000 USD to JPY."}],tools:te,expected:{type:"tool_call"}},{id:"tc3-directions-unicode",messages:[{role:"system",content:W},{role:"user",content:`Get walking directions from "Caf de Flore" to "Muse d'Orsay".`}],tools:te,expected:{type:"tool_call"}},{id:"tc3-correction-location",messages:[{role:"system",content:W},{role:"user",content:"What's the weather in Londonactually make that Dublin."}],tools:te,expected:{type:"tool_call"}},{id:"tc3-correction-currency",messages:[{role:"system",content:W},{role:"user",content:"Convert 100 USD to EURsorry, convert 100 USD to GBP instead."}],tools:te,expected:{type:"tool_call"}},{id:"tc3-correction-destination",messages:[{role:"system",content:W},{role:"user",content:"Get driving directions from Boston to New Yorkwait, to Philadelphia."}],tools:te,expected:{type:"tool_call"}},{id:"tc3-mt-final-search",messages:[{role:"system",content:W},{role:"user",content:"What's the weather in Tokyo?"},{role:"assistant",content:"",tool_calls:[{id:"tc3fs1",index:0,type:"function",function:{name:"get_weather",arguments:'{"location":"Tokyo"}'}}]},{role:"user",content:'Search for "Japanese tea set" in category kitchen, max 3 results.'}],tools:te,expected:{type:"tool_call"}},{id:"tc3-mt-final-translate",messages:[{role:"system",content:W},{role:"user",content:'Get walking directions from "Piazza Navona" to "Colosseum".'},{role:"assistant",content:"",tool_calls:[{id:"tc3ft1",index:0,type:"function",function:{name:"get_directions",arguments:'{"origin":"Piazza Navona","destination":"Colosseum","mode":"walking"}'}}]},{role:"user",content:'Translate "How far is the Colosseum?" from English to Italian.'}],tools:te,expected:{type:"tool_call"}},{id:"tc3-stock-by-company",messages:[{role:"system",content:W},{role:"user",content:"What is Microsoft's stock price?"}],tools:te,expected:{type:"tool_call"}},{id:"tc3-reminder-indirect",messages:[{role:"system",content:W},{role:"user",content:'At 2026-04-01T12:00:00 remind me to "renew subscription".'}],tools:te,expected:{type:"tool_call"}},{id:"tc3-mt-prior-convert-then-weather",messages:[{role:"system",content:W},{role:"user",content:"Convert 10 USD to EUR."},{role:"assistant",content:"",tool_calls:[{id:"tc3pcw1",index:0,type:"function",function:{name:"convert_currency",arguments:'{"amount":10,"from":"USD","to":"EUR"}'}}]},{role:"user",content:"Now what's the weather in Berlin?"}],tools:te,expected:{type:"tool_call"}},{id:"tc3-mt-prior-email-then-translate",messages:[{role:"system",content:W},{role:"user",content:'Send an email to bob@example.com with subject "Hi" and body "Test message."'},{role:"assistant",content:"",tool_calls:[{id:"tc3pet1",index:0,type:"function",function:{name:"send_email",arguments:'{"to":"bob@example.com","subject":"Hi","body":"Test message."}'}}]},{role:"user",content:'Now translate "Good night" to French.'}],tools:te,expected:{type:"tool_call"}},{id:"tc3-mt-prior-calendar-then-stock",messages:[{role:"system",content:W},{role:"user",content:'Create a calendar event titled "Review" on 2026-01-15 at 11:00.'},{role:"assistant",content:"",tool_calls:[{id:"tc3pcs1",index:0,type:"function",function:{name:"create_calendar_event",arguments:'{"title":"Review","date":"2026-01-15","time":"11:00"}'}}]},{role:"user",content:"What's the stock price for NVDA?"}],tools:te,expected:{type:"tool_call"}},{id:"tc3-mt-prior-reminder-then-search",messages:[{role:"system",content:W},{role:"user",content:'Set a reminder "Buy gift" for 2026-05-01T10:00:00.'},{role:"assistant",content:"",tool_calls:[{id:"tc3prs1",index:0,type:"function",function:{name:"set_reminder",arguments:'{"message":"Buy gift","datetime":"2026-05-01T10:00:00"}'}}]},{role:"user",content:'Search for "birthday gift ideas" with max 5 results.'}],tools:te,expected:{type:"tool_call"}},{id:"tc3-mt-prior-translate-then-add",messages:[{role:"system",content:W},{role:"user",content:'Translate "Invoice total" to German.'},{role:"assistant",content:"",tool_calls:[{id:"tc3pta1",index:0,type:"function",function:{name:"translate_text",arguments:'{"text":"Invoice total","target_language":"de"}'}}]},{role:"user",content:"Now add 450.00 + 67.50."}],tools:te,expected:{type:"tool_call"}},{id:"tc3-mt-prior-directions-then-reminder",messages:[{role:"system",content:W},{role:"user",content:'Get transit directions from "Grand Central" to "JFK Airport".'},{role:"assistant",content:"",tool_calls:[{id:"tc3pdr1",index:0,type:"function",function:{name:"get_directions",arguments:'{"origin":"Grand Central","destination":"JFK Airport","mode":"transit"}'}}]},{role:"user",content:"Set a reminder at 2026-06-15T06:00:00 to leave for the airport."}],tools:te,expected:{type:"tool_call"}},{id:"neg-simple-arithmetic",messages:[{role:"system",content:W},{role:"user",content:"What's 2 + 2? Answer with only the number."}],tools:te,expected:{type:"no_tool_call",value:"4"}},{id:"neg-general-knowledge",messages:[{role:"system",content:W},{role:"user",content:"What is the capital of Japan? Answer with only the city name."}],tools:te,expected:{type:"no_tool_call",value:"[Tt]okyo"}},{id:"neg-creative-writing",messages:[{role:"system",content:W},{role:"user",content:"Write a haiku about snow."}],tools:te,expected:{type:"no_tool_call"}},{id:"neg-explain-tool",messages:[{role:"system",content:W},{role:"user",content:"What does the convert_currency tool do? Explain in one sentence."}],tools:te,expected:{type:"no_tool_call"}},{id:"neg-forbid-tools",messages:[{role:"system",content:W},{role:"user",content:"Do not call any tools. Just tell me what 15 + 28 is."}],tools:te,expected:{type:"no_tool_call",value:"43"}},{id:"neg-no-matching-tool",messages:[{role:"system",content:W},{role:"user",content:"Summarize the plot of Romeo and Juliet in 2 sentences."}],tools:te,expected:{type:"no_tool_call"}},{id:"neg-greeting",messages:[{role:"system",content:W},{role:"user",content:"Hello! How are you today?"}],tools:te,expected:{type:"no_tool_call"}},{id:"neg-opinion",messages:[{role:"system",content:W},{role:"user",content:"What are the pros and cons of remote work? Be brief."}],tools:te,expected:{type:"no_tool_call"}},{id:"neg-define-word",messages:[{role:"system",content:W},{role:"user",content:'Define the word "ephemeral" in one sentence.'}],tools:te,expected:{type:"no_tool_call"}},{id:"neg-count-letters",messages:[{role:"system",content:W},{role:"user",content:'How many letters are in the word "banana"? Answer with only the number.'}],tools:te,expected:{type:"no_tool_call",value:"6"}},{id:"clar-weather-no-city",messages:[{role:"system",content:W},{role:"user",content:"What's the weather right now?"}],tools:te,expected:{type:"no_tool_call"}},{id:"clar-stock-no-symbol",messages:[{role:"system",content:W},{role:"user",content:"What's the current stock price?"}],tools:te,expected:{type:"no_tool_call"}},{id:"clar-convert-no-source",messages:[{role:"system",content:W},{role:"user",content:"Convert 100 to EUR."}],tools:te,expected:{type:"no_tool_call"}},{id:"clar-translate-no-target",messages:[{role:"system",content:W},{role:"user",content:'Translate "Good morning".'}],tools:te,expected:{type:"no_tool_call"}},{id:"clar-email-no-content",messages:[{role:"system",content:W},{role:"user",content:"Send an email to alice@example.com."}],tools:te,expected:{type:"no_tool_call"}},{id:"clar-calendar-no-datetime",messages:[{role:"system",content:W},{role:"user",content:'Create a calendar event titled "Team sync".'}],tools:te,expected:{type:"no_tool_call"}},{id:"clar-directions-no-origin",messages:[{role:"system",content:W},{role:"user",content:"How do I get to the airport?"}],tools:te,expected:{type:"no_tool_call"}},{id:"clar-reminder-no-time",messages:[{role:"system",content:W},{role:"user",content:"Remind me to pay rent."}],tools:te,expected:{type:"no_tool_call"}},{id:"clar-add-one-number",messages:[{role:"system",content:W},{role:"user",content:"Add 42."}],tools:te,expected:{type:"no_tool_call"}},{id:"clar-search-empty",messages:[{role:"system",content:W},{role:"user",content:"Search for products."}],tools:te,expected:{type:"no_tool_call"}},{id:"ambig-apple-stock-or-product",messages:[{role:"system",content:W},{role:"user",content:"What's the price of Apple?"}],tools:te,expected:{type:"no_tool_call"}},{id:"ambig-tesla-stock-or-search",messages:[{role:"system",content:W},{role:"user",content:"Find Tesla for me."}],tools:te,expected:{type:"no_tool_call"}},{id:"ambig-translate-and-send-no-recipient",messages:[{role:"system",content:W},{role:"user",content:'Translate "Hello" to French and email it.'}],tools:te,expected:{type:"no_tool_call"}},{id:"ambig-book-meeting-vague",messages:[{role:"system",content:W},{role:"user",content:"Book a meeting with Alice."}],tools:te,expected:{type:"no_tool_call"}},{id:"ambig-check-price-vague",messages:[{role:"system",content:W},{role:"user",content:"Check the price for me."}],tools:te,expected:{type:"no_tool_call"}},{id:"ambig-send-message-no-channel",messages:[{role:"system",content:W},{role:"user",content:'Send a message to Bob saying "See you later".'}],tools:te,expected:{type:"no_tool_call"}}]},la={id:"chat",name:"Performance",prompts:[{id:"codegen-python-fn",messages:[{role:"system",content:W},{role:"user",content:'Write a Python function called `fizzbuzz` that takes an integer n and returns a list of strings from 1 to n where multiples of 3 are "Fizz", multiples of 5 are "Buzz", and multiples of both are "FizzBuzz".'}],max_tokens:512,includeInScore:!1},{id:"codegen-js-class",messages:[{role:"system",content:W},{role:"user",content:"Write a JavaScript class called `Stack` with push, pop, peek, and isEmpty methods. Include JSDoc comments for each method."}],max_tokens:512,includeInScore:!1},{id:"codegen-go-struct",messages:[{role:"system",content:W},{role:"user",content:'Write a Go struct called `Config` with fields for Host (string), Port (int), and Timeout (time.Duration). Include a NewConfig constructor function and a String() method that formats it as "host:port".'}],max_tokens:512,includeInScore:!1},{id:"codegen-python-sort",messages:[{role:"system",content:W},{role:"user",content:"Write a Python implementation of merge sort. Include a main function that sorts the list [38, 27, 43, 3, 9, 82, 10] and prints the result."}],max_tokens:512,includeInScore:!1},{id:"codegen-rust-enum",messages:[{role:"system",content:W},{role:"user",content:"Write a Rust enum called `Shape` with variants Circle(f64), Rectangle(f64, f64), and Triangle(f64, f64, f64). Implement a method `area()` that returns the area for each variant."}],max_tokens:512,includeInScore:!1}]};function Lg(t,n=1/0){const r=n===1/0?1/0:Number.isFinite(n)?Math.max(1,Math.floor(n)):25,s={temperature:t.temperature[0]??.8,top_p:t.top_p[0]??.9,top_k:t.top_k[0]??40,min_p:t.min_p[0]??0,repeat_penalty:t.repeat_penalty[0]??1,repeat_last_n:t.repeat_last_n[0]??64,frequency_penalty:t.frequency_penalty[0]??0,presence_penalty:t.presence_penalty[0]??0,dry_multiplier:t.dry_multiplier[0]??1.05,dry_base:t.dry_base[0]??1.75,dry_allowed_length:t.dry_allowed_length[0]??2,dry_penalty_last_n:t.dry_penalty_last_n[0]??0,xtc_probability:t.xtc_probability[0]??0,xtc_threshold:t.xtc_threshold[0]??.1,xtc_min_keep:t.xtc_min_keep[0]??1,max_tokens:t.max_tokens[0]??4096,enable_thinking:t.enable_thinking[0]??"true",reasoning_effort:t.reasoning_effort[0]??"medium"},i=f=>f!==void 0&&Number.isFinite(f)?Math.round(f*1e3)/1e3:f,l=new Set,o=[],a=f=>`t=${i(f.temperature)}|p=${i(f.top_p)}|k=${f.top_k}|m=${i(f.min_p)}|rp=${i(f.repeat_penalty)}|rn=${f.repeat_last_n}|fp=${i(f.frequency_penalty)}|pp=${i(f.presence_penalty)}|dm=${i(f.dry_multiplier)}|db=${i(f.dry_base)}|da=${f.dry_allowed_length}|dp=${f.dry_penalty_last_n}|xp=${i(f.xtc_probability)}|xt=${i(f.xtc_threshold)}|xk=${f.xtc_min_keep}|mt=${f.max_tokens}|et=${f.enable_thinking}|re=${f.reasoning_effort}`,c=f=>{if(r!==1/0&&o.length>=r)return;const p=a(f);l.has(p)||(l.add(p),o.push(f))},d=(f,p)=>f!==void 0&&Math.abs(f-p)<.001;if(c({...s}),r<=1)return o;const u=(f,p)=>[...f].sort((g,k)=>Math.abs(g-p)-Math.abs(k-p)),m=[{key:"temperature",values:t.temperature},{key:"top_p",values:t.top_p},{key:"top_k",values:t.top_k},{key:"min_p",values:t.min_p},{key:"repeat_penalty",values:t.repeat_penalty},{key:"repeat_last_n",values:t.repeat_last_n},{key:"frequency_penalty",values:t.frequency_penalty},{key:"presence_penalty",values:t.presence_penalty},{key:"dry_multiplier",values:t.dry_multiplier},{key:"dry_base",values:t.dry_base},{key:"dry_allowed_length",values:t.dry_allowed_length},{key:"dry_penalty_last_n",values:t.dry_penalty_last_n},{key:"xtc_probability",values:t.xtc_probability},{key:"xtc_threshold",values:t.xtc_threshold},{key:"xtc_min_keep",values:t.xtc_min_keep},{key:"max_tokens",values:t.max_tokens}].filter(f=>f.values.length>1).map(f=>{const p=s[f.key]??0;return u(f.values.filter(g=>!d(p,g)),p).map(g=>({...s,[f.key]:g}))});t.enable_thinking.length>1&&m.push(t.enable_thinking.filter(f=>f!==s.enable_thinking).map(f=>({...s,enable_thinking:f}))),t.reasoning_effort.length>1&&m.push(t.reasoning_effort.filter(f=>f!==s.reasoning_effort).map(f=>({...s,reasoning_effort:f})));for(let f=0;r===1/0||o.length<r;f++){let p=!1;for(const g of m)if(f<g.length&&(c(g[f]),p=!0,o.length>=r))break;if(!p)break}const x=t.temperature.length>0?t.temperature:[s.temperature??.8],j=t.top_p.length>0?t.top_p:[s.top_p??.9],b=t.top_k.length>0?t.top_k:[s.top_k??40],N=t.min_p.length>0?t.min_p:[s.min_p??0];if(x.length>1||j.length>1||b.length>1||N.length>1){const f=Math.min(...x),p=Math.max(...x),g=Math.min(...j),k=Math.max(...j),S=Math.min(...b),_=Math.max(...b),E=Math.max(...N);[{...s,temperature:f,top_p:g},{...s,temperature:f,top_p:k},{...s,temperature:p,top_p:g},{...s,temperature:p,top_p:k},{...s,temperature:f,top_k:S},{...s,temperature:f,top_k:_},{...s,temperature:p,top_k:S},{...s,temperature:p,top_k:_},{...s,top_p:g,top_k:S},{...s,top_p:g,top_k:_},{...s,top_p:k,top_k:S},{...s,top_p:k,top_k:_},{...s,min_p:E,temperature:f},{...s,min_p:E,temperature:p},{...s,min_p:E,top_p:g},{...s,min_p:E,top_p:k}].forEach(c)}return o}const pw={temperature:[.8],top_p:[.9],top_k:[40],min_p:[0],repeat_penalty:[1],repeat_last_n:[64],frequency_penalty:[0],presence_penalty:[0],dry_multiplier:[1.05],dry_base:[1.75],dry_allowed_length:[2],dry_penalty_last_n:[0],xtc_probability:[0],xtc_threshold:[.1],xtc_min_keep:[1],max_tokens:[4096],enable_thinking:["true"],reasoning_effort:["medium"]},xw={nbatch:{enabled:!0,values:[128,256,512,1024,2048,4096]},nubatch:{enabled:!0,values:[128,256,512,1024,2048,4096]},contextWindow:{enabled:!0,values:[2048,4096,8192,16384,32768,65536,98304,131072]},nSeqMax:{enabled:!0,values:[1,2]},flashAttention:{enabled:!0,values:["enabled","disabled"]},cacheType:{enabled:!0,values:["f16","q8_0","q4_0"]},cacheMode:{enabled:!0,values:["none","spc","imc"]}};function Fg(t,n,r){const s={context_window:t.context_window,nbatch:t.nbatch,nubatch:t.nubatch,nseq_max:t.nseq_max},i=[];n.nbatch.enabled&&n.nbatch.values.length>0&&i.push({configKey:"nbatch",values:n.nbatch.values}),n.nubatch.enabled&&n.nubatch.values.length>0&&i.push({configKey:"nubatch",values:n.nubatch.values}),n.contextWindow.enabled&&n.contextWindow.values.length>0&&i.push({configKey:"context_window",values:n.contextWindow.values}),n.nSeqMax.enabled&&n.nSeqMax.values.length>0&&i.push({configKey:"nseq_max",values:n.nSeqMax.values});const l=[...i];if(n.flashAttention.enabled&&n.flashAttention.values.length>0&&l.push({configKey:"flash_attention",values:n.flashAttention.values}),n.cacheType.enabled&&n.cacheType.values.length>0&&l.push({configKey:"cache_type",values:n.cacheType.values}),n.cacheMode.enabled&&n.cacheMode.values.length>0&&l.push({configKey:"cache_mode",values:n.cacheMode.values}),l.length===0)return[{...s}];let o=[{...s}];for(const u of l){const h=[];for(const m of o)for(const x of u.values)h.push({...m,[u.configKey]:x});o=h}const a=new Set,c=[],d=u=>`cw=${u.context_window}|nb=${u.nbatch}|nub=${u.nubatch}|ns=${u.nseq_max}|fa=${u.flash_attention}|ct=${u.cache_type}|cm=${u.cache_mode}`;for(const u of o){const h=d(u);if(a.has(h))continue;const m=u.nbatch??t.nbatch,x=u.nubatch??t.nubatch;m!==void 0&&x!==void 0&&Number.isFinite(m)&&Number.isFinite(x)&&x>m||r!=null&&r.isHybrid&&(u.flash_attention==="enabled"||u.cache_type!==void 0&&u.cache_type!=="f16")||(a.add(h),c.push(u))}return c}function fw(t,n){const r=[];let s=0;if(!n)return{score:0,notes:["No expected value defined"]};switch(n.type){case"exact":{const i=t.trim().toLowerCase(),l=(n.value??"").trim().toLowerCase();i===l?s=100:i.includes(l)?(s=50,r.push(`Partial match: response contains "${n.value}" but has extra text`)):(s=0,r.push(`Expected "${n.value}", got "${t.trim().slice(0,100)}"`));break}case"regex":{new RegExp(n.value??"","im").test(t)?s=100:(s=0,r.push(`Regex /${n.value}/ did not match`));break}case"tool_call":case"no_tool_call":{s=0,r.push(`${n.type} expected type not applicable for chat scoring`);break}}return t.length>2e3&&(s=Math.max(0,s-10),r.push("Penalized: response exceeds 2000 characters")),{score:s,notes:r}}function gw(t,n){var l;const r=[];if(!t||t.length===0)return{score:0,notes:["No tool calls emitted"]};let s=100;const i=new Set(n.filter(o=>{var a;return o.type==="function"&&((a=o.function)==null?void 0:a.name)}).map(o=>o.function.name));for(const o of t){i.has(o.function.name)||(s-=40,r.push(`Tool "${o.function.name}" not in declared tools`));try{const a=JSON.parse(o.function.arguments),c=n.find(u=>{var h;return u.type==="function"&&((h=u.function)==null?void 0:h.name)===o.function.name}),d=(l=c==null?void 0:c.function)==null?void 0:l.parameters;if(d!=null&&d.required&&Array.isArray(d.required)){const u=d.required;for(const h of u)h in a||(s-=20,r.push(`Missing required field "${h}" in ${o.function.name}`))}}catch{s-=30,r.push(`Arguments for "${o.function.name}" are not valid JSON`)}}return{score:Math.max(0,Math.min(100,s)),notes:r}}function jw(t,n,r){const s=[];if(t&&t.length>0){const l=t.map(o=>{var a;return(a=o.function)==null?void 0:a.name}).filter(Boolean).join(", ");return s.push(`Unexpected tool call(s): ${l}`),{score:0,notes:s}}let i=100;return n.trim().length===0&&(i-=20,s.push("No text response produced")),r!=null&&r.value&&(new RegExp(r.value,"im").test(n)||(i-=30,s.push(`Expected text matching /${r.value}/ but got "${n.trim().slice(0,100)}"`))),{score:Math.max(0,i),notes:s}}function Il(t,n,r,s){return new Promise((i,l)=>{if(s!=null&&s.aborted)return l(new DOMException("Aborted","AbortError"));let o=!1,a="";const c=[];let d;const u=()=>{o||(o=!0,h(),l(new DOMException("Aborted","AbortError")))},h=fe.streamPlaygroundChat({session_id:t,messages:n.messages,tools:n.tools,stream:!0,temperature:r.temperature,top_p:r.top_p,top_k:r.top_k,min_p:r.min_p,max_tokens:r.max_tokens??n.max_tokens,repeat_penalty:r.repeat_penalty,repeat_last_n:r.repeat_last_n,frequency_penalty:r.frequency_penalty,presence_penalty:r.presence_penalty,dry_multiplier:r.dry_multiplier,dry_base:r.dry_base,dry_allowed_length:r.dry_allowed_length,dry_penalty_last_n:r.dry_penalty_last_n,xtc_probability:r.xtc_probability,xtc_threshold:r.xtc_threshold,xtc_min_keep:r.xtc_min_keep,adaptive_p_target:r.adaptive_p_target,adaptive_p_decay:r.adaptive_p_decay,enable_thinking:r.enable_thinking,reasoning_effort:r.reasoning_effort,grammar:r.grammar,stream_options:{include_usage:!0}},m=>{var j,b,N,f,p,g,k;const x=(j=m.choices)==null?void 0:j[0];if((b=x==null?void 0:x.delta)!=null&&b.content&&(a+=x.delta.content),(N=x==null?void 0:x.delta)!=null&&N.tool_calls)for(const S of x.delta.tool_calls){const _=c.find(E=>E.index===S.index);_?(S.id&&!_.id&&(_.id=S.id),S.type&&!_.type&&(_.type=S.type),(f=S.function)!=null&&f.name&&!_.function.name&&(_.function.name=S.function.name),(p=S.function)!=null&&p.arguments&&(_.function.arguments+=S.function.arguments)):c.push({id:S.id||"",index:S.index,type:S.type||"function",function:{name:((g=S.function)==null?void 0:g.name)||"",arguments:((k=S.function)==null?void 0:k.arguments)||""}})}m.usage&&(d=m.usage)},m=>{o||(o=!0,s==null||s.removeEventListener("abort",u),h(),l(new Error(m)))},()=>{var x,j;if(o)return;o=!0,s==null||s.removeEventListener("abort",u);let m;((x=n.expected)==null?void 0:x.type)==="tool_call"?m=gw(c,n.tools??[]):((j=n.expected)==null?void 0:j.type)==="no_tool_call"?m=jw(c,a,n.expected):m=fw(a,n.expected),i({promptId:n.id,assistantText:a,toolCalls:c,usage:d,score:m.score,notes:m.notes.length>0?m.notes:void 0})});s==null||s.addEventListener("abort",u,{once:!0})})}async function yw(t,n){const r={id:"probe-tool",messages:[{role:"system",content:W},{role:"user",content:"What's the weather in Boston?"}],tools:te,expected:{type:"tool_call"}};try{const s=await Il(t,r,{},n);return s.toolCalls.length>0&&s.score>0}catch{return!1}}const Hs={chatScore:.4,toolScore:.6,totalScore:0,avgTPS:0,avgTTFT:0,tps0:0,tps20:0,tps50:0,tps80:0,ttft0:0,ttft20:0,ttft50:0,ttft80:0},Od={chatScore:0,toolScore:0,totalScore:0,avgTPS:1,avgTTFT:.5,tps0:.8,tps20:.6,tps50:.4,tps80:.2,ttft0:0,ttft20:0,ttft50:0,ttft80:0};function Og(t,n){const r=n!=="config";switch(t){case"overall":return{chatScore:r?.4:0,toolScore:r?.6:0,totalScore:0,avgTPS:.5,avgTTFT:.3,tps0:.2,tps20:.2,tps50:.2,tps80:.2,ttft0:.1,ttft20:.1,ttft50:.1,ttft80:.1};case"0pct":return{chatScore:r?.2:0,toolScore:r?.3:0,totalScore:0,avgTPS:.2,avgTTFT:.1,tps0:1,tps20:0,tps50:0,tps80:0,ttft0:.8,ttft20:0,ttft50:0,ttft80:0};case"80pct":return{chatScore:r?.2:0,toolScore:r?.3:0,totalScore:0,avgTPS:.2,avgTTFT:.1,tps0:0,tps20:0,tps50:0,tps80:1,ttft0:0,ttft20:0,ttft50:0,ttft80:.8}}}function Jh(t,n){var h,m,x,j;const r=(h=t.scenarioResults.find(b=>b.scenarioId==="chat"))==null?void 0:h.score,s=(m=t.scenarioResults.find(b=>b.scenarioId==="tool_call"))==null?void 0:m.score,i=t.totalScore,l=t.avgTPS,o=t.avgTTFT,a=[];r!==void 0&&a.push({w:n.chatScore??0,v:r}),s!==void 0&&a.push({w:n.toolScore??0,v:s}),i!==void 0&&a.push({w:n.totalScore??0,v:i}),l!==void 0&&a.push({w:n.avgTPS??0,v:Math.min(100,Math.max(0,l))}),o!==void 0&&a.push({w:n.avgTTFT??0,v:Math.max(0,100-o/10)});const c=[{key:"0%",w:n.tps0??0},{key:"20%",w:n.tps20??0},{key:"50%",w:n.tps50??0},{key:"80%",w:n.tps80??0}];for(const{key:b,w:N}of c){const f=(x=t.avgTPSByFill)==null?void 0:x[b];f!==void 0&&a.push({w:N,v:Math.min(100,Math.max(0,f))})}const d=[{key:"0%",w:n.ttft0??0},{key:"20%",w:n.ttft20??0},{key:"50%",w:n.ttft50??0},{key:"80%",w:n.ttft80??0}];for(const{key:b,w:N}of d){const f=(j=t.avgTTFTByFill)==null?void 0:j[b];f!==void 0&&a.push({w:N,v:Math.max(0,100-f/10)})}const u=a.reduce((b,N)=>b+N.w,0);return u<=0?i??r??s??0:Math.round(a.reduce((b,N)=>b+N.w*N.v,0)/u*100)/100}const bw=6;async function kw(t,n,r,s){const i=new Array(t.length);let l=0;const o=Array.from({length:Math.min(n,t.length)},async()=>{for(;!s.aborted;){const a=l++;if(a>=t.length)break;i[a]=await r(t[a],a)}});return await Promise.all(o),i}function qd(t,n,r,s,i,l,o,a,c,d,u,h){const m=new Set(n.filter(p=>p.includeInScore===!1).map(p=>p.id)),x=r.filter(p=>!m.has(p.promptId)),j=x.length>0?Math.round(x.reduce((p,g)=>p+g.score,0)/x.length*100)/100:0,b={},N={},f={};for(const p of["0%","20%","50%","80%"]){const g=a[p],k=c[p];g!==void 0&&k!==void 0&&k>0&&(b[p]=g/k);const S=d[p],_=u[p];S!==void 0&&_!==void 0&&_>0&&(N[p]=S/_),h[p]!==void 0&&(f[p]=h[p])}return{scenarioId:t,promptResults:[...r],score:j,avgTPS:i>0?s/i:void 0,avgTTFT:o>0?l/o:void 0,...Object.keys(b).length>0&&{avgTPSByFill:b},...Object.keys(N).length>0&&{avgTTFTByFill:N},...Object.keys(f).length>0&&{promptTokensByFill:f}}}function vw(t){const n=t.scenarioResults.find(l=>l.scenarioId==="chat"),r=t.scenarioResults.find(l=>l.scenarioId==="tool_call"),s=n??r;(s==null?void 0:s.avgTPS)!==void 0&&(t.avgTPS=s.avgTPS),(s==null?void 0:s.avgTTFT)!==void 0&&(t.avgTTFT=s.avgTTFT);const i=n??r;i!=null&&i.avgTPSByFill&&Object.keys(i.avgTPSByFill).length>0&&(t.avgTPSByFill=i.avgTPSByFill),i!=null&&i.avgTTFTByFill&&Object.keys(i.avgTTFTByFill).length>0&&(t.avgTTFTByFill=i.avgTTFTByFill)}function Bd(t,n,r){const s=t.scenarioResults.findIndex(i=>i.scenarioId===n.scenarioId);s>=0?t.scenarioResults[s]=n:t.scenarioResults.push(n),vw(t),r({...t,scenarioResults:[...t.scenarioResults]})}function ww(t,n,r,s){var o,a,c,d,u;const i=(o=t.usage)==null?void 0:o.tokens_per_second,l=(a=t.usage)==null?void 0:a.output_tokens;if(s&&i&&i>0&&l!==void 0){const h=Math.max(0,l-1);h>0&&(r.genTokens+=h,r.genSeconds+=h/i)}if(s&&((c=t.usage)!=null&&c.time_to_first_token_ms)&&t.usage.time_to_first_token_ms>0&&(r.ttft+=t.usage.time_to_first_token_ms,r.ttftCount++),n.contextFill){const h=n.contextFill.label;if(i&&i>0&&l!==void 0){const m=Math.max(0,l-1);m>0&&(r.fillGenTokens[h]=(r.fillGenTokens[h]??0)+m,r.fillGenSeconds[h]=(r.fillGenSeconds[h]??0)+m/i)}(d=t.usage)!=null&&d.time_to_first_token_ms&&t.usage.time_to_first_token_ms>0&&(r.fillTTFT[h]=(r.fillTTFT[h]??0)+t.usage.time_to_first_token_ms,r.fillTTFTCount[h]=(r.fillTTFTCount[h]??0)+1),(u=t.usage)!=null&&u.prompt_tokens&&(r.actualFills[h]=t.usage.prompt_tokens)}}function Ar(t,n){t.logEntries||(t.logEntries=[]),t.logEntries.push({timestamp:new Date().toISOString(),message:n})}function qg(t){const n=[...t.messages].reverse().find(s=>s.role==="user");if(!n)return;const r=n.content;if(typeof r=="string")return r.slice(0,160);if(Array.isArray(r)){const s=r.filter(i=>(i==null?void 0:i.type)==="text").map(i=>i.text??"").join(" ");return s?s.slice(0,160):void 0}}async function Nw(t,n,r,s,i,l,o){var f,p,g,k,S,_,E;const a=[];let c=0,d=0,u=0,h=0;const m={},x={},j={},b={},N={};Ar(i,`Starting scenario: ${r.name} (${r.prompts.length} prompts, ${s}x repeats)`),l({...i});for(let D=0;D<r.prompts.length;D++){const L=r.prompts[D];if(o.aborted){i.activePrompts=void 0,i.status="cancelled",l({...i});return}const T=L.contextFill!=null?1:s,P=D===0,I=L.contextFill?`context fill @${L.contextFill.label}`:P?`${L.id} (warmup)`:L.id;Ar(i,`Prompt ${D+1}/${r.prompts.length}: ${I}${T>1?` (${T}x)`:""}`),i.activePrompts=[{scenarioId:r.id,promptId:L.id,promptIndex:D,repeats:T,repeatIndex:1,preview:qg(L),startedAt:new Date().toISOString()}],l({...i});const O=[],X=[];let J="",re=[],ne=0,A=0,B=0,v=0,F,z=!1,w=!1,Z="";for(let C=0;C<T;C++){if(o.aborted){z=!0;break}T>1&&C>0&&(i.activePrompts=[{...i.activePrompts[0],repeatIndex:C+1}],l({...i}));try{const R=await Il(t,L,n,o);if(O.push(R.score),R.notes&&X.push(...R.notes),C===0&&(J=R.assistantText,re=R.toolCalls),F=R.usage,!P){const $=(f=R.usage)==null?void 0:f.tokens_per_second,ie=(p=R.usage)==null?void 0:p.output_tokens;if($&&$>0&&ie!==void 0){const ce=Math.max(0,ie-1);ce>0&&(ne+=ce,A+=ce/$)}(g=R.usage)!=null&&g.time_to_first_token_ms&&R.usage.time_to_first_token_ms>0&&(B+=R.usage.time_to_first_token_ms,v++)}if(L.contextFill){const $=L.contextFill.label,ie=(k=R.usage)==null?void 0:k.tokens_per_second,ce=(S=R.usage)==null?void 0:S.output_tokens;if(ie&&ie>0&&ce!==void 0){const q=Math.max(0,ce-1);q>0&&(m[$]=(m[$]??0)+q,x[$]=(x[$]??0)+q/ie)}(_=R.usage)!=null&&_.time_to_first_token_ms&&R.usage.time_to_first_token_ms>0&&(j[$]=(j[$]??0)+R.usage.time_to_first_token_ms,b[$]=(b[$]??0)+1),(E=R.usage)!=null&&E.prompt_tokens&&(N[$]=R.usage.prompt_tokens)}}catch(R){if(R instanceof DOMException&&R.name==="AbortError"){z=!0;break}const $=R instanceof Error?R.message:String(R);if($.includes("Stream terminated")){Ar(i,`Prompt ${I} failed: ${$}`),i.activePrompts=void 0,i.status="failed",l({...i});return}O.push(0),Z=`Error: ${$}`,w=!0}}if(z){i.activePrompts=void 0,i.status="cancelled",l({...i});return}const K=O.length>0?Math.round(O.reduce((C,R)=>C+R,0)/O.length*100)/100:0,Q=X.length>0?[...new Set(X)]:void 0;a.push({promptId:L.id,assistantText:J,toolCalls:re,usage:F,score:K,notes:w&&!Q?[Z]:Q});const Y=!!L.contextFill;!P&&!Y&&(c+=ne,d+=A,u+=B,h+=v);const ee=qd(r.id,r.prompts,a,c,d,u,h,m,x,j,b,N);Bd(i,ee,l)}i.activePrompts=void 0,l({...i})}async function Sw(t,n,r,s,i,l,o,a){const c=new Array(r.prompts.length),d={genTokens:0,genSeconds:0,ttft:0,ttftCount:0,fillGenTokens:{},fillGenSeconds:{},fillTTFT:{},fillTTFTCount:{},actualFills:{}};Ar(l,`Starting scenario: ${r.name} (${r.prompts.length} prompts, concurrency=${i}, ${s}x repeats)`),o({...l});const u=new AbortController,h=u.signal,m=()=>u.abort();a.addEventListener("abort",m,{once:!0});const x=performance.now(),j=new Map,b=()=>{l.activePrompts=[...j.values()],o({...l})};try{await kw(r.prompts,i,async(k,S)=>{if(h.aborted)return;const _=k.contextFill!=null?1:s;j.set(S,{scenarioId:r.id,promptId:k.id,promptIndex:S,repeats:_,repeatIndex:1,preview:qg(k),startedAt:new Date().toISOString()}),b();const E=[],D=[];let L="",T=[],P,I=!1,O="";for(let A=0;A<_&&!h.aborted;A++){if(_>1&&A>0){const B=j.get(S);B&&(j.set(S,{...B,repeatIndex:A+1}),b())}try{const B=await Il(t,k,n,h);E.push(B.score),B.notes&&D.push(...B.notes),A===0&&(L=B.assistantText,T=B.toolCalls),P=B.usage;const v=S!==0&&!k.contextFill;ww(B,k,d,v)}catch(B){if(B instanceof DOMException&&B.name==="AbortError")break;const v=B instanceof Error?B.message:String(B);if(v.includes("Stream terminated")){Ar(l,`Prompt ${k.id} failed: ${v}`),l.activePrompts=void 0,l.status="failed",o({...l}),u.abort();return}E.push(0),O=`Error: ${v}`,I=!0}}if(h.aborted){j.delete(S);return}const X=E.length>0?E.reduce((A,B)=>A+B,0)/E.length:0,J=D.length>0?[...new Set(D)]:void 0;c[S]={promptId:k.id,assistantText:L,toolCalls:T,usage:P,score:X,notes:I&&!J?[O]:J},j.delete(S);const re=c.filter(Boolean),ne=qd(r.id,r.prompts,re,d.genTokens,d.genSeconds,d.ttft,d.ttftCount,d.fillGenTokens,d.fillGenSeconds,d.fillTTFT,d.fillTTFTCount,d.actualFills);l.activePrompts=[...j.values()],Bd(l,ne,o)},h)}finally{a.removeEventListener("abort",m)}if(l.activePrompts=void 0,l.status==="failed")return;if(h.aborted){l.status="cancelled",o({...l});return}const N=(performance.now()-x)/1e3,f=N>0&&d.genTokens>0?d.genTokens/N:void 0,p=c.filter(Boolean),g=qd(r.id,r.prompts,p,d.genTokens,d.genSeconds,d.ttft,d.ttftCount,d.fillGenTokens,d.fillGenSeconds,d.fillTTFT,d.fillTTFTCount,d.actualFills);f!==void 0&&(g.avgTPS=f),Bd(l,g,o)}async function ho(t,n,r,s,i,l,o=3,a){const c=`trial-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,d=Math.max(1,Math.floor(o)),u=Math.min(Math.max(1,(a==null?void 0:a.concurrency)??1),bw),h={id:c,status:"running",candidate:n,startedAt:new Date().toISOString(),scenarioResults:[],logEntries:[]};Ar(h,`Trial started (${r.length} scenario${r.length!==1?"s":""})`),s({...h});for(let p=0;p<r.length;p++){const g=r[p];if(i.aborted)return h.status="cancelled",s({...h}),h;if(p>0){Ar(h,`Pausing ${Gm/1e3}s before next scenario`),s({...h});try{await uw(Gm,i)}catch(k){if(k instanceof DOMException&&k.name==="AbortError")return h.status="cancelled",h.finishedAt=new Date().toISOString(),s({...h}),h;throw k}}if(u>1&&g.prompts.length>0){Ar(h,`Warming up cache for concurrent scenario: ${g.name}`),s({...h});try{await Il(t,g.prompts[0],{...n,max_tokens:1},i)}catch(k){if(k instanceof DOMException&&k.name==="AbortError")return h.status="cancelled",s({...h}),h}}if(u>1?await Sw(t,n,g,d,u,h,s,i):await Nw(t,n,g,d,h,s,i),h.status==="cancelled"||h.status==="failed")return h}const m=new Map;for(const p of h.scenarioResults)m.set(p.scenarioId,{score:p.score,avgTPS:p.avgTPS,avgTTFT:p.avgTTFT});const x=m.get("tool_call"),j=m.get("chat"),b=l??Hs;if(x&&j){const p=b.chatScore,g=b.toolScore,k=p+g,S=k>0?(g*x.score+p*j.score)/k:(x.score+j.score)/2;h.totalScore=Math.round(S*100)/100}else x?h.totalScore=x.score:j&&(h.totalScore=j.score);const N=j??x;h.avgTPS=N==null?void 0:N.avgTPS,h.avgTTFT=N==null?void 0:N.avgTTFT;const f=h.scenarioResults.find(p=>p.scenarioId==="chat");return f!=null&&f.avgTPSByFill&&Object.keys(f.avgTPSByFill).length>0&&(h.avgTPSByFill=f.avgTPSByFill),f!=null&&f.avgTTFTByFill&&Object.keys(f.avgTTFTByFill).length>0&&(h.avgTTFTByFill=f.avgTTFTByFill),h.finishedAt=new Date().toISOString(),h.status="completed",s({...h}),h}const oa="playground:autoTestHistory:v1",_w="playground:autoTestHistory:updatedAt",Ud=500,Tw="playground:autoTestHistory",Cw=1,Ze="entries",zn="meta";function ds(t){return new Promise((n,r)=>{t.onsuccess=()=>n(t.result),t.onerror=()=>r(t.error)})}function rr(t){return new Promise((n,r)=>{t.oncomplete=()=>n(),t.onerror=()=>r(t.error),t.onabort=()=>r(t.error)})}let Ci=null;function Pw(){return Ci||(Ci=new Promise((t,n)=>{const r=indexedDB.open(Tw,Cw);r.onupgradeneeded=()=>{const s=r.result;s.objectStoreNames.contains(Ze)||s.createObjectStore(Ze,{keyPath:"id"}).createIndex("by_savedAt","savedAt"),s.objectStoreNames.contains(zn)||s.createObjectStore(zn,{keyPath:"key"})},r.onsuccess=()=>t(r.result),r.onerror=()=>{Ci=null,n(r.error)}}),Ci)}let Pi=!1;async function Ew(t){if(Pi)return;const n=t.transaction(zn,"readonly");if(await ds(n.objectStore(zn).get("migratedFromLocalStorage"))){Pi=!0;return}const s=t.transaction(Ze,"readonly");if(await ds(s.objectStore(Ze).count())>0){const o=t.transaction(zn,"readwrite");o.objectStore(zn).put({key:"migratedFromLocalStorage",value:!0}),await rr(o),Pi=!0;return}try{const o=localStorage.getItem(oa);if(o){const a=JSON.parse(o);if(Array.isArray(a)){const c=a.filter(Aa);if(c.length>0){const d=t.transaction([Ze,zn],"readwrite"),u=d.objectStore(Ze);for(const h of c)u.put(h);d.objectStore(zn).put({key:"migratedFromLocalStorage",value:!0}),await rr(d),localStorage.removeItem(oa),Pi=!0;return}}}}catch{}const l=t.transaction(zn,"readwrite");l.objectStore(zn).put({key:"migratedFromLocalStorage",value:!0}),await rr(l),Pi=!0}function Aa(t){if(typeof t!="object"||t===null)return!1;const n=t;if(n.version!==1||typeof n.id!="string"||n.id.length===0||typeof n.savedAt!="string"||!Number.isFinite(Date.parse(n.savedAt))||n.sweepMode!=="sampling"&&n.sweepMode!=="config"||typeof n.run!="object"||n.run===null)return!1;const r=n.run;return!!Array.isArray(r.trials)}function Bg(t){const n=structuredClone(t);for(const r of n.trials)r.activePrompts=void 0,r.logEntries=void 0;return n}function Rw(t){let n;for(const r of t.trials)r.finishedAt&&(!n||r.finishedAt>n)&&(n=r.finishedAt);return n??t.runStartedAt}async function Ug(t){const n=t.transaction(Ze,"readwrite"),r=n.objectStore(Ze).index("by_savedAt"),s=await ds(r.getAllKeys());if(s.length<=Ud)return;const i=s.slice(0,s.length-Ud),l=n.objectStore(Ze);for(const o of i)l.delete(o);await rr(n)}function Al(){window.dispatchEvent(new Event("autotest-history-updated"));try{localStorage.setItem(_w,String(Date.now()))}catch{}}async function ci(){const t=await Pw();return await Ew(t),t}function di(){try{const t=localStorage.getItem(oa);if(!t)return[];const n=JSON.parse(t);return Array.isArray(n)?n.filter(Aa):[]}catch{return[]}}function Dl(t){try{localStorage.setItem(oa,JSON.stringify(t.slice(0,Ud)))}catch{}}async function Kd(){try{const r=(await ci()).transaction(Ze,"readonly").objectStore(Ze).index("by_savedAt");return(await ds(r.getAll())).filter(Aa).reverse()}catch{return di()}}async function Mw(t){var i;const n=Bg(t),r=t.kind==="sampling"?(i=t.sessionSeed)==null?void 0:i.model_id:t.sessionSeed.model_id,s={version:1,id:t.runId,savedAt:new Date().toISOString(),completedAt:Rw(t),modelId:r,sweepMode:t.kind,run:n};try{const l=await ci(),o=l.transaction(Ze,"readwrite");o.objectStore(Ze).put(s),await rr(o),await Ug(l)}catch{const l=di().filter(o=>o.id!==t.runId);l.unshift(s),Dl(l)}Al()}async function Iw(t,n){try{const r=await ci(),s=r.transaction(Ze,"readonly"),i=await ds(s.objectStore(Ze).get(t));if(!i)return;const l=n(i),o=r.transaction(Ze,"readwrite");o.objectStore(Ze).put(l),await rr(o)}catch{const r=di(),s=r.findIndex(i=>i.id===t);s>=0&&(r[s]=n(r[s]),Dl(r))}Al()}async function Aw(t){try{const r=(await ci()).transaction(Ze,"readwrite");r.objectStore(Ze).delete(t),await rr(r)}catch{const n=di().filter(r=>r.id!==t);Dl(n)}Al()}async function Dw(t){if(t.length!==0){try{const r=(await ci()).transaction(Ze,"readwrite"),s=r.objectStore(Ze);for(const i of t)s.delete(i);await rr(r)}catch{const n=new Set(t),r=di().filter(s=>!n.has(s.id));Dl(r)}Al()}}async function Lw(){const t=await Kd(),n={schemaVersion:1,exportedAt:new Date().toISOString(),entries:t};return new Blob([JSON.stringify(n,null,2)],{type:"application/json"})}async function Fw(t){let n;try{n=JSON.parse(t)}catch{throw new Error("Invalid JSON file")}if(typeof n!="object"||n===null||!("schemaVersion"in n)||n.schemaVersion!==1||!("entries"in n)||!Array.isArray(n.entries))throw new Error("Invalid export file format");const r=n.entries,s=new Map;for(const a of r){if(!Aa(a))continue;const c={...a,run:Bg(a.run)},d=s.get(c.id);(!d||c.savedAt>d.savedAt)&&s.set(c.id,c)}const i=Array.from(s.values());if(i.length===0)return{imported:0,skipped:r.length};let l=0,o=0;try{const a=await ci(),c=a.transaction(Ze,"readonly"),d=new Set(await ds(c.objectStore(Ze).getAllKeys())),u=a.transaction(Ze,"readwrite"),h=u.objectStore(Ze);for(const m of i)if(d.has(m.id)){const x=await ds(h.get(m.id));x&&m.savedAt>x.savedAt?(h.put(m),l++):o++}else h.put(m),l++;await rr(u),await Ug(a)}catch{const a=di(),c=new Map(a.map(d=>[d.id,d]));for(const d of i){const u=c.get(d.id);u?d.savedAt>u.savedAt?(c.set(d.id,d),l++):o++:(c.set(d.id,d),l++)}Dl(Array.from(c.values()))}return Al(),{imported:l,skipped:o}}function ks(t,n,r){const s=[...t,...n,...r??[]],i=new Set;return s.filter(l=>{const o=`${l.timestamp}|${l.message}`;return i.has(o)?!1:(i.add(o),!0)})}function Wm(t,n){return new Promise((r,s)=>{if(n.aborted){s(new DOMException("Aborted","AbortError"));return}const i=setTimeout(()=>{n.removeEventListener("abort",l),r()},t);function l(){clearTimeout(i),s(new DOMException("Aborted","AbortError"))}n.addEventListener("abort",l,{once:!0})})}async function uo(t){var l,o,a,c,d;let n=-1/0,r=-1/0,s,i=!1;if(t.initialDelayMs&&t.initialDelayMs>0){(l=t.onInitialDelayStart)==null||l.call(t);try{await Wm(t.initialDelayMs,t.signal)}catch(u){if((o=t.onInitialDelayEnd)==null||o.call(t),u instanceof DOMException&&u.name==="AbortError")return s;throw u}if(t.signal.aborted||t.isStale())return(a=t.onInitialDelayEnd)==null||a.call(t),s;(c=t.onInitialDelayEnd)==null||c.call(t)}for(;!(t.signal.aborted||t.isStale());){if(i)try{await Wm(Dg,t.signal)}catch(g){if(g instanceof DOMException&&g.name==="AbortError")break;throw g}if(t.signal.aborted||t.isStale())break;const u=t.getNextQueuedTrialId();if(u===void 0)break;const h=t.claimTrial(u);if(h<0)continue;if(i=!0,t.signal.aborted||t.isStale())break;const m=new AbortController;t.trialAbortRef&&(t.trialAbortRef.current=m);const x=()=>m.abort();t.signal.addEventListener("abort",x,{once:!0});let j=null,b=!1;try{j=await t.executeTrial(u,h,m.signal)}catch(g){if(g instanceof DOMException&&g.name==="AbortError")if(m.signal.aborted&&!t.signal.aborted)b=!0,(d=t.onTrialStopped)==null||d.call(t,u,h);else break;else throw g}finally{t.signal.removeEventListener("abort",x),t.trialAbortRef&&(t.trialAbortRef.current=null)}if(b||!j||t.isStale())continue;const N=Jh(j,t.weights),f=j.avgTPS??-1/0;(N>n+1e-6||Math.abs(N-n)<=1e-6&&f>r)&&(n=N,r=f,s=j.id),t.onTrialResult(u,h,j,s)}return s}const Kg=y.createContext(null);function Ow({children:t}){const[n,r]=y.useState(null),s=y.useRef(null),i=y.useCallback(P=>{const I=s.current,O=typeof P=="function"?P(I):P;s.current=O,r(O)},[]);y.useEffect(()=>{s.current=n},[n]);const l=y.useRef(null),o=y.useRef(null),a=y.useRef(null),c=y.useRef(null),d=y.useRef(0),u=y.useRef(null),h=y.useRef(null),[m,x]=y.useState(!1),j=y.useRef(new Set);y.useEffect(()=>{n&&n.status==="completed"&&(j.current.has(n.runId)||(j.current.add(n.runId),Mw(n)))},[n==null?void 0:n.runId,n==null?void 0:n.status]),y.useEffect(()=>()=>{var O,X;(O=l.current)==null||O.abort(),(X=c.current)==null||X.abort();const P=o.current;P&&fe.deletePlaygroundSession(P).catch(()=>{}),o.current=null;const I=a.current;I&&fe.deletePlaygroundSession(I).catch(()=>{}),a.current=null},[]);const b=y.useCallback(({sessionId:P,sessionSeed:I,enabledScenarios:O,sweepDef:X,maxTrials:J,weights:re,repeats:ne,effectiveConfig:A})=>{if(u.current)return;const B=++d.current,v=()=>d.current!==B,F=`run-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,z=new AbortController;l.current=z;let w;const Z=new Promise(K=>{w=K});u.current={runId:F,done:Z},x(!0),i({runId:F,kind:"sampling",status:"repairing_template",enabledScenarios:O,currentTrialIndex:0,totalTrials:0,sessionId:P??"",sessionSeed:I,sweepDef:X,maxTrials:J,trials:[],repeats:ne,weights:re}),(async()=>{try{let K=P??"",Q=A;if(!K&&(I!=null&&I.model_id)){i($=>$&&!v()?{...$,templateRepairStatus:"Creating session"}:$);const R=await fe.createPlaygroundSession({model_id:I.model_id,template_mode:I.template_mode,template_name:I.template_name,template_script:I.template_script,config:I.base_config??{}});if(K=R.session_id,Q=R.effective_config,a.current=K,z.signal.aborted||v()){fe.deletePlaygroundSession(K).catch(()=>{}),a.current=null;return}i($=>$&&!v()?{...$,sessionId:K,templateRepairStatus:"Session created "}:$)}if(!K){v()||i(R=>R&&{...R,status:"error",errorMessage:"No session available"});return}const Y=[];if(O.chat&&Y.push(ia),O.tool_call&&Y.push(vl),O.tool_call){i($=>$&&!v()?{...$,templateRepairStatus:"Probing template for tool calling compatibility..."}:$);const R=await yw(K,z.signal);if(v())return;if(R)i($=>$&&!v()?{...$,templateRepairStatus:"Template OK "}:$);else{i(ie=>ie&&!v()?{...ie,templateRepairStatus:"Template probe failed  running chat-only tests"}:ie);const $=Y.findIndex(ie=>ie.id==="tool_call");$!==-1&&Y.splice($,1)}}if(Y.length===0){v()||i(R=>R&&{...R,status:"error",errorMessage:"No runnable scenarios  template probe failed and chat is disabled"});return}if(O.chat){const R=$m(Q);if(R&&R>0){i($=>$&&!v()?{...$,calibrationStatus:"Calibrating context fill prompts..."}:$);try{const $=await Hm(K,R,z.signal);if(v())return;if($.length>0){const ie=Y.findIndex(ce=>ce.id==="chat");ie>=0&&(Y[ie]={...Y[ie],prompts:[...Y[ie].prompts,...$]}),i(ce=>ce&&!v()?{...ce,calibrationStatus:`Calibrated ${$.length} context fill levels `}:ce)}else i(ie=>ie&&!v()?{...ie,calibrationStatus:"Context window too small for fill tests"}:ie)}catch{if(v())return;i($=>$&&!v()?{...$,calibrationStatus:"Context fill calibration failed  skipping fill tests"}:$)}}}const ee=Lg(X,J),C=ee.map((R,$)=>({id:`${F}-trial-${$}`,status:"queued",candidate:R,scenarioResults:[]}));i(R=>R&&!v()?{...R,status:"running_trials",runStartedAt:new Date().toISOString(),totalTrials:ee.length,currentTrialIndex:0,trials:C}:R),await uo({signal:z.signal,weights:re,isStale:v,initialDelayMs:co,onInitialDelayStart:()=>{i(R=>R&&!v()?{...R,initialDelayUntil:new Date(Date.now()+co).toISOString()}:R)},onInitialDelayEnd:()=>{i(R=>R&&!v()?{...R,initialDelayUntil:void 0}:R)},trialAbortRef:c,onTrialStopped:(R,$)=>{i(ie=>{if(!ie||ie.kind!=="sampling"||v())return ie;const ce=ie.trials.findIndex(H=>H.id===R);if(ce<0)return ie;const q=[...ie.trials];return q[ce]={...q[ce],status:"cancelled",finishedAt:new Date().toISOString()},{...ie,trials:q}})},getNextQueuedTrialId:()=>{var $;const R=s.current;if(!(!R||R.status!=="running_trials"))return($=R.trials.find(ie=>ie.status==="queued"))==null?void 0:$.id},claimTrial:R=>{const $=new Date().toISOString();let ie=-1;return i(ce=>{if(!ce||ce.kind!=="sampling"||v())return ce;const q=ce.trials.findIndex(le=>le.id===R);if(q<0||ce.trials[q].status!=="queued")return ce;const H=[...ce.trials];return H[q]={...H[q],status:"running",startedAt:$},ie=q,{...ce,trials:H}}),ie},executeTrial:async(R,$,ie)=>{const ce=s.current,q=ce==null?void 0:ce.trials.find(ge=>ge.id===R);if(!q)return null;const H=q.candidate;return{...await ho(K,H,Y,ge=>{i(ve=>{if(!ve||ve.kind!=="sampling"||v())return ve;const Se=ve.trials.findIndex(G=>G.id===R);if(Se<0)return ve;const Re=[...ve.trials],qe=Re[Se].logEntries??[],Ke=ks(qe,[],ge.logEntries),{id:et,...ze}=ge;return Re[Se]={...Re[Se],...ze,id:R,logEntries:Ke},{...ve,trials:Re}})},ie,re,ne),id:R}},onTrialResult:(R,$,ie,ce)=>{i(q=>{if(!q||q.kind!=="sampling"||v())return q;const H=q.trials.findIndex(me=>me.id===R);if(H<0)return q;const le=[...q.trials];return le[H]=ie,{...q,trials:le,currentTrialIndex:H+1,bestTrialId:ce}})}}),v()||i(R=>R&&{...R,status:z.signal.aborted?"cancelled":"completed"})}catch(K){if(v())return;K instanceof DOMException&&K.name==="AbortError"?i(Q=>Q&&{...Q,status:"cancelled"}):i(Q=>Q&&{...Q,errorMessage:K.message||"Automated testing failed",status:"error"})}finally{const K=a.current;K&&(await fe.deletePlaygroundSession(K).catch(()=>{}),a.current=null),l.current=null,u.current=null,x(!1),w()}})()},[]),N=y.useCallback(({sessionSeed:P,enabledScenarios:I,configSweepDef:O,weights:X,repeats:J})=>{if(u.current)return;const re=++d.current,ne=()=>d.current!==re,A=`run-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,B=new AbortController;l.current=B;let v;const F=new Promise(z=>{v=z});u.current={runId:A,done:F},x(!0),i({runId:A,kind:"config",status:"running_trials",enabledScenarios:I,currentTrialIndex:0,totalTrials:0,sessionSeed:P,configSweepDef:O,trials:[],repeats:J,weights:X}),(async()=>{var z,w;try{let Z={},K=null;try{const R=await fe.createPlaygroundSession({model_id:P.model_id,template_mode:P.template_mode,template_name:P.template_name,template_script:P.template_script,config:{}});K=R.session_id,Z={isHybrid:((z=R.effective_config)==null?void 0:z.is_hybrid_model)===!0,isGPT:((w=R.effective_config)==null?void 0:w.is_gpt_model)===!0}}catch{}finally{K&&await fe.deletePlaygroundSession(K).catch(()=>{})}if(ne())return;const Q=Fg(P.base_config,O,Z);if(Q.length===0){ne()||i(R=>R&&{...R,errorMessage:"No valid config candidates generated (check sweep values; hybrid models require f16 cache type and disable flash attention)",status:"error"});return}const Y=[la],ee={temperature:0,top_p:1,top_k:1,min_p:0,repeat_penalty:1,frequency_penalty:0,presence_penalty:0},C=Q.map((R,$)=>({id:`${A}-trial-${$}`,status:"queued",candidate:ee,scenarioResults:[],config:R}));i(R=>R&&!ne()?{...R,status:"running_trials",runStartedAt:new Date().toISOString(),totalTrials:Q.length,currentTrialIndex:0,trials:C}:R),await uo({signal:B.signal,weights:X,isStale:ne,initialDelayMs:co,onInitialDelayStart:()=>{i(R=>R&&!ne()?{...R,initialDelayUntil:new Date(Date.now()+co).toISOString()}:R)},onInitialDelayEnd:()=>{i(R=>R&&!ne()?{...R,initialDelayUntil:void 0}:R)},trialAbortRef:c,onTrialStopped:(R,$)=>{i(ie=>{if(!ie||ie.kind!=="config"||ne())return ie;const ce=ie.trials.findIndex(H=>H.id===R);if(ce<0)return ie;const q=[...ie.trials];return q[ce]={...q[ce],status:"cancelled",finishedAt:new Date().toISOString()},{...ie,trials:q}})},getNextQueuedTrialId:()=>{var $;const R=s.current;if(!(!R||R.kind!=="config"||R.status!=="running_trials"))return($=R.trials.find(ie=>ie.status==="queued"))==null?void 0:$.id},claimTrial:R=>{const $=new Date().toISOString();let ie=-1;return i(ce=>{if(!ce||ce.kind!=="config"||ne())return ce;const q=ce.trials.findIndex(le=>le.id===R);if(q<0||ce.trials[q].status!=="queued")return ce;const H=[...ce.trials];return H[q]={...H[q],status:"running",startedAt:$,logEntries:[]},ie=q,{...ce,trials:H}}),ie},executeTrial:async(R,$,ie)=>{const ce=s.current,q=ce==null?void 0:ce.trials.find(Ke=>Ke.id===R);if(!(q!=null&&q.config))return null;const H=q.config,le=[],me=Ke=>{const et={timestamp:new Date().toISOString(),message:Ke};le.push(et),i(ze=>{if(!ze||ze.kind!=="config"||ne())return ze;const G=ze.trials.findIndex(he=>he.id===R);if(G<0)return ze;const se=[...ze.trials];return se[G]={...se[G],logEntries:[...le]},{...ze,trials:se}})},{cache_type:ge,cache_mode:ve,...Se}=H,Re={...Se,...ge!==void 0&&{cache_type_k:ge,cache_type_v:ge},...ve!==void 0&&{system_prompt_cache:ve==="spc",incremental_cache:ve==="imc"}};let qe=null;try{me("Creating session with config overrides");const Ke=await fe.createPlaygroundSession({model_id:P.model_id,template_mode:P.template_mode,template_name:P.template_name,template_script:P.template_script,config:{...P.base_config,...Re}});if(qe=Ke.session_id,o.current=qe,ie.aborted||ne())throw new DOMException("Aborted","AbortError");me("Session created ");const et=[...Y];if(et.length===0)throw new Error("No runnable scenarios for this config  template probe failed and chat is disabled");if(I.chat){const he=$m(Ke.effective_config,P.base_config);if(he&&he>0){me(`Calibrating context fill prompts (ctx=${he})`);try{const je=await Hm(qe,he,ie);if(ne())throw new DOMException("Aborted","AbortError");if(je.length>0){const Ne=et.findIndex(tt=>tt.id==="chat");Ne>=0&&(et[Ne]={...et[Ne],prompts:[...et[Ne].prompts,...je]}),me(`Calibrated ${je.length} fill levels `)}else me("Context window too small for fill tests")}catch{me("Context fill calibration failed  skipping")}}}me("Running scenarios");const ze=he=>{i(je=>{if(!je||je.kind!=="config"||ne())return je;const Ne=je.trials.findIndex(st=>st.id===R);if(Ne<0)return je;const tt=[...je.trials],Nt=tt[Ne].logEntries??[],jt=ks(Nt,le,he.logEntries),{id:Vt,...on}=he;return tt[Ne]={...tt[Ne],...on,id:R,config:H,logEntries:jt},{...je,trials:tt}})},G=H.nseq_max??P.base_config.nseq_max??1,se=await ho(qe,ee,et,ze,ie,X,J,G>1?{concurrency:G}:void 0);return{...se,id:R,config:H,logEntries:ks([],le,se.logEntries)}}catch(Ke){if(Ke instanceof DOMException&&Ke.name==="AbortError")throw Ke;const et=Ke instanceof Error?Ke.message:String(Ke);return ne()||i(ze=>{if(!ze||ze.kind!=="config")return ze;const G=ze.trials.findIndex(je=>je.id===R);if(G<0)return ze;const se=[...ze.trials],he=se[G];return se[G]={...he,id:(he==null?void 0:he.id)??R,status:"failed",startedAt:(he==null?void 0:he.startedAt)??new Date().toISOString(),finishedAt:new Date().toISOString(),scenarioResults:[],totalScore:void 0,avgTPS:void 0,config:H,error:et},{...ze,trials:se,currentTrialIndex:G+1}}),null}finally{qe&&(await fe.deletePlaygroundSession(qe).catch(()=>{}),o.current===qe&&(o.current=null))}},onTrialResult:(R,$,ie,ce)=>{i(q=>{if(!q||q.kind!=="config"||ne())return q;const H=q.trials.findIndex(me=>me.id===R);if(H<0)return q;const le=[...q.trials];return le[H]=ie,{...q,trials:le,currentTrialIndex:H+1,bestTrialId:ce}})}}),ne()||i(R=>R&&{...R,status:B.signal.aborted?"cancelled":"completed"})}catch(Z){if(ne())return;Z instanceof DOMException&&Z.name==="AbortError"?i(K=>K&&{...K,status:"cancelled"}):i(K=>K&&{...K,errorMessage:Z.message||"Automated testing failed",status:"error"})}finally{const Z=o.current;Z&&(await fe.deletePlaygroundSession(Z).catch(()=>{}),o.current=null),l.current=null,u.current=null,x(!1),v()}})()},[]),f=y.useCallback(()=>{const P=s.current;if(!P||u.current||!P.trials.some(A=>A.status==="queued"))return;const O=++d.current,X=()=>d.current!==O,J=new AbortController;l.current=J;let re;const ne=new Promise(A=>{re=A});u.current={runId:P.runId,done:ne},x(!0),i(A=>A&&{...A,status:"running_trials",initialDelayUntil:void 0}),(async()=>{var A;try{if(P.kind==="sampling"){const B=P;let v=B.sessionId;if((A=B.sessionSeed)!=null&&A.model_id)try{v=(await fe.createPlaygroundSession({model_id:B.sessionSeed.model_id,template_mode:B.sessionSeed.template_mode,template_name:B.sessionSeed.template_name,template_script:B.sessionSeed.template_script,config:B.sessionSeed.base_config??{}})).session_id,a.current=v,i(w=>w&&w.kind==="sampling"?{...w,sessionId:v}:w)}catch{i(z=>z&&{...z,status:"error",errorMessage:"Failed to recreate session for rerun"});return}if(!v){i(z=>z&&{...z,status:"error",errorMessage:"No session available for rerun"});return}const F=[];B.enabledScenarios.chat&&F.push(ia),B.enabledScenarios.tool_call&&F.push(vl),await uo({signal:J.signal,weights:B.weights,isStale:X,trialAbortRef:c,onTrialStopped:z=>{i(w=>{if(!w||w.kind!=="sampling"||X())return w;const Z=w.trials.findIndex(Q=>Q.id===z);if(Z<0)return w;const K=[...w.trials];return K[Z]={...K[Z],status:"cancelled",finishedAt:new Date().toISOString()},{...w,trials:K}})},getNextQueuedTrialId:()=>{var w;const z=s.current;if(!(!z||z.status!=="running_trials"))return(w=z.trials.find(Z=>Z.status==="queued"))==null?void 0:w.id},claimTrial:z=>{const w=new Date().toISOString();let Z=-1;return i(K=>{if(!K||K.kind!=="sampling"||X())return K;const Q=K.trials.findIndex(ee=>ee.id===z);if(Q<0||K.trials[Q].status!=="queued")return K;const Y=[...K.trials];return Y[Q]={...Y[Q],status:"running",startedAt:w},Z=Q,{...K,trials:Y}}),Z},executeTrial:async(z,w,Z)=>{const K=s.current,Q=K==null?void 0:K.trials.find(R=>R.id===z);if(!Q)return null;const Y=Q.candidate;return{...await ho(v,Y,F,R=>{i($=>{if(!$||$.kind!=="sampling"||X())return $;const ie=$.trials.findIndex(ge=>ge.id===z);if(ie<0)return $;const ce=[...$.trials],q=ce[ie].logEntries??[],H=ks(q,[],R.logEntries),{id:le,...me}=R;return ce[ie]={...ce[ie],...me,id:z,logEntries:H},{...$,trials:ce}})},Z,B.weights,B.repeats),id:z}},onTrialResult:(z,w,Z,K)=>{i(Q=>{if(!Q||Q.kind!=="sampling"||X())return Q;const Y=Q.trials.findIndex(C=>C.id===z);if(Y<0)return Q;const ee=[...Q.trials];return ee[Y]=Z,{...Q,trials:ee,currentTrialIndex:Y+1,bestTrialId:K}})}})}else{const B=P,v=B.sessionSeed,F=[la];await uo({signal:J.signal,weights:B.weights,isStale:X,trialAbortRef:c,onTrialStopped:z=>{i(w=>{if(!w||w.kind!=="config"||X())return w;const Z=w.trials.findIndex(Q=>Q.id===z);if(Z<0)return w;const K=[...w.trials];return K[Z]={...K[Z],status:"cancelled",finishedAt:new Date().toISOString()},{...w,trials:K}})},getNextQueuedTrialId:()=>{var w;const z=s.current;if(!(!z||z.status!=="running_trials"))return(w=z.trials.find(Z=>Z.status==="queued"))==null?void 0:w.id},claimTrial:z=>{const w=new Date().toISOString();let Z=-1;return i(K=>{if(!K||K.kind!=="config"||X())return K;const Q=K.trials.findIndex(ee=>ee.id===z);if(Q<0||K.trials[Q].status!=="queued")return K;const Y=[...K.trials];return Y[Q]={...Y[Q],status:"running",startedAt:w},Z=Q,{...K,trials:Y}}),Z},executeTrial:async(z,w,Z)=>{const K=s.current;if(!K||K.kind!=="config")return null;const Q=K.trials.find(q=>q.id===z);if(!Q)return null;const Y=Q.config;if(!Y)return null;let ee="";const C=[],R={temperature:0,top_p:1,top_k:1,min_p:0,repeat_penalty:1,frequency_penalty:0,presence_penalty:0},$=F,ie=B.repeats,ce=B.weights;try{const q={...R,...Y};if(ee=(await fe.createPlaygroundSession({model_id:v.model_id,template_mode:v.template_mode,template_name:v.template_name,template_script:v.template_script,config:q})).session_id,o.current=ee,J.signal.aborted||X())return await fe.deletePlaygroundSession(ee).catch(()=>{}),o.current=null,null;const le=ve=>{i(Se=>{if(!Se||Se.kind!=="config"||X())return Se;const Re=Se.trials.findIndex(se=>se.id===z);if(Re<0)return Se;const qe=[...Se.trials],Ke=qe[Re].logEntries??[],et=ks(Ke,C,ve.logEntries),{id:ze,...G}=ve;return qe[Re]={...qe[Re],...G,id:z,config:Y,logEntries:et},{...Se,trials:qe}})},me=Y.nseq_max??v.base_config.nseq_max??1,ge=await ho(ee,R,$,le,Z,ce,ie,me>1?{concurrency:me}:void 0);return{...ge,id:z,config:Y,logEntries:ks([],C,ge.logEntries)}}catch(q){if(q instanceof DOMException&&q.name==="AbortError")throw q;const H=q instanceof Error?q.message:String(q);return X()||i(le=>{if(!le||le.kind!=="config")return le;const me=le.trials.findIndex(Se=>Se.id===z);if(me<0)return le;const ge=[...le.trials],ve=ge[me];return ge[me]={...ve,id:(ve==null?void 0:ve.id)??z,status:"failed",startedAt:(ve==null?void 0:ve.startedAt)??new Date().toISOString(),finishedAt:new Date().toISOString(),scenarioResults:[],totalScore:void 0,avgTPS:void 0,config:Y,error:H},{...le,trials:ge,currentTrialIndex:me+1}}),null}finally{ee&&(await fe.deletePlaygroundSession(ee).catch(()=>{}),o.current===ee&&(o.current=null))}},onTrialResult:(z,w,Z,K)=>{i(Q=>{if(!Q||Q.kind!=="config"||X())return Q;const Y=Q.trials.findIndex(C=>C.id===z);if(Y<0)return Q;const ee=[...Q.trials];return ee[Y]=Z,{...Q,trials:ee,currentTrialIndex:Y+1,bestTrialId:K}})}})}X()||i(B=>B&&{...B,status:J.signal.aborted?"cancelled":"completed"})}catch(B){if(X())return;B instanceof DOMException&&B.name==="AbortError"?i(v=>v&&{...v,status:"cancelled"}):i(v=>v&&{...v,errorMessage:B.message||"Rerun failed",status:"error"})}finally{const B=a.current;B&&(await fe.deletePlaygroundSession(B).catch(()=>{}),a.current=null);const v=o.current;v&&(await fe.deletePlaygroundSession(v).catch(()=>{}),o.current=null),l.current=null,u.current=null,x(!1),re()}})()},[]);h.current=f;const p=y.useCallback(()=>{var P,I;++d.current,(P=l.current)==null||P.abort(),(I=c.current)==null||I.abort(),i(O=>{if(!O)return O;const X=O.trials.map(J=>J.status==="running"?{...J,status:"cancelled",finishedAt:new Date().toISOString()}:J);return{...O,status:"cancelled",initialDelayUntil:void 0,trials:X}})},[]),g=y.useCallback(()=>{u.current||i(null)},[]),k=y.useCallback(P=>{i(I=>{if(!I||I.status!=="completed")return I;let O=-1/0,X=-1/0,J;for(const re of I.trials){if(!re||re.status==="skipped"||re.totalScore===void 0||re.totalScore===null||I.kind==="config"&&re.error)continue;const ne=Jh(re,P),A=re.avgTPS??-1/0;(ne>O+1e-6||Math.abs(ne-O)<=1e-6&&A>X)&&(O=ne,X=A,J=re.id)}return{...I,bestTrialId:J}})},[]),S=y.useCallback(({trialId:P,direction:I})=>{i(O=>{if(!O||O.status!=="running_trials")return O;const X=O.trials.findIndex(ne=>ne.id===P);if(X<0||O.trials[X].status!=="queued")return O;const J=I==="up"?X-1:X+1;if(J<0||J>=O.trials.length||O.trials[J].status!=="queued")return O;const re=[...O.trials];return[re[X],re[J]]=[re[J],re[X]],{...O,trials:re}})},[]),_=y.useCallback(({trialId:P,targetId:I})=>{P!==I&&i(O=>{if(!O||O.status!=="running_trials")return O;const X=O.trials.findIndex(A=>A.id===P),J=O.trials.findIndex(A=>A.id===I);if(X<0||J<0||O.trials[X].status!=="queued")return O;const re=[...O.trials],[ne]=re.splice(X,1);return re.splice(J,0,ne),{...O,trials:re}})},[]),E=y.useCallback(({trialId:P})=>{i(I=>{if(!I||I.status!=="running_trials")return I;const O=I.trials.findIndex(J=>J.id===P);if(O<0||I.trials[O].status!=="queued")return I;const X=[...I.trials];return X[O]={...X[O],status:"skipped",finishedAt:new Date().toISOString()},{...I,trials:X}})},[]),D=y.useCallback(({trialId:P})=>{i(I=>{if(!I||I.status!=="running_trials")return I;const O=I.trials.findIndex(J=>J.id===P);if(O<0||I.trials[O].status!=="skipped")return I;const X=[...I.trials];return X[O]={...X[O],status:"queued",finishedAt:void 0},{...I,trials:X}})},[]),L=y.useCallback(()=>{var P;(P=c.current)==null||P.abort()},[]),T=y.useCallback(({trialId:P})=>{let I=!1;i(O=>{if(!O||O.status!=="running_trials"&&O.status!=="completed"&&O.status!=="cancelled")return O;const X=O.trials.findIndex(F=>F.id===P);if(X<0)return O;const J=O.trials[X];if(J.status!=="completed"&&J.status!=="cancelled"&&J.status!=="failed")return O;const re=[...O.trials],ne={id:J.id,status:"queued",candidate:J.candidate,scenarioResults:[]};let A;O.kind==="config"?A={...ne,config:J.config}:A=ne,re.splice(X,1);const B=re.findIndex(F=>F.status==="queued");B>=0?re.splice(B,0,A):re.push(A);const v=O.bestTrialId===P?void 0:O.bestTrialId;return(O.status==="completed"||O.status==="cancelled")&&(I=!0),{...O,trials:re,bestTrialId:v}}),I&&setTimeout(()=>f(),0)},[f]);return e.jsx(Kg.Provider,{value:{run:n,isRunning:m,startSamplingRun:b,startConfigRun:N,stopRun:p,clearRun:g,reevaluateBestTrial:k,moveQueuedTrial:S,reorderQueuedTrial:_,skipTrial:E,unskipTrial:D,stopTrial:L,rerunTrial:T},children:t})}function zg(){const t=y.useContext(Kg);if(!t)throw new Error("useAutoTestRunner must be used within an AutoTestRunnerProvider");return t}const Qm="theme",Gg=y.createContext(null);function qw({children:t}){const[n,r]=y.useState(()=>localStorage.getItem(Qm)||"light");y.useEffect(()=>{localStorage.setItem(Qm,n),document.documentElement.dataset.theme=n},[n]);const s=y.useCallback(()=>{r(i=>i==="light"?"dark":"light")},[]);return e.jsx(Gg.Provider,{value:{theme:n,toggleTheme:s},children:t})}function Bw(){const t=y.useContext(Gg);if(!t)throw new Error("useTheme must be used within a ThemeProvider");return t}const Ym=[{id:"settings",label:"Settings",items:[{page:"settings",label:"API Token"}]},{id:"model",label:"Models",items:[{page:"model-list",label:"List"},{page:"model-ps",label:"Running"},{page:"model-pull",label:"Pull"}]},{id:"catalog",label:"Catalog",items:[{page:"catalog-list",label:"List"},{page:"catalog-editor",label:"Editor"}]},{id:"libs",label:"Libs",items:[{page:"libs-pull",label:"Pull"}]},{id:"security",label:"Security",subcategories:[{id:"security-key",label:"Key",items:[{page:"security-key-list",label:"List"},{page:"security-key-create",label:"Create"},{page:"security-key-delete",label:"Delete"}]},{id:"security-token",label:"Token",items:[{page:"security-token-create",label:"Create"}]}]},{id:"docs",label:"Docs",subcategories:[{id:"docs-manual-sub",label:"Manual",items:[{page:"docs-manual",label:"Introduction",hash:"chapter-1-introduction"},{page:"docs-manual",label:"Installation & Quick Start",hash:"chapter-2-installation-quick-start"},{page:"docs-manual",label:"Model Configuration",hash:"chapter-3-model-configuration"},{page:"docs-manual",label:"Batch Processing",hash:"chapter-4-batch-processing"},{page:"docs-manual",label:"Message Caching",hash:"chapter-5-message-caching"},{page:"docs-manual",label:"YaRN Extended Context",hash:"chapter-6-yarn-extended-context"},{page:"docs-manual",label:"Model Server",hash:"chapter-7-model-server"},{page:"docs-manual",label:"API Endpoints",hash:"chapter-8-api-endpoints"},{page:"docs-manual",label:"Request Parameters",hash:"chapter-9-request-parameters"},{page:"docs-manual",label:"Multi-Modal Models",hash:"chapter-10-multi-modal-models"},{page:"docs-manual",label:"Security & Authentication",hash:"chapter-11-security-authentication"},{page:"docs-manual",label:"Browser UI (BUI)",hash:"chapter-12-browser-ui-bui"},{page:"docs-manual",label:"Client Integration",hash:"chapter-13-client-integration"},{page:"docs-manual",label:"Observability",hash:"chapter-14-observability"},{page:"docs-manual",label:"MCP Service",hash:"chapter-15-mcp-service"},{page:"docs-manual",label:"Troubleshooting",hash:"chapter-16-troubleshooting"},{page:"docs-manual",label:"Developer Guide",hash:"chapter-17-developer-guide"}]},{id:"docs-sdk",label:"SDK",items:[{page:"docs-sdk-kronk",label:"Kronk"},{page:"docs-sdk-model",label:"Model"},{page:"docs-sdk-examples",label:"Examples"},{page:"docs-sdk-examples",label:"Audio",hash:"example-audio"},{page:"docs-sdk-examples",label:"Chat",hash:"example-chat"},{page:"docs-sdk-examples",label:"Embedding",hash:"example-embedding"},{page:"docs-sdk-examples",label:"Grammar",hash:"example-grammar"},{page:"docs-sdk-examples",label:"Question",hash:"example-question"},{page:"docs-sdk-examples",label:"Rerank",hash:"example-rerank"},{page:"docs-sdk-examples",label:"Response",hash:"example-response"},{page:"docs-sdk-examples",label:"Vision",hash:"example-vision"}]},{id:"docs-cli-sub",label:"CLI",items:[{page:"docs-cli-catalog",label:"catalog"},{page:"docs-cli-libs",label:"libs"},{page:"docs-cli-model",label:"model"},{page:"docs-cli-run",label:"run"},{page:"docs-cli-security",label:"security"},{page:"docs-cli-server",label:"server"}]},{id:"docs-api-sub",label:"Web API",items:[{page:"docs-api-chat",label:"Chat"},{page:"docs-api-messages",label:"Messages"},{page:"docs-api-responses",label:"Responses"},{page:"docs-api-embeddings",label:"Embeddings"},{page:"docs-api-rerank",label:"Rerank"},{page:"docs-api-tokenize",label:"Tokenize"},{page:"docs-api-tools",label:"Tools"}]}]},{id:"apps",label:"Apps",items:[{page:"chat",label:"Chat"},{page:"playground",label:"Playground"},{page:"vram-calculator",label:"VRAM Calculator"}]}],Xm={settings:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[e.jsx("line",{x1:"4",y1:"6",x2:"20",y2:"6"}),e.jsx("line",{x1:"4",y1:"12",x2:"20",y2:"12"}),e.jsx("line",{x1:"4",y1:"18",x2:"20",y2:"18"}),e.jsx("circle",{cx:"8",cy:"6",r:"2",fill:"currentColor",stroke:"none"}),e.jsx("circle",{cx:"16",cy:"12",r:"2",fill:"currentColor",stroke:"none"}),e.jsx("circle",{cx:"12",cy:"18",r:"2",fill:"currentColor",stroke:"none"})]}),model:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 2l9 5v10l-9 5-9-5V7z"}),e.jsx("path",{d:"M12 22V12"}),e.jsx("path",{d:"M3 7l9 5 9-5"})]}),catalog:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"8",y:"2",width:"8",height:"4",rx:"1"}),e.jsx("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"})]}),libs:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),security:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"})}),docs:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"}),e.jsx("path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"})]}),apps:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),e.jsx("rect",{x:"3",y:"14",width:"7",height:"7"})]})};function Uw({children:t}){const n=fs(),r=Ml(),s=TE[n.pathname]||"home",[i,l]=y.useState(new Set),{download:o,isDownloading:a}=Ia(),{run:c,isRunning:d,stopRun:u}=zg(),{theme:h,toggleTheme:m}=Bw(),[x,j]=y.useState(()=>{try{return localStorage.getItem("sidebar-collapsed")==="true"}catch{return!1}}),b=()=>{j(T=>{const P=!T;try{localStorage.setItem("sidebar-collapsed",String(P))}catch{}return P})},N=T=>{if(T.items&&T.items.length>0)return Ki[T.items[0].page];if(T.subcategories)for(const P of T.subcategories){const I=N(P);if(I)return I}return null},f=(()=>{if(!c)return"";if(d)return"Testing...";switch(c.status){case"completed":return"Completed";case"cancelled":return"Cancelled";case"error":return"Failed";default:return"Testing"}})(),p=(()=>{if(c){if(c.status==="error"&&c.errorMessage)return c.errorMessage;if(d&&c.totalTrials===0)return c.calibrationStatus??c.templateRepairStatus??"Preparing...";if(c.totalTrials>0)return`Trial ${Math.min(c.currentTrialIndex+(d?1:0),c.totalTrials)}/${c.totalTrials}`}})(),g=(()=>{if(!c||!d)return;const T=c.trials.find(I=>(I==null?void 0:I.status)==="running"),P=T==null?void 0:T.logEntries;if(P&&P.length>0)return P[P.length-1].message})(),k=!!c,S=!!o;y.useEffect(()=>{const T=(I,O)=>{var X;for(const J of I){if((X=J.items)!=null&&X.some(re=>re.page===O))return[J.id];if(J.subcategories){const re=T(J.subcategories,O);if(re.length>0)return[J.id,...re]}}return[]},P=T(Ym,s);P.length>0&&l(I=>{const O=new Set(I);return P.forEach(X=>O.add(X)),O})},[s]),y.useEffect(()=>{qs.highlightAll()},[s]);const _=T=>{l(P=>{const I=new Set(P);return I.has(T)?I.delete(T):I.add(T),I})},E=T=>T.items?T.items.some(P=>P.page===s):T.subcategories?T.subcategories.some(P=>E(P)):!1,D=T=>{const P=Ki[T.page],I=s===T.page&&!T.hash;if(T.hash){const O=X=>{X.preventDefault(),r(`${P}#${T.hash}`),setTimeout(()=>{const J=document.getElementById(T.hash);J&&J.scrollIntoView({behavior:"smooth"})},100)};return e.jsx("a",{href:`${P}#${T.hash}`,onClick:O,className:"menu-item",children:T.label},`${T.page}-${T.hash}`)}return e.jsx(Nr,{to:P,className:`menu-item ${I?"active":""}`,children:T.label},T.page)},L=(T,P=!1)=>{var J,re;const I=i.has(T.id),O=E(T),X=()=>{if(x&&!P){const ne=N(T);ne&&r(ne)}else _(T.id)};return e.jsxs("div",{className:`menu-category ${P?"submenu":""}`,children:[e.jsxs("div",{className:`menu-category-header ${O?"active":""}`,onClick:X,title:x?T.label:void 0,children:[!P&&Xm[T.id]&&e.jsx("span",{className:"menu-category-icon","aria-hidden":"true",children:Xm[T.id]}),e.jsx("span",{className:"menu-category-label",children:T.label}),e.jsx("span",{className:`menu-category-arrow ${I?"expanded":""}`,children:""})]}),e.jsxs("div",{className:`menu-items ${I?"expanded":""}`,...!P&&{"data-label":T.label},children:[(J=T.subcategories)==null?void 0:J.map(ne=>L(ne,!0)),(re=T.items)==null?void 0:re.map(D)]})]},T.id)};return e.jsxs("div",{className:"app",children:[e.jsxs("aside",{className:`sidebar ${x?"sidebar-collapsed":""}`,children:[e.jsx("div",{className:"sidebar-header",children:e.jsxs(Nr,{to:"/",style:{textDecoration:"none",color:"inherit"},className:"sidebar-brand",children:[e.jsx("img",{src:"/kronk-logo.png",alt:"Kronk Logo",className:"sidebar-logo"}),e.jsx("h1",{children:"Model Server"})]})}),e.jsx("nav",{children:Ym.map(T=>L(T))}),(k||S)&&e.jsxs("div",{className:"sidebar-indicators",children:[k&&e.jsx("div",{className:"download-indicator",children:e.jsxs("div",{className:"download-indicator-link autotest-indicator-link",children:[e.jsxs(Nr,{to:Ki.playground,className:"autotest-indicator-top",children:[e.jsxs("div",{className:"download-indicator-header",children:[d?e.jsx("span",{className:"download-indicator-spinner"}):c.status==="completed"?e.jsx("span",{className:"download-indicator-icon success",children:""}):e.jsx("span",{className:"download-indicator-icon error",children:""}),e.jsx("span",{className:"download-indicator-title",children:f})]}),p&&e.jsx("div",{className:"download-indicator-url",title:p,"aria-live":"polite",children:p}),g&&e.jsx("div",{className:"autotest-indicator-log",title:g,children:g})]}),d&&e.jsx("button",{type:"button",className:"autotest-indicator-stop",onClick:u,"aria-label":"Stop automated testing",title:"Stop automated testing",children:""})]})}),S&&e.jsx("div",{className:"download-indicator",children:e.jsxs(Nr,{to:Ki["model-pull"],className:"download-indicator-link",children:[e.jsxs("div",{className:"download-indicator-header",children:[a?e.jsx("span",{className:"download-indicator-spinner"}):o.status==="complete"?e.jsx("span",{className:"download-indicator-icon success",children:""}):e.jsx("span",{className:"download-indicator-icon error",children:""}),e.jsx("span",{className:"download-indicator-title",children:a?"Downloading...":o.status==="complete"?"Complete":"Failed"})]}),e.jsx("div",{className:"download-indicator-url",title:o.modelUrl,children:o.modelUrl.split("/").pop()})]})})]}),e.jsx("button",{className:"sidebar-toggle",onClick:m,"aria-label":h==="light"?"Switch to dark mode":"Switch to light mode",title:h==="light"?"Switch to dark mode":"Switch to light mode",children:h==="light"?e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}):e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),e.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),e.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),e.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),e.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),e.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),e.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),e.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})}),e.jsx("button",{className:"sidebar-toggle",onClick:b,"aria-label":x?"Expand sidebar":"Collapse sidebar","aria-expanded":!x,title:x?"Expand sidebar":"Collapse sidebar",children:x?e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"9 18 15 12 9 6"})}):e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"15 18 9 12 15 6"})})})]}),e.jsx("main",{className:"main-content",children:t})]})}function Kw(t){return t===null?"asc":t==="asc"?"desc":null}function Ei(t,n){return n.column!==t||n.direction===null?"":n.direction==="asc"?" ":" "}function Jm(t,n){switch(n){case"id":return t.id.toLowerCase();case"owner":return(t.owned_by||"").toLowerCase();case"family":return(t.model_family||"").toLowerCase();case"size":return t.size;case"modified":return new Date(t.modified).getTime();default:return""}}function Hr(t){if(t===0)return"0 B";const n=1e3,r=["B","KB","MB","GB","TB"],s=Math.floor(Math.log(t)/Math.log(n));return parseFloat((t/Math.pow(n,s)).toFixed(2))+" "+r[s]}function zw(t){return new Date(t).toLocaleString()}function Gw(){var B,v;const{models:t,loading:n,error:r,loadModels:s,invalidate:i}=Ma(),[l,o]=y.useState(null),[a,c]=y.useState(null),[d,u]=y.useState(!1),[h,m]=y.useState(null),[x,j]=y.useState(!1),[b,N]=y.useState(null),[f,p]=y.useState(!1),[g,k]=y.useState(!1),[S,_]=y.useState(!1),[E,D]=y.useState(null),[L,T]=y.useState(null),[P,I]=y.useState({column:null,direction:null}),O=F=>{I(z=>({column:F,direction:z.column===F?Kw(z.direction):"asc"}))},X=async()=>{j(!0),N(null),p(!1);try{await fe.rebuildModelIndex(),i(),s(),o(null),c(null),p(!0),setTimeout(()=>p(!1),3e3)}catch(F){N(F instanceof Error?F.message:"Failed to rebuild index")}finally{j(!1)}};y.useEffect(()=>{s()},[s]);const J=async F=>{if(l===F){o(null),c(null),k(!1);return}o(F),k(!1),D(null),T(null),u(!0),m(null),c(null);try{const z=await fe.showModel(F);c(z)}catch(z){m(z instanceof Error?z.message:"Failed to load model info")}finally{u(!1)}},re=()=>{l&&k(!0)},ne=async()=>{if(l){_(!0),k(!1),D(null),T(null);try{await fe.removeModel(l),T(`Model "${l}" removed successfully`),o(null),c(null),i(),await s(),setTimeout(()=>T(null),3e3)}catch(F){D(F instanceof Error?F.message:"Failed to remove model")}finally{_(!1)}}},A=()=>{k(!1)};return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"Models"}),e.jsx("p",{children:"List of all models available in the system. Click a model to view details."})]}),e.jsxs("div",{className:"card",children:[n&&e.jsx("div",{className:"loading",children:"Loading models"}),r&&e.jsx("div",{className:"alert alert-error",children:r}),E&&e.jsx("div",{className:"alert alert-error",children:E}),L&&e.jsx("div",{className:"alert alert-success",children:L}),!n&&!r&&t&&e.jsx("div",{className:"table-container",children:t.data&&t.data.length>0?e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"40px",textAlign:"center"},title:"Validated",children:""}),e.jsxs("th",{className:"sortable-th",onClick:()=>O("id"),children:["ID",Ei("id",P)]}),e.jsxs("th",{className:"sortable-th",onClick:()=>O("owner"),children:["Owner",Ei("owner",P)]}),e.jsxs("th",{className:"sortable-th",onClick:()=>O("family"),children:["Family",Ei("family",P)]}),e.jsxs("th",{className:"sortable-th",onClick:()=>O("size"),children:["Size",Ei("size",P)]}),e.jsxs("th",{className:"sortable-th",onClick:()=>O("modified"),children:["Modified",Ei("modified",P)]})]})}),e.jsx("tbody",{children:(()=>{const F=t.data.filter(Z=>!Z.id.includes("/")),z=t.data.filter(Z=>Z.id.includes("/"));return(P.column&&P.direction?[...F].sort((Z,K)=>{const Q=Jm(Z,P.column),Y=Jm(K,P.column),ee=P.direction==="asc"?1:-1;let C;return typeof Q=="number"&&typeof Y=="number"?C=(Q-Y)*ee:C=String(Q).localeCompare(String(Y))*ee,C!==0||P.column==="size"?C:Z.size-K.size}):F).map(Z=>{const K=z.filter(C=>C.id.startsWith(Z.id+"/")),Q=l===Z.id,Y=l==null?void 0:l.startsWith(Z.id+"/"),ee=Q||Y;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{onClick:()=>J(Z.id),className:l===Z.id?"selected":"",style:{cursor:"pointer"},children:[e.jsx("td",{style:{textAlign:"center",color:Z.validated?"inherit":"var(--color-error)"},children:Z.validated?"":""}),e.jsx("td",{children:Z.id}),e.jsx("td",{children:Z.owned_by}),e.jsx("td",{children:Z.model_family}),e.jsx("td",{children:Hr(Z.size)}),e.jsx("td",{children:zw(Z.modified)})]},Z.id),ee&&K.map(C=>e.jsxs("tr",{onClick:()=>J(C.id),className:l===C.id?"selected":"",style:{cursor:"pointer"},children:[e.jsx("td",{}),e.jsxs("td",{style:{paddingLeft:"24px"},children:[" ",C.id]}),e.jsx("td",{}),e.jsx("td",{children:"Extension Model"}),e.jsx("td",{}),e.jsx("td",{})]},C.id))]})})})()})]}):e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No models found"}),e.jsx("p",{children:"Pull a model to get started"})]})}),e.jsxs("div",{style:{marginTop:"16px",display:"flex",gap:"8px"},children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>{i(),s(),o(null),c(null),k(!1),D(null),T(null),m(null),N(null),p(!1)},disabled:n,children:"Refresh"}),e.jsx("button",{className:"btn btn-secondary",onClick:X,disabled:x||n,children:x?"Rebuilding...":"Rebuild Index"}),l&&!g&&e.jsx("button",{className:"btn btn-danger",onClick:re,disabled:S,children:"Remove Model"}),l&&g&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-danger",onClick:ne,disabled:S,children:S?"Removing...":"Yes, Remove"}),e.jsx("button",{className:"btn btn-secondary",onClick:A,disabled:S,children:"Cancel"})]})]}),b&&e.jsx("div",{className:"alert alert-error",style:{marginTop:"8px"},children:b}),f&&e.jsx("div",{className:"alert alert-success",style:{marginTop:"8px"},children:"Index rebuilt successfully"})]}),h&&e.jsx("div",{className:"alert alert-error",children:h}),d&&e.jsx("div",{className:"card",children:e.jsx("div",{className:"loading",children:"Loading model details"})}),a&&!d&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{marginBottom:"16px"},children:a.id}),a.model_config&&e.jsxs("div",{style:{marginTop:"16px"},children:[e.jsx("label",{style:{fontWeight:500,display:"block",marginBottom:"8px"},children:"Model Configuration"}),e.jsxs("div",{className:"model-meta",children:[e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Device"}),e.jsx("span",{children:a.model_config.device||"default"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Context Window"}),e.jsx("span",{children:a.model_config["context-window"]})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Batch Size"}),e.jsx("span",{children:a.model_config.nbatch})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Micro Batch Size"}),e.jsx("span",{children:a.model_config.nubatch})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Threads"}),e.jsx("span",{children:a.model_config.nthreads})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Batch Threads"}),e.jsx("span",{children:a.model_config["nthreads-batch"]})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Cache Type K"}),e.jsx("span",{children:a.model_config["cache-type-k"]||"default"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Cache Type V"}),e.jsx("span",{children:a.model_config["cache-type-v"]||"default"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Flash Attention"}),e.jsx("span",{children:a.model_config["flash-attention"]||"default"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Max Sequences"}),e.jsx("span",{children:a.model_config["nseq-max"]})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"GPU Layers"}),e.jsx("span",{children:a.model_config["ngpu-layers"]??"auto"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Split Mode"}),e.jsx("span",{children:a.model_config["split-mode"]||"default"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"System Prompt Cache"}),e.jsx("span",{className:`badge ${a.model_config["system-prompt-cache"]?"badge-yes":"badge-no"}`,children:a.model_config["system-prompt-cache"]?"Yes":"No"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Incremental Cache"}),e.jsx("span",{className:`badge ${a.model_config["incremental-cache"]?"badge-yes":"badge-no"}`,children:a.model_config["incremental-cache"]?"Yes":"No"})]}),!!a.model_config["rope-scaling-type"]&&a.model_config["rope-scaling-type"]!=="none"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"RoPE Scaling"}),e.jsx("span",{children:a.model_config["rope-scaling-type"]})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"YaRN Original Context"}),e.jsx("span",{children:a.model_config["yarn-orig-ctx"]??"auto"})]}),a.model_config["rope-freq-base"]!=null&&e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"RoPE Freq Base"}),e.jsx("span",{children:a.model_config["rope-freq-base"]})]}),a.model_config["yarn-ext-factor"]!=null&&e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"YaRN Ext Factor"}),e.jsx("span",{children:a.model_config["yarn-ext-factor"]})]}),a.model_config["yarn-attn-factor"]!=null&&e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"YaRN Attn Factor"}),e.jsx("span",{children:a.model_config["yarn-attn-factor"]})]})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Owner"}),e.jsx("span",{children:a.owned_by})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Size"}),e.jsx("span",{children:Hr(a.size)})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Created"}),e.jsx("span",{children:new Date(a.created).toLocaleString()})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Has Projection"}),e.jsx("span",{className:`badge ${a.has_projection?"badge-yes":"badge-no"}`,children:a.has_projection?"Yes":"No"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Is GPT"}),e.jsx("span",{className:`badge ${a.is_gpt?"badge-yes":"badge-no"}`,children:a.is_gpt?"Yes":"No"})]})]})]}),((B=a.model_config)==null?void 0:B["sampling-parameters"])&&e.jsxs("div",{style:{marginTop:"16px"},children:[e.jsx("label",{style:{fontWeight:500,display:"block",marginBottom:"8px"},children:"Sampling Parameters"}),e.jsxs("div",{className:"model-meta",children:[e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Temperature"}),e.jsx("span",{children:a.model_config["sampling-parameters"].temperature.toFixed(2)})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Top K"}),e.jsx("span",{children:a.model_config["sampling-parameters"].top_k})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Top P"}),e.jsx("span",{children:a.model_config["sampling-parameters"].top_p.toFixed(2)})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Min P"}),e.jsx("span",{children:a.model_config["sampling-parameters"].min_p.toFixed(2)})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Max Tokens"}),e.jsx("span",{children:a.model_config["sampling-parameters"].max_tokens})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Repeat Penalty"}),e.jsx("span",{children:a.model_config["sampling-parameters"].repeat_penalty.toFixed(2)})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Repeat Last N"}),e.jsx("span",{children:a.model_config["sampling-parameters"].repeat_last_n})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Frequency Penalty"}),e.jsx("span",{children:a.model_config["sampling-parameters"].frequency_penalty.toFixed(2)})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Presence Penalty"}),e.jsx("span",{children:a.model_config["sampling-parameters"].presence_penalty.toFixed(2)})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Enable Thinking"}),e.jsx("span",{children:a.model_config["sampling-parameters"].enable_thinking||"default"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Reasoning Effort"}),e.jsx("span",{children:a.model_config["sampling-parameters"].reasoning_effort||"default"})]})]})]}),a.desc&&e.jsxs("div",{style:{marginTop:"16px"},children:[e.jsx("label",{style:{fontWeight:500,display:"block",marginBottom:"8px"},children:"Description"}),e.jsx("p",{children:a.desc})]}),a.vram&&e.jsxs("div",{style:{marginTop:"16px"},children:[e.jsx("label",{style:{fontWeight:500,display:"block",marginBottom:"8px"},children:"VRAM Requirements"}),e.jsxs("div",{className:"model-meta",children:[e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Total VRAM"}),e.jsx("span",{children:Hr(a.vram.total_vram)})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Slot Memory (KV Cache)"}),e.jsx("span",{children:Hr(a.vram.slot_memory)})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"KV Per Slot"}),e.jsx("span",{children:Hr(a.vram.kv_per_slot)})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"KV Per Token/Layer"}),e.jsx("span",{children:Hr(a.vram.kv_per_token_per_layer)})]})]}),e.jsx("div",{style:{marginTop:"2rem"}}),e.jsxs("div",{className:"model-meta",children:[e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Model Size"}),e.jsx("span",{children:Hr(a.vram.input.model_size_bytes)})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Block Count (Layers)"}),e.jsx("span",{children:a.vram.input.block_count})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Head Count KV"}),e.jsx("span",{children:a.vram.input.head_count_kv})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Key Length"}),e.jsx("span",{children:a.vram.input.key_length})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Value Length"}),e.jsx("span",{children:a.vram.input.value_length})]})]})]}),a.metadata&&Object.keys(a.metadata).filter(F=>F!=="tokenizer.chat_template").length>0&&e.jsxs("div",{style:{marginTop:"16px"},children:[e.jsx("label",{style:{fontWeight:500,display:"block",marginBottom:"8px"},children:"Metadata"}),e.jsx("div",{className:"model-meta",children:Object.entries(a.metadata).filter(([F])=>F!=="tokenizer.chat_template").map(([F,z])=>e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:F}),e.jsx("span",{children:z})]},F))})]}),((v=a.metadata)==null?void 0:v["tokenizer.chat_template"])&&e.jsxs("div",{style:{marginTop:"16px"},children:[e.jsx("label",{style:{fontWeight:500,display:"block",marginBottom:"8px"},children:"tokenizer.chat_template"}),e.jsx("pre",{style:{background:"var(--color-gray-100)",padding:"12px",borderRadius:"6px",fontSize:"12px",overflow:"auto",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:a.metadata["tokenizer.chat_template"]})]})]})]})}function Ri(t){if(t===0)return"0 B";const n=1e3,r=["B","KB","MB","GB","TB"],s=Math.floor(Math.log(t)/Math.log(n));return parseFloat((t/Math.pow(n,s)).toFixed(2))+" "+r[s]}function Vw(t){return new Date(t).toLocaleString()}function Hw(){const[t,n]=y.useState(null),[r,s]=y.useState(!0),[i,l]=y.useState(null),[o,a]=y.useState(null);y.useEffect(()=>{c()},[]);const c=async()=>{s(!0),l(null);try{const u=await fe.listRunningModels();n(u)}catch(u){l(u instanceof Error?u.message:"Failed to load running models")}finally{s(!1)}},d=async u=>{if(confirm(`Unload model "${u}"?`)){a(u),l(null);try{await fe.unloadModel(u),await c()}catch(h){l(h instanceof Error?h.message:"Failed to unload model")}finally{a(null)}}};return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"Running Models"}),e.jsx("p",{children:"Models currently loaded in cache"})]}),e.jsxs("div",{className:"card",children:[r&&e.jsx("div",{className:"loading",children:"Loading running models"}),i&&e.jsx("div",{className:"alert alert-error",children:i}),!r&&!i&&t&&e.jsx("div",{className:"table-container",children:t.length>0?e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Owner"}),e.jsx("th",{children:"Family"}),e.jsx("th",{style:{textAlign:"right"},children:"Size"}),e.jsx("th",{style:{textAlign:"right"},children:"VRAM Total"}),e.jsx("th",{style:{textAlign:"right"},children:"Slot Memory"}),e.jsx("th",{children:"Expires At"}),e.jsx("th",{children:"Active Streams"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:t.map(u=>e.jsxs("tr",{children:[e.jsx("td",{children:u.id}),e.jsx("td",{children:u.owned_by}),e.jsx("td",{children:u.model_family}),e.jsx("td",{style:{textAlign:"right"},children:Ri(u.size)}),e.jsx("td",{style:{textAlign:"right"},children:Ri(u.vram_total)}),e.jsx("td",{style:{textAlign:"right"},children:Ri(u.slot_memory)}),e.jsx("td",{children:Vw(u.expires_at)}),e.jsx("td",{children:u.active_streams}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>d(u.id),disabled:o===u.id||u.active_streams>0,title:u.active_streams>0?"Cannot unload while streams are active":"Unload model from cache",children:o===u.id?"Unloading":"Unload"})})]},u.id))}),t.length>1&&e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,style:{textAlign:"right",fontWeight:"bold"},children:"Total:"}),e.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Ri(t.reduce((u,h)=>u+h.vram_total,0))}),e.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Ri(t.reduce((u,h)=>u+h.slot_memory,0))}),e.jsx("td",{colSpan:3})]})})]}):e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No running models"}),e.jsx("p",{children:"Models will appear here when loaded into cache"})]})}),e.jsx("div",{style:{marginTop:"16px"},children:e.jsx("button",{className:"btn btn-secondary",onClick:c,disabled:r,children:"Refresh"})})]})]})}function $w(){const{download:t,isDownloading:n,startDownload:r,startBatchDownload:s,cancelDownload:i,clearDownload:l}=Ia(),[o,a]=y.useState([""]),[c,d]=y.useState(""),u=f=>{f.preventDefault();const p=o.map(g=>g.trim()).filter(Boolean);p.length===0||n||(p.length===1?r(p[0],c.trim()||void 0):s(p,c.trim()||void 0))},h=(f,p)=>{a(g=>{const k=[...g];return k[f]=p,k})},m=()=>{a(f=>[...f,""])},x=f=>{a(p=>p.filter((g,k)=>k!==f))},j=o.some(f=>f.trim().length>0),b=(t==null?void 0:t.status)==="complete",N=(t==null?void 0:t.status)==="error";return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"Pull Model"}),e.jsx("p",{children:"Download a model from a URL or shorthand reference. For split models, add multiple URLs and they will be pulled sequentially."}),e.jsxs("p",{children:["Shorthand: ",e.jsx("code",{children:"bartowski/Qwen3-8B-GGUF:Q4_K_M"})," or ",e.jsx("code",{children:"hf.co/bartowski/Qwen3-8B-GGUF:Q4_K_M"})]}),e.jsxs("p",{children:["With revision: ",e.jsx("code",{children:"bartowski/Qwen3-8B-GGUF:Q4_K_M@main"})]}),e.jsxs("p",{children:["Full URL: ",e.jsx("code",{children:"https://huggingface.co/ggml-org/Qwen2.5-VL-3B-Instruct-GGUF/resolve/main/Qwen2.5-VL-3B-Instruct-Q4_K_M.gguf"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("form",{onSubmit:u,children:[o.map((f,p)=>e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:`modelUrl-${p}`,children:o.length===1?"Model URL":`Model URL ${p+1}`}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("input",{type:"text",id:`modelUrl-${p}`,value:f,onChange:g=>h(p,g.target.value),placeholder:"owner/repo:Q4_K_M or https://huggingface.co/org/repo/resolve/main/model.gguf",disabled:n,style:{flex:1}}),o.length>1&&e.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>x(p),disabled:n,style:{padding:"8px 12px"},children:""})]})]},p)),e.jsx("div",{style:{marginBottom:"16px"},children:e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:m,disabled:n,children:"+ Add URL"})}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"projUrl",children:"Projection URL (optional, for vision/audio models)"}),e.jsx("input",{type:"text",id:"projUrl",value:c,onChange:f=>d(f.target.value),placeholder:"https://huggingface.co/org/repo/resolve/main/mmproj-model.gguf",disabled:n})]}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx("button",{className:"btn btn-primary",type:"submit",disabled:n||!j,children:n?"Downloading...":o.filter(f=>f.trim()).length>1?"Pull Models":"Pull Model"}),n&&e.jsx("button",{className:"btn btn-danger",type:"button",onClick:i,children:"Cancel"}),(b||N)&&e.jsx("button",{className:"btn",type:"button",onClick:l,children:"Clear"})]})]}),t&&t.messages.length>0&&e.jsx("div",{className:"status-box",children:t.messages.map((f,p)=>e.jsx("div",{className:`status-line ${f.type}`,children:f.text},p))})]})]})}const ye={temperature:"Scales the probability distribution to control randomness. Lower values (e.g. 0.2) make output more focused and deterministic; higher values (e.g. 1.5) increase variety and creativity. Values  0 fall back to the model default.",top_p:"Nucleus sampling  keeps the smallest set of top tokens whose cumulative probability is  this value. Lower values (e.g. 0.5) focus on the most likely tokens; 1.0 effectively disables top-p filtering. Works alongside temperature.",top_k:"Limits sampling to the top K most probable tokens at each step. Lower values (e.g. 10) make output more predictable; higher values allow more variety. Values  0 fall back to the model default (use a very large K to effectively disable).",min_p:"Filters out tokens whose probability is below this fraction of the top token's probability. For example, 0.05 removes tokens less than 5% as likely as the best choice. Higher = stricter filtering. 0 disables.",repeat_penalty:"Penalizes tokens that appeared in the recent context window (controlled by Repeat Last N). Values above 1.0 discourage repetition; 1.0 means no penalty. Typical range is 1.01.3. Too high can make text incoherent.",repeat_last_n:"How many recent tokens to check when applying the repeat penalty. Larger values look further back for repetitions. To disable repetition penalties, set Repeat Penalty to 1.0 instead.",frequency_penalty:"Reduces the likelihood of a token proportional to how many times it has appeared. Positive values discourage overused tokens; negative values encourage them. Common range: -2.0 to 2.0. 0 disables.",presence_penalty:"Applies a flat penalty to any token that has appeared at all, regardless of how often. Positive values encourage the model to use new tokens; negative values favor staying on existing ones. 0 disables.",dry_multiplier:"Strength of the DRY (Don't Repeat Yourself) anti-repetition penalty. Higher values more aggressively penalize repeated n-gram patterns. Values  0 fall back to the model default.",dry_base:"Base for exponential DRY penalty growth. Higher values make the penalty increase faster for longer repeated sequences. Typical values are 1.52.0.",dry_allowed_length:"Minimum n-gram length before DRY penalties apply  repeated sequences up to this token length are allowed without penalty. Useful for common short phrases. Higher values are more lenient.",dry_penalty_last_n:"How many recent tokens DRY examines when looking for repeated patterns. Larger values detect repetitions from further back. 0 means use the full context.",xtc_probability:'Chance of enabling XTC (eXtreme Token Culling) for a generation step. When active, XTC removes very high-probability ("obvious") tokens to increase variety. 0 disables XTC entirely, 1 always applies it.',xtc_threshold:"Probability cutoff for XTC culling. When XTC is active, tokens with probability  this threshold are candidates for removal (with safeguards to keep output coherent). Lower thresholds make XTC more aggressive.",xtc_min_keep:"Minimum number of token candidates to keep after XTC culling, preventing over-aggressive filtering. Ensures at least this many choices remain available.",max_tokens:"Maximum number of tokens (roughly words or word-pieces) to generate. Output may stop earlier on end-of-sequence or when the context window is full. Higher values allow longer answers but take more time.",enable_thinking:'Toggles "thinking" mode in the prompt template (model-dependent). Some models produce an explicit chain-of-thought section; others may ignore it. Can improve accuracy on complex tasks but increases token usage and latency.',reasoning_effort:"Requested reasoning level (model/provider dependent). Higher effort may produce more thorough reasoning but uses more tokens and time. Models that don't support this setting will ignore it.",nbatch:"Batch size capacity  maximum tokens processed per forward pass. Larger values speed up prompt evaluation and multi-request batching but increase VRAM usage. Typically keep  context window size.",nubatch:"Micro-batch size for prompt processing. Controls VRAM usage per batch operation. Must be  NBatch. Smaller values reduce peak VRAM usage at the cost of slightly slower processing.",contextWindow:"Maximum number of tokens (input + output combined) the model can handle at once. Larger windows support longer conversations but increase VRAM usage proportionally via the KV cache.",nSeqMax:"Maximum number of concurrent request slots. Each slot handles one user request simultaneously. More slots = better concurrency, but each slot reserves memory for its KV cache.",flashAttention:'Optimized attention algorithm that reduces VRAM usage and can improve speed. "Enabled" forces it on, "Disabled" forces it off, "Auto" lets the server decide based on model compatibility.',cacheType:"KV cache precision. f16 = full precision (best quality), q8_0 = 8-bit quantized (less VRAM, minimal quality loss), q4_0 = 4-bit quantized (most VRAM savings, slight quality trade-off especially at long context).",cacheMode:"Caching strategy. None = clears KV state after each request. SPC (System Prompt Cache) = reuses cached system-prompt state to speed up new conversations. IMC (Incremental Message Cache) = keeps the conversation's KV state in a dedicated slot for fast multi-turn follow-ups."};function be({text:t}){const n=y.useRef(null),r=y.useRef(null),s=y.useCallback(()=>{const i=n.current,l=r.current;if(!i||!l)return;const o=i.getBoundingClientRect(),a=l.offsetWidth,c=l.offsetHeight,d=o.top-c-8;let u=o.left;const h=u+a-window.innerWidth+8;h>0&&(u-=h),u<8&&(u=8),l.style.left=`${u}px`,l.style.top=`${d}px`;const m=Math.max(10,Math.min(a-10,o.left-u+o.width/2));l.style.setProperty("--arrow-left",`${m}px`)},[]);return e.jsxs("span",{className:"param-tooltip-wrapper",ref:n,onMouseEnter:s,children:[e.jsx("span",{className:"param-tooltip-icon",children:""}),e.jsx("span",{className:"param-tooltip-text",ref:r,children:t})]})}function Ww(t){return t===null?"asc":t==="asc"?"desc":null}function vs(t,n){return n.column!==t||n.direction===null?"":n.direction==="asc"?" ":" "}function Zm(t,n){switch(n){case"id":return t.id.toLowerCase();case"category":return(t.category||"").toLowerCase();case"owner":return(t.owned_by||"").toLowerCase();case"architecture":return(t.architecture||"").toLowerCase();case"size":return t.total_size_bytes;case"downloaded":return t.downloaded?1:0;default:return""}}function Mi(t){return t>=1e9?`${(t/1e9).toFixed(2)} GB`:t>=1e6?`${(t/1e6).toFixed(2)} MB`:t>=1e3?`${(t/1e3).toFixed(2)} KB`:`${t} bytes`}function Qw(){var B,v;const t=Ml(),{download:n,startCatalogDownload:r,cancelDownload:s}=Ia(),[i,l]=y.useState(null),[o,a]=y.useState(!0),[c,d]=y.useState(null),[u,h]=y.useState(null),[m,x]=y.useState(null),[j,b]=y.useState(!1),[N,f]=y.useState(null),[p,g]=y.useState("details"),[k,S]=y.useState(()=>localStorage.getItem("kronk_download_server")||""),_=F=>{S(F),F?localStorage.setItem("kronk_download_server",F):localStorage.removeItem("kronk_download_server")},[E,D]=y.useState({column:null,direction:null}),L=F=>{D(z=>({column:F,direction:z.column===F?Ww(z.direction):"asc"}))},T=(n==null?void 0:n.kind)==="catalog"&&n.catalogId===u,P=T?n.status==="downloading":!1,I=T?n.messages:[],O=(n==null?void 0:n.kind)==="catalog"&&(n.status==="downloading"||n.messages.length>0);y.useEffect(()=>{X()},[]),y.useEffect(()=>{(n==null?void 0:n.kind)==="catalog"&&n.catalogId&&(n.status==="downloading"&&(h(n.catalogId),g("pull")),n.status==="complete"&&X())},[n==null?void 0:n.status]);const X=async()=>{a(!0),d(null);try{const F=await fe.listCatalog();l(F)}catch(F){d(F instanceof Error?F.message:"Failed to load catalog")}finally{a(!1)}},J=async F=>{if(u===F){h(null),x(null),g("details");return}h(F),g("details"),b(!0),f(null),x(null);try{const z=await fe.showCatalogModel(F);x(z)}catch(z){f(z instanceof Error?z.message:"Failed to load model info")}finally{b(!1)}},re=()=>{u&&(r(u,k||void 0),g("pull"))},ne=()=>{s()},A=((B=i==null?void 0:i.find(F=>F.id===u))==null?void 0:B.downloaded)??!1;return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"Catalog"}),e.jsx("p",{children:"Browse available models in the catalog. Click a model to view details."})]}),e.jsxs("div",{className:"card",children:[o&&e.jsx("div",{className:"loading",children:"Loading catalog"}),c&&e.jsx("div",{className:"alert alert-error",children:c}),!o&&!c&&i&&e.jsx("div",{className:"table-container",children:i.length>0?e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"40px",textAlign:"center"},title:"Validated",children:""}),e.jsxs("th",{className:"sortable-th",onClick:()=>L("id"),children:["ID",vs("id",E)]}),e.jsxs("th",{className:"sortable-th",onClick:()=>L("category"),children:["Category",vs("category",E)]}),e.jsxs("th",{className:"sortable-th",onClick:()=>L("owner"),children:["Owner",vs("owner",E)]}),e.jsxs("th",{className:"sortable-th",onClick:()=>L("architecture"),children:["Arch",vs("architecture",E)]}),e.jsxs("th",{className:"sortable-th",onClick:()=>L("size"),children:["Size",vs("size",E)]}),e.jsxs("th",{className:"sortable-th",onClick:()=>L("downloaded"),children:["Downloaded",vs("downloaded",E)]}),e.jsx("th",{children:"Capabilities"})]})}),e.jsx("tbody",{children:(E.column&&E.direction?[...i].sort((F,z)=>{const w=Zm(F,E.column),Z=Zm(z,E.column),K=E.direction==="asc"?1:-1;let Q;return typeof w=="number"&&typeof Z=="number"?Q=(w-Z)*K:Q=String(w).localeCompare(String(Z))*K,Q!==0||E.column==="size"?Q:F.total_size_bytes-z.total_size_bytes}):i).map(F=>e.jsxs("tr",{onClick:()=>J(F.id),className:u===F.id?"selected":"",style:{cursor:"pointer"},children:[e.jsx("td",{style:{textAlign:"center",color:F.validated?"inherit":"var(--color-error)"},children:F.validated?"":""}),e.jsx("td",{children:F.id}),e.jsx("td",{children:F.category}),e.jsx("td",{children:F.owned_by}),e.jsx("td",{children:F.architecture||"-"}),e.jsx("td",{children:F.total_size||"-"}),e.jsx("td",{children:e.jsx("span",{className:`badge ${F.downloaded?"badge-yes":"badge-no"}`,children:F.downloaded?"Yes":"No"})}),e.jsxs("td",{children:[F.capabilities.images&&e.jsx("span",{className:"badge badge-yes",style:{marginRight:4},children:"Images"}),F.capabilities.audio&&e.jsx("span",{className:"badge badge-yes",style:{marginRight:4},children:"Audio"}),F.capabilities.video&&e.jsx("span",{className:"badge badge-yes",style:{marginRight:4},children:"Video"}),F.capabilities.streaming&&e.jsx("span",{className:"badge badge-yes",style:{marginRight:4},children:"Streaming"}),F.capabilities.reasoning&&e.jsx("span",{className:"badge badge-yes",style:{marginRight:4},children:"Reasoning"}),F.capabilities.tooling&&e.jsx("span",{className:"badge badge-yes",style:{marginRight:4},children:"Tooling"}),F.capabilities.embedding&&e.jsx("span",{className:"badge badge-yes",style:{marginRight:4},children:"Embedding"}),F.capabilities.rerank&&e.jsx("span",{className:"badge badge-yes",style:{marginRight:4},children:"Rerank"})]})]},F.id))})]}):e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No catalog entries"}),e.jsx("p",{children:"The catalog is empty"})]})}),u&&e.jsxs("div",{className:"form-group",style:{marginTop:"16px"},children:[e.jsxs("label",{htmlFor:"download-server",style:{display:"flex",alignItems:"center",gap:"4px"},children:["Kronk Download Server",e.jsx(be,{text:"Optional: specify a Kronk server on your local network that already has the model files. The pull will download from that server instead of HuggingFace, which is much faster."})]}),e.jsx("input",{id:"download-server",type:"text",className:"form-control",placeholder:"192.168.0.246:8080",value:k,onChange:F=>_(F.target.value),disabled:P})]}),e.jsxs("div",{style:{marginTop:"16px",display:"flex",gap:"8px"},children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>{X(),h(null),x(null),g("details"),f(null)},disabled:o,children:"Refresh"}),u&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-primary",onClick:re,disabled:P||A,children:P?"Pulling...":A?"Already Downloaded":"Pull Model"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>t(`/catalog/editor?id=${encodeURIComponent(u)}`),children:"Edit"})]}),P&&e.jsx("button",{className:"btn btn-danger",onClick:ne,children:"Cancel"})]})]}),N&&e.jsx("div",{className:"alert alert-error",children:N}),j&&e.jsx("div",{className:"card",children:e.jsx("div",{className:"loading",children:"Loading model details"})}),u&&!j&&(m||O)&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"tabs",children:[e.jsx("button",{className:`tab ${p==="details"?"active":""}`,onClick:()=>g("details"),children:"Details"}),e.jsx("button",{className:`tab ${p==="pull"?"active":""}`,onClick:()=>g("pull"),disabled:I.length===0&&!P,children:"Pull Output"})]}),p==="details"&&m&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{style:{marginBottom:"16px"},children:m.id}),e.jsxs("div",{className:"model-meta",children:[e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Category"}),e.jsx("span",{children:m.category})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Owner"}),e.jsx("span",{children:m.owned_by})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Family"}),e.jsx("span",{children:m.model_family})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Architecture"}),e.jsx("span",{children:m.architecture||"-"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"GGUF Arch"}),e.jsx("span",{children:m.gguf_arch||"-"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Downloaded"}),e.jsx("span",{className:`badge ${m.downloaded?"badge-yes":"badge-no"}`,children:m.downloaded?"Yes":"No"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Gated Model"}),e.jsx("span",{className:`badge ${m.gated_model?"badge-yes":"badge-no"}`,children:m.gated_model?"Yes":"No"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Endpoint"}),e.jsx("span",{children:m.capabilities.endpoint})]})]}),e.jsxs("div",{style:{marginTop:"24px"},children:[e.jsx("h4",{style:{marginBottom:"12px"},children:"Capabilities"}),e.jsxs("div",{className:"model-meta",children:[e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Images"}),e.jsx("span",{className:`badge ${m.capabilities.images?"badge-yes":"badge-no"}`,children:m.capabilities.images?"Yes":"No"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Audio"}),e.jsx("span",{className:`badge ${m.capabilities.audio?"badge-yes":"badge-no"}`,children:m.capabilities.audio?"Yes":"No"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Video"}),e.jsx("span",{className:`badge ${m.capabilities.video?"badge-yes":"badge-no"}`,children:m.capabilities.video?"Yes":"No"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Streaming"}),e.jsx("span",{className:`badge ${m.capabilities.streaming?"badge-yes":"badge-no"}`,children:m.capabilities.streaming?"Yes":"No"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Reasoning"}),e.jsx("span",{className:`badge ${m.capabilities.reasoning?"badge-yes":"badge-no"}`,children:m.capabilities.reasoning?"Yes":"No"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Tooling"}),e.jsx("span",{className:`badge ${m.capabilities.tooling?"badge-yes":"badge-no"}`,children:m.capabilities.tooling?"Yes":"No"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Embedding"}),e.jsx("span",{className:`badge ${m.capabilities.embedding?"badge-yes":"badge-no"}`,children:m.capabilities.embedding?"Yes":"No"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Rerank"}),e.jsx("span",{className:`badge ${m.capabilities.rerank?"badge-yes":"badge-no"}`,children:m.capabilities.rerank?"Yes":"No"})]})]})]}),e.jsxs("div",{style:{marginTop:"24px"},children:[e.jsx("h4",{style:{marginBottom:"12px"},children:"Web Page"}),e.jsx("div",{className:"model-meta-item",children:e.jsx("span",{children:m.web_page?e.jsx("a",{href:m.web_page,target:"_blank",rel:"noopener noreferrer",children:m.web_page}):"-"})})]}),e.jsxs("div",{style:{marginTop:"24px"},children:[e.jsx("h4",{style:{marginBottom:"12px"},children:"Files"}),e.jsxs("div",{className:"model-meta-item",style:{marginBottom:"12px"},children:[e.jsx("label",{children:"Model URL"}),e.jsx("span",{children:m.files.model.length>0?m.files.model.map((F,z)=>e.jsxs("div",{children:[F.url," ",F.size&&`(${F.size})`]},z)):"-"})]}),e.jsxs("div",{className:"model-meta-item",style:{marginBottom:"12px"},children:[e.jsx("label",{children:"Projection URL"}),e.jsx("span",{children:m.files.proj.url?e.jsxs("div",{children:[m.files.proj.url," ",m.files.proj.size&&`(${m.files.proj.size})`]}):"-"})]})]}),m.metadata.description&&e.jsxs("div",{style:{marginTop:"24px"},children:[e.jsx("h4",{style:{marginBottom:"12px"},children:"Description"}),e.jsx("div",{className:"model-meta-item",children:e.jsx("span",{children:m.metadata.description})})]}),e.jsxs("div",{style:{marginTop:"24px"},children:[e.jsx("h4",{style:{marginBottom:"12px"},children:"Catalog Metadata"}),e.jsxs("div",{className:"model-meta",children:[e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Created"}),e.jsx("span",{children:new Date(m.metadata.created).toLocaleString()})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Collections"}),e.jsx("span",{children:m.metadata.collections||"-"})]})]})]}),m.vram&&e.jsxs("div",{style:{marginTop:"24px"},children:[e.jsx("h4",{style:{marginBottom:"12px"},children:"VRAM Requirements"}),e.jsxs("div",{className:"model-meta",children:[e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Total VRAM"}),e.jsx("span",{children:Mi(m.vram.total_vram)})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Slot Memory (KV Cache)"}),e.jsx("span",{children:Mi(m.vram.slot_memory)})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"KV Per Slot"}),e.jsx("span",{children:Mi(m.vram.kv_per_slot)})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"KV Per Token/Layer"}),e.jsx("span",{children:Mi(m.vram.kv_per_token_per_layer)})]})]}),e.jsx("div",{style:{marginTop:"2rem"}}),e.jsxs("div",{className:"model-meta",children:[e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Model Size"}),e.jsx("span",{children:Mi(m.vram.input.model_size_bytes)})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Block Count (Layers)"}),e.jsx("span",{children:m.vram.input.block_count})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Head Count KV"}),e.jsx("span",{children:m.vram.input.head_count_kv})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Key Length"}),e.jsx("span",{children:m.vram.input.key_length})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Value Length"}),e.jsx("span",{children:m.vram.input.value_length})]})]})]}),m.model_config&&e.jsxs("div",{style:{marginTop:"24px"},children:[e.jsx("h4",{style:{marginBottom:"12px"},children:"Model Configuration"}),e.jsxs("div",{className:"model-meta",children:[e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Device"}),e.jsx("span",{children:m.model_config.device||"default"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Context Window"}),e.jsx("span",{children:m.model_config["context-window"]})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Batch Size"}),e.jsx("span",{children:m.model_config.nbatch})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Micro Batch Size"}),e.jsx("span",{children:m.model_config.nubatch})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Threads"}),e.jsx("span",{children:m.model_config.nthreads})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Batch Threads"}),e.jsx("span",{children:m.model_config["nthreads-batch"]})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Cache Type K"}),e.jsx("span",{children:m.model_config["cache-type-k"]||"default"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Cache Type V"}),e.jsx("span",{children:m.model_config["cache-type-v"]||"default"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Flash Attention"}),e.jsx("span",{children:m.model_config["flash-attention"]||"default"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Max Sequences"}),e.jsx("span",{children:m.model_config["nseq-max"]})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"GPU Layers"}),e.jsx("span",{children:m.model_config["ngpu-layers"]??"auto"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Split Mode"}),e.jsx("span",{children:m.model_config["split-mode"]||"default"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"System Prompt Cache"}),e.jsx("span",{className:`badge ${m.model_config["system-prompt-cache"]?"badge-yes":"badge-no"}`,children:m.model_config["system-prompt-cache"]?"Yes":"No"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Incremental Cache"}),e.jsx("span",{className:`badge ${m.model_config["incremental-cache"]?"badge-yes":"badge-no"}`,children:m.model_config["incremental-cache"]?"Yes":"No"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Template"}),e.jsx("span",{children:m.template||"-"})]}),!!m.model_config["rope-scaling-type"]&&m.model_config["rope-scaling-type"]!=="none"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"RoPE Scaling"}),e.jsx("span",{children:m.model_config["rope-scaling-type"]})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"YaRN Original Context"}),e.jsx("span",{children:m.model_config["yarn-orig-ctx"]??"auto"})]}),m.model_config["rope-freq-base"]!=null&&e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"RoPE Freq Base"}),e.jsx("span",{children:m.model_config["rope-freq-base"]})]}),m.model_config["yarn-ext-factor"]!=null&&e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"YaRN Ext Factor"}),e.jsx("span",{children:m.model_config["yarn-ext-factor"]})]}),m.model_config["yarn-attn-factor"]!=null&&e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"YaRN Attn Factor"}),e.jsx("span",{children:m.model_config["yarn-attn-factor"]})]})]})]})]}),((v=m.model_config)==null?void 0:v["sampling-parameters"])&&e.jsxs("div",{style:{marginTop:"24px"},children:[e.jsx("h4",{style:{marginBottom:"12px"},children:"Sampling Parameters"}),e.jsxs("div",{className:"model-meta",children:[e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Temperature"}),e.jsx("span",{children:m.model_config["sampling-parameters"].temperature.toFixed(2)})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Top K"}),e.jsx("span",{children:m.model_config["sampling-parameters"].top_k})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Top P"}),e.jsx("span",{children:m.model_config["sampling-parameters"].top_p.toFixed(2)})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Min P"}),e.jsx("span",{children:m.model_config["sampling-parameters"].min_p.toFixed(2)})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Max Tokens"}),e.jsx("span",{children:m.model_config["sampling-parameters"].max_tokens})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Repeat Penalty"}),e.jsx("span",{children:m.model_config["sampling-parameters"].repeat_penalty.toFixed(2)})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Repeat Last N"}),e.jsx("span",{children:m.model_config["sampling-parameters"].repeat_last_n})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Frequency Penalty"}),e.jsx("span",{children:m.model_config["sampling-parameters"].frequency_penalty.toFixed(2)})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Presence Penalty"}),e.jsx("span",{children:m.model_config["sampling-parameters"].presence_penalty.toFixed(2)})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Enable Thinking"}),e.jsx("span",{children:m.model_config["sampling-parameters"].enable_thinking||"default"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Reasoning Effort"}),e.jsx("span",{children:m.model_config["sampling-parameters"].reasoning_effort||"default"})]}),e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Grammar"}),e.jsx("span",{children:m.model_config["sampling-parameters"].grammar||"-"})]})]})]}),m.model_metadata&&Object.keys(m.model_metadata).filter(F=>F!=="tokenizer.chat_template").length>0&&e.jsxs("div",{style:{marginTop:"24px"},children:[e.jsx("h4",{style:{marginBottom:"12px"},children:"Model Metadata"}),e.jsx("div",{className:"model-meta",children:Object.entries(m.model_metadata).filter(([F])=>F!=="tokenizer.chat_template").map(([F,z])=>e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:F}),e.jsx("span",{children:z})]},F))})]})]}),p==="pull"&&e.jsxs("div",{children:[e.jsxs("h3",{style:{marginBottom:"16px"},children:["Pull Output: ",u]}),I.length>0?e.jsx("div",{className:"status-box",children:I.map((F,z)=>e.jsx("div",{className:`status-line ${F.type}`,children:F.text},z))}):e.jsx("p",{children:"No pull output yet."}),P&&e.jsx("button",{className:"btn btn-danger",onClick:ne,style:{marginTop:"16px"},children:"Cancel"})]})]})]})}const ep={id:"",category:"Text-Generation",catalogFile:"",newCatalogFile:"",ownedBy:"",modelFamily:"",architecture:"",ggufArch:"",webPage:"",template:"",gatedModel:!1,files:[{url:"",size:""}],projUrl:"",projSize:"",capabilities:{endpoint:"chat_completion",images:!1,audio:!1,video:!1,streaming:!0,reasoning:!1,tooling:!1,embedding:!1,rerank:!1},description:"",collections:"",created:new Date().toISOString().split("T")[0],config:{device:"",contextWindow:null,nbatch:null,nubatch:null,nthreads:null,nthreadsBatch:null,cacheTypeK:"",cacheTypeV:"",useDirectIO:null,flashAttention:"",ignoreIntegrityCheck:null,nseqMax:null,offloadKQV:null,opOffload:null,ngpuLayers:null,splitMode:"",systemPromptCache:null,incrementalCache:null,cacheMinTokens:null,ropeScaling:"",ropeFreqBase:null,ropeFreqScale:null,yarnExtFactor:null,yarnAttnFactor:null,yarnBetaFast:null,yarnBetaSlow:null,yarnOrigCtx:null,draftModelId:"",draftNDraft:null,draftNGpuLayers:null,draftDevice:""},sampling:{temperature:null,topK:null,topP:null,minP:null,presencePenalty:null,maxTokens:null,repeatPenalty:null,repeatLastN:null,dryMultiplier:null,dryBase:null,dryAllowedLen:null,dryPenaltyLast:null,xtcProbability:null,xtcThreshold:null,xtcMinKeep:null,frequencyPenalty:null,enableThinking:"",reasoningEffort:"",grammar:""}},Be={width:"100%",padding:"8px",borderRadius:"4px",border:"1px solid var(--color-gray-300)",background:"var(--color-gray-50)",color:"var(--color-gray-900)",fontSize:"14px",boxSizing:"border-box"},Fe={fontWeight:600,fontSize:"14px",color:"var(--color-gray-700)",marginBottom:"4px",display:"block"},$r={display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},Wr={marginTop:"24px"};function vc(t){var l,o,a,c,d,u,h,m,x,j,b,N,f,p,g,k,S,_,E,D,L,T;const n=(l=t.metadata)!=null&&l.created?new Date(t.metadata.created).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],r=(a=(o=t.files)==null?void 0:o.model)!=null&&a.length?t.files.model.map(P=>({url:P.url,size:P.size})):[{url:"",size:""}],s=t.base_config||t.model_config,i=s==null?void 0:s["sampling-parameters"];return{id:t.id||"",category:t.category||"Text-Generation",catalogFile:t.catalog_file||"",newCatalogFile:"",ownedBy:t.owned_by||"",modelFamily:t.model_family||"",architecture:t.architecture||"",ggufArch:t.gguf_arch||"",webPage:t.web_page||"",template:t.template||"",gatedModel:t.gated_model||!1,files:r,projUrl:((d=(c=t.files)==null?void 0:c.proj)==null?void 0:d.url)||"",projSize:((h=(u=t.files)==null?void 0:u.proj)==null?void 0:h.size)||"",capabilities:{endpoint:((m=t.capabilities)==null?void 0:m.endpoint)||"chat_completion",images:((x=t.capabilities)==null?void 0:x.images)||!1,audio:((j=t.capabilities)==null?void 0:j.audio)||!1,video:((b=t.capabilities)==null?void 0:b.video)||!1,streaming:((N=t.capabilities)==null?void 0:N.streaming)||!1,reasoning:((f=t.capabilities)==null?void 0:f.reasoning)||!1,tooling:((p=t.capabilities)==null?void 0:p.tooling)||!1,embedding:((g=t.capabilities)==null?void 0:g.embedding)||!1,rerank:((k=t.capabilities)==null?void 0:k.rerank)||!1},description:((S=t.metadata)==null?void 0:S.description)||"",collections:((_=t.metadata)==null?void 0:_.collections)||"",created:n,config:{device:(s==null?void 0:s.device)||"",contextWindow:(s==null?void 0:s["context-window"])??null,nbatch:(s==null?void 0:s.nbatch)??null,nubatch:(s==null?void 0:s.nubatch)??null,nthreads:(s==null?void 0:s.nthreads)??null,nthreadsBatch:(s==null?void 0:s["nthreads-batch"])??null,cacheTypeK:(s==null?void 0:s["cache-type-k"])||"",cacheTypeV:(s==null?void 0:s["cache-type-v"])||"",useDirectIO:(s==null?void 0:s["use-direct-io"])??null,flashAttention:(s==null?void 0:s["flash-attention"])||"",ignoreIntegrityCheck:(s==null?void 0:s["ignore-integrity-check"])??null,nseqMax:(s==null?void 0:s["nseq-max"])??null,offloadKQV:(s==null?void 0:s["offload-kqv"])??null,opOffload:(s==null?void 0:s["op-offload"])??null,ngpuLayers:(s==null?void 0:s["ngpu-layers"])??null,splitMode:(s==null?void 0:s["split-mode"])||"",systemPromptCache:(s==null?void 0:s["system-prompt-cache"])??null,incrementalCache:(s==null?void 0:s["incremental-cache"])??null,cacheMinTokens:(s==null?void 0:s["cache-min-tokens"])??null,ropeScaling:(s==null?void 0:s["rope-scaling-type"])||"",ropeFreqBase:(s==null?void 0:s["rope-freq-base"])??null,ropeFreqScale:(s==null?void 0:s["rope-freq-scale"])??null,yarnExtFactor:(s==null?void 0:s["yarn-ext-factor"])??null,yarnAttnFactor:(s==null?void 0:s["yarn-attn-factor"])??null,yarnBetaFast:(s==null?void 0:s["yarn-beta-fast"])??null,yarnBetaSlow:(s==null?void 0:s["yarn-beta-slow"])??null,yarnOrigCtx:(s==null?void 0:s["yarn-orig-ctx"])??null,draftModelId:((E=s==null?void 0:s["draft-model"])==null?void 0:E["model-id"])||"",draftNDraft:((D=s==null?void 0:s["draft-model"])==null?void 0:D.ndraft)??null,draftNGpuLayers:((L=s==null?void 0:s["draft-model"])==null?void 0:L["ngpu-layers"])??null,draftDevice:((T=s==null?void 0:s["draft-model"])==null?void 0:T.device)||""},sampling:{temperature:(i==null?void 0:i.temperature)??null,topK:(i==null?void 0:i.top_k)??null,topP:(i==null?void 0:i.top_p)??null,minP:(i==null?void 0:i.min_p)??null,presencePenalty:(i==null?void 0:i.presence_penalty)??null,maxTokens:(i==null?void 0:i.max_tokens)??null,repeatPenalty:(i==null?void 0:i.repeat_penalty)??null,repeatLastN:(i==null?void 0:i.repeat_last_n)??null,dryMultiplier:(i==null?void 0:i.dry_multiplier)??null,dryBase:(i==null?void 0:i.dry_base)??null,dryAllowedLen:(i==null?void 0:i.dry_allowed_length)??null,dryPenaltyLast:(i==null?void 0:i.dry_penalty_last_n)??null,xtcProbability:(i==null?void 0:i.xtc_probability)??null,xtcThreshold:(i==null?void 0:i.xtc_threshold)??null,xtcMinKeep:(i==null?void 0:i.xtc_min_keep)??null,frequencyPenalty:(i==null?void 0:i.frequency_penalty)??null,enableThinking:(i==null?void 0:i.enable_thinking)||"",reasoningEffort:(i==null?void 0:i.reasoning_effort)||"",grammar:(i==null?void 0:i.grammar)||""}}}function Yw(t){return t===void 0||t===0?"":`default: ${t}`}function Le({label:t,value:n,step:r,defaultValue:s,onChange:i}){return e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:t}),e.jsx("input",{type:"number",step:r,value:n??"",onChange:l=>i(l.target.value===""?null:parseFloat(l.target.value)||0),style:Be,placeholder:Yw(s)||"not set"})]})}function ws({label:t,value:n,onChange:r}){const s=n===null?"":n?"true":"false";return e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:t}),e.jsxs("select",{value:s,onChange:i=>r(i.target.value===""?null:i.target.value==="true"),style:Be,children:[e.jsx("option",{value:"",children:"not set"}),e.jsx("option",{value:"true",children:"Yes"}),e.jsx("option",{value:"false",children:"No"})]})]})}function Xw(){const[t]=ow(),n=t.get("id"),[r,s]=y.useState({...ep}),[i,l]=y.useState(null),[o,a]=y.useState([]),[c,d]=y.useState(""),[u,h]=y.useState(!1),[m,x]=y.useState(null),[j,b]=y.useState([]),[N,f]=y.useState(!1),[p,g]=y.useState(null),[k,S]=y.useState(!1),[_,E]=y.useState(!1),[D,L]=y.useState(!1),[T,P]=y.useState(""),[I,O]=y.useState(!1),[X,J]=y.useState([]),[re,ne]=y.useState([]);y.useEffect(()=>{fe.listCatalogFiles().then(a).catch(()=>{}),fe.getCatalogRepoPath().then(C=>P(C.repo_path)).catch(()=>{}),fe.listTemplates().then(C=>J(C.files||[])).catch(()=>{}),fe.listGrammars().then(C=>ne(C.files||[])).catch(()=>{})},[]),y.useEffect(()=>{n&&(S(!0),fe.showCatalogModel(n).then(C=>{s(vc(C)),C.model_config&&l(C.model_config)}).catch(()=>{}).finally(()=>S(!1)))},[n]),y.useEffect(()=>{if(t.get("source")==="playground"){const C=sessionStorage.getItem("kronk_catalog_draft");if(C)try{const R=JSON.parse(C);s($=>{var ie,ce,q,H,le,me,ge,ve,Se,Re;return{...$,id:R.id||$.id,template:R.template||$.template,capabilities:{...$.capabilities,streaming:((ie=R.capabilities)==null?void 0:ie.streaming)??$.capabilities.streaming,tooling:((ce=R.capabilities)==null?void 0:ce.tooling)??$.capabilities.tooling},config:{...$.config,contextWindow:((q=R.config)==null?void 0:q["context-window"])??$.config.contextWindow,nbatch:((H=R.config)==null?void 0:H.nbatch)??$.config.nbatch,nubatch:((le=R.config)==null?void 0:le.nubatch)??$.config.nubatch,nseqMax:((me=R.config)==null?void 0:me["nseq-max"])??$.config.nseqMax,flashAttention:((ge=R.config)==null?void 0:ge["flash-attention"])??$.config.flashAttention,cacheTypeK:((ve=R.config)==null?void 0:ve["cache-type-k"])??$.config.cacheTypeK,cacheTypeV:((Se=R.config)==null?void 0:Se["cache-type-v"])??$.config.cacheTypeV,systemPromptCache:((Re=R.config)==null?void 0:Re["system-prompt-cache"])??$.config.systemPromptCache}}}),sessionStorage.removeItem("kronk_catalog_draft")}catch{}}},[t]);const A=async()=>{var C;if(c.trim()){h(!0),x(null),b([]);try{const R=await fe.lookupHuggingFace(c.trim()),$=vc(R.model);s(ie=>({...ie,...$,catalogFile:ie.catalogFile,newCatalogFile:ie.newCatalogFile})),(C=R.repo_files)!=null&&C.length&&b(R.repo_files)}catch(R){x(R instanceof Error?R.message:"Lookup failed")}finally{h(!1)}}},B=async C=>{const R=c.trim().replace("https://huggingface.co/","").split("/"),$=R[0],ie=R[1],ce=`${$}/${ie}/${C}`;d(ce),h(!0),x(null);try{const q=await fe.lookupHuggingFace(ce),H=vc(q.model);s(le=>({...le,...H,catalogFile:le.catalogFile,newCatalogFile:le.newCatalogFile})),b([])}catch(q){x(q instanceof Error?q.message:"Lookup failed")}finally{h(!1)}},v=async()=>{if(!r.id){g({type:"error",text:"Model ID is required"});return}const C=r.catalogFile==="__new__"?r.newCatalogFile:r.catalogFile;if(!C){g({type:"error",text:"Catalog file is required"});return}f(!0),g(null);try{await fe.saveCatalogModel({id:r.id,category:r.category,owned_by:r.ownedBy,model_family:r.modelFamily,architecture:r.architecture,gguf_arch:r.ggufArch,web_page:r.webPage,gated_model:r.gatedModel,template:r.template,files:{model:r.files.filter(R=>R.url),proj:{url:r.projUrl,size:r.projSize}},capabilities:r.capabilities,metadata:{created:r.created?new Date(r.created).toISOString():new Date().toISOString(),collections:r.collections,description:r.description},config:{device:r.config.device,"context-window":r.config.contextWindow??0,nbatch:r.config.nbatch??0,nubatch:r.config.nubatch??0,nthreads:r.config.nthreads??0,"nthreads-batch":r.config.nthreadsBatch??0,"cache-type-k":r.config.cacheTypeK,"cache-type-v":r.config.cacheTypeV,"use-direct-io":r.config.useDirectIO??!1,"flash-attention":r.config.flashAttention,"ignore-integrity-check":r.config.ignoreIntegrityCheck??!1,"nseq-max":r.config.nseqMax??0,"offload-kqv":r.config.offloadKQV,"op-offload":r.config.opOffload,"ngpu-layers":r.config.ngpuLayers,"split-mode":r.config.splitMode,"system-prompt-cache":r.config.systemPromptCache??!1,"incremental-cache":r.config.incrementalCache??!1,"cache-min-tokens":r.config.cacheMinTokens??0,"rope-scaling-type":r.config.ropeScaling,"rope-freq-base":r.config.ropeFreqBase,"rope-freq-scale":r.config.ropeFreqScale,"yarn-ext-factor":r.config.yarnExtFactor,"yarn-attn-factor":r.config.yarnAttnFactor,"yarn-beta-fast":r.config.yarnBetaFast,"yarn-beta-slow":r.config.yarnBetaSlow,"yarn-orig-ctx":r.config.yarnOrigCtx,...r.config.draftModelId?{"draft-model":{"model-id":r.config.draftModelId,ndraft:r.config.draftNDraft??0,"ngpu-layers":r.config.draftNGpuLayers,device:r.config.draftDevice||void 0}}:{},"sampling-parameters":{temperature:r.sampling.temperature??0,top_k:r.sampling.topK??0,top_p:r.sampling.topP??0,min_p:r.sampling.minP??0,presence_penalty:r.sampling.presencePenalty??0,max_tokens:r.sampling.maxTokens??0,repeat_penalty:r.sampling.repeatPenalty??0,repeat_last_n:r.sampling.repeatLastN??0,dry_multiplier:r.sampling.dryMultiplier??0,dry_base:r.sampling.dryBase??0,dry_allowed_length:r.sampling.dryAllowedLen??0,dry_penalty_last_n:r.sampling.dryPenaltyLast??0,xtc_probability:r.sampling.xtcProbability??0,xtc_threshold:r.sampling.xtcThreshold??0,xtc_min_keep:r.sampling.xtcMinKeep??0,frequency_penalty:r.sampling.frequencyPenalty??0,enable_thinking:r.sampling.enableThinking||"",reasoning_effort:r.sampling.reasoningEffort||"",grammar:r.sampling.grammar??""}},catalog_file:C}),g({type:"success",text:`Model "${r.id}" saved to ${C}`}),fe.listCatalogFiles().then(a).catch(()=>{})}catch(R){g({type:"error",text:R instanceof Error?R.message:"Save failed"})}finally{f(!1)}},F=async()=>{const C=r.catalogFile==="__new__"?r.newCatalogFile:r.catalogFile;if(!C){g({type:"error",text:"Catalog file is required to publish"});return}O(!0),g(null);try{await fe.publishCatalogModel(C),g({type:"success",text:`Published "${C}" to repo`})}catch(R){g({type:"error",text:R instanceof Error?R.message:"Publish failed"})}finally{O(!1)}},z=(C,R,$)=>{const ie=[...r.files];ie[C]={...ie[C],[R]:$},s({...r,files:ie})},w=()=>{s({...r,files:[...r.files,{url:"",size:""}]})},Z=C=>{r.files.length<=1||s({...r,files:r.files.filter((R,$)=>$!==C)})},K=C=>{s({...r,config:{...r.config,...C}})},Q=C=>{s({...r,sampling:{...r.sampling,...C}})},Y=i,ee=Y==null?void 0:Y["sampling-parameters"];return k?e.jsxs("div",{children:[e.jsx("div",{className:"page-header",children:e.jsx("h2",{children:"Catalog Editor"})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"loading",children:"Loading model details"})})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:n?`Edit: ${n}`:"Catalog Editor"}),e.jsx("p",{children:"Create or edit catalog entries. Use HuggingFace lookup to auto-populate fields."})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{marginBottom:"12px"},children:"HuggingFace Import"}),e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"flex-end"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:Fe,children:"Model URL or Path"}),e.jsx("input",{type:"text",value:c,onChange:C=>d(C.target.value),placeholder:"e.g., unsloth/Qwen3-8B-GGUF/Qwen3-8B-Q8_0.gguf or full HuggingFace URL",style:Be,onKeyDown:C=>C.key==="Enter"&&A()})]}),e.jsx("button",{className:"btn btn-primary",onClick:A,disabled:u||!c.trim(),children:u?"Looking up...":"Lookup"})]}),m&&e.jsx("div",{className:"alert alert-error",style:{marginTop:"8px"},children:m}),j.length>0&&e.jsxs("div",{style:{marginTop:"12px"},children:[e.jsx("label",{style:Fe,children:"Select a GGUF file from this repository"}),e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto",border:"1px solid var(--color-gray-300)",borderRadius:"4px"},children:e.jsxs("table",{style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left",padding:"6px 8px"},children:"File"}),e.jsx("th",{style:{textAlign:"right",padding:"6px 8px"},children:"Size"}),e.jsx("th",{style:{width:"80px"}})]})}),e.jsx("tbody",{children:j.map(C=>e.jsxs("tr",{style:{cursor:"pointer"},onClick:()=>B(C.filename),children:[e.jsx("td",{style:{padding:"6px 8px",fontSize:"13px"},children:C.filename}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontSize:"13px"},children:C.size_str}),e.jsx("td",{style:{padding:"6px 8px"},children:e.jsx("button",{className:"btn btn-secondary",style:{padding:"2px 8px",fontSize:"12px"},children:"Select"})})]},C.filename))})]})})]})]}),e.jsxs("div",{className:"card",style:Wr,children:[e.jsx("h3",{style:{marginBottom:"12px"},children:"Model Identity"}),e.jsxs("div",{style:$r,children:[e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"ID *"}),e.jsx("input",{type:"text",value:r.id,onChange:C=>s({...r,id:C.target.value}),style:Be})]}),e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"Category"}),e.jsxs("select",{value:r.category,onChange:C=>s({...r,category:C.target.value}),style:Be,children:[e.jsx("option",{value:"Text-Generation",children:"Text-Generation"}),e.jsx("option",{value:"Embedding",children:"Embedding"}),e.jsx("option",{value:"Image-Text-to-Text",children:"Image-Text-to-Text"}),e.jsx("option",{value:"Audio-Text-to-Text",children:"Audio-Text-to-Text"}),e.jsx("option",{value:"Rerank",children:"Rerank"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"Catalog File *"}),e.jsxs("select",{value:r.catalogFile,onChange:C=>s({...r,catalogFile:C.target.value}),style:Be,children:[e.jsx("option",{value:"",children:"-- Select --"}),o.map(C=>e.jsxs("option",{value:C.name,children:[C.name," (",C.model_count," models)"]},C.name)),e.jsx("option",{value:"__new__",children:"New catalog file..."})]})]}),r.catalogFile==="__new__"&&e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"New File Name"}),e.jsx("input",{type:"text",value:r.newCatalogFile,onChange:C=>s({...r,newCatalogFile:C.target.value}),placeholder:"e.g., text_generation",style:Be})]}),e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"Owned By"}),e.jsx("input",{type:"text",value:r.ownedBy,onChange:C=>s({...r,ownedBy:C.target.value}),style:Be})]}),e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"Model Family"}),e.jsx("input",{type:"text",value:r.modelFamily,onChange:C=>s({...r,modelFamily:C.target.value}),style:Be})]}),e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"Architecture"}),e.jsxs("select",{value:r.architecture,onChange:C=>s({...r,architecture:C.target.value}),style:Be,children:[e.jsx("option",{value:"",children:"not set"}),e.jsx("option",{value:"Dense",children:"Dense"}),e.jsx("option",{value:"MoE",children:"MoE"}),e.jsx("option",{value:"Hybrid",children:"Hybrid"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"GGUF Arch"}),e.jsx("input",{type:"text",value:r.ggufArch,onChange:C=>s({...r,ggufArch:C.target.value}),style:Be,placeholder:"e.g. llama, qwen2moe"})]}),e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"Web Page"}),e.jsx("input",{type:"text",value:r.webPage,onChange:C=>s({...r,webPage:C.target.value}),style:Be})]}),e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"Template"}),e.jsxs("select",{value:r.template,onChange:C=>s({...r,template:C.target.value}),style:Be,children:[e.jsx("option",{value:"",children:"not set"}),X.map(C=>e.jsx("option",{value:C,children:C},C))]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",paddingTop:"24px"},children:[e.jsx("input",{type:"checkbox",checked:r.gatedModel,onChange:C=>s({...r,gatedModel:C.target.checked}),id:"gated-model"}),e.jsx("label",{htmlFor:"gated-model",style:{...Fe,marginBottom:0},children:"Gated Model"})]})]})]}),e.jsxs("div",{className:"card",style:Wr,children:[e.jsx("h3",{style:{marginBottom:"12px"},children:"Files"}),e.jsx("label",{style:{...Fe,marginBottom:"8px"},children:"Model Files"}),r.files.map((C,R)=>e.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"8px",alignItems:"flex-end"},children:[e.jsxs("div",{style:{flex:3},children:[R===0&&e.jsx("label",{style:{fontSize:"12px",color:"var(--color-gray-500)"},children:"URL"}),e.jsx("input",{type:"text",value:C.url,onChange:$=>z(R,"url",$.target.value),style:Be,placeholder:"owner/repo/file.gguf"})]}),e.jsxs("div",{style:{flex:1},children:[R===0&&e.jsx("label",{style:{fontSize:"12px",color:"var(--color-gray-500)"},children:"Size"}),e.jsx("input",{type:"text",value:C.size,onChange:$=>z(R,"size",$.target.value),style:Be,placeholder:"8.71 GB"})]}),e.jsx("button",{className:"btn btn-danger",onClick:()=>Z(R),disabled:r.files.length<=1,style:{padding:"8px 12px"},title:"Remove this file entry",children:""})]},R)),e.jsx("button",{className:"btn btn-secondary",onClick:w,style:{marginTop:"4px"},children:"+ Add File"}),e.jsxs("div",{style:{...$r,marginTop:"16px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"Projection File URL (optional)"}),e.jsx("input",{type:"text",value:r.projUrl,onChange:C=>s({...r,projUrl:C.target.value}),style:Be})]}),e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"Projection File Size"}),e.jsx("input",{type:"text",value:r.projSize,onChange:C=>s({...r,projSize:C.target.value}),style:Be})]})]})]}),e.jsxs("div",{className:"card",style:Wr,children:[e.jsx("h3",{style:{marginBottom:"12px"},children:"Capabilities"}),e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("label",{style:Fe,children:"Endpoint"}),e.jsxs("select",{value:r.capabilities.endpoint,onChange:C=>s({...r,capabilities:{...r.capabilities,endpoint:C.target.value}}),style:{...Be,maxWidth:"300px"},children:[e.jsx("option",{value:"chat_completion",children:"chat_completion"}),e.jsx("option",{value:"embeddings",children:"embeddings"}),e.jsx("option",{value:"rerank",children:"rerank"})]})]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"16px"},children:["images","audio","video","streaming","reasoning","tooling","embedding","rerank"].map(C=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:r.capabilities[C],onChange:R=>s({...r,capabilities:{...r.capabilities,[C]:R.target.checked}})}),e.jsx("span",{style:{fontSize:"14px",textTransform:"capitalize"},children:C})]},C))})]}),e.jsxs("div",{className:"card",style:Wr,children:[e.jsx("h3",{style:{marginBottom:"12px"},children:"Metadata"}),e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("label",{style:Fe,children:"Description"}),e.jsx("textarea",{value:r.description,onChange:C=>s({...r,description:C.target.value}),rows:3,style:{...Be,resize:"vertical"}})]}),e.jsxs("div",{style:$r,children:[e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"Collections"}),e.jsx("input",{type:"text",value:r.collections,onChange:C=>s({...r,collections:C.target.value}),style:Be,placeholder:"collections/owner"})]}),e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"Created"}),e.jsx("input",{type:"date",value:r.created,onChange:C=>s({...r,created:C.target.value}),style:Be})]})]})]}),e.jsxs("div",{className:"card",style:Wr,children:[e.jsxs("h3",{onClick:()=>E(!_),style:{cursor:"pointer",userSelect:"none",marginBottom:_?"12px":0},children:[_?"":""," Configuration"]}),_&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:$r,children:[e.jsx(Le,{label:"Batch Size (nbatch)",value:r.config.nbatch,defaultValue:Y==null?void 0:Y.nbatch,onChange:C=>K({nbatch:C})}),e.jsx(Le,{label:"Micro Batch Size (nubatch)",value:r.config.nubatch,defaultValue:Y==null?void 0:Y.nubatch,onChange:C=>K({nubatch:C})}),e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"Cache Type K"}),e.jsxs("select",{value:r.config.cacheTypeK,onChange:C=>K({cacheTypeK:C.target.value}),style:Be,children:[e.jsx("option",{value:"",children:"not set"}),e.jsx("option",{value:"f16",children:"f16"}),e.jsx("option",{value:"bf16",children:"bf16"}),e.jsx("option",{value:"q8_0",children:"q8_0"}),e.jsx("option",{value:"q4_0",children:"q4_0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"Cache Type V"}),e.jsxs("select",{value:r.config.cacheTypeV,onChange:C=>K({cacheTypeV:C.target.value}),style:Be,children:[e.jsx("option",{value:"",children:"not set"}),e.jsx("option",{value:"f16",children:"f16"}),e.jsx("option",{value:"bf16",children:"bf16"}),e.jsx("option",{value:"q8_0",children:"q8_0"}),e.jsx("option",{value:"q4_0",children:"q4_0"})]})]}),e.jsx(Le,{label:"Context Window",value:r.config.contextWindow,defaultValue:Y==null?void 0:Y["context-window"],onChange:C=>K({contextWindow:C})}),e.jsx(Le,{label:"Max Sequences (nseq-max)",value:r.config.nseqMax,defaultValue:Y==null?void 0:Y["nseq-max"],onChange:C=>K({nseqMax:C})}),e.jsx(ws,{label:"System Prompt Cache",value:r.config.systemPromptCache,onChange:C=>K({systemPromptCache:C})}),e.jsx(ws,{label:"Incremental Cache",value:r.config.incrementalCache,onChange:C=>K({incrementalCache:C})}),e.jsx(Le,{label:"Batch Threads (nthreads-batch)",value:r.config.nthreadsBatch,defaultValue:Y==null?void 0:Y["nthreads-batch"],onChange:C=>K({nthreadsBatch:C})}),e.jsx(Le,{label:"Cache Min Tokens",value:r.config.cacheMinTokens,defaultValue:Y==null?void 0:Y["cache-min-tokens"],onChange:C=>K({cacheMinTokens:C})}),e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"Device"}),e.jsxs("select",{value:r.config.device,onChange:C=>K({device:C.target.value}),style:Be,children:[e.jsx("option",{value:"",children:"not set"}),e.jsx("option",{value:"cpu",children:"cpu"}),e.jsx("option",{value:"cuda",children:"cuda"}),e.jsx("option",{value:"metal",children:"metal"}),e.jsx("option",{value:"vulkan",children:"vulkan"}),e.jsx("option",{value:"rocm",children:"rocm"})]})]}),e.jsx(ws,{label:"Direct I/O",value:r.config.useDirectIO,onChange:C=>K({useDirectIO:C})}),e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"Flash Attention"}),e.jsxs("select",{value:r.config.flashAttention,onChange:C=>K({flashAttention:C.target.value}),style:Be,children:[e.jsx("option",{value:"",children:"not set"}),e.jsx("option",{value:"enabled",children:"enabled"}),e.jsx("option",{value:"disabled",children:"disabled"})]})]}),e.jsx(Le,{label:"GPU Layers (ngpu-layers)",value:r.config.ngpuLayers,defaultValue:(Y==null?void 0:Y["ngpu-layers"])??void 0,onChange:C=>K({ngpuLayers:C===null?null:Math.round(C)})}),e.jsx(ws,{label:"Ignore Integrity Check",value:r.config.ignoreIntegrityCheck,onChange:C=>K({ignoreIntegrityCheck:C})}),e.jsx(ws,{label:"Offload KQV",value:r.config.offloadKQV,onChange:C=>K({offloadKQV:C})}),e.jsx(ws,{label:"Op Offload",value:r.config.opOffload,onChange:C=>K({opOffload:C})}),e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"Split Mode"}),e.jsxs("select",{value:r.config.splitMode,onChange:C=>K({splitMode:C.target.value}),style:Be,children:[e.jsx("option",{value:"",children:"not set"}),e.jsx("option",{value:"none",children:"none"}),e.jsx("option",{value:"layer",children:"layer"}),e.jsx("option",{value:"row",children:"row"})]})]}),e.jsx(Le,{label:"Threads (nthreads)",value:r.config.nthreads,defaultValue:Y==null?void 0:Y.nthreads,onChange:C=>K({nthreads:C})})]}),e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsx("h4",{style:{marginBottom:"12px",fontSize:"14px",fontWeight:600,color:"var(--color-gray-700)"},children:"RoPE / YaRN Scaling"}),e.jsxs("div",{style:$r,children:[e.jsx(Le,{label:"RoPE Freq Base",value:r.config.ropeFreqBase,step:"0.01",defaultValue:(Y==null?void 0:Y["rope-freq-base"])??void 0,onChange:C=>K({ropeFreqBase:C})}),e.jsx(Le,{label:"RoPE Freq Scale",value:r.config.ropeFreqScale,step:"0.01",defaultValue:(Y==null?void 0:Y["rope-freq-scale"])??void 0,onChange:C=>K({ropeFreqScale:C})}),e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"RoPE Scaling Type"}),e.jsxs("select",{value:r.config.ropeScaling,onChange:C=>K({ropeScaling:C.target.value}),style:Be,children:[e.jsx("option",{value:"",children:"none"}),e.jsx("option",{value:"linear",children:"linear"}),e.jsx("option",{value:"yarn",children:"yarn"})]})]}),e.jsx(Le,{label:"YaRN Attn Factor",value:r.config.yarnAttnFactor,step:"0.01",defaultValue:(Y==null?void 0:Y["yarn-attn-factor"])??void 0,onChange:C=>K({yarnAttnFactor:C})}),e.jsx(Le,{label:"YaRN Beta Fast",value:r.config.yarnBetaFast,step:"0.01",defaultValue:(Y==null?void 0:Y["yarn-beta-fast"])??void 0,onChange:C=>K({yarnBetaFast:C})}),e.jsx(Le,{label:"YaRN Beta Slow",value:r.config.yarnBetaSlow,step:"0.01",defaultValue:(Y==null?void 0:Y["yarn-beta-slow"])??void 0,onChange:C=>K({yarnBetaSlow:C})}),e.jsx(Le,{label:"YaRN Ext Factor",value:r.config.yarnExtFactor,step:"0.01",defaultValue:(Y==null?void 0:Y["yarn-ext-factor"])??void 0,onChange:C=>K({yarnExtFactor:C})}),e.jsx(Le,{label:"YaRN Original Context",value:r.config.yarnOrigCtx,defaultValue:(Y==null?void 0:Y["yarn-orig-ctx"])??void 0,onChange:C=>K({yarnOrigCtx:C===null?null:Math.round(C)})})]})]}),e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsx("h4",{style:{marginBottom:"12px",fontSize:"14px",fontWeight:600,color:"var(--color-gray-700)"},children:"Speculative Decoding"}),e.jsxs("div",{style:$r,children:[e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"Draft Model ID"}),e.jsx("input",{type:"text",value:r.config.draftModelId,onChange:C=>K({draftModelId:C.target.value}),style:Be,placeholder:"e.g., Qwen3-0.6B-Q8_0"})]}),e.jsx(Le,{label:"Draft Tokens (ndraft)",value:r.config.draftNDraft,onChange:C=>K({draftNDraft:C===null?null:Math.round(C)})}),e.jsx(Le,{label:"Draft GPU Layers",value:r.config.draftNGpuLayers,onChange:C=>K({draftNGpuLayers:C===null?null:Math.round(C)})}),e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"Draft Device"}),e.jsx("input",{type:"text",value:r.config.draftDevice,onChange:C=>K({draftDevice:C.target.value}),style:Be,placeholder:"e.g., GPU1"})]})]})]})]})]}),e.jsxs("div",{className:"card",style:Wr,children:[e.jsxs("h3",{onClick:()=>L(!D),style:{cursor:"pointer",userSelect:"none",marginBottom:D?"12px":0},children:[D?"":""," Sampling Parameters"]}),D&&e.jsxs("div",{style:$r,children:[e.jsx(Le,{label:"DRY Allowed Length",value:r.sampling.dryAllowedLen,defaultValue:ee==null?void 0:ee.dry_allowed_length,onChange:C=>Q({dryAllowedLen:C})}),e.jsx(Le,{label:"DRY Base",value:r.sampling.dryBase,step:"0.01",defaultValue:ee==null?void 0:ee.dry_base,onChange:C=>Q({dryBase:C})}),e.jsx(Le,{label:"DRY Multiplier",value:r.sampling.dryMultiplier,step:"0.01",defaultValue:ee==null?void 0:ee.dry_multiplier,onChange:C=>Q({dryMultiplier:C})}),e.jsx(Le,{label:"DRY Penalty Last N",value:r.sampling.dryPenaltyLast,defaultValue:ee==null?void 0:ee.dry_penalty_last_n,onChange:C=>Q({dryPenaltyLast:C})}),e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"Enable Thinking"}),e.jsxs("select",{value:r.sampling.enableThinking,onChange:C=>Q({enableThinking:C.target.value}),style:Be,children:[e.jsx("option",{value:"",children:"not set"}),e.jsx("option",{value:"on",children:"on"}),e.jsx("option",{value:"off",children:"off"})]})]}),e.jsx(Le,{label:"Max Tokens",value:r.sampling.maxTokens,defaultValue:ee==null?void 0:ee.max_tokens,onChange:C=>Q({maxTokens:C})}),e.jsx(Le,{label:"Min P",value:r.sampling.minP,step:"0.01",defaultValue:ee==null?void 0:ee.min_p,onChange:C=>Q({minP:C})}),e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"Reasoning Effort"}),e.jsxs("select",{value:r.sampling.reasoningEffort,onChange:C=>Q({reasoningEffort:C.target.value}),style:Be,children:[e.jsx("option",{value:"",children:"not set"}),e.jsx("option",{value:"low",children:"low"}),e.jsx("option",{value:"medium",children:"medium"}),e.jsx("option",{value:"high",children:"high"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:Fe,children:"Grammar"}),e.jsxs("select",{value:r.sampling.grammar,onChange:C=>Q({grammar:C.target.value}),style:Be,children:[e.jsx("option",{value:"",children:"empty"}),re.map(C=>e.jsx("option",{value:C,children:C},C))]})]}),e.jsx(Le,{label:"Repeat Last N",value:r.sampling.repeatLastN,defaultValue:ee==null?void 0:ee.repeat_last_n,onChange:C=>Q({repeatLastN:C})}),e.jsx(Le,{label:"Repeat Penalty",value:r.sampling.repeatPenalty,step:"0.01",defaultValue:ee==null?void 0:ee.repeat_penalty,onChange:C=>Q({repeatPenalty:C})}),e.jsx(Le,{label:"Frequency Penalty",value:r.sampling.frequencyPenalty,step:"0.01",defaultValue:ee==null?void 0:ee.frequency_penalty,onChange:C=>Q({frequencyPenalty:C})}),e.jsx(Le,{label:"Presence Penalty",value:r.sampling.presencePenalty,step:"0.01",defaultValue:ee==null?void 0:ee.presence_penalty,onChange:C=>Q({presencePenalty:C})}),e.jsx(Le,{label:"Temperature",value:r.sampling.temperature,step:"0.01",defaultValue:ee==null?void 0:ee.temperature,onChange:C=>Q({temperature:C})}),e.jsx(Le,{label:"Top K",value:r.sampling.topK,defaultValue:ee==null?void 0:ee.top_k,onChange:C=>Q({topK:C})}),e.jsx(Le,{label:"Top P",value:r.sampling.topP,step:"0.01",defaultValue:ee==null?void 0:ee.top_p,onChange:C=>Q({topP:C})}),e.jsx(Le,{label:"XTC Min Keep",value:r.sampling.xtcMinKeep,defaultValue:ee==null?void 0:ee.xtc_min_keep,onChange:C=>Q({xtcMinKeep:C})}),e.jsx(Le,{label:"XTC Probability",value:r.sampling.xtcProbability,step:"0.01",defaultValue:ee==null?void 0:ee.xtc_probability,onChange:C=>Q({xtcProbability:C})}),e.jsx(Le,{label:"XTC Threshold",value:r.sampling.xtcThreshold,step:"0.01",defaultValue:ee==null?void 0:ee.xtc_threshold,onChange:C=>Q({xtcThreshold:C})})]})]}),e.jsxs("div",{className:"card",style:Wr,children:[e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[e.jsx("button",{className:"btn btn-primary",onClick:v,disabled:N,children:N?"Saving...":"Save to Catalog"}),T&&e.jsx("button",{className:"btn btn-primary",onClick:F,disabled:I,style:{background:"var(--color-success-dark)"},children:I?"Publishing...":"Publish to Repo"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>{s({...ep}),l(null),d(""),b([]),g(null)},children:"Reset"})]}),p&&e.jsx("div",{className:p.type==="error"?"alert alert-error":"alert",style:p.type==="success"?{marginTop:"8px",background:"var(--color-success-bg)",color:"var(--color-success-dark)",padding:"12px",borderRadius:"6px"}:{marginTop:"8px"},children:p.text})]})]})}function Jw(){const[t,n]=y.useState(!1),[r,s]=y.useState([]),[i,l]=y.useState(null),[o,a]=y.useState(!0),[c,d]=y.useState(!1),[u,h]=y.useState(""),m=y.useRef(null);y.useEffect(()=>{fe.getLibsVersion().then(l).catch(()=>{}).finally(()=>a(!1))},[]);const x=()=>{n(!0),s([]),l(null);const b=(f,p)=>{s(g=>[...g,{text:f,type:p}])},N=c?!0:void 0;m.current=fe.pullLibs(f=>{f.status&&b(f.status,"info"),(f.current||f.latest)&&l(f)},f=>{b(f,"error"),n(!1)},()=>{b("Libs update complete!","success"),n(!1)},N,u||void 0)},j=()=>{m.current&&(m.current(),m.current=null),n(!1),s(b=>[...b,{text:"Cancelled",type:"error"}])};return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"Pull/Update Libs"}),e.jsx("p",{children:"Download or update the Kronk libraries"})]}),e.jsxs("div",{className:"card",children:[o?e.jsx("p",{children:"Loading version info..."}):i?e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("h4",{style:{marginBottom:"12px"},children:"Current Version"}),e.jsxs("div",{className:"model-meta",children:[i.arch&&e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Architecture"}),e.jsx("span",{children:i.arch})]}),i.os&&e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"OS"}),e.jsx("span",{children:i.os})]}),i.processor&&e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Processor"}),e.jsx("span",{children:i.processor})]}),i.current&&e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Installed Version"}),e.jsx("span",{children:i.current})]}),i.latest&&e.jsxs("div",{className:"model-meta-item",children:[e.jsx("label",{children:"Latest Version"}),e.jsx("span",{children:i.latest})]})]})]}):e.jsx("p",{style:{marginBottom:"24px",color:"var(--color-gray-600)"},children:"No libs installed yet."}),i&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[e.jsx("input",{type:"checkbox",checked:i.allow_upgrade||c,disabled:i.allow_upgrade||t,onChange:b=>d(b.target.checked),id:"allow-upgrade"}),e.jsx("label",{htmlFor:"allow-upgrade",style:{fontSize:"14px",cursor:i.allow_upgrade?"default":"pointer"},children:"Allow Upgrade"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"version",children:"Version (leave empty for latest)"}),e.jsx("input",{type:"text",id:"version",value:u,onChange:b=>h(b.target.value),disabled:t,placeholder:"e.g. b5540",style:{maxWidth:"200px"}})]}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx("button",{className:"btn btn-primary",onClick:x,disabled:t||i!==null&&!i.allow_upgrade&&!c,children:t?"Updating...":"Pull/Update Libs"}),t&&e.jsx("button",{className:"btn btn-danger",onClick:j,children:"Cancel"})]}),r.length>0&&e.jsx("div",{className:"status-box",children:r.map((b,N)=>e.jsx("div",{className:`status-line ${b.type}`,children:b.text},N))})]})]})}const wc="kronk_token",Vg=y.createContext(null);function Zw({children:t}){const[n,r]=y.useState(()=>localStorage.getItem(wc)||"");y.useEffect(()=>{n?localStorage.setItem(wc,n):localStorage.removeItem(wc)},[n]);const s=y.useCallback(l=>{r(l)},[]),i=y.useCallback(()=>{r("")},[]);return e.jsx(Vg.Provider,{value:{token:n,setToken:s,clearToken:i,hasToken:!!n},children:t})}function hi(){const t=y.useContext(Vg);if(!t)throw new Error("useToken must be used within a TokenProvider");return t}function e0(){const{token:t}=hi(),[n,r]=y.useState(null),[s,i]=y.useState(!1),[l,o]=y.useState(null),a=async()=>{if(t){i(!0),o(null);try{const c=await fe.listKeys(t);r(c)}catch(c){o(c instanceof Error?c.message:"Failed to load keys"),r(null)}finally{i(!1)}}};return y.useEffect(()=>{t&&a()},[t]),e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"Security Keys"}),e.jsx("p",{children:"List all security keys (requires admin token)"})]}),!t&&e.jsxs("div",{className:"alert alert-error",children:["No API token configured. ",e.jsx(Nr,{to:"/settings",children:"Configure your token in Settings"})]}),t&&e.jsx("div",{className:"card",children:e.jsx("button",{className:"btn btn-primary",onClick:a,disabled:s,children:s?"Loading...":"Refresh Keys"})}),l&&e.jsx("div",{className:"alert alert-error",children:l}),n&&e.jsx("div",{className:"card",children:e.jsx("div",{className:"table-container",children:n.length>0?e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Created"})]})}),e.jsx("tbody",{children:n.map(c=>e.jsxs("tr",{children:[e.jsx("td",{children:c.id}),e.jsx("td",{children:new Date(c.created).toLocaleString()})]},c.id))})]}):e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No keys found"}),e.jsx("p",{children:"Create a key to get started"})]})})})]})}function t0(){const{token:t}=hi(),[n,r]=y.useState(!1),[s,i]=y.useState(null),[l,o]=y.useState(null),a=async c=>{if(c.preventDefault(),!!t){r(!0),i(null),o(null);try{const d=await fe.createKey(t);o(d.id)}catch(d){i(d instanceof Error?d.message:"Failed to create key")}finally{r(!1)}}};return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"Create Security Key"}),e.jsx("p",{children:"Generate a new security key (requires admin token)"})]}),!t&&e.jsxs("div",{className:"alert alert-error",children:["No API token configured. ",e.jsx(Nr,{to:"/settings",children:"Configure your token in Settings"})]}),t&&e.jsx("div",{className:"card",children:e.jsx("form",{onSubmit:a,children:e.jsx("button",{className:"btn btn-primary",type:"submit",disabled:n,children:n?"Creating...":"Create Key"})})}),s&&e.jsx("div",{className:"alert alert-error",children:s}),l&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"alert alert-success",children:"Key created successfully!"}),e.jsxs("div",{style:{marginTop:"12px"},children:[e.jsx("label",{style:{fontWeight:500,display:"block",marginBottom:"8px"},children:"New Key ID"}),e.jsx("div",{className:"token-display",children:l}),e.jsx("p",{style:{marginTop:"8px",fontSize:"13px",color:"var(--color-gray-600)"},children:"Store this key securely. It will not be shown again."})]})]})]})}function n0(){const{token:t}=hi(),[n,r]=y.useState(""),[s,i]=y.useState(!1),[l,o]=y.useState(null),[a,c]=y.useState(null),d=async u=>{if(u.preventDefault(),!(!t||!n.trim())){i(!0),o(null),c(null);try{await fe.deleteKey(t,n.trim()),c(`Key "${n}" deleted successfully`),r("")}catch(h){o(h instanceof Error?h.message:"Failed to delete key")}finally{i(!1)}}};return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"Delete Security Key"}),e.jsx("p",{children:"Remove a security key (requires admin token)"})]}),!t&&e.jsxs("div",{className:"alert alert-error",children:["No API token configured. ",e.jsx(Nr,{to:"/settings",children:"Configure your token in Settings"})]}),t&&e.jsxs("div",{className:"card",children:[l&&e.jsx("div",{className:"alert alert-error",children:l}),a&&e.jsx("div",{className:"alert alert-success",children:a}),e.jsxs("form",{onSubmit:d,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"keyId",children:"Key ID"}),e.jsx("input",{type:"text",id:"keyId",value:n,onChange:u=>r(u.target.value),placeholder:"Enter key ID to delete"})]}),e.jsx("button",{className:"btn btn-danger",type:"submit",disabled:s||!n.trim(),children:s?"Deleting...":"Delete Key"})]})]})]})}const tp=[{label:"/v1/chat/completions",value:"chat-completions"},{label:"/v1/embeddings",value:"embeddings"}],r0=[{label:"Unlimited",value:"unlimited"},{label:"Per Day",value:"day"},{label:"Per Month",value:"month"},{label:"Per Year",value:"year"}],s0=()=>({enabled:!1,limit:1e3,window:"unlimited"});function i0(){const{token:t}=hi(),[n,r]=y.useState(!1),[s,i]=y.useState(()=>{const f={};return tp.forEach(p=>{f[p.value]=s0()}),f}),[l,o]=y.useState("24"),[a,c]=y.useState("h"),[d,u]=y.useState(!1),[h,m]=y.useState(null),[x,j]=y.useState(null),b=(f,p)=>{i(g=>({...g,[f]:{...g[f],...p}}))},N=async f=>{if(f.preventDefault(),!t)return;u(!0),m(null),j(null);const p=parseInt(l);let g;switch(a){case"h":g=p*60*60*1e9;break;case"d":g=p*24*60*60*1e9;break;case"M":g=p*30*24*60*60*1e9;break;case"y":g=p*365*24*60*60*1e9;break}const k={};Object.entries(s).forEach(([S,_])=>{_.enabled&&(k[S]={limit:_.window==="unlimited"?0:_.limit,window:_.window})});try{const S=await fe.createToken(t,{admin:n,endpoints:k,duration:g});j(S.token)}catch(S){m(S instanceof Error?S.message:"Failed to create token")}finally{u(!1)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"Create Token"}),e.jsx("p",{children:"Generate a new authentication token"})]}),!t&&e.jsxs("div",{className:"alert alert-error",children:["No API token configured. ",e.jsx(Nr,{to:"/settings",children:"Configure your token in Settings"})]}),t&&e.jsx("div",{className:"card",children:e.jsxs("form",{onSubmit:N,children:[e.jsx("div",{className:"form-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:n,onChange:f=>r(f.target.checked)}),"Admin privileges"]})}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Endpoints & Rate Limits"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:tp.map(f=>{const p=s[f.value];return e.jsxs("div",{style:{padding:"12px",background:p.enabled?"rgba(240, 181, 49, 0.1)":"var(--color-gray-100)",borderRadius:"6px",border:p.enabled?"1px solid rgba(240, 181, 49, 0.3)":"1px solid transparent"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer",fontWeight:500},children:[e.jsx("input",{type:"checkbox",checked:p.enabled,onChange:g=>b(f.value,{enabled:g.target.checked}),style:{marginRight:"8px"}}),f.label]}),p.enabled&&e.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"10px",paddingLeft:"24px"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:"12px",color:"var(--color-gray-600)",display:"block",marginBottom:"4px"},children:"Rate Limit"}),e.jsx("select",{value:p.window,onChange:g=>b(f.value,{window:g.target.value}),style:{width:"100%"},children:r0.map(g=>e.jsx("option",{value:g.value,children:g.label},g.value))})]}),p.window!=="unlimited"&&e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:"12px",color:"var(--color-gray-600)",display:"block",marginBottom:"4px"},children:"Max Requests"}),e.jsx("input",{type:"number",value:p.limit,onChange:g=>b(f.value,{limit:parseInt(g.target.value)||0}),min:"1",style:{width:"100%"}})]})]})]},f.value)})})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"duration",children:"Duration"}),e.jsx("input",{type:"number",id:"duration",value:l,onChange:f=>o(f.target.value),min:"1"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"durationUnit",children:"Unit"}),e.jsxs("select",{id:"durationUnit",value:a,onChange:f=>c(f.target.value),children:[e.jsx("option",{value:"h",children:"Hours"}),e.jsx("option",{value:"d",children:"Days"}),e.jsx("option",{value:"M",children:"Months"}),e.jsx("option",{value:"y",children:"Years"})]})]})]}),e.jsx("button",{className:"btn btn-primary",type:"submit",disabled:d,children:d?"Creating...":"Create Token"})]})}),h&&e.jsx("div",{className:"alert alert-error",children:h}),x&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"alert alert-success",children:"Token created successfully!"}),e.jsxs("div",{style:{marginTop:"12px"},children:[e.jsx("label",{style:{fontWeight:500,display:"block",marginBottom:"8px"},children:"Token"}),e.jsx("div",{className:"token-display",children:x}),e.jsx("p",{style:{marginTop:"8px",fontSize:"13px",color:"var(--color-gray-600)"},children:"Store this token securely. It will not be shown again."})]})]})]})}function l0(){const{token:t,setToken:n,clearToken:r,hasToken:s}=hi(),[i,l]=y.useState(t),[o,a]=y.useState(!1),[c,d]=y.useState(!1),u=m=>{m.preventDefault(),n(i.trim()),d(!0),setTimeout(()=>d(!1),2e3)},h=()=>{r(),l(""),d(!0),setTimeout(()=>d(!1),2e3)};return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"Settings"}),e.jsx("p",{children:"Configure your API token for authenticated requests"})]}),e.jsx("div",{className:"card",children:e.jsxs("form",{onSubmit:u,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"apiToken",children:"API Token"}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("input",{type:o?"text":"password",id:"apiToken",value:i,onChange:m=>l(m.target.value),placeholder:"Enter your KRONK_TOKEN",style:{flex:1}}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>a(!o),children:o?"Hide":"Show"})]}),e.jsx("p",{style:{fontSize:"12px",color:"var(--color-gray-600)",marginTop:"8px"},children:"This token will be stored in your browser and used for all API requests that require authentication."})]}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx("button",{className:"btn btn-primary",type:"submit",children:"Save Token"}),s&&e.jsx("button",{className:"btn btn-danger",type:"button",onClick:h,children:"Clear Token"})]})]})}),c&&e.jsx("div",{className:"alert alert-success",children:"Token settings saved"}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{style:{marginBottom:"12px",color:"var(--color-page-title)"},children:"Token Status"}),e.jsx("p",{style:{color:s?"var(--color-success)":"var(--color-gray-600)"},children:s?" Token is configured":" No token configured"})]})]})}function o0(t,n){const r={};return(t[t.length-1]===""?[...t,""]:t).join((r.padRight?" ":"")+","+(r.padLeft===!1?"":" ")).trim()}const a0=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,c0=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,d0={};function np(t,n){return(d0.jsx?c0:a0).test(t)}const h0=/[ \t\n\f\r]/g;function u0(t){return typeof t=="object"?t.type==="text"?rp(t.value):!1:rp(t)}function rp(t){return t.replace(h0,"")===""}class Ll{constructor(n,r,s){this.normal=r,this.property=n,s&&(this.space=s)}}Ll.prototype.normal={};Ll.prototype.property={};Ll.prototype.space=void 0;function Hg(t,n){const r={},s={};for(const i of t)Object.assign(r,i.property),Object.assign(s,i.normal);return new Ll(r,s,n)}function zd(t){return t.toLowerCase()}class ln{constructor(n,r){this.attribute=r,this.property=n}}ln.prototype.attribute="";ln.prototype.booleanish=!1;ln.prototype.boolean=!1;ln.prototype.commaOrSpaceSeparated=!1;ln.prototype.commaSeparated=!1;ln.prototype.defined=!1;ln.prototype.mustUseProperty=!1;ln.prototype.number=!1;ln.prototype.overloadedBoolean=!1;ln.prototype.property="";ln.prototype.spaceSeparated=!1;ln.prototype.space=void 0;let m0=0;const Pe=gs(),xt=gs(),Gd=gs(),ae=gs(),Qe=gs(),$s=gs(),hn=gs();function gs(){return 2**++m0}const Vd=Object.freeze(Object.defineProperty({__proto__:null,boolean:Pe,booleanish:xt,commaOrSpaceSeparated:hn,commaSeparated:$s,number:ae,overloadedBoolean:Gd,spaceSeparated:Qe},Symbol.toStringTag,{value:"Module"})),Nc=Object.keys(Vd);class Zh extends ln{constructor(n,r,s,i){let l=-1;if(super(n,r),sp(this,"space",i),typeof s=="number")for(;++l<Nc.length;){const o=Nc[l];sp(this,Nc[l],(s&Vd[o])===Vd[o])}}}Zh.prototype.defined=!0;function sp(t,n,r){r&&(t[n]=r)}function ui(t){const n={},r={};for(const[s,i]of Object.entries(t.properties)){const l=new Zh(s,t.transform(t.attributes||{},s),i,t.space);t.mustUseProperty&&t.mustUseProperty.includes(s)&&(l.mustUseProperty=!0),n[s]=l,r[zd(s)]=s,r[zd(l.attribute)]=s}return new Ll(n,r,t.space)}const $g=ui({properties:{ariaActiveDescendant:null,ariaAtomic:xt,ariaAutoComplete:null,ariaBusy:xt,ariaChecked:xt,ariaColCount:ae,ariaColIndex:ae,ariaColSpan:ae,ariaControls:Qe,ariaCurrent:null,ariaDescribedBy:Qe,ariaDetails:null,ariaDisabled:xt,ariaDropEffect:Qe,ariaErrorMessage:null,ariaExpanded:xt,ariaFlowTo:Qe,ariaGrabbed:xt,ariaHasPopup:null,ariaHidden:xt,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Qe,ariaLevel:ae,ariaLive:null,ariaModal:xt,ariaMultiLine:xt,ariaMultiSelectable:xt,ariaOrientation:null,ariaOwns:Qe,ariaPlaceholder:null,ariaPosInSet:ae,ariaPressed:xt,ariaReadOnly:xt,ariaRelevant:null,ariaRequired:xt,ariaRoleDescription:Qe,ariaRowCount:ae,ariaRowIndex:ae,ariaRowSpan:ae,ariaSelected:xt,ariaSetSize:ae,ariaSort:null,ariaValueMax:ae,ariaValueMin:ae,ariaValueNow:ae,ariaValueText:null,role:null},transform(t,n){return n==="role"?n:"aria-"+n.slice(4).toLowerCase()}});function Wg(t,n){return n in t?t[n]:n}function Qg(t,n){return Wg(t,n.toLowerCase())}const p0=ui({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:$s,acceptCharset:Qe,accessKey:Qe,action:null,allow:null,allowFullScreen:Pe,allowPaymentRequest:Pe,allowUserMedia:Pe,alt:null,as:null,async:Pe,autoCapitalize:null,autoComplete:Qe,autoFocus:Pe,autoPlay:Pe,blocking:Qe,capture:null,charSet:null,checked:Pe,cite:null,className:Qe,cols:ae,colSpan:null,content:null,contentEditable:xt,controls:Pe,controlsList:Qe,coords:ae|$s,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Pe,defer:Pe,dir:null,dirName:null,disabled:Pe,download:Gd,draggable:xt,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Pe,formTarget:null,headers:Qe,height:ae,hidden:Gd,high:ae,href:null,hrefLang:null,htmlFor:Qe,httpEquiv:Qe,id:null,imageSizes:null,imageSrcSet:null,inert:Pe,inputMode:null,integrity:null,is:null,isMap:Pe,itemId:null,itemProp:Qe,itemRef:Qe,itemScope:Pe,itemType:Qe,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Pe,low:ae,manifest:null,max:null,maxLength:ae,media:null,method:null,min:null,minLength:ae,multiple:Pe,muted:Pe,name:null,nonce:null,noModule:Pe,noValidate:Pe,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Pe,optimum:ae,pattern:null,ping:Qe,placeholder:null,playsInline:Pe,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Pe,referrerPolicy:null,rel:Qe,required:Pe,reversed:Pe,rows:ae,rowSpan:ae,sandbox:Qe,scope:null,scoped:Pe,seamless:Pe,selected:Pe,shadowRootClonable:Pe,shadowRootDelegatesFocus:Pe,shadowRootMode:null,shape:null,size:ae,sizes:null,slot:null,span:ae,spellCheck:xt,src:null,srcDoc:null,srcLang:null,srcSet:null,start:ae,step:null,style:null,tabIndex:ae,target:null,title:null,translate:null,type:null,typeMustMatch:Pe,useMap:null,value:xt,width:ae,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Qe,axis:null,background:null,bgColor:null,border:ae,borderColor:null,bottomMargin:ae,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Pe,declare:Pe,event:null,face:null,frame:null,frameBorder:null,hSpace:ae,leftMargin:ae,link:null,longDesc:null,lowSrc:null,marginHeight:ae,marginWidth:ae,noResize:Pe,noHref:Pe,noShade:Pe,noWrap:Pe,object:null,profile:null,prompt:null,rev:null,rightMargin:ae,rules:null,scheme:null,scrolling:xt,standby:null,summary:null,text:null,topMargin:ae,valueType:null,version:null,vAlign:null,vLink:null,vSpace:ae,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Pe,disableRemotePlayback:Pe,prefix:null,property:null,results:ae,security:null,unselectable:null},space:"html",transform:Qg}),x0=ui({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:hn,accentHeight:ae,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:ae,amplitude:ae,arabicForm:null,ascent:ae,attributeName:null,attributeType:null,azimuth:ae,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:ae,by:null,calcMode:null,capHeight:ae,className:Qe,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:ae,diffuseConstant:ae,direction:null,display:null,dur:null,divisor:ae,dominantBaseline:null,download:Pe,dx:null,dy:null,edgeMode:null,editable:null,elevation:ae,enableBackground:null,end:null,event:null,exponent:ae,externalResourcesRequired:null,fill:null,fillOpacity:ae,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:$s,g2:$s,glyphName:$s,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:ae,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:ae,horizOriginX:ae,horizOriginY:ae,id:null,ideographic:ae,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:ae,k:ae,k1:ae,k2:ae,k3:ae,k4:ae,kernelMatrix:hn,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:ae,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:ae,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:ae,overlineThickness:ae,paintOrder:null,panose1:null,path:null,pathLength:ae,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Qe,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:ae,pointsAtY:ae,pointsAtZ:ae,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:hn,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:hn,rev:hn,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:hn,requiredFeatures:hn,requiredFonts:hn,requiredFormats:hn,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:ae,specularExponent:ae,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:ae,strikethroughThickness:ae,string:null,stroke:null,strokeDashArray:hn,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:ae,strokeOpacity:ae,strokeWidth:null,style:null,surfaceScale:ae,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:hn,tabIndex:ae,tableValues:null,target:null,targetX:ae,targetY:ae,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:hn,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:ae,underlineThickness:ae,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:ae,values:null,vAlphabetic:ae,vMathematical:ae,vectorEffect:null,vHanging:ae,vIdeographic:ae,version:null,vertAdvY:ae,vertOriginX:ae,vertOriginY:ae,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:ae,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:Wg}),Yg=ui({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,n){return"xlink:"+n.slice(5).toLowerCase()}}),Xg=ui({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:Qg}),Jg=ui({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,n){return"xml:"+n.slice(3).toLowerCase()}}),f0={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},g0=/[A-Z]/g,ip=/-[a-z]/g,j0=/^data[-\w.:]+$/i;function y0(t,n){const r=zd(n);let s=n,i=ln;if(r in t.normal)return t.property[t.normal[r]];if(r.length>4&&r.slice(0,4)==="data"&&j0.test(n)){if(n.charAt(4)==="-"){const l=n.slice(5).replace(ip,k0);s="data"+l.charAt(0).toUpperCase()+l.slice(1)}else{const l=n.slice(4);if(!ip.test(l)){let o=l.replace(g0,b0);o.charAt(0)!=="-"&&(o="-"+o),n="data"+o}}i=Zh}return new i(s,n)}function b0(t){return"-"+t.toLowerCase()}function k0(t){return t.charAt(1).toUpperCase()}const v0=Hg([$g,p0,Yg,Xg,Jg],"html"),eu=Hg([$g,x0,Yg,Xg,Jg],"svg");function w0(t){return t.join(" ").trim()}var tu={},lp=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,N0=/\n/g,S0=/^\s*/,_0=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,T0=/^:\s*/,C0=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,P0=/^[;\s]*/,E0=/^\s+|\s+$/g,R0=`
`,op="/",ap="*",Jr="",M0="comment",I0="declaration";function A0(t,n){if(typeof t!="string")throw new TypeError("First argument must be a string");if(!t)return[];n=n||{};var r=1,s=1;function i(j){var b=j.match(N0);b&&(r+=b.length);var N=j.lastIndexOf(R0);s=~N?j.length-N:s+j.length}function l(){var j={line:r,column:s};return function(b){return b.position=new o(j),d(),b}}function o(j){this.start=j,this.end={line:r,column:s},this.source=n.source}o.prototype.content=t;function a(j){var b=new Error(n.source+":"+r+":"+s+": "+j);if(b.reason=j,b.filename=n.source,b.line=r,b.column=s,b.source=t,!n.silent)throw b}function c(j){var b=j.exec(t);if(b){var N=b[0];return i(N),t=t.slice(N.length),b}}function d(){c(S0)}function u(j){var b;for(j=j||[];b=h();)b!==!1&&j.push(b);return j}function h(){var j=l();if(!(op!=t.charAt(0)||ap!=t.charAt(1))){for(var b=2;Jr!=t.charAt(b)&&(ap!=t.charAt(b)||op!=t.charAt(b+1));)++b;if(b+=2,Jr===t.charAt(b-1))return a("End of comment missing");var N=t.slice(2,b-2);return s+=2,i(N),t=t.slice(b),s+=2,j({type:M0,comment:N})}}function m(){var j=l(),b=c(_0);if(b){if(h(),!c(T0))return a("property missing ':'");var N=c(C0),f=j({type:I0,property:cp(b[0].replace(lp,Jr)),value:N?cp(N[0].replace(lp,Jr)):Jr});return c(P0),f}}function x(){var j=[];u(j);for(var b;b=m();)b!==!1&&(j.push(b),u(j));return j}return d(),x()}function cp(t){return t?t.replace(E0,Jr):Jr}var D0=A0,L0=Ws&&Ws.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(tu,"__esModule",{value:!0});tu.default=O0;const F0=L0(D0);function O0(t,n){let r=null;if(!t||typeof t!="string")return r;const s=(0,F0.default)(t),i=typeof n=="function";return s.forEach(l=>{if(l.type!=="declaration")return;const{property:o,value:a}=l;i?n(o,a,l):a&&(r=r||{},r[o]=a)}),r}var Da={};Object.defineProperty(Da,"__esModule",{value:!0});Da.camelCase=void 0;var q0=/^--[a-zA-Z0-9_-]+$/,B0=/-([a-z])/g,U0=/^[^-]+$/,K0=/^-(webkit|moz|ms|o|khtml)-/,z0=/^-(ms)-/,G0=function(t){return!t||U0.test(t)||q0.test(t)},V0=function(t,n){return n.toUpperCase()},dp=function(t,n){return"".concat(n,"-")},H0=function(t,n){return n===void 0&&(n={}),G0(t)?t:(t=t.toLowerCase(),n.reactCompat?t=t.replace(z0,dp):t=t.replace(K0,dp),t.replace(B0,V0))};Da.camelCase=H0;var $0=Ws&&Ws.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},W0=$0(tu),Q0=Da;function Hd(t,n){var r={};return!t||typeof t!="string"||(0,W0.default)(t,function(s,i){s&&i&&(r[(0,Q0.camelCase)(s,n)]=i)}),r}Hd.default=Hd;var Y0=Hd;const X0=ma(Y0),Zg=ej("end"),nu=ej("start");function ej(t){return n;function n(r){const s=r&&r.position&&r.position[t]||{};if(typeof s.line=="number"&&s.line>0&&typeof s.column=="number"&&s.column>0)return{line:s.line,column:s.column,offset:typeof s.offset=="number"&&s.offset>-1?s.offset:void 0}}}function J0(t){const n=nu(t),r=Zg(t);if(n&&r)return{start:n,end:r}}function Ji(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?hp(t.position):"start"in t||"end"in t?hp(t):"line"in t||"column"in t?$d(t):""}function $d(t){return up(t&&t.line)+":"+up(t&&t.column)}function hp(t){return $d(t&&t.start)+"-"+$d(t&&t.end)}function up(t){return t&&typeof t=="number"?t:1}class Gt extends Error{constructor(n,r,s){super(),typeof r=="string"&&(s=r,r=void 0);let i="",l={},o=!1;if(r&&("line"in r&&"column"in r?l={place:r}:"start"in r&&"end"in r?l={place:r}:"type"in r?l={ancestors:[r],place:r.position}:l={...r}),typeof n=="string"?i=n:!l.cause&&n&&(o=!0,i=n.message,l.cause=n),!l.ruleId&&!l.source&&typeof s=="string"){const c=s.indexOf(":");c===-1?l.ruleId=s:(l.source=s.slice(0,c),l.ruleId=s.slice(c+1))}if(!l.place&&l.ancestors&&l.ancestors){const c=l.ancestors[l.ancestors.length-1];c&&(l.place=c.position)}const a=l.place&&"start"in l.place?l.place.start:l.place;this.ancestors=l.ancestors||void 0,this.cause=l.cause||void 0,this.column=a?a.column:void 0,this.fatal=void 0,this.file="",this.message=i,this.line=a?a.line:void 0,this.name=Ji(l.place)||"1:1",this.place=l.place||void 0,this.reason=this.message,this.ruleId=l.ruleId||void 0,this.source=l.source||void 0,this.stack=o&&l.cause&&typeof l.cause.stack=="string"?l.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}Gt.prototype.file="";Gt.prototype.name="";Gt.prototype.reason="";Gt.prototype.message="";Gt.prototype.stack="";Gt.prototype.column=void 0;Gt.prototype.line=void 0;Gt.prototype.ancestors=void 0;Gt.prototype.cause=void 0;Gt.prototype.fatal=void 0;Gt.prototype.place=void 0;Gt.prototype.ruleId=void 0;Gt.prototype.source=void 0;const ru={}.hasOwnProperty,Z0=new Map,eN=/[A-Z]/g,tN=new Set(["table","tbody","thead","tfoot","tr"]),nN=new Set(["td","th"]),tj="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function rN(t,n){if(!n||n.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const r=n.filePath||void 0;let s;if(n.development){if(typeof n.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");s=hN(r,n.jsxDEV)}else{if(typeof n.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof n.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");s=dN(r,n.jsx,n.jsxs)}const i={Fragment:n.Fragment,ancestors:[],components:n.components||{},create:s,elementAttributeNameCase:n.elementAttributeNameCase||"react",evaluater:n.createEvaluater?n.createEvaluater():void 0,filePath:r,ignoreInvalidStyle:n.ignoreInvalidStyle||!1,passKeys:n.passKeys!==!1,passNode:n.passNode||!1,schema:n.space==="svg"?eu:v0,stylePropertyNameCase:n.stylePropertyNameCase||"dom",tableCellAlignToStyle:n.tableCellAlignToStyle!==!1},l=nj(i,t,void 0);return l&&typeof l!="string"?l:i.create(t,i.Fragment,{children:l||void 0},void 0)}function nj(t,n,r){if(n.type==="element")return sN(t,n,r);if(n.type==="mdxFlowExpression"||n.type==="mdxTextExpression")return iN(t,n);if(n.type==="mdxJsxFlowElement"||n.type==="mdxJsxTextElement")return oN(t,n,r);if(n.type==="mdxjsEsm")return lN(t,n);if(n.type==="root")return aN(t,n,r);if(n.type==="text")return cN(t,n)}function sN(t,n,r){const s=t.schema;let i=s;n.tagName.toLowerCase()==="svg"&&s.space==="html"&&(i=eu,t.schema=i),t.ancestors.push(n);const l=sj(t,n.tagName,!1),o=uN(t,n);let a=iu(t,n);return tN.has(n.tagName)&&(a=a.filter(function(c){return typeof c=="string"?!u0(c):!0})),rj(t,o,l,n),su(o,a),t.ancestors.pop(),t.schema=s,t.create(n,l,o,r)}function iN(t,n){if(n.data&&n.data.estree&&t.evaluater){const s=n.data.estree.body[0];return s.type,t.evaluater.evaluateExpression(s.expression)}wl(t,n.position)}function lN(t,n){if(n.data&&n.data.estree&&t.evaluater)return t.evaluater.evaluateProgram(n.data.estree);wl(t,n.position)}function oN(t,n,r){const s=t.schema;let i=s;n.name==="svg"&&s.space==="html"&&(i=eu,t.schema=i),t.ancestors.push(n);const l=n.name===null?t.Fragment:sj(t,n.name,!0),o=mN(t,n),a=iu(t,n);return rj(t,o,l,n),su(o,a),t.ancestors.pop(),t.schema=s,t.create(n,l,o,r)}function aN(t,n,r){const s={};return su(s,iu(t,n)),t.create(n,t.Fragment,s,r)}function cN(t,n){return n.value}function rj(t,n,r,s){typeof r!="string"&&r!==t.Fragment&&t.passNode&&(n.node=s)}function su(t,n){if(n.length>0){const r=n.length>1?n:n[0];r&&(t.children=r)}}function dN(t,n,r){return s;function s(i,l,o,a){const d=Array.isArray(o.children)?r:n;return a?d(l,o,a):d(l,o)}}function hN(t,n){return r;function r(s,i,l,o){const a=Array.isArray(l.children),c=nu(s);return n(i,l,o,a,{columnNumber:c?c.column-1:void 0,fileName:t,lineNumber:c?c.line:void 0},void 0)}}function uN(t,n){const r={};let s,i;for(i in n.properties)if(i!=="children"&&ru.call(n.properties,i)){const l=pN(t,i,n.properties[i]);if(l){const[o,a]=l;t.tableCellAlignToStyle&&o==="align"&&typeof a=="string"&&nN.has(n.tagName)?s=a:r[o]=a}}if(s){const l=r.style||(r.style={});l[t.stylePropertyNameCase==="css"?"text-align":"textAlign"]=s}return r}function mN(t,n){const r={};for(const s of n.attributes)if(s.type==="mdxJsxExpressionAttribute")if(s.data&&s.data.estree&&t.evaluater){const l=s.data.estree.body[0];l.type;const o=l.expression;o.type;const a=o.properties[0];a.type,Object.assign(r,t.evaluater.evaluateExpression(a.argument))}else wl(t,n.position);else{const i=s.name;let l;if(s.value&&typeof s.value=="object")if(s.value.data&&s.value.data.estree&&t.evaluater){const a=s.value.data.estree.body[0];a.type,l=t.evaluater.evaluateExpression(a.expression)}else wl(t,n.position);else l=s.value===null?!0:s.value;r[i]=l}return r}function iu(t,n){const r=[];let s=-1;const i=t.passKeys?new Map:Z0;for(;++s<n.children.length;){const l=n.children[s];let o;if(t.passKeys){const c=l.type==="element"?l.tagName:l.type==="mdxJsxFlowElement"||l.type==="mdxJsxTextElement"?l.name:void 0;if(c){const d=i.get(c)||0;o=c+"-"+d,i.set(c,d+1)}}const a=nj(t,l,o);a!==void 0&&r.push(a)}return r}function pN(t,n,r){const s=y0(t.schema,n);if(!(r==null||typeof r=="number"&&Number.isNaN(r))){if(Array.isArray(r)&&(r=s.commaSeparated?o0(r):w0(r)),s.property==="style"){let i=typeof r=="object"?r:xN(t,String(r));return t.stylePropertyNameCase==="css"&&(i=fN(i)),["style",i]}return[t.elementAttributeNameCase==="react"&&s.space?f0[s.property]||s.property:s.attribute,r]}}function xN(t,n){try{return X0(n,{reactCompat:!0})}catch(r){if(t.ignoreInvalidStyle)return{};const s=r,i=new Gt("Cannot parse `style` attribute",{ancestors:t.ancestors,cause:s,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw i.file=t.filePath||void 0,i.url=tj+"#cannot-parse-style-attribute",i}}function sj(t,n,r){let s;if(!r)s={type:"Literal",value:n};else if(n.includes(".")){const i=n.split(".");let l=-1,o;for(;++l<i.length;){const a=np(i[l])?{type:"Identifier",name:i[l]}:{type:"Literal",value:i[l]};o=o?{type:"MemberExpression",object:o,property:a,computed:!!(l&&a.type==="Literal"),optional:!1}:a}s=o}else s=np(n)&&!/^[a-z]/.test(n)?{type:"Identifier",name:n}:{type:"Literal",value:n};if(s.type==="Literal"){const i=s.value;return ru.call(t.components,i)?t.components[i]:i}if(t.evaluater)return t.evaluater.evaluateExpression(s);wl(t)}function wl(t,n){const r=new Gt("Cannot handle MDX estrees without `createEvaluater`",{ancestors:t.ancestors,place:n,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw r.file=t.filePath||void 0,r.url=tj+"#cannot-handle-mdx-estrees-without-createevaluater",r}function fN(t){const n={};let r;for(r in t)ru.call(t,r)&&(n[gN(r)]=t[r]);return n}function gN(t){let n=t.replace(eN,jN);return n.slice(0,3)==="ms-"&&(n="-"+n),n}function jN(t){return"-"+t.toLowerCase()}const Sc={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},yN={};function lu(t,n){const r=yN,s=typeof r.includeImageAlt=="boolean"?r.includeImageAlt:!0,i=typeof r.includeHtml=="boolean"?r.includeHtml:!0;return ij(t,s,i)}function ij(t,n,r){if(bN(t)){if("value"in t)return t.type==="html"&&!r?"":t.value;if(n&&"alt"in t&&t.alt)return t.alt;if("children"in t)return mp(t.children,n,r)}return Array.isArray(t)?mp(t,n,r):""}function mp(t,n,r){const s=[];let i=-1;for(;++i<t.length;)s[i]=ij(t[i],n,r);return s.join("")}function bN(t){return!!(t&&typeof t=="object")}const pp=document.createElement("i");function ou(t){const n="&"+t+";";pp.innerHTML=n;const r=pp.textContent;return r.charCodeAt(r.length-1)===59&&t!=="semi"||r===n?!1:r}function xn(t,n,r,s){const i=t.length;let l=0,o;if(n<0?n=-n>i?0:i+n:n=n>i?i:n,r=r>0?r:0,s.length<1e4)o=Array.from(s),o.unshift(n,r),t.splice(...o);else for(r&&t.splice(n,r);l<s.length;)o=s.slice(l,l+1e4),o.unshift(n,0),t.splice(...o),l+=1e4,n+=1e4}function vn(t,n){return t.length>0?(xn(t,t.length,0,n),t):n}const xp={}.hasOwnProperty;function lj(t){const n={};let r=-1;for(;++r<t.length;)kN(n,t[r]);return n}function kN(t,n){let r;for(r in n){const i=(xp.call(t,r)?t[r]:void 0)||(t[r]={}),l=n[r];let o;if(l)for(o in l){xp.call(i,o)||(i[o]=[]);const a=l[o];vN(i[o],Array.isArray(a)?a:a?[a]:[])}}}function vN(t,n){let r=-1;const s=[];for(;++r<n.length;)(n[r].add==="after"?t:s).push(n[r]);xn(t,0,0,s)}function oj(t,n){const r=Number.parseInt(t,n);return r<9||r===11||r>13&&r<32||r>126&&r<160||r>55295&&r<57344||r>64975&&r<65008||(r&65535)===65535||(r&65535)===65534||r>1114111?"":String.fromCodePoint(r)}function On(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const Wt=Br(/[A-Za-z]/),Kt=Br(/[\dA-Za-z]/),wN=Br(/[#-'*+\--9=?A-Z^-~]/);function aa(t){return t!==null&&(t<32||t===127)}const Wd=Br(/\d/),NN=Br(/[\dA-Fa-f]/),SN=Br(/[!-/:-@[-`{-~]/);function ke(t){return t!==null&&t<-2}function We(t){return t!==null&&(t<0||t===32)}function Me(t){return t===-2||t===-1||t===32}const La=Br(new RegExp("\\p{P}|\\p{S}","u")),hs=Br(/\s/);function Br(t){return n;function n(r){return r!==null&&r>-1&&t.test(String.fromCharCode(r))}}function mi(t){const n=[];let r=-1,s=0,i=0;for(;++r<t.length;){const l=t.charCodeAt(r);let o="";if(l===37&&Kt(t.charCodeAt(r+1))&&Kt(t.charCodeAt(r+2)))i=2;else if(l<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(l))||(o=String.fromCharCode(l));else if(l>55295&&l<57344){const a=t.charCodeAt(r+1);l<56320&&a>56319&&a<57344?(o=String.fromCharCode(l,a),i=1):o=""}else o=String.fromCharCode(l);o&&(n.push(t.slice(s,r),encodeURIComponent(o)),s=r+i+1,o=""),i&&(r+=i,i=0)}return n.join("")+t.slice(s)}function De(t,n,r,s){const i=s?s-1:Number.POSITIVE_INFINITY;let l=0;return o;function o(c){return Me(c)?(t.enter(r),a(c)):n(c)}function a(c){return Me(c)&&l++<i?(t.consume(c),a):(t.exit(r),n(c))}}const _N={tokenize:TN};function TN(t){const n=t.attempt(this.parser.constructs.contentInitial,s,i);let r;return n;function s(a){if(a===null){t.consume(a);return}return t.enter("lineEnding"),t.consume(a),t.exit("lineEnding"),De(t,n,"linePrefix")}function i(a){return t.enter("paragraph"),l(a)}function l(a){const c=t.enter("chunkText",{contentType:"text",previous:r});return r&&(r.next=c),r=c,o(a)}function o(a){if(a===null){t.exit("chunkText"),t.exit("paragraph"),t.consume(a);return}return ke(a)?(t.consume(a),t.exit("chunkText"),l):(t.consume(a),o)}}const CN={tokenize:PN},fp={tokenize:EN};function PN(t){const n=this,r=[];let s=0,i,l,o;return a;function a(g){if(s<r.length){const k=r[s];return n.containerState=k[1],t.attempt(k[0].continuation,c,d)(g)}return d(g)}function c(g){if(s++,n.containerState._closeFlow){n.containerState._closeFlow=void 0,i&&p();const k=n.events.length;let S=k,_;for(;S--;)if(n.events[S][0]==="exit"&&n.events[S][1].type==="chunkFlow"){_=n.events[S][1].end;break}f(s);let E=k;for(;E<n.events.length;)n.events[E][1].end={..._},E++;return xn(n.events,S+1,0,n.events.slice(k)),n.events.length=E,d(g)}return a(g)}function d(g){if(s===r.length){if(!i)return m(g);if(i.currentConstruct&&i.currentConstruct.concrete)return j(g);n.interrupt=!!(i.currentConstruct&&!i._gfmTableDynamicInterruptHack)}return n.containerState={},t.check(fp,u,h)(g)}function u(g){return i&&p(),f(s),m(g)}function h(g){return n.parser.lazy[n.now().line]=s!==r.length,o=n.now().offset,j(g)}function m(g){return n.containerState={},t.attempt(fp,x,j)(g)}function x(g){return s++,r.push([n.currentConstruct,n.containerState]),m(g)}function j(g){if(g===null){i&&p(),f(0),t.consume(g);return}return i=i||n.parser.flow(n.now()),t.enter("chunkFlow",{_tokenizer:i,contentType:"flow",previous:l}),b(g)}function b(g){if(g===null){N(t.exit("chunkFlow"),!0),f(0),t.consume(g);return}return ke(g)?(t.consume(g),N(t.exit("chunkFlow")),s=0,n.interrupt=void 0,a):(t.consume(g),b)}function N(g,k){const S=n.sliceStream(g);if(k&&S.push(null),g.previous=l,l&&(l.next=g),l=g,i.defineSkip(g.start),i.write(S),n.parser.lazy[g.start.line]){let _=i.events.length;for(;_--;)if(i.events[_][1].start.offset<o&&(!i.events[_][1].end||i.events[_][1].end.offset>o))return;const E=n.events.length;let D=E,L,T;for(;D--;)if(n.events[D][0]==="exit"&&n.events[D][1].type==="chunkFlow"){if(L){T=n.events[D][1].end;break}L=!0}for(f(s),_=E;_<n.events.length;)n.events[_][1].end={...T},_++;xn(n.events,D+1,0,n.events.slice(E)),n.events.length=_}}function f(g){let k=r.length;for(;k-- >g;){const S=r[k];n.containerState=S[1],S[0].exit.call(n,t)}r.length=g}function p(){i.write([null]),l=void 0,i=void 0,n.containerState._closeFlow=void 0}}function EN(t,n,r){return De(t,t.attempt(this.parser.constructs.document,n,r),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function ni(t){if(t===null||We(t)||hs(t))return 1;if(La(t))return 2}function Fa(t,n,r){const s=[];let i=-1;for(;++i<t.length;){const l=t[i].resolveAll;l&&!s.includes(l)&&(n=l(n,r),s.push(l))}return n}const Qd={name:"attention",resolveAll:RN,tokenize:MN};function RN(t,n){let r=-1,s,i,l,o,a,c,d,u;for(;++r<t.length;)if(t[r][0]==="enter"&&t[r][1].type==="attentionSequence"&&t[r][1]._close){for(s=r;s--;)if(t[s][0]==="exit"&&t[s][1].type==="attentionSequence"&&t[s][1]._open&&n.sliceSerialize(t[s][1]).charCodeAt(0)===n.sliceSerialize(t[r][1]).charCodeAt(0)){if((t[s][1]._close||t[r][1]._open)&&(t[r][1].end.offset-t[r][1].start.offset)%3&&!((t[s][1].end.offset-t[s][1].start.offset+t[r][1].end.offset-t[r][1].start.offset)%3))continue;c=t[s][1].end.offset-t[s][1].start.offset>1&&t[r][1].end.offset-t[r][1].start.offset>1?2:1;const h={...t[s][1].end},m={...t[r][1].start};gp(h,-c),gp(m,c),o={type:c>1?"strongSequence":"emphasisSequence",start:h,end:{...t[s][1].end}},a={type:c>1?"strongSequence":"emphasisSequence",start:{...t[r][1].start},end:m},l={type:c>1?"strongText":"emphasisText",start:{...t[s][1].end},end:{...t[r][1].start}},i={type:c>1?"strong":"emphasis",start:{...o.start},end:{...a.end}},t[s][1].end={...o.start},t[r][1].start={...a.end},d=[],t[s][1].end.offset-t[s][1].start.offset&&(d=vn(d,[["enter",t[s][1],n],["exit",t[s][1],n]])),d=vn(d,[["enter",i,n],["enter",o,n],["exit",o,n],["enter",l,n]]),d=vn(d,Fa(n.parser.constructs.insideSpan.null,t.slice(s+1,r),n)),d=vn(d,[["exit",l,n],["enter",a,n],["exit",a,n],["exit",i,n]]),t[r][1].end.offset-t[r][1].start.offset?(u=2,d=vn(d,[["enter",t[r][1],n],["exit",t[r][1],n]])):u=0,xn(t,s-1,r-s+3,d),r=s+d.length-u-2;break}}for(r=-1;++r<t.length;)t[r][1].type==="attentionSequence"&&(t[r][1].type="data");return t}function MN(t,n){const r=this.parser.constructs.attentionMarkers.null,s=this.previous,i=ni(s);let l;return o;function o(c){return l=c,t.enter("attentionSequence"),a(c)}function a(c){if(c===l)return t.consume(c),a;const d=t.exit("attentionSequence"),u=ni(c),h=!u||u===2&&i||r.includes(c),m=!i||i===2&&u||r.includes(s);return d._open=!!(l===42?h:h&&(i||!m)),d._close=!!(l===42?m:m&&(u||!h)),n(c)}}function gp(t,n){t.column+=n,t.offset+=n,t._bufferIndex+=n}const IN={name:"autolink",tokenize:AN};function AN(t,n,r){let s=0;return i;function i(x){return t.enter("autolink"),t.enter("autolinkMarker"),t.consume(x),t.exit("autolinkMarker"),t.enter("autolinkProtocol"),l}function l(x){return Wt(x)?(t.consume(x),o):x===64?r(x):d(x)}function o(x){return x===43||x===45||x===46||Kt(x)?(s=1,a(x)):d(x)}function a(x){return x===58?(t.consume(x),s=0,c):(x===43||x===45||x===46||Kt(x))&&s++<32?(t.consume(x),a):(s=0,d(x))}function c(x){return x===62?(t.exit("autolinkProtocol"),t.enter("autolinkMarker"),t.consume(x),t.exit("autolinkMarker"),t.exit("autolink"),n):x===null||x===32||x===60||aa(x)?r(x):(t.consume(x),c)}function d(x){return x===64?(t.consume(x),u):wN(x)?(t.consume(x),d):r(x)}function u(x){return Kt(x)?h(x):r(x)}function h(x){return x===46?(t.consume(x),s=0,u):x===62?(t.exit("autolinkProtocol").type="autolinkEmail",t.enter("autolinkMarker"),t.consume(x),t.exit("autolinkMarker"),t.exit("autolink"),n):m(x)}function m(x){if((x===45||Kt(x))&&s++<63){const j=x===45?m:h;return t.consume(x),j}return r(x)}}const Fl={partial:!0,tokenize:DN};function DN(t,n,r){return s;function s(l){return Me(l)?De(t,i,"linePrefix")(l):i(l)}function i(l){return l===null||ke(l)?n(l):r(l)}}const aj={continuation:{tokenize:FN},exit:ON,name:"blockQuote",tokenize:LN};function LN(t,n,r){const s=this;return i;function i(o){if(o===62){const a=s.containerState;return a.open||(t.enter("blockQuote",{_container:!0}),a.open=!0),t.enter("blockQuotePrefix"),t.enter("blockQuoteMarker"),t.consume(o),t.exit("blockQuoteMarker"),l}return r(o)}function l(o){return Me(o)?(t.enter("blockQuotePrefixWhitespace"),t.consume(o),t.exit("blockQuotePrefixWhitespace"),t.exit("blockQuotePrefix"),n):(t.exit("blockQuotePrefix"),n(o))}}function FN(t,n,r){const s=this;return i;function i(o){return Me(o)?De(t,l,"linePrefix",s.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o):l(o)}function l(o){return t.attempt(aj,n,r)(o)}}function ON(t){t.exit("blockQuote")}const cj={name:"characterEscape",tokenize:qN};function qN(t,n,r){return s;function s(l){return t.enter("characterEscape"),t.enter("escapeMarker"),t.consume(l),t.exit("escapeMarker"),i}function i(l){return SN(l)?(t.enter("characterEscapeValue"),t.consume(l),t.exit("characterEscapeValue"),t.exit("characterEscape"),n):r(l)}}const dj={name:"characterReference",tokenize:BN};function BN(t,n,r){const s=this;let i=0,l,o;return a;function a(h){return t.enter("characterReference"),t.enter("characterReferenceMarker"),t.consume(h),t.exit("characterReferenceMarker"),c}function c(h){return h===35?(t.enter("characterReferenceMarkerNumeric"),t.consume(h),t.exit("characterReferenceMarkerNumeric"),d):(t.enter("characterReferenceValue"),l=31,o=Kt,u(h))}function d(h){return h===88||h===120?(t.enter("characterReferenceMarkerHexadecimal"),t.consume(h),t.exit("characterReferenceMarkerHexadecimal"),t.enter("characterReferenceValue"),l=6,o=NN,u):(t.enter("characterReferenceValue"),l=7,o=Wd,u(h))}function u(h){if(h===59&&i){const m=t.exit("characterReferenceValue");return o===Kt&&!ou(s.sliceSerialize(m))?r(h):(t.enter("characterReferenceMarker"),t.consume(h),t.exit("characterReferenceMarker"),t.exit("characterReference"),n)}return o(h)&&i++<l?(t.consume(h),u):r(h)}}const jp={partial:!0,tokenize:KN},yp={concrete:!0,name:"codeFenced",tokenize:UN};function UN(t,n,r){const s=this,i={partial:!0,tokenize:S};let l=0,o=0,a;return c;function c(_){return d(_)}function d(_){const E=s.events[s.events.length-1];return l=E&&E[1].type==="linePrefix"?E[2].sliceSerialize(E[1],!0).length:0,a=_,t.enter("codeFenced"),t.enter("codeFencedFence"),t.enter("codeFencedFenceSequence"),u(_)}function u(_){return _===a?(o++,t.consume(_),u):o<3?r(_):(t.exit("codeFencedFenceSequence"),Me(_)?De(t,h,"whitespace")(_):h(_))}function h(_){return _===null||ke(_)?(t.exit("codeFencedFence"),s.interrupt?n(_):t.check(jp,b,k)(_)):(t.enter("codeFencedFenceInfo"),t.enter("chunkString",{contentType:"string"}),m(_))}function m(_){return _===null||ke(_)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),h(_)):Me(_)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),De(t,x,"whitespace")(_)):_===96&&_===a?r(_):(t.consume(_),m)}function x(_){return _===null||ke(_)?h(_):(t.enter("codeFencedFenceMeta"),t.enter("chunkString",{contentType:"string"}),j(_))}function j(_){return _===null||ke(_)?(t.exit("chunkString"),t.exit("codeFencedFenceMeta"),h(_)):_===96&&_===a?r(_):(t.consume(_),j)}function b(_){return t.attempt(i,k,N)(_)}function N(_){return t.enter("lineEnding"),t.consume(_),t.exit("lineEnding"),f}function f(_){return l>0&&Me(_)?De(t,p,"linePrefix",l+1)(_):p(_)}function p(_){return _===null||ke(_)?t.check(jp,b,k)(_):(t.enter("codeFlowValue"),g(_))}function g(_){return _===null||ke(_)?(t.exit("codeFlowValue"),p(_)):(t.consume(_),g)}function k(_){return t.exit("codeFenced"),n(_)}function S(_,E,D){let L=0;return T;function T(J){return _.enter("lineEnding"),_.consume(J),_.exit("lineEnding"),P}function P(J){return _.enter("codeFencedFence"),Me(J)?De(_,I,"linePrefix",s.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(J):I(J)}function I(J){return J===a?(_.enter("codeFencedFenceSequence"),O(J)):D(J)}function O(J){return J===a?(L++,_.consume(J),O):L>=o?(_.exit("codeFencedFenceSequence"),Me(J)?De(_,X,"whitespace")(J):X(J)):D(J)}function X(J){return J===null||ke(J)?(_.exit("codeFencedFence"),E(J)):D(J)}}}function KN(t,n,r){const s=this;return i;function i(o){return o===null?r(o):(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),l)}function l(o){return s.parser.lazy[s.now().line]?r(o):n(o)}}const _c={name:"codeIndented",tokenize:GN},zN={partial:!0,tokenize:VN};function GN(t,n,r){const s=this;return i;function i(d){return t.enter("codeIndented"),De(t,l,"linePrefix",5)(d)}function l(d){const u=s.events[s.events.length-1];return u&&u[1].type==="linePrefix"&&u[2].sliceSerialize(u[1],!0).length>=4?o(d):r(d)}function o(d){return d===null?c(d):ke(d)?t.attempt(zN,o,c)(d):(t.enter("codeFlowValue"),a(d))}function a(d){return d===null||ke(d)?(t.exit("codeFlowValue"),o(d)):(t.consume(d),a)}function c(d){return t.exit("codeIndented"),n(d)}}function VN(t,n,r){const s=this;return i;function i(o){return s.parser.lazy[s.now().line]?r(o):ke(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),i):De(t,l,"linePrefix",5)(o)}function l(o){const a=s.events[s.events.length-1];return a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?n(o):ke(o)?i(o):r(o)}}const HN={name:"codeText",previous:WN,resolve:$N,tokenize:QN};function $N(t){let n=t.length-4,r=3,s,i;if((t[r][1].type==="lineEnding"||t[r][1].type==="space")&&(t[n][1].type==="lineEnding"||t[n][1].type==="space")){for(s=r;++s<n;)if(t[s][1].type==="codeTextData"){t[r][1].type="codeTextPadding",t[n][1].type="codeTextPadding",r+=2,n-=2;break}}for(s=r-1,n++;++s<=n;)i===void 0?s!==n&&t[s][1].type!=="lineEnding"&&(i=s):(s===n||t[s][1].type==="lineEnding")&&(t[i][1].type="codeTextData",s!==i+2&&(t[i][1].end=t[s-1][1].end,t.splice(i+2,s-i-2),n-=s-i-2,s=i+2),i=void 0);return t}function WN(t){return t!==96||this.events[this.events.length-1][1].type==="characterEscape"}function QN(t,n,r){let s=0,i,l;return o;function o(h){return t.enter("codeText"),t.enter("codeTextSequence"),a(h)}function a(h){return h===96?(t.consume(h),s++,a):(t.exit("codeTextSequence"),c(h))}function c(h){return h===null?r(h):h===32?(t.enter("space"),t.consume(h),t.exit("space"),c):h===96?(l=t.enter("codeTextSequence"),i=0,u(h)):ke(h)?(t.enter("lineEnding"),t.consume(h),t.exit("lineEnding"),c):(t.enter("codeTextData"),d(h))}function d(h){return h===null||h===32||h===96||ke(h)?(t.exit("codeTextData"),c(h)):(t.consume(h),d)}function u(h){return h===96?(t.consume(h),i++,u):i===s?(t.exit("codeTextSequence"),t.exit("codeText"),n(h)):(l.type="codeTextData",d(h))}}class YN{constructor(n){this.left=n?[...n]:[],this.right=[]}get(n){if(n<0||n>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+n+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return n<this.left.length?this.left[n]:this.right[this.right.length-n+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(n,r){const s=r??Number.POSITIVE_INFINITY;return s<this.left.length?this.left.slice(n,s):n>this.left.length?this.right.slice(this.right.length-s+this.left.length,this.right.length-n+this.left.length).reverse():this.left.slice(n).concat(this.right.slice(this.right.length-s+this.left.length).reverse())}splice(n,r,s){const i=r||0;this.setCursor(Math.trunc(n));const l=this.right.splice(this.right.length-i,Number.POSITIVE_INFINITY);return s&&Ii(this.left,s),l.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(n){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(n)}pushMany(n){this.setCursor(Number.POSITIVE_INFINITY),Ii(this.left,n)}unshift(n){this.setCursor(0),this.right.push(n)}unshiftMany(n){this.setCursor(0),Ii(this.right,n.reverse())}setCursor(n){if(!(n===this.left.length||n>this.left.length&&this.right.length===0||n<0&&this.left.length===0))if(n<this.left.length){const r=this.left.splice(n,Number.POSITIVE_INFINITY);Ii(this.right,r.reverse())}else{const r=this.right.splice(this.left.length+this.right.length-n,Number.POSITIVE_INFINITY);Ii(this.left,r.reverse())}}}function Ii(t,n){let r=0;if(n.length<1e4)t.push(...n);else for(;r<n.length;)t.push(...n.slice(r,r+1e4)),r+=1e4}function hj(t){const n={};let r=-1,s,i,l,o,a,c,d;const u=new YN(t);for(;++r<u.length;){for(;r in n;)r=n[r];if(s=u.get(r),r&&s[1].type==="chunkFlow"&&u.get(r-1)[1].type==="listItemPrefix"&&(c=s[1]._tokenizer.events,l=0,l<c.length&&c[l][1].type==="lineEndingBlank"&&(l+=2),l<c.length&&c[l][1].type==="content"))for(;++l<c.length&&c[l][1].type!=="content";)c[l][1].type==="chunkText"&&(c[l][1]._isInFirstContentOfListItem=!0,l++);if(s[0]==="enter")s[1].contentType&&(Object.assign(n,XN(u,r)),r=n[r],d=!0);else if(s[1]._container){for(l=r,i=void 0;l--;)if(o=u.get(l),o[1].type==="lineEnding"||o[1].type==="lineEndingBlank")o[0]==="enter"&&(i&&(u.get(i)[1].type="lineEndingBlank"),o[1].type="lineEnding",i=l);else if(!(o[1].type==="linePrefix"||o[1].type==="listItemIndent"))break;i&&(s[1].end={...u.get(i)[1].start},a=u.slice(i,r),a.unshift(s),u.splice(i,r-i+1,a))}}return xn(t,0,Number.POSITIVE_INFINITY,u.slice(0)),!d}function XN(t,n){const r=t.get(n)[1],s=t.get(n)[2];let i=n-1;const l=[];let o=r._tokenizer;o||(o=s.parser[r.contentType](r.start),r._contentTypeTextTrailing&&(o._contentTypeTextTrailing=!0));const a=o.events,c=[],d={};let u,h,m=-1,x=r,j=0,b=0;const N=[b];for(;x;){for(;t.get(++i)[1]!==x;);l.push(i),x._tokenizer||(u=s.sliceStream(x),x.next||u.push(null),h&&o.defineSkip(x.start),x._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=!0),o.write(u),x._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=void 0)),h=x,x=x.next}for(x=r;++m<a.length;)a[m][0]==="exit"&&a[m-1][0]==="enter"&&a[m][1].type===a[m-1][1].type&&a[m][1].start.line!==a[m][1].end.line&&(b=m+1,N.push(b),x._tokenizer=void 0,x.previous=void 0,x=x.next);for(o.events=[],x?(x._tokenizer=void 0,x.previous=void 0):N.pop(),m=N.length;m--;){const f=a.slice(N[m],N[m+1]),p=l.pop();c.push([p,p+f.length-1]),t.splice(p,2,f)}for(c.reverse(),m=-1;++m<c.length;)d[j+c[m][0]]=j+c[m][1],j+=c[m][1]-c[m][0]-1;return d}const JN={resolve:eS,tokenize:tS},ZN={partial:!0,tokenize:nS};function eS(t){return hj(t),t}function tS(t,n){let r;return s;function s(a){return t.enter("content"),r=t.enter("chunkContent",{contentType:"content"}),i(a)}function i(a){return a===null?l(a):ke(a)?t.check(ZN,o,l)(a):(t.consume(a),i)}function l(a){return t.exit("chunkContent"),t.exit("content"),n(a)}function o(a){return t.consume(a),t.exit("chunkContent"),r.next=t.enter("chunkContent",{contentType:"content",previous:r}),r=r.next,i}}function nS(t,n,r){const s=this;return i;function i(o){return t.exit("chunkContent"),t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),De(t,l,"linePrefix")}function l(o){if(o===null||ke(o))return r(o);const a=s.events[s.events.length-1];return!s.parser.constructs.disable.null.includes("codeIndented")&&a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?n(o):t.interrupt(s.parser.constructs.flow,r,n)(o)}}function uj(t,n,r,s,i,l,o,a,c){const d=c||Number.POSITIVE_INFINITY;let u=0;return h;function h(f){return f===60?(t.enter(s),t.enter(i),t.enter(l),t.consume(f),t.exit(l),m):f===null||f===32||f===41||aa(f)?r(f):(t.enter(s),t.enter(o),t.enter(a),t.enter("chunkString",{contentType:"string"}),b(f))}function m(f){return f===62?(t.enter(l),t.consume(f),t.exit(l),t.exit(i),t.exit(s),n):(t.enter(a),t.enter("chunkString",{contentType:"string"}),x(f))}function x(f){return f===62?(t.exit("chunkString"),t.exit(a),m(f)):f===null||f===60||ke(f)?r(f):(t.consume(f),f===92?j:x)}function j(f){return f===60||f===62||f===92?(t.consume(f),x):x(f)}function b(f){return!u&&(f===null||f===41||We(f))?(t.exit("chunkString"),t.exit(a),t.exit(o),t.exit(s),n(f)):u<d&&f===40?(t.consume(f),u++,b):f===41?(t.consume(f),u--,b):f===null||f===32||f===40||aa(f)?r(f):(t.consume(f),f===92?N:b)}function N(f){return f===40||f===41||f===92?(t.consume(f),b):b(f)}}function mj(t,n,r,s,i,l){const o=this;let a=0,c;return d;function d(x){return t.enter(s),t.enter(i),t.consume(x),t.exit(i),t.enter(l),u}function u(x){return a>999||x===null||x===91||x===93&&!c||x===94&&!a&&"_hiddenFootnoteSupport"in o.parser.constructs?r(x):x===93?(t.exit(l),t.enter(i),t.consume(x),t.exit(i),t.exit(s),n):ke(x)?(t.enter("lineEnding"),t.consume(x),t.exit("lineEnding"),u):(t.enter("chunkString",{contentType:"string"}),h(x))}function h(x){return x===null||x===91||x===93||ke(x)||a++>999?(t.exit("chunkString"),u(x)):(t.consume(x),c||(c=!Me(x)),x===92?m:h)}function m(x){return x===91||x===92||x===93?(t.consume(x),a++,h):h(x)}}function pj(t,n,r,s,i,l){let o;return a;function a(m){return m===34||m===39||m===40?(t.enter(s),t.enter(i),t.consume(m),t.exit(i),o=m===40?41:m,c):r(m)}function c(m){return m===o?(t.enter(i),t.consume(m),t.exit(i),t.exit(s),n):(t.enter(l),d(m))}function d(m){return m===o?(t.exit(l),c(o)):m===null?r(m):ke(m)?(t.enter("lineEnding"),t.consume(m),t.exit("lineEnding"),De(t,d,"linePrefix")):(t.enter("chunkString",{contentType:"string"}),u(m))}function u(m){return m===o||m===null||ke(m)?(t.exit("chunkString"),d(m)):(t.consume(m),m===92?h:u)}function h(m){return m===o||m===92?(t.consume(m),u):u(m)}}function Zi(t,n){let r;return s;function s(i){return ke(i)?(t.enter("lineEnding"),t.consume(i),t.exit("lineEnding"),r=!0,s):Me(i)?De(t,s,r?"linePrefix":"lineSuffix")(i):n(i)}}const rS={name:"definition",tokenize:iS},sS={partial:!0,tokenize:lS};function iS(t,n,r){const s=this;let i;return l;function l(x){return t.enter("definition"),o(x)}function o(x){return mj.call(s,t,a,r,"definitionLabel","definitionLabelMarker","definitionLabelString")(x)}function a(x){return i=On(s.sliceSerialize(s.events[s.events.length-1][1]).slice(1,-1)),x===58?(t.enter("definitionMarker"),t.consume(x),t.exit("definitionMarker"),c):r(x)}function c(x){return We(x)?Zi(t,d)(x):d(x)}function d(x){return uj(t,u,r,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(x)}function u(x){return t.attempt(sS,h,h)(x)}function h(x){return Me(x)?De(t,m,"whitespace")(x):m(x)}function m(x){return x===null||ke(x)?(t.exit("definition"),s.parser.defined.push(i),n(x)):r(x)}}function lS(t,n,r){return s;function s(a){return We(a)?Zi(t,i)(a):r(a)}function i(a){return pj(t,l,r,"definitionTitle","definitionTitleMarker","definitionTitleString")(a)}function l(a){return Me(a)?De(t,o,"whitespace")(a):o(a)}function o(a){return a===null||ke(a)?n(a):r(a)}}const oS={name:"hardBreakEscape",tokenize:aS};function aS(t,n,r){return s;function s(l){return t.enter("hardBreakEscape"),t.consume(l),i}function i(l){return ke(l)?(t.exit("hardBreakEscape"),n(l)):r(l)}}const cS={name:"headingAtx",resolve:dS,tokenize:hS};function dS(t,n){let r=t.length-2,s=3,i,l;return t[s][1].type==="whitespace"&&(s+=2),r-2>s&&t[r][1].type==="whitespace"&&(r-=2),t[r][1].type==="atxHeadingSequence"&&(s===r-1||r-4>s&&t[r-2][1].type==="whitespace")&&(r-=s+1===r?2:4),r>s&&(i={type:"atxHeadingText",start:t[s][1].start,end:t[r][1].end},l={type:"chunkText",start:t[s][1].start,end:t[r][1].end,contentType:"text"},xn(t,s,r-s+1,[["enter",i,n],["enter",l,n],["exit",l,n],["exit",i,n]])),t}function hS(t,n,r){let s=0;return i;function i(u){return t.enter("atxHeading"),l(u)}function l(u){return t.enter("atxHeadingSequence"),o(u)}function o(u){return u===35&&s++<6?(t.consume(u),o):u===null||We(u)?(t.exit("atxHeadingSequence"),a(u)):r(u)}function a(u){return u===35?(t.enter("atxHeadingSequence"),c(u)):u===null||ke(u)?(t.exit("atxHeading"),n(u)):Me(u)?De(t,a,"whitespace")(u):(t.enter("atxHeadingText"),d(u))}function c(u){return u===35?(t.consume(u),c):(t.exit("atxHeadingSequence"),a(u))}function d(u){return u===null||u===35||We(u)?(t.exit("atxHeadingText"),a(u)):(t.consume(u),d)}}const uS=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],bp=["pre","script","style","textarea"],mS={concrete:!0,name:"htmlFlow",resolveTo:fS,tokenize:gS},pS={partial:!0,tokenize:yS},xS={partial:!0,tokenize:jS};function fS(t){let n=t.length;for(;n--&&!(t[n][0]==="enter"&&t[n][1].type==="htmlFlow"););return n>1&&t[n-2][1].type==="linePrefix"&&(t[n][1].start=t[n-2][1].start,t[n+1][1].start=t[n-2][1].start,t.splice(n-2,2)),t}function gS(t,n,r){const s=this;let i,l,o,a,c;return d;function d(w){return u(w)}function u(w){return t.enter("htmlFlow"),t.enter("htmlFlowData"),t.consume(w),h}function h(w){return w===33?(t.consume(w),m):w===47?(t.consume(w),l=!0,b):w===63?(t.consume(w),i=3,s.interrupt?n:v):Wt(w)?(t.consume(w),o=String.fromCharCode(w),N):r(w)}function m(w){return w===45?(t.consume(w),i=2,x):w===91?(t.consume(w),i=5,a=0,j):Wt(w)?(t.consume(w),i=4,s.interrupt?n:v):r(w)}function x(w){return w===45?(t.consume(w),s.interrupt?n:v):r(w)}function j(w){const Z="CDATA[";return w===Z.charCodeAt(a++)?(t.consume(w),a===Z.length?s.interrupt?n:I:j):r(w)}function b(w){return Wt(w)?(t.consume(w),o=String.fromCharCode(w),N):r(w)}function N(w){if(w===null||w===47||w===62||We(w)){const Z=w===47,K=o.toLowerCase();return!Z&&!l&&bp.includes(K)?(i=1,s.interrupt?n(w):I(w)):uS.includes(o.toLowerCase())?(i=6,Z?(t.consume(w),f):s.interrupt?n(w):I(w)):(i=7,s.interrupt&&!s.parser.lazy[s.now().line]?r(w):l?p(w):g(w))}return w===45||Kt(w)?(t.consume(w),o+=String.fromCharCode(w),N):r(w)}function f(w){return w===62?(t.consume(w),s.interrupt?n:I):r(w)}function p(w){return Me(w)?(t.consume(w),p):T(w)}function g(w){return w===47?(t.consume(w),T):w===58||w===95||Wt(w)?(t.consume(w),k):Me(w)?(t.consume(w),g):T(w)}function k(w){return w===45||w===46||w===58||w===95||Kt(w)?(t.consume(w),k):S(w)}function S(w){return w===61?(t.consume(w),_):Me(w)?(t.consume(w),S):g(w)}function _(w){return w===null||w===60||w===61||w===62||w===96?r(w):w===34||w===39?(t.consume(w),c=w,E):Me(w)?(t.consume(w),_):D(w)}function E(w){return w===c?(t.consume(w),c=null,L):w===null||ke(w)?r(w):(t.consume(w),E)}function D(w){return w===null||w===34||w===39||w===47||w===60||w===61||w===62||w===96||We(w)?S(w):(t.consume(w),D)}function L(w){return w===47||w===62||Me(w)?g(w):r(w)}function T(w){return w===62?(t.consume(w),P):r(w)}function P(w){return w===null||ke(w)?I(w):Me(w)?(t.consume(w),P):r(w)}function I(w){return w===45&&i===2?(t.consume(w),re):w===60&&i===1?(t.consume(w),ne):w===62&&i===4?(t.consume(w),F):w===63&&i===3?(t.consume(w),v):w===93&&i===5?(t.consume(w),B):ke(w)&&(i===6||i===7)?(t.exit("htmlFlowData"),t.check(pS,z,O)(w)):w===null||ke(w)?(t.exit("htmlFlowData"),O(w)):(t.consume(w),I)}function O(w){return t.check(xS,X,z)(w)}function X(w){return t.enter("lineEnding"),t.consume(w),t.exit("lineEnding"),J}function J(w){return w===null||ke(w)?O(w):(t.enter("htmlFlowData"),I(w))}function re(w){return w===45?(t.consume(w),v):I(w)}function ne(w){return w===47?(t.consume(w),o="",A):I(w)}function A(w){if(w===62){const Z=o.toLowerCase();return bp.includes(Z)?(t.consume(w),F):I(w)}return Wt(w)&&o.length<8?(t.consume(w),o+=String.fromCharCode(w),A):I(w)}function B(w){return w===93?(t.consume(w),v):I(w)}function v(w){return w===62?(t.consume(w),F):w===45&&i===2?(t.consume(w),v):I(w)}function F(w){return w===null||ke(w)?(t.exit("htmlFlowData"),z(w)):(t.consume(w),F)}function z(w){return t.exit("htmlFlow"),n(w)}}function jS(t,n,r){const s=this;return i;function i(o){return ke(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),l):r(o)}function l(o){return s.parser.lazy[s.now().line]?r(o):n(o)}}function yS(t,n,r){return s;function s(i){return t.enter("lineEnding"),t.consume(i),t.exit("lineEnding"),t.attempt(Fl,n,r)}}const bS={name:"htmlText",tokenize:kS};function kS(t,n,r){const s=this;let i,l,o;return a;function a(v){return t.enter("htmlText"),t.enter("htmlTextData"),t.consume(v),c}function c(v){return v===33?(t.consume(v),d):v===47?(t.consume(v),S):v===63?(t.consume(v),g):Wt(v)?(t.consume(v),D):r(v)}function d(v){return v===45?(t.consume(v),u):v===91?(t.consume(v),l=0,j):Wt(v)?(t.consume(v),p):r(v)}function u(v){return v===45?(t.consume(v),x):r(v)}function h(v){return v===null?r(v):v===45?(t.consume(v),m):ke(v)?(o=h,ne(v)):(t.consume(v),h)}function m(v){return v===45?(t.consume(v),x):h(v)}function x(v){return v===62?re(v):v===45?m(v):h(v)}function j(v){const F="CDATA[";return v===F.charCodeAt(l++)?(t.consume(v),l===F.length?b:j):r(v)}function b(v){return v===null?r(v):v===93?(t.consume(v),N):ke(v)?(o=b,ne(v)):(t.consume(v),b)}function N(v){return v===93?(t.consume(v),f):b(v)}function f(v){return v===62?re(v):v===93?(t.consume(v),f):b(v)}function p(v){return v===null||v===62?re(v):ke(v)?(o=p,ne(v)):(t.consume(v),p)}function g(v){return v===null?r(v):v===63?(t.consume(v),k):ke(v)?(o=g,ne(v)):(t.consume(v),g)}function k(v){return v===62?re(v):g(v)}function S(v){return Wt(v)?(t.consume(v),_):r(v)}function _(v){return v===45||Kt(v)?(t.consume(v),_):E(v)}function E(v){return ke(v)?(o=E,ne(v)):Me(v)?(t.consume(v),E):re(v)}function D(v){return v===45||Kt(v)?(t.consume(v),D):v===47||v===62||We(v)?L(v):r(v)}function L(v){return v===47?(t.consume(v),re):v===58||v===95||Wt(v)?(t.consume(v),T):ke(v)?(o=L,ne(v)):Me(v)?(t.consume(v),L):re(v)}function T(v){return v===45||v===46||v===58||v===95||Kt(v)?(t.consume(v),T):P(v)}function P(v){return v===61?(t.consume(v),I):ke(v)?(o=P,ne(v)):Me(v)?(t.consume(v),P):L(v)}function I(v){return v===null||v===60||v===61||v===62||v===96?r(v):v===34||v===39?(t.consume(v),i=v,O):ke(v)?(o=I,ne(v)):Me(v)?(t.consume(v),I):(t.consume(v),X)}function O(v){return v===i?(t.consume(v),i=void 0,J):v===null?r(v):ke(v)?(o=O,ne(v)):(t.consume(v),O)}function X(v){return v===null||v===34||v===39||v===60||v===61||v===96?r(v):v===47||v===62||We(v)?L(v):(t.consume(v),X)}function J(v){return v===47||v===62||We(v)?L(v):r(v)}function re(v){return v===62?(t.consume(v),t.exit("htmlTextData"),t.exit("htmlText"),n):r(v)}function ne(v){return t.exit("htmlTextData"),t.enter("lineEnding"),t.consume(v),t.exit("lineEnding"),A}function A(v){return Me(v)?De(t,B,"linePrefix",s.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(v):B(v)}function B(v){return t.enter("htmlTextData"),o(v)}}const au={name:"labelEnd",resolveAll:SS,resolveTo:_S,tokenize:TS},vS={tokenize:CS},wS={tokenize:PS},NS={tokenize:ES};function SS(t){let n=-1;const r=[];for(;++n<t.length;){const s=t[n][1];if(r.push(t[n]),s.type==="labelImage"||s.type==="labelLink"||s.type==="labelEnd"){const i=s.type==="labelImage"?4:2;s.type="data",n+=i}}return t.length!==r.length&&xn(t,0,t.length,r),t}function _S(t,n){let r=t.length,s=0,i,l,o,a;for(;r--;)if(i=t[r][1],l){if(i.type==="link"||i.type==="labelLink"&&i._inactive)break;t[r][0]==="enter"&&i.type==="labelLink"&&(i._inactive=!0)}else if(o){if(t[r][0]==="enter"&&(i.type==="labelImage"||i.type==="labelLink")&&!i._balanced&&(l=r,i.type!=="labelLink")){s=2;break}}else i.type==="labelEnd"&&(o=r);const c={type:t[l][1].type==="labelLink"?"link":"image",start:{...t[l][1].start},end:{...t[t.length-1][1].end}},d={type:"label",start:{...t[l][1].start},end:{...t[o][1].end}},u={type:"labelText",start:{...t[l+s+2][1].end},end:{...t[o-2][1].start}};return a=[["enter",c,n],["enter",d,n]],a=vn(a,t.slice(l+1,l+s+3)),a=vn(a,[["enter",u,n]]),a=vn(a,Fa(n.parser.constructs.insideSpan.null,t.slice(l+s+4,o-3),n)),a=vn(a,[["exit",u,n],t[o-2],t[o-1],["exit",d,n]]),a=vn(a,t.slice(o+1)),a=vn(a,[["exit",c,n]]),xn(t,l,t.length,a),t}function TS(t,n,r){const s=this;let i=s.events.length,l,o;for(;i--;)if((s.events[i][1].type==="labelImage"||s.events[i][1].type==="labelLink")&&!s.events[i][1]._balanced){l=s.events[i][1];break}return a;function a(m){return l?l._inactive?h(m):(o=s.parser.defined.includes(On(s.sliceSerialize({start:l.end,end:s.now()}))),t.enter("labelEnd"),t.enter("labelMarker"),t.consume(m),t.exit("labelMarker"),t.exit("labelEnd"),c):r(m)}function c(m){return m===40?t.attempt(vS,u,o?u:h)(m):m===91?t.attempt(wS,u,o?d:h)(m):o?u(m):h(m)}function d(m){return t.attempt(NS,u,h)(m)}function u(m){return n(m)}function h(m){return l._balanced=!0,r(m)}}function CS(t,n,r){return s;function s(h){return t.enter("resource"),t.enter("resourceMarker"),t.consume(h),t.exit("resourceMarker"),i}function i(h){return We(h)?Zi(t,l)(h):l(h)}function l(h){return h===41?u(h):uj(t,o,a,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(h)}function o(h){return We(h)?Zi(t,c)(h):u(h)}function a(h){return r(h)}function c(h){return h===34||h===39||h===40?pj(t,d,r,"resourceTitle","resourceTitleMarker","resourceTitleString")(h):u(h)}function d(h){return We(h)?Zi(t,u)(h):u(h)}function u(h){return h===41?(t.enter("resourceMarker"),t.consume(h),t.exit("resourceMarker"),t.exit("resource"),n):r(h)}}function PS(t,n,r){const s=this;return i;function i(a){return mj.call(s,t,l,o,"reference","referenceMarker","referenceString")(a)}function l(a){return s.parser.defined.includes(On(s.sliceSerialize(s.events[s.events.length-1][1]).slice(1,-1)))?n(a):r(a)}function o(a){return r(a)}}function ES(t,n,r){return s;function s(l){return t.enter("reference"),t.enter("referenceMarker"),t.consume(l),t.exit("referenceMarker"),i}function i(l){return l===93?(t.enter("referenceMarker"),t.consume(l),t.exit("referenceMarker"),t.exit("reference"),n):r(l)}}const RS={name:"labelStartImage",resolveAll:au.resolveAll,tokenize:MS};function MS(t,n,r){const s=this;return i;function i(a){return t.enter("labelImage"),t.enter("labelImageMarker"),t.consume(a),t.exit("labelImageMarker"),l}function l(a){return a===91?(t.enter("labelMarker"),t.consume(a),t.exit("labelMarker"),t.exit("labelImage"),o):r(a)}function o(a){return a===94&&"_hiddenFootnoteSupport"in s.parser.constructs?r(a):n(a)}}const IS={name:"labelStartLink",resolveAll:au.resolveAll,tokenize:AS};function AS(t,n,r){const s=this;return i;function i(o){return t.enter("labelLink"),t.enter("labelMarker"),t.consume(o),t.exit("labelMarker"),t.exit("labelLink"),l}function l(o){return o===94&&"_hiddenFootnoteSupport"in s.parser.constructs?r(o):n(o)}}const Tc={name:"lineEnding",tokenize:DS};function DS(t,n){return r;function r(s){return t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),De(t,n,"linePrefix")}}const Mo={name:"thematicBreak",tokenize:LS};function LS(t,n,r){let s=0,i;return l;function l(d){return t.enter("thematicBreak"),o(d)}function o(d){return i=d,a(d)}function a(d){return d===i?(t.enter("thematicBreakSequence"),c(d)):s>=3&&(d===null||ke(d))?(t.exit("thematicBreak"),n(d)):r(d)}function c(d){return d===i?(t.consume(d),s++,c):(t.exit("thematicBreakSequence"),Me(d)?De(t,a,"whitespace")(d):a(d))}}const Jt={continuation:{tokenize:BS},exit:KS,name:"list",tokenize:qS},FS={partial:!0,tokenize:zS},OS={partial:!0,tokenize:US};function qS(t,n,r){const s=this,i=s.events[s.events.length-1];let l=i&&i[1].type==="linePrefix"?i[2].sliceSerialize(i[1],!0).length:0,o=0;return a;function a(x){const j=s.containerState.type||(x===42||x===43||x===45?"listUnordered":"listOrdered");if(j==="listUnordered"?!s.containerState.marker||x===s.containerState.marker:Wd(x)){if(s.containerState.type||(s.containerState.type=j,t.enter(j,{_container:!0})),j==="listUnordered")return t.enter("listItemPrefix"),x===42||x===45?t.check(Mo,r,d)(x):d(x);if(!s.interrupt||x===49)return t.enter("listItemPrefix"),t.enter("listItemValue"),c(x)}return r(x)}function c(x){return Wd(x)&&++o<10?(t.consume(x),c):(!s.interrupt||o<2)&&(s.containerState.marker?x===s.containerState.marker:x===41||x===46)?(t.exit("listItemValue"),d(x)):r(x)}function d(x){return t.enter("listItemMarker"),t.consume(x),t.exit("listItemMarker"),s.containerState.marker=s.containerState.marker||x,t.check(Fl,s.interrupt?r:u,t.attempt(FS,m,h))}function u(x){return s.containerState.initialBlankLine=!0,l++,m(x)}function h(x){return Me(x)?(t.enter("listItemPrefixWhitespace"),t.consume(x),t.exit("listItemPrefixWhitespace"),m):r(x)}function m(x){return s.containerState.size=l+s.sliceSerialize(t.exit("listItemPrefix"),!0).length,n(x)}}function BS(t,n,r){const s=this;return s.containerState._closeFlow=void 0,t.check(Fl,i,l);function i(a){return s.containerState.furtherBlankLines=s.containerState.furtherBlankLines||s.containerState.initialBlankLine,De(t,n,"listItemIndent",s.containerState.size+1)(a)}function l(a){return s.containerState.furtherBlankLines||!Me(a)?(s.containerState.furtherBlankLines=void 0,s.containerState.initialBlankLine=void 0,o(a)):(s.containerState.furtherBlankLines=void 0,s.containerState.initialBlankLine=void 0,t.attempt(OS,n,o)(a))}function o(a){return s.containerState._closeFlow=!0,s.interrupt=void 0,De(t,t.attempt(Jt,n,r),"linePrefix",s.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a)}}function US(t,n,r){const s=this;return De(t,i,"listItemIndent",s.containerState.size+1);function i(l){const o=s.events[s.events.length-1];return o&&o[1].type==="listItemIndent"&&o[2].sliceSerialize(o[1],!0).length===s.containerState.size?n(l):r(l)}}function KS(t){t.exit(this.containerState.type)}function zS(t,n,r){const s=this;return De(t,i,"listItemPrefixWhitespace",s.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function i(l){const o=s.events[s.events.length-1];return!Me(l)&&o&&o[1].type==="listItemPrefixWhitespace"?n(l):r(l)}}const kp={name:"setextUnderline",resolveTo:GS,tokenize:VS};function GS(t,n){let r=t.length,s,i,l;for(;r--;)if(t[r][0]==="enter"){if(t[r][1].type==="content"){s=r;break}t[r][1].type==="paragraph"&&(i=r)}else t[r][1].type==="content"&&t.splice(r,1),!l&&t[r][1].type==="definition"&&(l=r);const o={type:"setextHeading",start:{...t[s][1].start},end:{...t[t.length-1][1].end}};return t[i][1].type="setextHeadingText",l?(t.splice(i,0,["enter",o,n]),t.splice(l+1,0,["exit",t[s][1],n]),t[s][1].end={...t[l][1].end}):t[s][1]=o,t.push(["exit",o,n]),t}function VS(t,n,r){const s=this;let i;return l;function l(d){let u=s.events.length,h;for(;u--;)if(s.events[u][1].type!=="lineEnding"&&s.events[u][1].type!=="linePrefix"&&s.events[u][1].type!=="content"){h=s.events[u][1].type==="paragraph";break}return!s.parser.lazy[s.now().line]&&(s.interrupt||h)?(t.enter("setextHeadingLine"),i=d,o(d)):r(d)}function o(d){return t.enter("setextHeadingLineSequence"),a(d)}function a(d){return d===i?(t.consume(d),a):(t.exit("setextHeadingLineSequence"),Me(d)?De(t,c,"lineSuffix")(d):c(d))}function c(d){return d===null||ke(d)?(t.exit("setextHeadingLine"),n(d)):r(d)}}const HS={tokenize:$S};function $S(t){const n=this,r=t.attempt(Fl,s,t.attempt(this.parser.constructs.flowInitial,i,De(t,t.attempt(this.parser.constructs.flow,i,t.attempt(JN,i)),"linePrefix")));return r;function s(l){if(l===null){t.consume(l);return}return t.enter("lineEndingBlank"),t.consume(l),t.exit("lineEndingBlank"),n.currentConstruct=void 0,r}function i(l){if(l===null){t.consume(l);return}return t.enter("lineEnding"),t.consume(l),t.exit("lineEnding"),n.currentConstruct=void 0,r}}const WS={resolveAll:fj()},QS=xj("string"),YS=xj("text");function xj(t){return{resolveAll:fj(t==="text"?XS:void 0),tokenize:n};function n(r){const s=this,i=this.parser.constructs[t],l=r.attempt(i,o,a);return o;function o(u){return d(u)?l(u):a(u)}function a(u){if(u===null){r.consume(u);return}return r.enter("data"),r.consume(u),c}function c(u){return d(u)?(r.exit("data"),l(u)):(r.consume(u),c)}function d(u){if(u===null)return!0;const h=i[u];let m=-1;if(h)for(;++m<h.length;){const x=h[m];if(!x.previous||x.previous.call(s,s.previous))return!0}return!1}}}function fj(t){return n;function n(r,s){let i=-1,l;for(;++i<=r.length;)l===void 0?r[i]&&r[i][1].type==="data"&&(l=i,i++):(!r[i]||r[i][1].type!=="data")&&(i!==l+2&&(r[l][1].end=r[i-1][1].end,r.splice(l+2,i-l-2),i=l+2),l=void 0);return t?t(r,s):r}}function XS(t,n){let r=0;for(;++r<=t.length;)if((r===t.length||t[r][1].type==="lineEnding")&&t[r-1][1].type==="data"){const s=t[r-1][1],i=n.sliceStream(s);let l=i.length,o=-1,a=0,c;for(;l--;){const d=i[l];if(typeof d=="string"){for(o=d.length;d.charCodeAt(o-1)===32;)a++,o--;if(o)break;o=-1}else if(d===-2)c=!0,a++;else if(d!==-1){l++;break}}if(n._contentTypeTextTrailing&&r===t.length&&(a=0),a){const d={type:r===t.length||c||a<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:l?o:s.start._bufferIndex+o,_index:s.start._index+l,line:s.end.line,column:s.end.column-a,offset:s.end.offset-a},end:{...s.end}};s.end={...d.start},s.start.offset===s.end.offset?Object.assign(s,d):(t.splice(r,0,["enter",d,n],["exit",d,n]),r+=2)}r++}return t}const JS={42:Jt,43:Jt,45:Jt,48:Jt,49:Jt,50:Jt,51:Jt,52:Jt,53:Jt,54:Jt,55:Jt,56:Jt,57:Jt,62:aj},ZS={91:rS},e_={[-2]:_c,[-1]:_c,32:_c},t_={35:cS,42:Mo,45:[kp,Mo],60:mS,61:kp,95:Mo,96:yp,126:yp},n_={38:dj,92:cj},r_={[-5]:Tc,[-4]:Tc,[-3]:Tc,33:RS,38:dj,42:Qd,60:[IN,bS],91:IS,92:[oS,cj],93:au,95:Qd,96:HN},s_={null:[Qd,WS]},i_={null:[42,95]},l_={null:[]},o_=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:i_,contentInitial:ZS,disable:l_,document:JS,flow:t_,flowInitial:e_,insideSpan:s_,string:n_,text:r_},Symbol.toStringTag,{value:"Module"}));function a_(t,n,r){let s={_bufferIndex:-1,_index:0,line:r&&r.line||1,column:r&&r.column||1,offset:r&&r.offset||0};const i={},l=[];let o=[],a=[];const c={attempt:E(S),check:E(_),consume:p,enter:g,exit:k,interrupt:E(_,{interrupt:!0})},d={code:null,containerState:{},defineSkip:b,events:[],now:j,parser:t,previous:null,sliceSerialize:m,sliceStream:x,write:h};let u=n.tokenize.call(d,c);return n.resolveAll&&l.push(n),d;function h(P){return o=vn(o,P),N(),o[o.length-1]!==null?[]:(D(n,0),d.events=Fa(l,d.events,d),d.events)}function m(P,I){return d_(x(P),I)}function x(P){return c_(o,P)}function j(){const{_bufferIndex:P,_index:I,line:O,column:X,offset:J}=s;return{_bufferIndex:P,_index:I,line:O,column:X,offset:J}}function b(P){i[P.line]=P.column,T()}function N(){let P;for(;s._index<o.length;){const I=o[s._index];if(typeof I=="string")for(P=s._index,s._bufferIndex<0&&(s._bufferIndex=0);s._index===P&&s._bufferIndex<I.length;)f(I.charCodeAt(s._bufferIndex));else f(I)}}function f(P){u=u(P)}function p(P){ke(P)?(s.line++,s.column=1,s.offset+=P===-3?2:1,T()):P!==-1&&(s.column++,s.offset++),s._bufferIndex<0?s._index++:(s._bufferIndex++,s._bufferIndex===o[s._index].length&&(s._bufferIndex=-1,s._index++)),d.previous=P}function g(P,I){const O=I||{};return O.type=P,O.start=j(),d.events.push(["enter",O,d]),a.push(O),O}function k(P){const I=a.pop();return I.end=j(),d.events.push(["exit",I,d]),I}function S(P,I){D(P,I.from)}function _(P,I){I.restore()}function E(P,I){return O;function O(X,J,re){let ne,A,B,v;return Array.isArray(X)?z(X):"tokenize"in X?z([X]):F(X);function F(Q){return Y;function Y(ee){const C=ee!==null&&Q[ee],R=ee!==null&&Q.null,$=[...Array.isArray(C)?C:C?[C]:[],...Array.isArray(R)?R:R?[R]:[]];return z($)(ee)}}function z(Q){return ne=Q,A=0,Q.length===0?re:w(Q[A])}function w(Q){return Y;function Y(ee){return v=L(),B=Q,Q.partial||(d.currentConstruct=Q),Q.name&&d.parser.constructs.disable.null.includes(Q.name)?K():Q.tokenize.call(I?Object.assign(Object.create(d),I):d,c,Z,K)(ee)}}function Z(Q){return P(B,v),J}function K(Q){return v.restore(),++A<ne.length?w(ne[A]):re}}}function D(P,I){P.resolveAll&&!l.includes(P)&&l.push(P),P.resolve&&xn(d.events,I,d.events.length-I,P.resolve(d.events.slice(I),d)),P.resolveTo&&(d.events=P.resolveTo(d.events,d))}function L(){const P=j(),I=d.previous,O=d.currentConstruct,X=d.events.length,J=Array.from(a);return{from:X,restore:re};function re(){s=P,d.previous=I,d.currentConstruct=O,d.events.length=X,a=J,T()}}function T(){s.line in i&&s.column<2&&(s.column=i[s.line],s.offset+=i[s.line]-1)}}function c_(t,n){const r=n.start._index,s=n.start._bufferIndex,i=n.end._index,l=n.end._bufferIndex;let o;if(r===i)o=[t[r].slice(s,l)];else{if(o=t.slice(r,i),s>-1){const a=o[0];typeof a=="string"?o[0]=a.slice(s):o.shift()}l>0&&o.push(t[i].slice(0,l))}return o}function d_(t,n){let r=-1;const s=[];let i;for(;++r<t.length;){const l=t[r];let o;if(typeof l=="string")o=l;else switch(l){case-5:{o="\r";break}case-4:{o=`
`;break}case-3:{o=`\r
`;break}case-2:{o=n?" ":"	";break}case-1:{if(!n&&i)continue;o=" ";break}default:o=String.fromCharCode(l)}i=l===-2,s.push(o)}return s.join("")}function h_(t){const s={constructs:lj([o_,...(t||{}).extensions||[]]),content:i(_N),defined:[],document:i(CN),flow:i(HS),lazy:{},string:i(QS),text:i(YS)};return s;function i(l){return o;function o(a){return a_(s,l,a)}}}function u_(t){for(;!hj(t););return t}const vp=/[\0\t\n\r]/g;function m_(){let t=1,n="",r=!0,s;return i;function i(l,o,a){const c=[];let d,u,h,m,x;for(l=n+(typeof l=="string"?l.toString():new TextDecoder(o||void 0).decode(l)),h=0,n="",r&&(l.charCodeAt(0)===65279&&h++,r=void 0);h<l.length;){if(vp.lastIndex=h,d=vp.exec(l),m=d&&d.index!==void 0?d.index:l.length,x=l.charCodeAt(m),!d){n=l.slice(h);break}if(x===10&&h===m&&s)c.push(-3),s=void 0;else switch(s&&(c.push(-5),s=void 0),h<m&&(c.push(l.slice(h,m)),t+=m-h),x){case 0:{c.push(65533),t++;break}case 9:{for(u=Math.ceil(t/4)*4,c.push(-2);t++<u;)c.push(-1);break}case 10:{c.push(-4),t=1;break}default:s=!0,t=1}h=m+1}return a&&(s&&c.push(-5),n&&c.push(n),c.push(null)),c}}const p_=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function x_(t){return t.replace(p_,f_)}function f_(t,n,r){if(n)return n;if(r.charCodeAt(0)===35){const i=r.charCodeAt(1),l=i===120||i===88;return oj(r.slice(l?2:1),l?16:10)}return ou(r)||t}const gj={}.hasOwnProperty;function g_(t,n,r){return n&&typeof n=="object"&&(r=n,n=void 0),j_(r)(u_(h_(r).document().write(m_()(t,n,!0))))}function j_(t){const n={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:l(ve),autolinkProtocol:L,autolinkEmail:L,atxHeading:l(H),blockQuote:l(R),characterEscape:L,characterReference:L,codeFenced:l($),codeFencedFenceInfo:o,codeFencedFenceMeta:o,codeIndented:l($,o),codeText:l(ie,o),codeTextData:L,data:L,codeFlowValue:L,definition:l(ce),definitionDestinationString:o,definitionLabelString:o,definitionTitleString:o,emphasis:l(q),hardBreakEscape:l(le),hardBreakTrailing:l(le),htmlFlow:l(me,o),htmlFlowData:L,htmlText:l(me,o),htmlTextData:L,image:l(ge),label:o,link:l(ve),listItem:l(Re),listItemValue:m,listOrdered:l(Se,h),listUnordered:l(Se),paragraph:l(qe),reference:w,referenceString:o,resourceDestinationString:o,resourceTitleString:o,setextHeading:l(H),strong:l(Ke),thematicBreak:l(ze)},exit:{atxHeading:c(),atxHeadingSequence:S,autolink:c(),autolinkEmail:C,autolinkProtocol:ee,blockQuote:c(),characterEscapeValue:T,characterReferenceMarkerHexadecimal:K,characterReferenceMarkerNumeric:K,characterReferenceValue:Q,characterReference:Y,codeFenced:c(N),codeFencedFence:b,codeFencedFenceInfo:x,codeFencedFenceMeta:j,codeFlowValue:T,codeIndented:c(f),codeText:c(J),codeTextData:T,data:T,definition:c(),definitionDestinationString:k,definitionLabelString:p,definitionTitleString:g,emphasis:c(),hardBreakEscape:c(I),hardBreakTrailing:c(I),htmlFlow:c(O),htmlFlowData:T,htmlText:c(X),htmlTextData:T,image:c(ne),label:B,labelText:A,lineEnding:P,link:c(re),listItem:c(),listOrdered:c(),listUnordered:c(),paragraph:c(),referenceString:Z,resourceDestinationString:v,resourceTitleString:F,resource:z,setextHeading:c(D),setextHeadingLineSequence:E,setextHeadingText:_,strong:c(),thematicBreak:c()}};jj(n,(t||{}).mdastExtensions||[]);const r={};return s;function s(G){let se={type:"root",children:[]};const he={stack:[se],tokenStack:[],config:n,enter:a,exit:d,buffer:o,resume:u,data:r},je=[];let Ne=-1;for(;++Ne<G.length;)if(G[Ne][1].type==="listOrdered"||G[Ne][1].type==="listUnordered")if(G[Ne][0]==="enter")je.push(Ne);else{const tt=je.pop();Ne=i(G,tt,Ne)}for(Ne=-1;++Ne<G.length;){const tt=n[G[Ne][0]];gj.call(tt,G[Ne][1].type)&&tt[G[Ne][1].type].call(Object.assign({sliceSerialize:G[Ne][2].sliceSerialize},he),G[Ne][1])}if(he.tokenStack.length>0){const tt=he.tokenStack[he.tokenStack.length-1];(tt[1]||wp).call(he,void 0,tt[0])}for(se.position={start:xr(G.length>0?G[0][1].start:{line:1,column:1,offset:0}),end:xr(G.length>0?G[G.length-2][1].end:{line:1,column:1,offset:0})},Ne=-1;++Ne<n.transforms.length;)se=n.transforms[Ne](se)||se;return se}function i(G,se,he){let je=se-1,Ne=-1,tt=!1,Nt,jt,Vt,on;for(;++je<=he;){const st=G[je];switch(st[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{st[0]==="enter"?Ne++:Ne--,on=void 0;break}case"lineEndingBlank":{st[0]==="enter"&&(Nt&&!on&&!Ne&&!Vt&&(Vt=je),on=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:on=void 0}if(!Ne&&st[0]==="enter"&&st[1].type==="listItemPrefix"||Ne===-1&&st[0]==="exit"&&(st[1].type==="listUnordered"||st[1].type==="listOrdered")){if(Nt){let mt=je;for(jt=void 0;mt--;){const yt=G[mt];if(yt[1].type==="lineEnding"||yt[1].type==="lineEndingBlank"){if(yt[0]==="exit")continue;jt&&(G[jt][1].type="lineEndingBlank",tt=!0),yt[1].type="lineEnding",jt=mt}else if(!(yt[1].type==="linePrefix"||yt[1].type==="blockQuotePrefix"||yt[1].type==="blockQuotePrefixWhitespace"||yt[1].type==="blockQuoteMarker"||yt[1].type==="listItemIndent"))break}Vt&&(!jt||Vt<jt)&&(Nt._spread=!0),Nt.end=Object.assign({},jt?G[jt][1].start:st[1].end),G.splice(jt||je,0,["exit",Nt,st[2]]),je++,he++}if(st[1].type==="listItemPrefix"){const mt={type:"listItem",_spread:!1,start:Object.assign({},st[1].start),end:void 0};Nt=mt,G.splice(je,0,["enter",mt,st[2]]),je++,he++,Vt=void 0,on=!0}}}return G[se][1]._spread=tt,he}function l(G,se){return he;function he(je){a.call(this,G(je),je),se&&se.call(this,je)}}function o(){this.stack.push({type:"fragment",children:[]})}function a(G,se,he){this.stack[this.stack.length-1].children.push(G),this.stack.push(G),this.tokenStack.push([se,he||void 0]),G.position={start:xr(se.start),end:void 0}}function c(G){return se;function se(he){G&&G.call(this,he),d.call(this,he)}}function d(G,se){const he=this.stack.pop(),je=this.tokenStack.pop();if(je)je[0].type!==G.type&&(se?se.call(this,G,je[0]):(je[1]||wp).call(this,G,je[0]));else throw new Error("Cannot close `"+G.type+"` ("+Ji({start:G.start,end:G.end})+"): its not open");he.position.end=xr(G.end)}function u(){return lu(this.stack.pop())}function h(){this.data.expectingFirstListItemValue=!0}function m(G){if(this.data.expectingFirstListItemValue){const se=this.stack[this.stack.length-2];se.start=Number.parseInt(this.sliceSerialize(G),10),this.data.expectingFirstListItemValue=void 0}}function x(){const G=this.resume(),se=this.stack[this.stack.length-1];se.lang=G}function j(){const G=this.resume(),se=this.stack[this.stack.length-1];se.meta=G}function b(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function N(){const G=this.resume(),se=this.stack[this.stack.length-1];se.value=G.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function f(){const G=this.resume(),se=this.stack[this.stack.length-1];se.value=G.replace(/(\r?\n|\r)$/g,"")}function p(G){const se=this.resume(),he=this.stack[this.stack.length-1];he.label=se,he.identifier=On(this.sliceSerialize(G)).toLowerCase()}function g(){const G=this.resume(),se=this.stack[this.stack.length-1];se.title=G}function k(){const G=this.resume(),se=this.stack[this.stack.length-1];se.url=G}function S(G){const se=this.stack[this.stack.length-1];if(!se.depth){const he=this.sliceSerialize(G).length;se.depth=he}}function _(){this.data.setextHeadingSlurpLineEnding=!0}function E(G){const se=this.stack[this.stack.length-1];se.depth=this.sliceSerialize(G).codePointAt(0)===61?1:2}function D(){this.data.setextHeadingSlurpLineEnding=void 0}function L(G){const he=this.stack[this.stack.length-1].children;let je=he[he.length-1];(!je||je.type!=="text")&&(je=et(),je.position={start:xr(G.start),end:void 0},he.push(je)),this.stack.push(je)}function T(G){const se=this.stack.pop();se.value+=this.sliceSerialize(G),se.position.end=xr(G.end)}function P(G){const se=this.stack[this.stack.length-1];if(this.data.atHardBreak){const he=se.children[se.children.length-1];he.position.end=xr(G.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&n.canContainEols.includes(se.type)&&(L.call(this,G),T.call(this,G))}function I(){this.data.atHardBreak=!0}function O(){const G=this.resume(),se=this.stack[this.stack.length-1];se.value=G}function X(){const G=this.resume(),se=this.stack[this.stack.length-1];se.value=G}function J(){const G=this.resume(),se=this.stack[this.stack.length-1];se.value=G}function re(){const G=this.stack[this.stack.length-1];if(this.data.inReference){const se=this.data.referenceType||"shortcut";G.type+="Reference",G.referenceType=se,delete G.url,delete G.title}else delete G.identifier,delete G.label;this.data.referenceType=void 0}function ne(){const G=this.stack[this.stack.length-1];if(this.data.inReference){const se=this.data.referenceType||"shortcut";G.type+="Reference",G.referenceType=se,delete G.url,delete G.title}else delete G.identifier,delete G.label;this.data.referenceType=void 0}function A(G){const se=this.sliceSerialize(G),he=this.stack[this.stack.length-2];he.label=x_(se),he.identifier=On(se).toLowerCase()}function B(){const G=this.stack[this.stack.length-1],se=this.resume(),he=this.stack[this.stack.length-1];if(this.data.inReference=!0,he.type==="link"){const je=G.children;he.children=je}else he.alt=se}function v(){const G=this.resume(),se=this.stack[this.stack.length-1];se.url=G}function F(){const G=this.resume(),se=this.stack[this.stack.length-1];se.title=G}function z(){this.data.inReference=void 0}function w(){this.data.referenceType="collapsed"}function Z(G){const se=this.resume(),he=this.stack[this.stack.length-1];he.label=se,he.identifier=On(this.sliceSerialize(G)).toLowerCase(),this.data.referenceType="full"}function K(G){this.data.characterReferenceType=G.type}function Q(G){const se=this.sliceSerialize(G),he=this.data.characterReferenceType;let je;he?(je=oj(se,he==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):je=ou(se);const Ne=this.stack[this.stack.length-1];Ne.value+=je}function Y(G){const se=this.stack.pop();se.position.end=xr(G.end)}function ee(G){T.call(this,G);const se=this.stack[this.stack.length-1];se.url=this.sliceSerialize(G)}function C(G){T.call(this,G);const se=this.stack[this.stack.length-1];se.url="mailto:"+this.sliceSerialize(G)}function R(){return{type:"blockquote",children:[]}}function $(){return{type:"code",lang:null,meta:null,value:""}}function ie(){return{type:"inlineCode",value:""}}function ce(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function q(){return{type:"emphasis",children:[]}}function H(){return{type:"heading",depth:0,children:[]}}function le(){return{type:"break"}}function me(){return{type:"html",value:""}}function ge(){return{type:"image",title:null,url:"",alt:null}}function ve(){return{type:"link",title:null,url:"",children:[]}}function Se(G){return{type:"list",ordered:G.type==="listOrdered",start:null,spread:G._spread,children:[]}}function Re(G){return{type:"listItem",spread:G._spread,checked:null,children:[]}}function qe(){return{type:"paragraph",children:[]}}function Ke(){return{type:"strong",children:[]}}function et(){return{type:"text",value:""}}function ze(){return{type:"thematicBreak"}}}function xr(t){return{line:t.line,column:t.column,offset:t.offset}}function jj(t,n){let r=-1;for(;++r<n.length;){const s=n[r];Array.isArray(s)?jj(t,s):y_(t,s)}}function y_(t,n){let r;for(r in n)if(gj.call(n,r))switch(r){case"canContainEols":{const s=n[r];s&&t[r].push(...s);break}case"transforms":{const s=n[r];s&&t[r].push(...s);break}case"enter":case"exit":{const s=n[r];s&&Object.assign(t[r],s);break}}}function wp(t,n){throw t?new Error("Cannot close `"+t.type+"` ("+Ji({start:t.start,end:t.end})+"): a different token (`"+n.type+"`, "+Ji({start:n.start,end:n.end})+") is open"):new Error("Cannot close document, a token (`"+n.type+"`, "+Ji({start:n.start,end:n.end})+") is still open")}function b_(t){const n=this;n.parser=r;function r(s){return g_(s,{...n.data("settings"),...t,extensions:n.data("micromarkExtensions")||[],mdastExtensions:n.data("fromMarkdownExtensions")||[]})}}function k_(t,n){const r={type:"element",tagName:"blockquote",properties:{},children:t.wrap(t.all(n),!0)};return t.patch(n,r),t.applyData(n,r)}function v_(t,n){const r={type:"element",tagName:"br",properties:{},children:[]};return t.patch(n,r),[t.applyData(n,r),{type:"text",value:`
`}]}function w_(t,n){const r=n.value?n.value+`
`:"",s={},i=n.lang?n.lang.split(/\s+/):[];i.length>0&&(s.className=["language-"+i[0]]);let l={type:"element",tagName:"code",properties:s,children:[{type:"text",value:r}]};return n.meta&&(l.data={meta:n.meta}),t.patch(n,l),l=t.applyData(n,l),l={type:"element",tagName:"pre",properties:{},children:[l]},t.patch(n,l),l}function N_(t,n){const r={type:"element",tagName:"del",properties:{},children:t.all(n)};return t.patch(n,r),t.applyData(n,r)}function S_(t,n){const r={type:"element",tagName:"em",properties:{},children:t.all(n)};return t.patch(n,r),t.applyData(n,r)}function __(t,n){const r=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",s=String(n.identifier).toUpperCase(),i=mi(s.toLowerCase()),l=t.footnoteOrder.indexOf(s);let o,a=t.footnoteCounts.get(s);a===void 0?(a=0,t.footnoteOrder.push(s),o=t.footnoteOrder.length):o=l+1,a+=1,t.footnoteCounts.set(s,a);const c={type:"element",tagName:"a",properties:{href:"#"+r+"fn-"+i,id:r+"fnref-"+i+(a>1?"-"+a:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(o)}]};t.patch(n,c);const d={type:"element",tagName:"sup",properties:{},children:[c]};return t.patch(n,d),t.applyData(n,d)}function T_(t,n){const r={type:"element",tagName:"h"+n.depth,properties:{},children:t.all(n)};return t.patch(n,r),t.applyData(n,r)}function C_(t,n){if(t.options.allowDangerousHtml){const r={type:"raw",value:n.value};return t.patch(n,r),t.applyData(n,r)}}function yj(t,n){const r=n.referenceType;let s="]";if(r==="collapsed"?s+="[]":r==="full"&&(s+="["+(n.label||n.identifier)+"]"),n.type==="imageReference")return[{type:"text",value:"!["+n.alt+s}];const i=t.all(n),l=i[0];l&&l.type==="text"?l.value="["+l.value:i.unshift({type:"text",value:"["});const o=i[i.length-1];return o&&o.type==="text"?o.value+=s:i.push({type:"text",value:s}),i}function P_(t,n){const r=String(n.identifier).toUpperCase(),s=t.definitionById.get(r);if(!s)return yj(t,n);const i={src:mi(s.url||""),alt:n.alt};s.title!==null&&s.title!==void 0&&(i.title=s.title);const l={type:"element",tagName:"img",properties:i,children:[]};return t.patch(n,l),t.applyData(n,l)}function E_(t,n){const r={src:mi(n.url)};n.alt!==null&&n.alt!==void 0&&(r.alt=n.alt),n.title!==null&&n.title!==void 0&&(r.title=n.title);const s={type:"element",tagName:"img",properties:r,children:[]};return t.patch(n,s),t.applyData(n,s)}function R_(t,n){const r={type:"text",value:n.value.replace(/\r?\n|\r/g," ")};t.patch(n,r);const s={type:"element",tagName:"code",properties:{},children:[r]};return t.patch(n,s),t.applyData(n,s)}function M_(t,n){const r=String(n.identifier).toUpperCase(),s=t.definitionById.get(r);if(!s)return yj(t,n);const i={href:mi(s.url||"")};s.title!==null&&s.title!==void 0&&(i.title=s.title);const l={type:"element",tagName:"a",properties:i,children:t.all(n)};return t.patch(n,l),t.applyData(n,l)}function I_(t,n){const r={href:mi(n.url)};n.title!==null&&n.title!==void 0&&(r.title=n.title);const s={type:"element",tagName:"a",properties:r,children:t.all(n)};return t.patch(n,s),t.applyData(n,s)}function A_(t,n,r){const s=t.all(n),i=r?D_(r):bj(n),l={},o=[];if(typeof n.checked=="boolean"){const u=s[0];let h;u&&u.type==="element"&&u.tagName==="p"?h=u:(h={type:"element",tagName:"p",properties:{},children:[]},s.unshift(h)),h.children.length>0&&h.children.unshift({type:"text",value:" "}),h.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:n.checked,disabled:!0},children:[]}),l.className=["task-list-item"]}let a=-1;for(;++a<s.length;){const u=s[a];(i||a!==0||u.type!=="element"||u.tagName!=="p")&&o.push({type:"text",value:`
`}),u.type==="element"&&u.tagName==="p"&&!i?o.push(...u.children):o.push(u)}const c=s[s.length-1];c&&(i||c.type!=="element"||c.tagName!=="p")&&o.push({type:"text",value:`
`});const d={type:"element",tagName:"li",properties:l,children:o};return t.patch(n,d),t.applyData(n,d)}function D_(t){let n=!1;if(t.type==="list"){n=t.spread||!1;const r=t.children;let s=-1;for(;!n&&++s<r.length;)n=bj(r[s])}return n}function bj(t){const n=t.spread;return n??t.children.length>1}function L_(t,n){const r={},s=t.all(n);let i=-1;for(typeof n.start=="number"&&n.start!==1&&(r.start=n.start);++i<s.length;){const o=s[i];if(o.type==="element"&&o.tagName==="li"&&o.properties&&Array.isArray(o.properties.className)&&o.properties.className.includes("task-list-item")){r.className=["contains-task-list"];break}}const l={type:"element",tagName:n.ordered?"ol":"ul",properties:r,children:t.wrap(s,!0)};return t.patch(n,l),t.applyData(n,l)}function F_(t,n){const r={type:"element",tagName:"p",properties:{},children:t.all(n)};return t.patch(n,r),t.applyData(n,r)}function O_(t,n){const r={type:"root",children:t.wrap(t.all(n))};return t.patch(n,r),t.applyData(n,r)}function q_(t,n){const r={type:"element",tagName:"strong",properties:{},children:t.all(n)};return t.patch(n,r),t.applyData(n,r)}function B_(t,n){const r=t.all(n),s=r.shift(),i=[];if(s){const o={type:"element",tagName:"thead",properties:{},children:t.wrap([s],!0)};t.patch(n.children[0],o),i.push(o)}if(r.length>0){const o={type:"element",tagName:"tbody",properties:{},children:t.wrap(r,!0)},a=nu(n.children[1]),c=Zg(n.children[n.children.length-1]);a&&c&&(o.position={start:a,end:c}),i.push(o)}const l={type:"element",tagName:"table",properties:{},children:t.wrap(i,!0)};return t.patch(n,l),t.applyData(n,l)}function U_(t,n,r){const s=r?r.children:void 0,l=(s?s.indexOf(n):1)===0?"th":"td",o=r&&r.type==="table"?r.align:void 0,a=o?o.length:n.children.length;let c=-1;const d=[];for(;++c<a;){const h=n.children[c],m={},x=o?o[c]:void 0;x&&(m.align=x);let j={type:"element",tagName:l,properties:m,children:[]};h&&(j.children=t.all(h),t.patch(h,j),j=t.applyData(h,j)),d.push(j)}const u={type:"element",tagName:"tr",properties:{},children:t.wrap(d,!0)};return t.patch(n,u),t.applyData(n,u)}function K_(t,n){const r={type:"element",tagName:"td",properties:{},children:t.all(n)};return t.patch(n,r),t.applyData(n,r)}const Np=9,Sp=32;function z_(t){const n=String(t),r=/\r?\n|\r/g;let s=r.exec(n),i=0;const l=[];for(;s;)l.push(_p(n.slice(i,s.index),i>0,!0),s[0]),i=s.index+s[0].length,s=r.exec(n);return l.push(_p(n.slice(i),i>0,!1)),l.join("")}function _p(t,n,r){let s=0,i=t.length;if(n){let l=t.codePointAt(s);for(;l===Np||l===Sp;)s++,l=t.codePointAt(s)}if(r){let l=t.codePointAt(i-1);for(;l===Np||l===Sp;)i--,l=t.codePointAt(i-1)}return i>s?t.slice(s,i):""}function G_(t,n){const r={type:"text",value:z_(String(n.value))};return t.patch(n,r),t.applyData(n,r)}function V_(t,n){const r={type:"element",tagName:"hr",properties:{},children:[]};return t.patch(n,r),t.applyData(n,r)}const H_={blockquote:k_,break:v_,code:w_,delete:N_,emphasis:S_,footnoteReference:__,heading:T_,html:C_,imageReference:P_,image:E_,inlineCode:R_,linkReference:M_,link:I_,listItem:A_,list:L_,paragraph:F_,root:O_,strong:q_,table:B_,tableCell:K_,tableRow:U_,text:G_,thematicBreak:V_,toml:mo,yaml:mo,definition:mo,footnoteDefinition:mo};function mo(){}const kj=-1,Oa=0,el=1,ca=2,cu=3,du=4,hu=5,uu=6,vj=7,wj=8,Tp=typeof self=="object"?self:globalThis,$_=(t,n)=>{const r=(i,l)=>(t.set(l,i),i),s=i=>{if(t.has(i))return t.get(i);const[l,o]=n[i];switch(l){case Oa:case kj:return r(o,i);case el:{const a=r([],i);for(const c of o)a.push(s(c));return a}case ca:{const a=r({},i);for(const[c,d]of o)a[s(c)]=s(d);return a}case cu:return r(new Date(o),i);case du:{const{source:a,flags:c}=o;return r(new RegExp(a,c),i)}case hu:{const a=r(new Map,i);for(const[c,d]of o)a.set(s(c),s(d));return a}case uu:{const a=r(new Set,i);for(const c of o)a.add(s(c));return a}case vj:{const{name:a,message:c}=o;return r(new Tp[a](c),i)}case wj:return r(BigInt(o),i);case"BigInt":return r(Object(BigInt(o)),i);case"ArrayBuffer":return r(new Uint8Array(o).buffer,o);case"DataView":{const{buffer:a}=new Uint8Array(o);return r(new DataView(a),o)}}return r(new Tp[l](o),i)};return s},Cp=t=>$_(new Map,t)(0),Ns="",{toString:W_}={},{keys:Q_}=Object,Ai=t=>{const n=typeof t;if(n!=="object"||!t)return[Oa,n];const r=W_.call(t).slice(8,-1);switch(r){case"Array":return[el,Ns];case"Object":return[ca,Ns];case"Date":return[cu,Ns];case"RegExp":return[du,Ns];case"Map":return[hu,Ns];case"Set":return[uu,Ns];case"DataView":return[el,r]}return r.includes("Array")?[el,r]:r.includes("Error")?[vj,r]:[ca,r]},po=([t,n])=>t===Oa&&(n==="function"||n==="symbol"),Y_=(t,n,r,s)=>{const i=(o,a)=>{const c=s.push(o)-1;return r.set(a,c),c},l=o=>{if(r.has(o))return r.get(o);let[a,c]=Ai(o);switch(a){case Oa:{let u=o;switch(c){case"bigint":a=wj,u=o.toString();break;case"function":case"symbol":if(t)throw new TypeError("unable to serialize "+c);u=null;break;case"undefined":return i([kj],o)}return i([a,u],o)}case el:{if(c){let m=o;return c==="DataView"?m=new Uint8Array(o.buffer):c==="ArrayBuffer"&&(m=new Uint8Array(o)),i([c,[...m]],o)}const u=[],h=i([a,u],o);for(const m of o)u.push(l(m));return h}case ca:{if(c)switch(c){case"BigInt":return i([c,o.toString()],o);case"Boolean":case"Number":case"String":return i([c,o.valueOf()],o)}if(n&&"toJSON"in o)return l(o.toJSON());const u=[],h=i([a,u],o);for(const m of Q_(o))(t||!po(Ai(o[m])))&&u.push([l(m),l(o[m])]);return h}case cu:return i([a,o.toISOString()],o);case du:{const{source:u,flags:h}=o;return i([a,{source:u,flags:h}],o)}case hu:{const u=[],h=i([a,u],o);for(const[m,x]of o)(t||!(po(Ai(m))||po(Ai(x))))&&u.push([l(m),l(x)]);return h}case uu:{const u=[],h=i([a,u],o);for(const m of o)(t||!po(Ai(m)))&&u.push(l(m));return h}}const{message:d}=o;return i([a,{name:c,message:d}],o)};return l},Pp=(t,{json:n,lossy:r}={})=>{const s=[];return Y_(!(n||r),!!n,new Map,s)(t),s},da=typeof structuredClone=="function"?(t,n)=>n&&("json"in n||"lossy"in n)?Cp(Pp(t,n)):structuredClone(t):(t,n)=>Cp(Pp(t,n));function X_(t,n){const r=[{type:"text",value:""}];return n>1&&r.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(n)}]}),r}function J_(t,n){return"Back to reference "+(t+1)+(n>1?"-"+n:"")}function Z_(t){const n=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",r=t.options.footnoteBackContent||X_,s=t.options.footnoteBackLabel||J_,i=t.options.footnoteLabel||"Footnotes",l=t.options.footnoteLabelTagName||"h2",o=t.options.footnoteLabelProperties||{className:["sr-only"]},a=[];let c=-1;for(;++c<t.footnoteOrder.length;){const d=t.footnoteById.get(t.footnoteOrder[c]);if(!d)continue;const u=t.all(d),h=String(d.identifier).toUpperCase(),m=mi(h.toLowerCase());let x=0;const j=[],b=t.footnoteCounts.get(h);for(;b!==void 0&&++x<=b;){j.length>0&&j.push({type:"text",value:" "});let p=typeof r=="string"?r:r(c,x);typeof p=="string"&&(p={type:"text",value:p}),j.push({type:"element",tagName:"a",properties:{href:"#"+n+"fnref-"+m+(x>1?"-"+x:""),dataFootnoteBackref:"",ariaLabel:typeof s=="string"?s:s(c,x),className:["data-footnote-backref"]},children:Array.isArray(p)?p:[p]})}const N=u[u.length-1];if(N&&N.type==="element"&&N.tagName==="p"){const p=N.children[N.children.length-1];p&&p.type==="text"?p.value+=" ":N.children.push({type:"text",value:" "}),N.children.push(...j)}else u.push(...j);const f={type:"element",tagName:"li",properties:{id:n+"fn-"+m},children:t.wrap(u,!0)};t.patch(d,f),a.push(f)}if(a.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:l,properties:{...da(o),id:"footnote-label"},children:[{type:"text",value:i}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:t.wrap(a,!0)},{type:"text",value:`
`}]}}const qa=function(t){if(t==null)return r1;if(typeof t=="function")return Ba(t);if(typeof t=="object")return Array.isArray(t)?e1(t):t1(t);if(typeof t=="string")return n1(t);throw new Error("Expected function, string, or object as test")};function e1(t){const n=[];let r=-1;for(;++r<t.length;)n[r]=qa(t[r]);return Ba(s);function s(...i){let l=-1;for(;++l<n.length;)if(n[l].apply(this,i))return!0;return!1}}function t1(t){const n=t;return Ba(r);function r(s){const i=s;let l;for(l in t)if(i[l]!==n[l])return!1;return!0}}function n1(t){return Ba(n);function n(r){return r&&r.type===t}}function Ba(t){return n;function n(r,s,i){return!!(s1(r)&&t.call(this,r,typeof s=="number"?s:void 0,i||void 0))}}function r1(){return!0}function s1(t){return t!==null&&typeof t=="object"&&"type"in t}const Nj=[],i1=!0,Yd=!1,l1="skip";function Sj(t,n,r,s){let i;typeof n=="function"&&typeof r!="function"?(s=r,r=n):i=n;const l=qa(i),o=s?-1:1;a(t,void 0,[])();function a(c,d,u){const h=c&&typeof c=="object"?c:{};if(typeof h.type=="string"){const x=typeof h.tagName=="string"?h.tagName:typeof h.name=="string"?h.name:void 0;Object.defineProperty(m,"name",{value:"node ("+(c.type+(x?"<"+x+">":""))+")"})}return m;function m(){let x=Nj,j,b,N;if((!n||l(c,d,u[u.length-1]||void 0))&&(x=o1(r(c,u)),x[0]===Yd))return x;if("children"in c&&c.children){const f=c;if(f.children&&x[0]!==l1)for(b=(s?f.children.length:-1)+o,N=u.concat(f);b>-1&&b<f.children.length;){const p=f.children[b];if(j=a(p,b,N)(),j[0]===Yd)return j;b=typeof j[1]=="number"?j[1]:b+o}}return x}}}function o1(t){return Array.isArray(t)?t:typeof t=="number"?[i1,t]:t==null?Nj:[t]}function mu(t,n,r,s){let i,l,o;typeof n=="function"&&typeof r!="function"?(l=void 0,o=n,i=r):(l=n,o=r,i=s),Sj(t,l,a,i);function a(c,d){const u=d[d.length-1],h=u?u.children.indexOf(c):void 0;return o(c,h,u)}}const Xd={}.hasOwnProperty,a1={};function c1(t,n){const r=n||a1,s=new Map,i=new Map,l=new Map,o={...H_,...r.handlers},a={all:d,applyData:h1,definitionById:s,footnoteById:i,footnoteCounts:l,footnoteOrder:[],handlers:o,one:c,options:r,patch:d1,wrap:m1};return mu(t,function(u){if(u.type==="definition"||u.type==="footnoteDefinition"){const h=u.type==="definition"?s:i,m=String(u.identifier).toUpperCase();h.has(m)||h.set(m,u)}}),a;function c(u,h){const m=u.type,x=a.handlers[m];if(Xd.call(a.handlers,m)&&x)return x(a,u,h);if(a.options.passThrough&&a.options.passThrough.includes(m)){if("children"in u){const{children:b,...N}=u,f=da(N);return f.children=a.all(u),f}return da(u)}return(a.options.unknownHandler||u1)(a,u,h)}function d(u){const h=[];if("children"in u){const m=u.children;let x=-1;for(;++x<m.length;){const j=a.one(m[x],u);if(j){if(x&&m[x-1].type==="break"&&(!Array.isArray(j)&&j.type==="text"&&(j.value=Ep(j.value)),!Array.isArray(j)&&j.type==="element")){const b=j.children[0];b&&b.type==="text"&&(b.value=Ep(b.value))}Array.isArray(j)?h.push(...j):h.push(j)}}}return h}}function d1(t,n){t.position&&(n.position=J0(t))}function h1(t,n){let r=n;if(t&&t.data){const s=t.data.hName,i=t.data.hChildren,l=t.data.hProperties;if(typeof s=="string")if(r.type==="element")r.tagName=s;else{const o="children"in r?r.children:[r];r={type:"element",tagName:s,properties:{},children:o}}r.type==="element"&&l&&Object.assign(r.properties,da(l)),"children"in r&&r.children&&i!==null&&i!==void 0&&(r.children=i)}return r}function u1(t,n){const r=n.data||{},s="value"in n&&!(Xd.call(r,"hProperties")||Xd.call(r,"hChildren"))?{type:"text",value:n.value}:{type:"element",tagName:"div",properties:{},children:t.all(n)};return t.patch(n,s),t.applyData(n,s)}function m1(t,n){const r=[];let s=-1;for(n&&r.push({type:"text",value:`
`});++s<t.length;)s&&r.push({type:"text",value:`
`}),r.push(t[s]);return n&&t.length>0&&r.push({type:"text",value:`
`}),r}function Ep(t){let n=0,r=t.charCodeAt(n);for(;r===9||r===32;)n++,r=t.charCodeAt(n);return t.slice(n)}function Rp(t,n){const r=c1(t,n),s=r.one(t,void 0),i=Z_(r),l=Array.isArray(s)?{type:"root",children:s}:s||{type:"root",children:[]};return i&&l.children.push({type:"text",value:`
`},i),l}function p1(t,n){return t&&"run"in t?async function(r,s){const i=Rp(r,{file:s,...n});await t.run(i,s)}:function(r,s){return Rp(r,{file:s,...t||n})}}function Mp(t){if(t)throw t}var Io=Object.prototype.hasOwnProperty,_j=Object.prototype.toString,Ip=Object.defineProperty,Ap=Object.getOwnPropertyDescriptor,Dp=function(n){return typeof Array.isArray=="function"?Array.isArray(n):_j.call(n)==="[object Array]"},Lp=function(n){if(!n||_j.call(n)!=="[object Object]")return!1;var r=Io.call(n,"constructor"),s=n.constructor&&n.constructor.prototype&&Io.call(n.constructor.prototype,"isPrototypeOf");if(n.constructor&&!r&&!s)return!1;var i;for(i in n);return typeof i>"u"||Io.call(n,i)},Fp=function(n,r){Ip&&r.name==="__proto__"?Ip(n,r.name,{enumerable:!0,configurable:!0,value:r.newValue,writable:!0}):n[r.name]=r.newValue},Op=function(n,r){if(r==="__proto__")if(Io.call(n,r)){if(Ap)return Ap(n,r).value}else return;return n[r]},x1=function t(){var n,r,s,i,l,o,a=arguments[0],c=1,d=arguments.length,u=!1;for(typeof a=="boolean"&&(u=a,a=arguments[1]||{},c=2),(a==null||typeof a!="object"&&typeof a!="function")&&(a={});c<d;++c)if(n=arguments[c],n!=null)for(r in n)s=Op(a,r),i=Op(n,r),a!==i&&(u&&i&&(Lp(i)||(l=Dp(i)))?(l?(l=!1,o=s&&Dp(s)?s:[]):o=s&&Lp(s)?s:{},Fp(a,{name:r,newValue:t(u,o,i)})):typeof i<"u"&&Fp(a,{name:r,newValue:i}));return a};const Cc=ma(x1);function Jd(t){if(typeof t!="object"||t===null)return!1;const n=Object.getPrototypeOf(t);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function f1(){const t=[],n={run:r,use:s};return n;function r(...i){let l=-1;const o=i.pop();if(typeof o!="function")throw new TypeError("Expected function as last argument, not "+o);a(null,...i);function a(c,...d){const u=t[++l];let h=-1;if(c){o(c);return}for(;++h<i.length;)(d[h]===null||d[h]===void 0)&&(d[h]=i[h]);i=d,u?g1(u,a)(...d):o(null,...d)}}function s(i){if(typeof i!="function")throw new TypeError("Expected `middelware` to be a function, not "+i);return t.push(i),n}}function g1(t,n){let r;return s;function s(...o){const a=t.length>o.length;let c;a&&o.push(i);try{c=t.apply(this,o)}catch(d){const u=d;if(a&&r)throw u;return i(u)}a||(c&&c.then&&typeof c.then=="function"?c.then(l,i):c instanceof Error?i(c):l(c))}function i(o,...a){r||(r=!0,n(o,...a))}function l(o){i(null,o)}}const Gn={basename:j1,dirname:y1,extname:b1,join:k1,sep:"/"};function j1(t,n){if(n!==void 0&&typeof n!="string")throw new TypeError('"ext" argument must be a string');Ol(t);let r=0,s=-1,i=t.length,l;if(n===void 0||n.length===0||n.length>t.length){for(;i--;)if(t.codePointAt(i)===47){if(l){r=i+1;break}}else s<0&&(l=!0,s=i+1);return s<0?"":t.slice(r,s)}if(n===t)return"";let o=-1,a=n.length-1;for(;i--;)if(t.codePointAt(i)===47){if(l){r=i+1;break}}else o<0&&(l=!0,o=i+1),a>-1&&(t.codePointAt(i)===n.codePointAt(a--)?a<0&&(s=i):(a=-1,s=o));return r===s?s=o:s<0&&(s=t.length),t.slice(r,s)}function y1(t){if(Ol(t),t.length===0)return".";let n=-1,r=t.length,s;for(;--r;)if(t.codePointAt(r)===47){if(s){n=r;break}}else s||(s=!0);return n<0?t.codePointAt(0)===47?"/":".":n===1&&t.codePointAt(0)===47?"//":t.slice(0,n)}function b1(t){Ol(t);let n=t.length,r=-1,s=0,i=-1,l=0,o;for(;n--;){const a=t.codePointAt(n);if(a===47){if(o){s=n+1;break}continue}r<0&&(o=!0,r=n+1),a===46?i<0?i=n:l!==1&&(l=1):i>-1&&(l=-1)}return i<0||r<0||l===0||l===1&&i===r-1&&i===s+1?"":t.slice(i,r)}function k1(...t){let n=-1,r;for(;++n<t.length;)Ol(t[n]),t[n]&&(r=r===void 0?t[n]:r+"/"+t[n]);return r===void 0?".":v1(r)}function v1(t){Ol(t);const n=t.codePointAt(0)===47;let r=w1(t,!n);return r.length===0&&!n&&(r="."),r.length>0&&t.codePointAt(t.length-1)===47&&(r+="/"),n?"/"+r:r}function w1(t,n){let r="",s=0,i=-1,l=0,o=-1,a,c;for(;++o<=t.length;){if(o<t.length)a=t.codePointAt(o);else{if(a===47)break;a=47}if(a===47){if(!(i===o-1||l===1))if(i!==o-1&&l===2){if(r.length<2||s!==2||r.codePointAt(r.length-1)!==46||r.codePointAt(r.length-2)!==46){if(r.length>2){if(c=r.lastIndexOf("/"),c!==r.length-1){c<0?(r="",s=0):(r=r.slice(0,c),s=r.length-1-r.lastIndexOf("/")),i=o,l=0;continue}}else if(r.length>0){r="",s=0,i=o,l=0;continue}}n&&(r=r.length>0?r+"/..":"..",s=2)}else r.length>0?r+="/"+t.slice(i+1,o):r=t.slice(i+1,o),s=o-i-1;i=o,l=0}else a===46&&l>-1?l++:l=-1}return r}function Ol(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const N1={cwd:S1};function S1(){return"/"}function Zd(t){return!!(t!==null&&typeof t=="object"&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&t.auth===void 0)}function _1(t){if(typeof t=="string")t=new URL(t);else if(!Zd(t)){const n=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw n.code="ERR_INVALID_ARG_TYPE",n}if(t.protocol!=="file:"){const n=new TypeError("The URL must be of scheme file");throw n.code="ERR_INVALID_URL_SCHEME",n}return T1(t)}function T1(t){if(t.hostname!==""){const s=new TypeError('File URL host must be "localhost" or empty on darwin');throw s.code="ERR_INVALID_FILE_URL_HOST",s}const n=t.pathname;let r=-1;for(;++r<n.length;)if(n.codePointAt(r)===37&&n.codePointAt(r+1)===50){const s=n.codePointAt(r+2);if(s===70||s===102){const i=new TypeError("File URL path must not include encoded / characters");throw i.code="ERR_INVALID_FILE_URL_PATH",i}}return decodeURIComponent(n)}const Pc=["history","path","basename","stem","extname","dirname"];class Tj{constructor(n){let r;n?Zd(n)?r={path:n}:typeof n=="string"||C1(n)?r={value:n}:r=n:r={},this.cwd="cwd"in r?"":N1.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let s=-1;for(;++s<Pc.length;){const l=Pc[s];l in r&&r[l]!==void 0&&r[l]!==null&&(this[l]=l==="history"?[...r[l]]:r[l])}let i;for(i in r)Pc.includes(i)||(this[i]=r[i])}get basename(){return typeof this.path=="string"?Gn.basename(this.path):void 0}set basename(n){Rc(n,"basename"),Ec(n,"basename"),this.path=Gn.join(this.dirname||"",n)}get dirname(){return typeof this.path=="string"?Gn.dirname(this.path):void 0}set dirname(n){qp(this.basename,"dirname"),this.path=Gn.join(n||"",this.basename)}get extname(){return typeof this.path=="string"?Gn.extname(this.path):void 0}set extname(n){if(Ec(n,"extname"),qp(this.dirname,"extname"),n){if(n.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(n.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=Gn.join(this.dirname,this.stem+(n||""))}get path(){return this.history[this.history.length-1]}set path(n){Zd(n)&&(n=_1(n)),Rc(n,"path"),this.path!==n&&this.history.push(n)}get stem(){return typeof this.path=="string"?Gn.basename(this.path,this.extname):void 0}set stem(n){Rc(n,"stem"),Ec(n,"stem"),this.path=Gn.join(this.dirname||"",n+(this.extname||""))}fail(n,r,s){const i=this.message(n,r,s);throw i.fatal=!0,i}info(n,r,s){const i=this.message(n,r,s);return i.fatal=void 0,i}message(n,r,s){const i=new Gt(n,r,s);return this.path&&(i.name=this.path+":"+i.name,i.file=this.path),i.fatal=!1,this.messages.push(i),i}toString(n){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(n||void 0).decode(this.value)}}function Ec(t,n){if(t&&t.includes(Gn.sep))throw new Error("`"+n+"` cannot be a path: did not expect `"+Gn.sep+"`")}function Rc(t,n){if(!t)throw new Error("`"+n+"` cannot be empty")}function qp(t,n){if(!t)throw new Error("Setting `"+n+"` requires `path` to be set too")}function C1(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const P1=function(t){const s=this.constructor.prototype,i=s[t],l=function(){return i.apply(l,arguments)};return Object.setPrototypeOf(l,s),l},E1={}.hasOwnProperty;class pu extends P1{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=f1()}copy(){const n=new pu;let r=-1;for(;++r<this.attachers.length;){const s=this.attachers[r];n.use(...s)}return n.data(Cc(!0,{},this.namespace)),n}data(n,r){return typeof n=="string"?arguments.length===2?(Ac("data",this.frozen),this.namespace[n]=r,this):E1.call(this.namespace,n)&&this.namespace[n]||void 0:n?(Ac("data",this.frozen),this.namespace=n,this):this.namespace}freeze(){if(this.frozen)return this;const n=this;for(;++this.freezeIndex<this.attachers.length;){const[r,...s]=this.attachers[this.freezeIndex];if(s[0]===!1)continue;s[0]===!0&&(s[0]=void 0);const i=r.call(n,...s);typeof i=="function"&&this.transformers.use(i)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(n){this.freeze();const r=xo(n),s=this.parser||this.Parser;return Mc("parse",s),s(String(r),r)}process(n,r){const s=this;return this.freeze(),Mc("process",this.parser||this.Parser),Ic("process",this.compiler||this.Compiler),r?i(void 0,r):new Promise(i);function i(l,o){const a=xo(n),c=s.parse(a);s.run(c,a,function(u,h,m){if(u||!h||!m)return d(u);const x=h,j=s.stringify(x,m);I1(j)?m.value=j:m.result=j,d(u,m)});function d(u,h){u||!h?o(u):l?l(h):r(void 0,h)}}}processSync(n){let r=!1,s;return this.freeze(),Mc("processSync",this.parser||this.Parser),Ic("processSync",this.compiler||this.Compiler),this.process(n,i),Up("processSync","process",r),s;function i(l,o){r=!0,Mp(l),s=o}}run(n,r,s){Bp(n),this.freeze();const i=this.transformers;return!s&&typeof r=="function"&&(s=r,r=void 0),s?l(void 0,s):new Promise(l);function l(o,a){const c=xo(r);i.run(n,c,d);function d(u,h,m){const x=h||n;u?a(u):o?o(x):s(void 0,x,m)}}}runSync(n,r){let s=!1,i;return this.run(n,r,l),Up("runSync","run",s),i;function l(o,a){Mp(o),i=a,s=!0}}stringify(n,r){this.freeze();const s=xo(r),i=this.compiler||this.Compiler;return Ic("stringify",i),Bp(n),i(n,s)}use(n,...r){const s=this.attachers,i=this.namespace;if(Ac("use",this.frozen),n!=null)if(typeof n=="function")c(n,r);else if(typeof n=="object")Array.isArray(n)?a(n):o(n);else throw new TypeError("Expected usable value, not `"+n+"`");return this;function l(d){if(typeof d=="function")c(d,[]);else if(typeof d=="object")if(Array.isArray(d)){const[u,...h]=d;c(u,h)}else o(d);else throw new TypeError("Expected usable value, not `"+d+"`")}function o(d){if(!("plugins"in d)&&!("settings"in d))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");a(d.plugins),d.settings&&(i.settings=Cc(!0,i.settings,d.settings))}function a(d){let u=-1;if(d!=null)if(Array.isArray(d))for(;++u<d.length;){const h=d[u];l(h)}else throw new TypeError("Expected a list of plugins, not `"+d+"`")}function c(d,u){let h=-1,m=-1;for(;++h<s.length;)if(s[h][0]===d){m=h;break}if(m===-1)s.push([d,...u]);else if(u.length>0){let[x,...j]=u;const b=s[m][1];Jd(b)&&Jd(x)&&(x=Cc(!0,b,x)),s[m]=[d,x,...j]}}}}const R1=new pu().freeze();function Mc(t,n){if(typeof n!="function")throw new TypeError("Cannot `"+t+"` without `parser`")}function Ic(t,n){if(typeof n!="function")throw new TypeError("Cannot `"+t+"` without `compiler`")}function Ac(t,n){if(n)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function Bp(t){if(!Jd(t)||typeof t.type!="string")throw new TypeError("Expected node, got `"+t+"`")}function Up(t,n,r){if(!r)throw new Error("`"+t+"` finished async. Use `"+n+"` instead")}function xo(t){return M1(t)?t:new Tj(t)}function M1(t){return!!(t&&typeof t=="object"&&"message"in t&&"messages"in t)}function I1(t){return typeof t=="string"||A1(t)}function A1(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const D1="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",Kp=[],zp={allowDangerousHtml:!0},L1=/^(https?|ircs?|mailto|xmpp)$/i,F1=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function O1(t){const n=q1(t),r=B1(t);return U1(n.runSync(n.parse(r),r),t)}function q1(t){const n=t.rehypePlugins||Kp,r=t.remarkPlugins||Kp,s=t.remarkRehypeOptions?{...t.remarkRehypeOptions,...zp}:zp;return R1().use(b_).use(r).use(p1,s).use(n)}function B1(t){const n=t.children||"",r=new Tj;return typeof n=="string"&&(r.value=n),r}function U1(t,n){const r=n.allowedElements,s=n.allowElement,i=n.components,l=n.disallowedElements,o=n.skipHtml,a=n.unwrapDisallowed,c=n.urlTransform||K1;for(const u of F1)Object.hasOwn(n,u.from)&&(""+u.from+(u.to?"use `"+u.to+"` instead":"remove it")+D1+u.id,void 0);return mu(t,d),rN(t,{Fragment:e.Fragment,components:i,ignoreInvalidStyle:!0,jsx:e.jsx,jsxs:e.jsxs,passKeys:!0,passNode:!0});function d(u,h,m){if(u.type==="raw"&&m&&typeof h=="number")return o?m.children.splice(h,1):m.children[h]={type:"text",value:u.value},h;if(u.type==="element"){let x;for(x in Sc)if(Object.hasOwn(Sc,x)&&Object.hasOwn(u.properties,x)){const j=u.properties[x],b=Sc[x];(b===null||b.includes(u.tagName))&&(u.properties[x]=c(String(j||""),x,u))}}if(u.type==="element"){let x=r?!r.includes(u.tagName):l?l.includes(u.tagName):!1;if(!x&&s&&typeof h=="number"&&(x=!s(u,h,m)),x&&m&&typeof h=="number")return a&&u.children?m.children.splice(h,1,...u.children):m.children.splice(h,1),h}}}function K1(t){const n=t.indexOf(":"),r=t.indexOf("?"),s=t.indexOf("#"),i=t.indexOf("/");return n===-1||i!==-1&&n>i||r!==-1&&n>r||s!==-1&&n>s||L1.test(t.slice(0,n))?t:""}function Gp(t,n){const r=String(t);if(typeof n!="string")throw new TypeError("Expected character");let s=0,i=r.indexOf(n);for(;i!==-1;)s++,i=r.indexOf(n,i+n.length);return s}function z1(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function G1(t,n,r){const i=qa((r||{}).ignore||[]),l=V1(n);let o=-1;for(;++o<l.length;)Sj(t,"text",a);function a(d,u){let h=-1,m;for(;++h<u.length;){const x=u[h],j=m?m.children:void 0;if(i(x,j?j.indexOf(x):void 0,m))return;m=x}if(m)return c(d,u)}function c(d,u){const h=u[u.length-1],m=l[o][0],x=l[o][1];let j=0;const N=h.children.indexOf(d);let f=!1,p=[];m.lastIndex=0;let g=m.exec(d.value);for(;g;){const k=g.index,S={index:g.index,input:g.input,stack:[...u,d]};let _=x(...g,S);if(typeof _=="string"&&(_=_.length>0?{type:"text",value:_}:void 0),_===!1?m.lastIndex=k+1:(j!==k&&p.push({type:"text",value:d.value.slice(j,k)}),Array.isArray(_)?p.push(..._):_&&p.push(_),j=k+g[0].length,f=!0),!m.global)break;g=m.exec(d.value)}return f?(j<d.value.length&&p.push({type:"text",value:d.value.slice(j)}),h.children.splice(N,1,...p)):p=[d],N+p.length}}function V1(t){const n=[];if(!Array.isArray(t))throw new TypeError("Expected find and replace tuple or list of tuples");const r=!t[0]||Array.isArray(t[0])?t:[t];let s=-1;for(;++s<r.length;){const i=r[s];n.push([H1(i[0]),$1(i[1])])}return n}function H1(t){return typeof t=="string"?new RegExp(z1(t),"g"):t}function $1(t){return typeof t=="function"?t:function(){return t}}const Dc="phrasing",Lc=["autolink","link","image","label"];function W1(){return{transforms:[tT],enter:{literalAutolink:Y1,literalAutolinkEmail:Fc,literalAutolinkHttp:Fc,literalAutolinkWww:Fc},exit:{literalAutolink:eT,literalAutolinkEmail:Z1,literalAutolinkHttp:X1,literalAutolinkWww:J1}}}function Q1(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:Dc,notInConstruct:Lc},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:Dc,notInConstruct:Lc},{character:":",before:"[ps]",after:"\\/",inConstruct:Dc,notInConstruct:Lc}]}}function Y1(t){this.enter({type:"link",title:null,url:"",children:[]},t)}function Fc(t){this.config.enter.autolinkProtocol.call(this,t)}function X1(t){this.config.exit.autolinkProtocol.call(this,t)}function J1(t){this.config.exit.data.call(this,t);const n=this.stack[this.stack.length-1];n.type,n.url="http://"+this.sliceSerialize(t)}function Z1(t){this.config.exit.autolinkEmail.call(this,t)}function eT(t){this.exit(t)}function tT(t){G1(t,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,nT],[new RegExp("(?<=^|\\s|\\p{P}|\\p{S})([-.\\w+]+)@([-\\w]+(?:\\.[-\\w]+)+)","gu"),rT]],{ignore:["link","linkReference"]})}function nT(t,n,r,s,i){let l="";if(!Cj(i)||(/^w/i.test(n)&&(r=n+r,n="",l="http://"),!sT(r)))return!1;const o=iT(r+s);if(!o[0])return!1;const a={type:"link",title:null,url:l+n+o[0],children:[{type:"text",value:n+o[0]}]};return o[1]?[a,{type:"text",value:o[1]}]:a}function rT(t,n,r,s){return!Cj(s,!0)||/[-\d_]$/.test(r)?!1:{type:"link",title:null,url:"mailto:"+n+"@"+r,children:[{type:"text",value:n+"@"+r}]}}function sT(t){const n=t.split(".");return!(n.length<2||n[n.length-1]&&(/_/.test(n[n.length-1])||!/[a-zA-Z\d]/.test(n[n.length-1]))||n[n.length-2]&&(/_/.test(n[n.length-2])||!/[a-zA-Z\d]/.test(n[n.length-2])))}function iT(t){const n=/[!"&'),.:;<>?\]}]+$/.exec(t);if(!n)return[t,void 0];t=t.slice(0,n.index);let r=n[0],s=r.indexOf(")");const i=Gp(t,"(");let l=Gp(t,")");for(;s!==-1&&i>l;)t+=r.slice(0,s+1),r=r.slice(s+1),s=r.indexOf(")"),l++;return[t,r]}function Cj(t,n){const r=t.input.charCodeAt(t.index-1);return(t.index===0||hs(r)||La(r))&&(!n||r!==47)}Pj.peek=pT;function lT(){this.buffer()}function oT(t){this.enter({type:"footnoteReference",identifier:"",label:""},t)}function aT(){this.buffer()}function cT(t){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},t)}function dT(t){const n=this.resume(),r=this.stack[this.stack.length-1];r.type,r.identifier=On(this.sliceSerialize(t)).toLowerCase(),r.label=n}function hT(t){this.exit(t)}function uT(t){const n=this.resume(),r=this.stack[this.stack.length-1];r.type,r.identifier=On(this.sliceSerialize(t)).toLowerCase(),r.label=n}function mT(t){this.exit(t)}function pT(){return"["}function Pj(t,n,r,s){const i=r.createTracker(s);let l=i.move("[^");const o=r.enter("footnoteReference"),a=r.enter("reference");return l+=i.move(r.safe(r.associationId(t),{after:"]",before:l})),a(),o(),l+=i.move("]"),l}function xT(){return{enter:{gfmFootnoteCallString:lT,gfmFootnoteCall:oT,gfmFootnoteDefinitionLabelString:aT,gfmFootnoteDefinition:cT},exit:{gfmFootnoteCallString:dT,gfmFootnoteCall:hT,gfmFootnoteDefinitionLabelString:uT,gfmFootnoteDefinition:mT}}}function fT(t){let n=!1;return t&&t.firstLineBlank&&(n=!0),{handlers:{footnoteDefinition:r,footnoteReference:Pj},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function r(s,i,l,o){const a=l.createTracker(o);let c=a.move("[^");const d=l.enter("footnoteDefinition"),u=l.enter("label");return c+=a.move(l.safe(l.associationId(s),{before:c,after:"]"})),u(),c+=a.move("]:"),s.children&&s.children.length>0&&(a.shift(4),c+=a.move((n?`
`:" ")+l.indentLines(l.containerFlow(s,a.current()),n?Ej:gT))),d(),c}}function gT(t,n,r){return n===0?t:Ej(t,n,r)}function Ej(t,n,r){return(r?"":"    ")+t}const jT=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];Rj.peek=wT;function yT(){return{canContainEols:["delete"],enter:{strikethrough:kT},exit:{strikethrough:vT}}}function bT(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:jT}],handlers:{delete:Rj}}}function kT(t){this.enter({type:"delete",children:[]},t)}function vT(t){this.exit(t)}function Rj(t,n,r,s){const i=r.createTracker(s),l=r.enter("strikethrough");let o=i.move("~~");return o+=r.containerPhrasing(t,{...i.current(),before:o,after:"~"}),o+=i.move("~~"),l(),o}function wT(){return"~"}function NT(t){return t.length}function ST(t,n){const r=n||{},s=(r.align||[]).concat(),i=r.stringLength||NT,l=[],o=[],a=[],c=[];let d=0,u=-1;for(;++u<t.length;){const b=[],N=[];let f=-1;for(t[u].length>d&&(d=t[u].length);++f<t[u].length;){const p=_T(t[u][f]);if(r.alignDelimiters!==!1){const g=i(p);N[f]=g,(c[f]===void 0||g>c[f])&&(c[f]=g)}b.push(p)}o[u]=b,a[u]=N}let h=-1;if(typeof s=="object"&&"length"in s)for(;++h<d;)l[h]=Vp(s[h]);else{const b=Vp(s);for(;++h<d;)l[h]=b}h=-1;const m=[],x=[];for(;++h<d;){const b=l[h];let N="",f="";b===99?(N=":",f=":"):b===108?N=":":b===114&&(f=":");let p=r.alignDelimiters===!1?1:Math.max(1,c[h]-N.length-f.length);const g=N+"-".repeat(p)+f;r.alignDelimiters!==!1&&(p=N.length+p+f.length,p>c[h]&&(c[h]=p),x[h]=p),m[h]=g}o.splice(1,0,m),a.splice(1,0,x),u=-1;const j=[];for(;++u<o.length;){const b=o[u],N=a[u];h=-1;const f=[];for(;++h<d;){const p=b[h]||"";let g="",k="";if(r.alignDelimiters!==!1){const S=c[h]-(N[h]||0),_=l[h];_===114?g=" ".repeat(S):_===99?S%2?(g=" ".repeat(S/2+.5),k=" ".repeat(S/2-.5)):(g=" ".repeat(S/2),k=g):k=" ".repeat(S)}r.delimiterStart!==!1&&!h&&f.push("|"),r.padding!==!1&&!(r.alignDelimiters===!1&&p==="")&&(r.delimiterStart!==!1||h)&&f.push(" "),r.alignDelimiters!==!1&&f.push(g),f.push(p),r.alignDelimiters!==!1&&f.push(k),r.padding!==!1&&f.push(" "),(r.delimiterEnd!==!1||h!==d-1)&&f.push("|")}j.push(r.delimiterEnd===!1?f.join("").replace(/ +$/,""):f.join(""))}return j.join(`
`)}function _T(t){return t==null?"":String(t)}function Vp(t){const n=typeof t=="string"?t.codePointAt(0):0;return n===67||n===99?99:n===76||n===108?108:n===82||n===114?114:0}function TT(t,n,r,s){const i=r.enter("blockquote"),l=r.createTracker(s);l.move("> "),l.shift(2);const o=r.indentLines(r.containerFlow(t,l.current()),CT);return i(),o}function CT(t,n,r){return">"+(r?"":" ")+t}function PT(t,n){return Hp(t,n.inConstruct,!0)&&!Hp(t,n.notInConstruct,!1)}function Hp(t,n,r){if(typeof n=="string"&&(n=[n]),!n||n.length===0)return r;let s=-1;for(;++s<n.length;)if(t.includes(n[s]))return!0;return!1}function $p(t,n,r,s){let i=-1;for(;++i<r.unsafe.length;)if(r.unsafe[i].character===`
`&&PT(r.stack,r.unsafe[i]))return/[ \t]/.test(s.before)?"":" ";return`\\
`}function ET(t,n){const r=String(t);let s=r.indexOf(n),i=s,l=0,o=0;if(typeof n!="string")throw new TypeError("Expected substring");for(;s!==-1;)s===i?++l>o&&(o=l):l=1,i=s+n.length,s=r.indexOf(n,i);return o}function RT(t,n){return!!(n.options.fences===!1&&t.value&&!t.lang&&/[^ \r\n]/.test(t.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(t.value))}function MT(t){const n=t.options.fence||"`";if(n!=="`"&&n!=="~")throw new Error("Cannot serialize code with `"+n+"` for `options.fence`, expected `` ` `` or `~`");return n}function IT(t,n,r,s){const i=MT(r),l=t.value||"",o=i==="`"?"GraveAccent":"Tilde";if(RT(t,r)){const h=r.enter("codeIndented"),m=r.indentLines(l,AT);return h(),m}const a=r.createTracker(s),c=i.repeat(Math.max(ET(l,i)+1,3)),d=r.enter("codeFenced");let u=a.move(c);if(t.lang){const h=r.enter(`codeFencedLang${o}`);u+=a.move(r.safe(t.lang,{before:u,after:" ",encode:["`"],...a.current()})),h()}if(t.lang&&t.meta){const h=r.enter(`codeFencedMeta${o}`);u+=a.move(" "),u+=a.move(r.safe(t.meta,{before:u,after:`
`,encode:["`"],...a.current()})),h()}return u+=a.move(`
`),l&&(u+=a.move(l+`
`)),u+=a.move(c),d(),u}function AT(t,n,r){return(r?"":"    ")+t}function xu(t){const n=t.options.quote||'"';if(n!=='"'&&n!=="'")throw new Error("Cannot serialize title with `"+n+"` for `options.quote`, expected `\"`, or `'`");return n}function DT(t,n,r,s){const i=xu(r),l=i==='"'?"Quote":"Apostrophe",o=r.enter("definition");let a=r.enter("label");const c=r.createTracker(s);let d=c.move("[");return d+=c.move(r.safe(r.associationId(t),{before:d,after:"]",...c.current()})),d+=c.move("]: "),a(),!t.url||/[\0- \u007F]/.test(t.url)?(a=r.enter("destinationLiteral"),d+=c.move("<"),d+=c.move(r.safe(t.url,{before:d,after:">",...c.current()})),d+=c.move(">")):(a=r.enter("destinationRaw"),d+=c.move(r.safe(t.url,{before:d,after:t.title?" ":`
`,...c.current()}))),a(),t.title&&(a=r.enter(`title${l}`),d+=c.move(" "+i),d+=c.move(r.safe(t.title,{before:d,after:i,...c.current()})),d+=c.move(i),a()),o(),d}function LT(t){const n=t.options.emphasis||"*";if(n!=="*"&&n!=="_")throw new Error("Cannot serialize emphasis with `"+n+"` for `options.emphasis`, expected `*`, or `_`");return n}function Nl(t){return"&#x"+t.toString(16).toUpperCase()+";"}function ha(t,n,r){const s=ni(t),i=ni(n);return s===void 0?i===void 0?r==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:i===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:s===1?i===void 0?{inside:!1,outside:!1}:i===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:i===void 0?{inside:!1,outside:!1}:i===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}Mj.peek=FT;function Mj(t,n,r,s){const i=LT(r),l=r.enter("emphasis"),o=r.createTracker(s),a=o.move(i);let c=o.move(r.containerPhrasing(t,{after:i,before:a,...o.current()}));const d=c.charCodeAt(0),u=ha(s.before.charCodeAt(s.before.length-1),d,i);u.inside&&(c=Nl(d)+c.slice(1));const h=c.charCodeAt(c.length-1),m=ha(s.after.charCodeAt(0),h,i);m.inside&&(c=c.slice(0,-1)+Nl(h));const x=o.move(i);return l(),r.attentionEncodeSurroundingInfo={after:m.outside,before:u.outside},a+c+x}function FT(t,n,r){return r.options.emphasis||"*"}function OT(t,n){let r=!1;return mu(t,function(s){if("value"in s&&/\r?\n|\r/.test(s.value)||s.type==="break")return r=!0,Yd}),!!((!t.depth||t.depth<3)&&lu(t)&&(n.options.setext||r))}function qT(t,n,r,s){const i=Math.max(Math.min(6,t.depth||1),1),l=r.createTracker(s);if(OT(t,r)){const u=r.enter("headingSetext"),h=r.enter("phrasing"),m=r.containerPhrasing(t,{...l.current(),before:`
`,after:`
`});return h(),u(),m+`
`+(i===1?"=":"-").repeat(m.length-(Math.max(m.lastIndexOf("\r"),m.lastIndexOf(`
`))+1))}const o="#".repeat(i),a=r.enter("headingAtx"),c=r.enter("phrasing");l.move(o+" ");let d=r.containerPhrasing(t,{before:"# ",after:`
`,...l.current()});return/^[\t ]/.test(d)&&(d=Nl(d.charCodeAt(0))+d.slice(1)),d=d?o+" "+d:o,r.options.closeAtx&&(d+=" "+o),c(),a(),d}Ij.peek=BT;function Ij(t){return t.value||""}function BT(){return"<"}Aj.peek=UT;function Aj(t,n,r,s){const i=xu(r),l=i==='"'?"Quote":"Apostrophe",o=r.enter("image");let a=r.enter("label");const c=r.createTracker(s);let d=c.move("![");return d+=c.move(r.safe(t.alt,{before:d,after:"]",...c.current()})),d+=c.move("]("),a(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(a=r.enter("destinationLiteral"),d+=c.move("<"),d+=c.move(r.safe(t.url,{before:d,after:">",...c.current()})),d+=c.move(">")):(a=r.enter("destinationRaw"),d+=c.move(r.safe(t.url,{before:d,after:t.title?" ":")",...c.current()}))),a(),t.title&&(a=r.enter(`title${l}`),d+=c.move(" "+i),d+=c.move(r.safe(t.title,{before:d,after:i,...c.current()})),d+=c.move(i),a()),d+=c.move(")"),o(),d}function UT(){return"!"}Dj.peek=KT;function Dj(t,n,r,s){const i=t.referenceType,l=r.enter("imageReference");let o=r.enter("label");const a=r.createTracker(s);let c=a.move("![");const d=r.safe(t.alt,{before:c,after:"]",...a.current()});c+=a.move(d+"]["),o();const u=r.stack;r.stack=[],o=r.enter("reference");const h=r.safe(r.associationId(t),{before:c,after:"]",...a.current()});return o(),r.stack=u,l(),i==="full"||!d||d!==h?c+=a.move(h+"]"):i==="shortcut"?c=c.slice(0,-1):c+=a.move("]"),c}function KT(){return"!"}Lj.peek=zT;function Lj(t,n,r){let s=t.value||"",i="`",l=-1;for(;new RegExp("(^|[^`])"+i+"([^`]|$)").test(s);)i+="`";for(/[^ \r\n]/.test(s)&&(/^[ \r\n]/.test(s)&&/[ \r\n]$/.test(s)||/^`|`$/.test(s))&&(s=" "+s+" ");++l<r.unsafe.length;){const o=r.unsafe[l],a=r.compilePattern(o);let c;if(o.atBreak)for(;c=a.exec(s);){let d=c.index;s.charCodeAt(d)===10&&s.charCodeAt(d-1)===13&&d--,s=s.slice(0,d)+" "+s.slice(c.index+1)}}return i+s+i}function zT(){return"`"}function Fj(t,n){const r=lu(t);return!!(!n.options.resourceLink&&t.url&&!t.title&&t.children&&t.children.length===1&&t.children[0].type==="text"&&(r===t.url||"mailto:"+r===t.url)&&/^[a-z][a-z+.-]+:/i.test(t.url)&&!/[\0- <>\u007F]/.test(t.url))}Oj.peek=GT;function Oj(t,n,r,s){const i=xu(r),l=i==='"'?"Quote":"Apostrophe",o=r.createTracker(s);let a,c;if(Fj(t,r)){const u=r.stack;r.stack=[],a=r.enter("autolink");let h=o.move("<");return h+=o.move(r.containerPhrasing(t,{before:h,after:">",...o.current()})),h+=o.move(">"),a(),r.stack=u,h}a=r.enter("link"),c=r.enter("label");let d=o.move("[");return d+=o.move(r.containerPhrasing(t,{before:d,after:"](",...o.current()})),d+=o.move("]("),c(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(c=r.enter("destinationLiteral"),d+=o.move("<"),d+=o.move(r.safe(t.url,{before:d,after:">",...o.current()})),d+=o.move(">")):(c=r.enter("destinationRaw"),d+=o.move(r.safe(t.url,{before:d,after:t.title?" ":")",...o.current()}))),c(),t.title&&(c=r.enter(`title${l}`),d+=o.move(" "+i),d+=o.move(r.safe(t.title,{before:d,after:i,...o.current()})),d+=o.move(i),c()),d+=o.move(")"),a(),d}function GT(t,n,r){return Fj(t,r)?"<":"["}qj.peek=VT;function qj(t,n,r,s){const i=t.referenceType,l=r.enter("linkReference");let o=r.enter("label");const a=r.createTracker(s);let c=a.move("[");const d=r.containerPhrasing(t,{before:c,after:"]",...a.current()});c+=a.move(d+"]["),o();const u=r.stack;r.stack=[],o=r.enter("reference");const h=r.safe(r.associationId(t),{before:c,after:"]",...a.current()});return o(),r.stack=u,l(),i==="full"||!d||d!==h?c+=a.move(h+"]"):i==="shortcut"?c=c.slice(0,-1):c+=a.move("]"),c}function VT(){return"["}function fu(t){const n=t.options.bullet||"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bullet`, expected `*`, `+`, or `-`");return n}function HT(t){const n=fu(t),r=t.options.bulletOther;if(!r)return n==="*"?"-":"*";if(r!=="*"&&r!=="+"&&r!=="-")throw new Error("Cannot serialize items with `"+r+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(r===n)throw new Error("Expected `bullet` (`"+n+"`) and `bulletOther` (`"+r+"`) to be different");return r}function $T(t){const n=t.options.bulletOrdered||".";if(n!=="."&&n!==")")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOrdered`, expected `.` or `)`");return n}function Bj(t){const n=t.options.rule||"*";if(n!=="*"&&n!=="-"&&n!=="_")throw new Error("Cannot serialize rules with `"+n+"` for `options.rule`, expected `*`, `-`, or `_`");return n}function WT(t,n,r,s){const i=r.enter("list"),l=r.bulletCurrent;let o=t.ordered?$T(r):fu(r);const a=t.ordered?o==="."?")":".":HT(r);let c=n&&r.bulletLastUsed?o===r.bulletLastUsed:!1;if(!t.ordered){const u=t.children?t.children[0]:void 0;if((o==="*"||o==="-")&&u&&(!u.children||!u.children[0])&&r.stack[r.stack.length-1]==="list"&&r.stack[r.stack.length-2]==="listItem"&&r.stack[r.stack.length-3]==="list"&&r.stack[r.stack.length-4]==="listItem"&&r.indexStack[r.indexStack.length-1]===0&&r.indexStack[r.indexStack.length-2]===0&&r.indexStack[r.indexStack.length-3]===0&&(c=!0),Bj(r)===o&&u){let h=-1;for(;++h<t.children.length;){const m=t.children[h];if(m&&m.type==="listItem"&&m.children&&m.children[0]&&m.children[0].type==="thematicBreak"){c=!0;break}}}}c&&(o=a),r.bulletCurrent=o;const d=r.containerFlow(t,s);return r.bulletLastUsed=o,r.bulletCurrent=l,i(),d}function QT(t){const n=t.options.listItemIndent||"one";if(n!=="tab"&&n!=="one"&&n!=="mixed")throw new Error("Cannot serialize items with `"+n+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return n}function YT(t,n,r,s){const i=QT(r);let l=r.bulletCurrent||fu(r);n&&n.type==="list"&&n.ordered&&(l=(typeof n.start=="number"&&n.start>-1?n.start:1)+(r.options.incrementListMarker===!1?0:n.children.indexOf(t))+l);let o=l.length+1;(i==="tab"||i==="mixed"&&(n&&n.type==="list"&&n.spread||t.spread))&&(o=Math.ceil(o/4)*4);const a=r.createTracker(s);a.move(l+" ".repeat(o-l.length)),a.shift(o);const c=r.enter("listItem"),d=r.indentLines(r.containerFlow(t,a.current()),u);return c(),d;function u(h,m,x){return m?(x?"":" ".repeat(o))+h:(x?l:l+" ".repeat(o-l.length))+h}}function XT(t,n,r,s){const i=r.enter("paragraph"),l=r.enter("phrasing"),o=r.containerPhrasing(t,s);return l(),i(),o}const JT=qa(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function ZT(t,n,r,s){return(t.children.some(function(o){return JT(o)})?r.containerPhrasing:r.containerFlow).call(r,t,s)}function eC(t){const n=t.options.strong||"*";if(n!=="*"&&n!=="_")throw new Error("Cannot serialize strong with `"+n+"` for `options.strong`, expected `*`, or `_`");return n}Uj.peek=tC;function Uj(t,n,r,s){const i=eC(r),l=r.enter("strong"),o=r.createTracker(s),a=o.move(i+i);let c=o.move(r.containerPhrasing(t,{after:i,before:a,...o.current()}));const d=c.charCodeAt(0),u=ha(s.before.charCodeAt(s.before.length-1),d,i);u.inside&&(c=Nl(d)+c.slice(1));const h=c.charCodeAt(c.length-1),m=ha(s.after.charCodeAt(0),h,i);m.inside&&(c=c.slice(0,-1)+Nl(h));const x=o.move(i+i);return l(),r.attentionEncodeSurroundingInfo={after:m.outside,before:u.outside},a+c+x}function tC(t,n,r){return r.options.strong||"*"}function nC(t,n,r,s){return r.safe(t.value,s)}function rC(t){const n=t.options.ruleRepetition||3;if(n<3)throw new Error("Cannot serialize rules with repetition `"+n+"` for `options.ruleRepetition`, expected `3` or more");return n}function sC(t,n,r){const s=(Bj(r)+(r.options.ruleSpaces?" ":"")).repeat(rC(r));return r.options.ruleSpaces?s.slice(0,-1):s}const Kj={blockquote:TT,break:$p,code:IT,definition:DT,emphasis:Mj,hardBreak:$p,heading:qT,html:Ij,image:Aj,imageReference:Dj,inlineCode:Lj,link:Oj,linkReference:qj,list:WT,listItem:YT,paragraph:XT,root:ZT,strong:Uj,text:nC,thematicBreak:sC};function iC(){return{enter:{table:lC,tableData:Wp,tableHeader:Wp,tableRow:aC},exit:{codeText:cC,table:oC,tableData:Oc,tableHeader:Oc,tableRow:Oc}}}function lC(t){const n=t._align;this.enter({type:"table",align:n.map(function(r){return r==="none"?null:r}),children:[]},t),this.data.inTable=!0}function oC(t){this.exit(t),this.data.inTable=void 0}function aC(t){this.enter({type:"tableRow",children:[]},t)}function Oc(t){this.exit(t)}function Wp(t){this.enter({type:"tableCell",children:[]},t)}function cC(t){let n=this.resume();this.data.inTable&&(n=n.replace(/\\([\\|])/g,dC));const r=this.stack[this.stack.length-1];r.type,r.value=n,this.exit(t)}function dC(t,n){return n==="|"?n:t}function hC(t){const n=t||{},r=n.tableCellPadding,s=n.tablePipeAlign,i=n.stringLength,l=r?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:m,table:o,tableCell:c,tableRow:a}};function o(x,j,b,N){return d(u(x,b,N),x.align)}function a(x,j,b,N){const f=h(x,b,N),p=d([f]);return p.slice(0,p.indexOf(`
`))}function c(x,j,b,N){const f=b.enter("tableCell"),p=b.enter("phrasing"),g=b.containerPhrasing(x,{...N,before:l,after:l});return p(),f(),g}function d(x,j){return ST(x,{align:j,alignDelimiters:s,padding:r,stringLength:i})}function u(x,j,b){const N=x.children;let f=-1;const p=[],g=j.enter("table");for(;++f<N.length;)p[f]=h(N[f],j,b);return g(),p}function h(x,j,b){const N=x.children;let f=-1;const p=[],g=j.enter("tableRow");for(;++f<N.length;)p[f]=c(N[f],x,j,b);return g(),p}function m(x,j,b){let N=Kj.inlineCode(x,j,b);return b.stack.includes("tableCell")&&(N=N.replace(/\|/g,"\\$&")),N}}function uC(){return{exit:{taskListCheckValueChecked:Qp,taskListCheckValueUnchecked:Qp,paragraph:pC}}}function mC(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:xC}}}function Qp(t){const n=this.stack[this.stack.length-2];n.type,n.checked=t.type==="taskListCheckValueChecked"}function pC(t){const n=this.stack[this.stack.length-2];if(n&&n.type==="listItem"&&typeof n.checked=="boolean"){const r=this.stack[this.stack.length-1];r.type;const s=r.children[0];if(s&&s.type==="text"){const i=n.children;let l=-1,o;for(;++l<i.length;){const a=i[l];if(a.type==="paragraph"){o=a;break}}o===r&&(s.value=s.value.slice(1),s.value.length===0?r.children.shift():r.position&&s.position&&typeof s.position.start.offset=="number"&&(s.position.start.column++,s.position.start.offset++,r.position.start=Object.assign({},s.position.start)))}}this.exit(t)}function xC(t,n,r,s){const i=t.children[0],l=typeof t.checked=="boolean"&&i&&i.type==="paragraph",o="["+(t.checked?"x":" ")+"] ",a=r.createTracker(s);l&&a.move(o);let c=Kj.listItem(t,n,r,{...s,...a.current()});return l&&(c=c.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,d)),c;function d(u){return u+o}}function fC(){return[W1(),xT(),yT(),iC(),uC()]}function gC(t){return{extensions:[Q1(),fT(t),bT(),hC(t),mC()]}}const jC={tokenize:NC,partial:!0},zj={tokenize:SC,partial:!0},Gj={tokenize:_C,partial:!0},Vj={tokenize:TC,partial:!0},yC={tokenize:CC,partial:!0},Hj={name:"wwwAutolink",tokenize:vC,previous:Wj},$j={name:"protocolAutolink",tokenize:wC,previous:Qj},cr={name:"emailAutolink",tokenize:kC,previous:Yj},Qn={};function bC(){return{text:Qn}}let Qr=48;for(;Qr<123;)Qn[Qr]=cr,Qr++,Qr===58?Qr=65:Qr===91&&(Qr=97);Qn[43]=cr;Qn[45]=cr;Qn[46]=cr;Qn[95]=cr;Qn[72]=[cr,$j];Qn[104]=[cr,$j];Qn[87]=[cr,Hj];Qn[119]=[cr,Hj];function kC(t,n,r){const s=this;let i,l;return o;function o(h){return!eh(h)||!Yj.call(s,s.previous)||gu(s.events)?r(h):(t.enter("literalAutolink"),t.enter("literalAutolinkEmail"),a(h))}function a(h){return eh(h)?(t.consume(h),a):h===64?(t.consume(h),c):r(h)}function c(h){return h===46?t.check(yC,u,d)(h):h===45||h===95||Kt(h)?(l=!0,t.consume(h),c):u(h)}function d(h){return t.consume(h),i=!0,c}function u(h){return l&&i&&Wt(s.previous)?(t.exit("literalAutolinkEmail"),t.exit("literalAutolink"),n(h)):r(h)}}function vC(t,n,r){const s=this;return i;function i(o){return o!==87&&o!==119||!Wj.call(s,s.previous)||gu(s.events)?r(o):(t.enter("literalAutolink"),t.enter("literalAutolinkWww"),t.check(jC,t.attempt(zj,t.attempt(Gj,l),r),r)(o))}function l(o){return t.exit("literalAutolinkWww"),t.exit("literalAutolink"),n(o)}}function wC(t,n,r){const s=this;let i="",l=!1;return o;function o(h){return(h===72||h===104)&&Qj.call(s,s.previous)&&!gu(s.events)?(t.enter("literalAutolink"),t.enter("literalAutolinkHttp"),i+=String.fromCodePoint(h),t.consume(h),a):r(h)}function a(h){if(Wt(h)&&i.length<5)return i+=String.fromCodePoint(h),t.consume(h),a;if(h===58){const m=i.toLowerCase();if(m==="http"||m==="https")return t.consume(h),c}return r(h)}function c(h){return h===47?(t.consume(h),l?d:(l=!0,c)):r(h)}function d(h){return h===null||aa(h)||We(h)||hs(h)||La(h)?r(h):t.attempt(zj,t.attempt(Gj,u),r)(h)}function u(h){return t.exit("literalAutolinkHttp"),t.exit("literalAutolink"),n(h)}}function NC(t,n,r){let s=0;return i;function i(o){return(o===87||o===119)&&s<3?(s++,t.consume(o),i):o===46&&s===3?(t.consume(o),l):r(o)}function l(o){return o===null?r(o):n(o)}}function SC(t,n,r){let s,i,l;return o;function o(d){return d===46||d===95?t.check(Vj,c,a)(d):d===null||We(d)||hs(d)||d!==45&&La(d)?c(d):(l=!0,t.consume(d),o)}function a(d){return d===95?s=!0:(i=s,s=void 0),t.consume(d),o}function c(d){return i||s||!l?r(d):n(d)}}function _C(t,n){let r=0,s=0;return i;function i(o){return o===40?(r++,t.consume(o),i):o===41&&s<r?l(o):o===33||o===34||o===38||o===39||o===41||o===42||o===44||o===46||o===58||o===59||o===60||o===63||o===93||o===95||o===126?t.check(Vj,n,l)(o):o===null||We(o)||hs(o)?n(o):(t.consume(o),i)}function l(o){return o===41&&s++,t.consume(o),i}}function TC(t,n,r){return s;function s(a){return a===33||a===34||a===39||a===41||a===42||a===44||a===46||a===58||a===59||a===63||a===95||a===126?(t.consume(a),s):a===38?(t.consume(a),l):a===93?(t.consume(a),i):a===60||a===null||We(a)||hs(a)?n(a):r(a)}function i(a){return a===null||a===40||a===91||We(a)||hs(a)?n(a):s(a)}function l(a){return Wt(a)?o(a):r(a)}function o(a){return a===59?(t.consume(a),s):Wt(a)?(t.consume(a),o):r(a)}}function CC(t,n,r){return s;function s(l){return t.consume(l),i}function i(l){return Kt(l)?r(l):n(l)}}function Wj(t){return t===null||t===40||t===42||t===95||t===91||t===93||t===126||We(t)}function Qj(t){return!Wt(t)}function Yj(t){return!(t===47||eh(t))}function eh(t){return t===43||t===45||t===46||t===95||Kt(t)}function gu(t){let n=t.length,r=!1;for(;n--;){const s=t[n][1];if((s.type==="labelLink"||s.type==="labelImage")&&!s._balanced){r=!0;break}if(s._gfmAutolinkLiteralWalkedInto){r=!1;break}}return t.length>0&&!r&&(t[t.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),r}const PC={tokenize:FC,partial:!0};function EC(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:AC,continuation:{tokenize:DC},exit:LC}},text:{91:{name:"gfmFootnoteCall",tokenize:IC},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:RC,resolveTo:MC}}}}function RC(t,n,r){const s=this;let i=s.events.length;const l=s.parser.gfmFootnotes||(s.parser.gfmFootnotes=[]);let o;for(;i--;){const c=s.events[i][1];if(c.type==="labelImage"){o=c;break}if(c.type==="gfmFootnoteCall"||c.type==="labelLink"||c.type==="label"||c.type==="image"||c.type==="link")break}return a;function a(c){if(!o||!o._balanced)return r(c);const d=On(s.sliceSerialize({start:o.end,end:s.now()}));return d.codePointAt(0)!==94||!l.includes(d.slice(1))?r(c):(t.enter("gfmFootnoteCallLabelMarker"),t.consume(c),t.exit("gfmFootnoteCallLabelMarker"),n(c))}}function MC(t,n){let r=t.length;for(;r--;)if(t[r][1].type==="labelImage"&&t[r][0]==="enter"){t[r][1];break}t[r+1][1].type="data",t[r+3][1].type="gfmFootnoteCallLabelMarker";const s={type:"gfmFootnoteCall",start:Object.assign({},t[r+3][1].start),end:Object.assign({},t[t.length-1][1].end)},i={type:"gfmFootnoteCallMarker",start:Object.assign({},t[r+3][1].end),end:Object.assign({},t[r+3][1].end)};i.end.column++,i.end.offset++,i.end._bufferIndex++;const l={type:"gfmFootnoteCallString",start:Object.assign({},i.end),end:Object.assign({},t[t.length-1][1].start)},o={type:"chunkString",contentType:"string",start:Object.assign({},l.start),end:Object.assign({},l.end)},a=[t[r+1],t[r+2],["enter",s,n],t[r+3],t[r+4],["enter",i,n],["exit",i,n],["enter",l,n],["enter",o,n],["exit",o,n],["exit",l,n],t[t.length-2],t[t.length-1],["exit",s,n]];return t.splice(r,t.length-r+1,...a),t}function IC(t,n,r){const s=this,i=s.parser.gfmFootnotes||(s.parser.gfmFootnotes=[]);let l=0,o;return a;function a(h){return t.enter("gfmFootnoteCall"),t.enter("gfmFootnoteCallLabelMarker"),t.consume(h),t.exit("gfmFootnoteCallLabelMarker"),c}function c(h){return h!==94?r(h):(t.enter("gfmFootnoteCallMarker"),t.consume(h),t.exit("gfmFootnoteCallMarker"),t.enter("gfmFootnoteCallString"),t.enter("chunkString").contentType="string",d)}function d(h){if(l>999||h===93&&!o||h===null||h===91||We(h))return r(h);if(h===93){t.exit("chunkString");const m=t.exit("gfmFootnoteCallString");return i.includes(On(s.sliceSerialize(m)))?(t.enter("gfmFootnoteCallLabelMarker"),t.consume(h),t.exit("gfmFootnoteCallLabelMarker"),t.exit("gfmFootnoteCall"),n):r(h)}return We(h)||(o=!0),l++,t.consume(h),h===92?u:d}function u(h){return h===91||h===92||h===93?(t.consume(h),l++,d):d(h)}}function AC(t,n,r){const s=this,i=s.parser.gfmFootnotes||(s.parser.gfmFootnotes=[]);let l,o=0,a;return c;function c(j){return t.enter("gfmFootnoteDefinition")._container=!0,t.enter("gfmFootnoteDefinitionLabel"),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(j),t.exit("gfmFootnoteDefinitionLabelMarker"),d}function d(j){return j===94?(t.enter("gfmFootnoteDefinitionMarker"),t.consume(j),t.exit("gfmFootnoteDefinitionMarker"),t.enter("gfmFootnoteDefinitionLabelString"),t.enter("chunkString").contentType="string",u):r(j)}function u(j){if(o>999||j===93&&!a||j===null||j===91||We(j))return r(j);if(j===93){t.exit("chunkString");const b=t.exit("gfmFootnoteDefinitionLabelString");return l=On(s.sliceSerialize(b)),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(j),t.exit("gfmFootnoteDefinitionLabelMarker"),t.exit("gfmFootnoteDefinitionLabel"),m}return We(j)||(a=!0),o++,t.consume(j),j===92?h:u}function h(j){return j===91||j===92||j===93?(t.consume(j),o++,u):u(j)}function m(j){return j===58?(t.enter("definitionMarker"),t.consume(j),t.exit("definitionMarker"),i.includes(l)||i.push(l),De(t,x,"gfmFootnoteDefinitionWhitespace")):r(j)}function x(j){return n(j)}}function DC(t,n,r){return t.check(Fl,n,t.attempt(PC,n,r))}function LC(t){t.exit("gfmFootnoteDefinition")}function FC(t,n,r){const s=this;return De(t,i,"gfmFootnoteDefinitionIndent",5);function i(l){const o=s.events[s.events.length-1];return o&&o[1].type==="gfmFootnoteDefinitionIndent"&&o[2].sliceSerialize(o[1],!0).length===4?n(l):r(l)}}function OC(t){let r=(t||{}).singleTilde;const s={name:"strikethrough",tokenize:l,resolveAll:i};return r==null&&(r=!0),{text:{126:s},insideSpan:{null:[s]},attentionMarkers:{null:[126]}};function i(o,a){let c=-1;for(;++c<o.length;)if(o[c][0]==="enter"&&o[c][1].type==="strikethroughSequenceTemporary"&&o[c][1]._close){let d=c;for(;d--;)if(o[d][0]==="exit"&&o[d][1].type==="strikethroughSequenceTemporary"&&o[d][1]._open&&o[c][1].end.offset-o[c][1].start.offset===o[d][1].end.offset-o[d][1].start.offset){o[c][1].type="strikethroughSequence",o[d][1].type="strikethroughSequence";const u={type:"strikethrough",start:Object.assign({},o[d][1].start),end:Object.assign({},o[c][1].end)},h={type:"strikethroughText",start:Object.assign({},o[d][1].end),end:Object.assign({},o[c][1].start)},m=[["enter",u,a],["enter",o[d][1],a],["exit",o[d][1],a],["enter",h,a]],x=a.parser.constructs.insideSpan.null;x&&xn(m,m.length,0,Fa(x,o.slice(d+1,c),a)),xn(m,m.length,0,[["exit",h,a],["enter",o[c][1],a],["exit",o[c][1],a],["exit",u,a]]),xn(o,d-1,c-d+3,m),c=d+m.length-2;break}}for(c=-1;++c<o.length;)o[c][1].type==="strikethroughSequenceTemporary"&&(o[c][1].type="data");return o}function l(o,a,c){const d=this.previous,u=this.events;let h=0;return m;function m(j){return d===126&&u[u.length-1][1].type!=="characterEscape"?c(j):(o.enter("strikethroughSequenceTemporary"),x(j))}function x(j){const b=ni(d);if(j===126)return h>1?c(j):(o.consume(j),h++,x);if(h<2&&!r)return c(j);const N=o.exit("strikethroughSequenceTemporary"),f=ni(j);return N._open=!f||f===2&&!!b,N._close=!b||b===2&&!!f,a(j)}}}class qC{constructor(){this.map=[]}add(n,r,s){BC(this,n,r,s)}consume(n){if(this.map.sort(function(l,o){return l[0]-o[0]}),this.map.length===0)return;let r=this.map.length;const s=[];for(;r>0;)r-=1,s.push(n.slice(this.map[r][0]+this.map[r][1]),this.map[r][2]),n.length=this.map[r][0];s.push(n.slice()),n.length=0;let i=s.pop();for(;i;){for(const l of i)n.push(l);i=s.pop()}this.map.length=0}}function BC(t,n,r,s){let i=0;if(!(r===0&&s.length===0)){for(;i<t.map.length;){if(t.map[i][0]===n){t.map[i][1]+=r,t.map[i][2].push(...s);return}i+=1}t.map.push([n,r,s])}}function UC(t,n){let r=!1;const s=[];for(;n<t.length;){const i=t[n];if(r){if(i[0]==="enter")i[1].type==="tableContent"&&s.push(t[n+1][1].type==="tableDelimiterMarker"?"left":"none");else if(i[1].type==="tableContent"){if(t[n-1][1].type==="tableDelimiterMarker"){const l=s.length-1;s[l]=s[l]==="left"?"center":"right"}}else if(i[1].type==="tableDelimiterRow")break}else i[0]==="enter"&&i[1].type==="tableDelimiterRow"&&(r=!0);n+=1}return s}function KC(){return{flow:{null:{name:"table",tokenize:zC,resolveAll:GC}}}}function zC(t,n,r){const s=this;let i=0,l=0,o;return a;function a(T){let P=s.events.length-1;for(;P>-1;){const X=s.events[P][1].type;if(X==="lineEnding"||X==="linePrefix")P--;else break}const I=P>-1?s.events[P][1].type:null,O=I==="tableHead"||I==="tableRow"?_:c;return O===_&&s.parser.lazy[s.now().line]?r(T):O(T)}function c(T){return t.enter("tableHead"),t.enter("tableRow"),d(T)}function d(T){return T===124||(o=!0,l+=1),u(T)}function u(T){return T===null?r(T):ke(T)?l>1?(l=0,s.interrupt=!0,t.exit("tableRow"),t.enter("lineEnding"),t.consume(T),t.exit("lineEnding"),x):r(T):Me(T)?De(t,u,"whitespace")(T):(l+=1,o&&(o=!1,i+=1),T===124?(t.enter("tableCellDivider"),t.consume(T),t.exit("tableCellDivider"),o=!0,u):(t.enter("data"),h(T)))}function h(T){return T===null||T===124||We(T)?(t.exit("data"),u(T)):(t.consume(T),T===92?m:h)}function m(T){return T===92||T===124?(t.consume(T),h):h(T)}function x(T){return s.interrupt=!1,s.parser.lazy[s.now().line]?r(T):(t.enter("tableDelimiterRow"),o=!1,Me(T)?De(t,j,"linePrefix",s.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(T):j(T))}function j(T){return T===45||T===58?N(T):T===124?(o=!0,t.enter("tableCellDivider"),t.consume(T),t.exit("tableCellDivider"),b):S(T)}function b(T){return Me(T)?De(t,N,"whitespace")(T):N(T)}function N(T){return T===58?(l+=1,o=!0,t.enter("tableDelimiterMarker"),t.consume(T),t.exit("tableDelimiterMarker"),f):T===45?(l+=1,f(T)):T===null||ke(T)?k(T):S(T)}function f(T){return T===45?(t.enter("tableDelimiterFiller"),p(T)):S(T)}function p(T){return T===45?(t.consume(T),p):T===58?(o=!0,t.exit("tableDelimiterFiller"),t.enter("tableDelimiterMarker"),t.consume(T),t.exit("tableDelimiterMarker"),g):(t.exit("tableDelimiterFiller"),g(T))}function g(T){return Me(T)?De(t,k,"whitespace")(T):k(T)}function k(T){return T===124?j(T):T===null||ke(T)?!o||i!==l?S(T):(t.exit("tableDelimiterRow"),t.exit("tableHead"),n(T)):S(T)}function S(T){return r(T)}function _(T){return t.enter("tableRow"),E(T)}function E(T){return T===124?(t.enter("tableCellDivider"),t.consume(T),t.exit("tableCellDivider"),E):T===null||ke(T)?(t.exit("tableRow"),n(T)):Me(T)?De(t,E,"whitespace")(T):(t.enter("data"),D(T))}function D(T){return T===null||T===124||We(T)?(t.exit("data"),E(T)):(t.consume(T),T===92?L:D)}function L(T){return T===92||T===124?(t.consume(T),D):D(T)}}function GC(t,n){let r=-1,s=!0,i=0,l=[0,0,0,0],o=[0,0,0,0],a=!1,c=0,d,u,h;const m=new qC;for(;++r<t.length;){const x=t[r],j=x[1];x[0]==="enter"?j.type==="tableHead"?(a=!1,c!==0&&(Yp(m,n,c,d,u),u=void 0,c=0),d={type:"table",start:Object.assign({},j.start),end:Object.assign({},j.end)},m.add(r,0,[["enter",d,n]])):j.type==="tableRow"||j.type==="tableDelimiterRow"?(s=!0,h=void 0,l=[0,0,0,0],o=[0,r+1,0,0],a&&(a=!1,u={type:"tableBody",start:Object.assign({},j.start),end:Object.assign({},j.end)},m.add(r,0,[["enter",u,n]])),i=j.type==="tableDelimiterRow"?2:u?3:1):i&&(j.type==="data"||j.type==="tableDelimiterMarker"||j.type==="tableDelimiterFiller")?(s=!1,o[2]===0&&(l[1]!==0&&(o[0]=o[1],h=fo(m,n,l,i,void 0,h),l=[0,0,0,0]),o[2]=r)):j.type==="tableCellDivider"&&(s?s=!1:(l[1]!==0&&(o[0]=o[1],h=fo(m,n,l,i,void 0,h)),l=o,o=[l[1],r,0,0])):j.type==="tableHead"?(a=!0,c=r):j.type==="tableRow"||j.type==="tableDelimiterRow"?(c=r,l[1]!==0?(o[0]=o[1],h=fo(m,n,l,i,r,h)):o[1]!==0&&(h=fo(m,n,o,i,r,h)),i=0):i&&(j.type==="data"||j.type==="tableDelimiterMarker"||j.type==="tableDelimiterFiller")&&(o[3]=r)}for(c!==0&&Yp(m,n,c,d,u),m.consume(n.events),r=-1;++r<n.events.length;){const x=n.events[r];x[0]==="enter"&&x[1].type==="table"&&(x[1]._align=UC(n.events,r))}return t}function fo(t,n,r,s,i,l){const o=s===1?"tableHeader":s===2?"tableDelimiter":"tableData",a="tableContent";r[0]!==0&&(l.end=Object.assign({},Ss(n.events,r[0])),t.add(r[0],0,[["exit",l,n]]));const c=Ss(n.events,r[1]);if(l={type:o,start:Object.assign({},c),end:Object.assign({},c)},t.add(r[1],0,[["enter",l,n]]),r[2]!==0){const d=Ss(n.events,r[2]),u=Ss(n.events,r[3]),h={type:a,start:Object.assign({},d),end:Object.assign({},u)};if(t.add(r[2],0,[["enter",h,n]]),s!==2){const m=n.events[r[2]],x=n.events[r[3]];if(m[1].end=Object.assign({},x[1].end),m[1].type="chunkText",m[1].contentType="text",r[3]>r[2]+1){const j=r[2]+1,b=r[3]-r[2]-1;t.add(j,b,[])}}t.add(r[3]+1,0,[["exit",h,n]])}return i!==void 0&&(l.end=Object.assign({},Ss(n.events,i)),t.add(i,0,[["exit",l,n]]),l=void 0),l}function Yp(t,n,r,s,i){const l=[],o=Ss(n.events,r);i&&(i.end=Object.assign({},o),l.push(["exit",i,n])),s.end=Object.assign({},o),l.push(["exit",s,n]),t.add(r+1,0,l)}function Ss(t,n){const r=t[n],s=r[0]==="enter"?"start":"end";return r[1][s]}const VC={name:"tasklistCheck",tokenize:$C};function HC(){return{text:{91:VC}}}function $C(t,n,r){const s=this;return i;function i(c){return s.previous!==null||!s._gfmTasklistFirstContentOfListItem?r(c):(t.enter("taskListCheck"),t.enter("taskListCheckMarker"),t.consume(c),t.exit("taskListCheckMarker"),l)}function l(c){return We(c)?(t.enter("taskListCheckValueUnchecked"),t.consume(c),t.exit("taskListCheckValueUnchecked"),o):c===88||c===120?(t.enter("taskListCheckValueChecked"),t.consume(c),t.exit("taskListCheckValueChecked"),o):r(c)}function o(c){return c===93?(t.enter("taskListCheckMarker"),t.consume(c),t.exit("taskListCheckMarker"),t.exit("taskListCheck"),a):r(c)}function a(c){return ke(c)?n(c):Me(c)?t.check({tokenize:WC},n,r)(c):r(c)}}function WC(t,n,r){return De(t,s,"whitespace");function s(i){return i===null?r(i):n(i)}}function QC(t){return lj([bC(),EC(),OC(t),KC(),HC()])}const YC={};function XC(t){const n=this,r=t||YC,s=n.data(),i=s.micromarkExtensions||(s.micromarkExtensions=[]),l=s.fromMarkdownExtensions||(s.fromMarkdownExtensions=[]),o=s.toMarkdownExtensions||(s.toMarkdownExtensions=[]);i.push(QC(r)),l.push(fC()),o.push(gC(r))}const Sl="kronk_chat_messages",ri="kronk_chat_history",JC="kronk:chatHistory",ZC=1,Dn="session",tn="history",Vn="meta";function tl(t){return new Promise((n,r)=>{t.onsuccess=()=>n(t.result),t.onerror=()=>r(t.error)})}function ss(t){return new Promise((n,r)=>{t.oncomplete=()=>n(),t.onerror=()=>r(t.error),t.onabort=()=>r(t.error)})}let Di=null;function eP(){return Di||(Di=new Promise((t,n)=>{const r=indexedDB.open(JC,ZC);r.onupgradeneeded=()=>{const s=r.result;s.objectStoreNames.contains(Dn)||s.createObjectStore(Dn,{keyPath:"key"}),s.objectStoreNames.contains(tn)||s.createObjectStore(tn,{keyPath:"id"}).createIndex("by_savedAt","savedAt"),s.objectStoreNames.contains(Vn)||s.createObjectStore(Vn,{keyPath:"key"})},r.onsuccess=()=>t(r.result),r.onerror=()=>{Di=null,n(r.error)}}),Di)}let Ui=!1,go=null;async function tP(t){if(!Ui)return go||(go=nP(t),go)}async function nP(t){const n=t.transaction(Vn,"readonly");if(await tl(n.objectStore(Vn).get("migratedFromLocalStorage"))){Ui=!0;return}const s=t.transaction([Dn,tn],"readonly"),i=await tl(s.objectStore(Dn).count()),l=await tl(s.objectStore(tn).count());if(i>0||l>0){const a=t.transaction(Vn,"readwrite");a.objectStore(Vn).put({key:"migratedFromLocalStorage",value:!0}),await ss(a),Ui=!0;return}try{const a=t.transaction([Dn,tn,Vn],"readwrite");let c=!1;const d=localStorage.getItem(Sl);if(d){const h=JSON.parse(d);Array.isArray(h)&&h.length>0&&(a.objectStore(Dn).put({key:"messages",value:h}),c=!0)}const u=localStorage.getItem(ri);if(u){const h=JSON.parse(u);if(Array.isArray(h)){const m=a.objectStore(tn);for(const x of h)m.put(x);h.length>0&&(c=!0)}}a.objectStore(Vn).put({key:"migratedFromLocalStorage",value:!0}),await ss(a),c&&(localStorage.removeItem(Sl),localStorage.removeItem(ri)),Ui=!0;return}catch{}const o=t.transaction(Vn,"readwrite");o.objectStore(Vn).put({key:"migratedFromLocalStorage",value:!0}),await ss(o),Ui=!0}async function pi(){const t=await eP();return await tP(t),t}function rP(){try{const t=localStorage.getItem(Sl);if(!t)return[];const n=JSON.parse(t);return Array.isArray(n)?n:[]}catch{return[]}}function sP(t){try{t.length>0?localStorage.setItem(Sl,JSON.stringify(t)):localStorage.removeItem(Sl)}catch{}}function ju(){try{const t=localStorage.getItem(ri);if(!t)return[];const n=JSON.parse(t);return Array.isArray(n)?n:[]}catch{return[]}}function Xj(t){try{t.length>0?localStorage.setItem(ri,JSON.stringify(t)):localStorage.removeItem(ri)}catch{}}async function iP(){try{const n=(await pi()).transaction(Dn,"readonly"),r=await tl(n.objectStore(Dn).get("messages"));return r&&Array.isArray(r.value)?r.value:[]}catch{return rP()}}async function Jj(t){try{const r=(await pi()).transaction(Dn,"readwrite");t.length===0?r.objectStore(Dn).delete("messages"):r.objectStore(Dn).put({key:"messages",value:t}),await ss(r)}catch{sP(t)}}async function lP(){await Jj([])}async function oP(){try{const r=(await pi()).transaction(tn,"readonly").objectStore(tn).index("by_savedAt");return(await tl(r.getAll())).reverse()}catch{return ju()}}async function aP(t){try{const r=(await pi()).transaction(tn,"readwrite");r.objectStore(tn).put(t),await ss(r)}catch{const n=ju().filter(r=>r.id!==t.id);n.unshift(t),Xj(n)}}async function cP(t){if(t.length!==0)try{const r=(await pi()).transaction(tn,"readwrite"),s=r.objectStore(tn);for(const i of t)s.delete(i);await ss(r)}catch{const n=new Set(t),r=ju().filter(s=>!n.has(s.id));Xj(r)}}async function dP(){try{const n=(await pi()).transaction(tn,"readwrite");n.objectStore(tn).clear(),await ss(n)}catch{try{localStorage.removeItem(ri)}catch{}}}const Zj=y.createContext(null);function hP({children:t}){const[n,r]=y.useState([]),s=y.useRef(!1),i=y.useRef(Promise.resolve());y.useEffect(()=>{let a=!1;return iP().then(c=>{a||(r(d=>d.length===0?c:d),s.current=!0)}),()=>{a=!0}},[]),y.useEffect(()=>{if(!s.current)return;const a=window.setTimeout(()=>{i.current=i.current.then(()=>Jj(n)).catch(()=>{})},250);return()=>window.clearTimeout(a)},[n]);const l=y.useCallback(a=>{r(a)},[]),o=y.useCallback(()=>{r([]),lP()},[]);return e.jsx(Zj.Provider,{value:{messages:n,setMessages:l,clearMessages:o},children:t})}function uP(){const t=y.useContext(Zj);if(!t)throw new Error("useChatMessages must be used within a ChatProvider");return t}const qc="kronk_chat_sampling",He={maxTokens:4096,temperature:.8,topP:.9,topK:40,minP:0,presencePenalty:0,repeatPenalty:1,repeatLastN:64,dryMultiplier:1.05,dryBase:1.75,dryAllowedLen:2,dryPenaltyLast:0,xtcProbability:0,xtcThreshold:.1,xtcMinKeep:1,frequencyPenalty:0,enableThinking:"",reasoningEffort:"",returnPrompt:!1,includeUsage:!0,logprobs:!1,topLogprobs:0,grammar:"",systemPrompt:"",cacheId:""},ey=y.createContext(null);function mP({children:t}){const[n,r]=y.useState(()=>{try{const l=localStorage.getItem(qc);if(l)return{...He,...JSON.parse(l)}}catch{}return He});y.useEffect(()=>{try{localStorage.setItem(qc,JSON.stringify(n))}catch{}},[n]);const s=y.useCallback(l=>{r(o=>({...o,...l}))},[]),i=y.useCallback(()=>{r(He),localStorage.removeItem(qc)},[]);return e.jsx(ey.Provider,{value:{sampling:n,setSampling:s,resetSampling:i},children:t})}function pP(){const t=y.useContext(ey);if(!t)throw new Error("useSampling must be used within a SamplingProvider");return t}function _e(t,n,r){return r?n!==r[t]:!1}function ct(t,n){if(!n)return"";const r=n[t];return typeof r=="boolean"?r?"true":"false":typeof r=="string"?r===""?"default":r:String(r)}const xP=["maxTokens","temperature","topP","topK"],ty=["minP","presencePenalty","repeatPenalty","repeatLastN","frequencyPenalty","dryMultiplier","dryBase","dryAllowedLen","dryPenaltyLast","xtcProbability","xtcThreshold","xtcMinKeep","enableThinking","reasoningEffort"];function Xp(t,n){return n?[...xP,...ty].some(r=>t[r]!==n[r]):!1}function fP(t,n){return n?ty.some(r=>t[r]!==n[r]):!1}Prism.languages.go=Prism.languages.extend("clike",{string:{pattern:/(^|[^\\])"(?:\\.|[^"\\\r\n])*"|`[^`]*`/,lookbehind:!0,greedy:!0},keyword:/\b(?:break|case|chan|const|continue|default|defer|else|fallthrough|for|func|go(?:to)?|if|import|interface|map|package|range|return|select|struct|switch|type|var)\b/,boolean:/\b(?:_|false|iota|nil|true)\b/,number:[/\b0(?:b[01_]+|o[0-7_]+)i?\b/i,/\b0x(?:[a-f\d_]+(?:\.[a-f\d_]*)?|\.[a-f\d_]+)(?:p[+-]?\d+(?:_\d+)*)?i?(?!\w)/i,/(?:\b\d[\d_]*(?:\.[\d_]*)?|\B\.\d[\d_]*)(?:e[+-]?[\d_]+)?i?(?!\w)/i],operator:/[*\/%^!=]=?|\+[=+]?|-[=-]?|\|[=|]?|&(?:=|&|\^=?)?|>(?:>=?|=)?|<(?:<=?|=|-)?|:=|\.\.\./,builtin:/\b(?:append|bool|byte|cap|close|complex|complex(?:64|128)|copy|delete|error|float(?:32|64)|u?int(?:8|16|32|64)?|imag|len|make|new|panic|print(?:ln)?|real|recover|rune|string|uintptr)\b/});Prism.languages.insertBefore("go","string",{char:{pattern:/'(?:\\.|[^'\\\r\n]){0,10}'/,greedy:!0}});delete Prism.languages.go["class-name"];Prism.languages.python={comment:{pattern:/(^|[^\\])#.*/,lookbehind:!0,greedy:!0},"string-interpolation":{pattern:/(?:f|fr|rf)(?:("""|''')[\s\S]*?\1|("|')(?:\\.|(?!\2)[^\\\r\n])*\2)/i,greedy:!0,inside:{interpolation:{pattern:/((?:^|[^{])(?:\{\{)*)\{(?!\{)(?:[^{}]|\{(?!\{)(?:[^{}]|\{(?!\{)(?:[^{}])+\})+\})+\}/,lookbehind:!0,inside:{"format-spec":{pattern:/(:)[^:(){}]+(?=\}$)/,lookbehind:!0},"conversion-option":{pattern:/![sra](?=[:}]$)/,alias:"punctuation"},rest:null}},string:/[\s\S]+/}},"triple-quoted-string":{pattern:/(?:[rub]|br|rb)?("""|''')[\s\S]*?\1/i,greedy:!0,alias:"string"},string:{pattern:/(?:[rub]|br|rb)?("|')(?:\\.|(?!\1)[^\\\r\n])*\1/i,greedy:!0},function:{pattern:/((?:^|\s)def[ \t]+)[a-zA-Z_]\w*(?=\s*\()/g,lookbehind:!0},"class-name":{pattern:/(\bclass\s+)\w+/i,lookbehind:!0},decorator:{pattern:/(^[\t ]*)@\w+(?:\.\w+)*/m,lookbehind:!0,alias:["annotation","punctuation"],inside:{punctuation:/\./}},keyword:/\b(?:_(?=\s*:)|and|as|assert|async|await|break|case|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|match|nonlocal|not|or|pass|print|raise|return|try|while|with|yield)\b/,builtin:/\b(?:__import__|abs|all|any|apply|ascii|basestring|bin|bool|buffer|bytearray|bytes|callable|chr|classmethod|cmp|coerce|compile|complex|delattr|dict|dir|divmod|enumerate|eval|execfile|file|filter|float|format|frozenset|getattr|globals|hasattr|hash|help|hex|id|input|int|intern|isinstance|issubclass|iter|len|list|locals|long|map|max|memoryview|min|next|object|oct|open|ord|pow|property|range|raw_input|reduce|reload|repr|reversed|round|set|setattr|slice|sorted|staticmethod|str|sum|super|tuple|type|unichr|unicode|vars|xrange|zip)\b/,boolean:/\b(?:False|None|True)\b/,number:/\b0(?:b(?:_?[01])+|o(?:_?[0-7])+|x(?:_?[a-f0-9])+)\b|(?:\b\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\B\.\d+(?:_\d+)*)(?:e[+-]?\d+(?:_\d+)*)?j?(?!\w)/i,operator:/[-+%=]=?|!=|:=|\*\*?=?|\/\/?=?|<[<=>]?|>[=>]?|[&|^~]/,punctuation:/[{}[\];(),.:]/};Prism.languages.python["string-interpolation"].inside.interpolation.inside.rest=Prism.languages.python;Prism.languages.py=Prism.languages.python;Prism.languages.javascript=Prism.languages.extend("clike",{"class-name":[Prism.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+(/NaN|Infinity/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source)+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/});Prism.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/;Prism.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:Prism.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:Prism.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:Prism.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:Prism.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:Prism.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/});Prism.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:Prism.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}});Prism.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}});Prism.languages.markup&&(Prism.languages.markup.tag.addInlined("script","javascript"),Prism.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript"));Prism.languages.js=Prism.languages.javascript;(function(t){t.languages.typescript=t.languages.extend("javascript",{"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|type)\s+)(?!keyof\b)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?:\s*<(?:[^<>]|<(?:[^<>]|<[^<>]*>)*>)*>)?/,lookbehind:!0,greedy:!0,inside:null},builtin:/\b(?:Array|Function|Promise|any|boolean|console|never|number|string|symbol|unknown)\b/}),t.languages.typescript.keyword.push(/\b(?:abstract|declare|is|keyof|readonly|require)\b/,/\b(?:asserts|infer|interface|module|namespace|type)\b(?=\s*(?:[{_$a-zA-Z\xA0-\uFFFF]|$))/,/\btype\b(?=\s*(?:[\{*]|$))/),delete t.languages.typescript.parameter,delete t.languages.typescript["literal-property"];var n=t.languages.extend("typescript",{});delete n["class-name"],t.languages.typescript["class-name"].inside=n,t.languages.insertBefore("typescript","function",{decorator:{pattern:/@[$\w\xA0-\uFFFF]+/,inside:{at:{pattern:/^@/,alias:"operator"},function:/^[\s\S]+/}},"generic-function":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*<(?:[^<>]|<(?:[^<>]|<[^<>]*>)*>)*>(?=\s*\()/,greedy:!0,inside:{function:/^#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*/,generic:{pattern:/<[\s\S]+/,alias:"class-name",inside:n}}}}),t.languages.ts=t.languages.typescript})(Prism);(function(t){for(var n=/\/\*(?:[^*/]|\*(?!\/)|\/(?!\*)|<self>)*\*\//.source,r=0;r<2;r++)n=n.replace(/<self>/g,function(){return n});n=n.replace(/<self>/g,function(){return/[^\s\S]/.source}),t.languages.rust={comment:[{pattern:RegExp(/(^|[^\\])/.source+n),lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/b?"(?:\\[\s\S]|[^\\"])*"|b?r(#*)"(?:[^"]|"(?!\1))*"\1/,greedy:!0},char:{pattern:/b?'(?:\\(?:x[0-7][\da-fA-F]|u\{(?:[\da-fA-F]_*){1,6}\}|.)|[^\\\r\n\t'])'/,greedy:!0},attribute:{pattern:/#!?\[(?:[^\[\]"]|"(?:\\[\s\S]|[^\\"])*")*\]/,greedy:!0,alias:"attr-name",inside:{string:null}},"closure-params":{pattern:/([=(,:]\s*|\bmove\s*)\|[^|]*\||\|[^|]*\|(?=\s*(?:\{|->))/,lookbehind:!0,greedy:!0,inside:{"closure-punctuation":{pattern:/^\||\|$/,alias:"punctuation"},rest:null}},"lifetime-annotation":{pattern:/'\w+/,alias:"symbol"},"fragment-specifier":{pattern:/(\$\w+:)[a-z]+/,lookbehind:!0,alias:"punctuation"},variable:/\$\w+/,"function-definition":{pattern:/(\bfn\s+)\w+/,lookbehind:!0,alias:"function"},"type-definition":{pattern:/(\b(?:enum|struct|trait|type|union)\s+)\w+/,lookbehind:!0,alias:"class-name"},"module-declaration":[{pattern:/(\b(?:crate|mod)\s+)[a-z][a-z_\d]*/,lookbehind:!0,alias:"namespace"},{pattern:/(\b(?:crate|self|super)\s*)::\s*[a-z][a-z_\d]*\b(?:\s*::(?:\s*[a-z][a-z_\d]*\s*::)*)?/,lookbehind:!0,alias:"namespace",inside:{punctuation:/::/}}],keyword:[/\b(?:Self|abstract|as|async|await|become|box|break|const|continue|crate|do|dyn|else|enum|extern|final|fn|for|if|impl|in|let|loop|macro|match|mod|move|mut|override|priv|pub|ref|return|self|static|struct|super|trait|try|type|typeof|union|unsafe|unsized|use|virtual|where|while|yield)\b/,/\b(?:bool|char|f(?:32|64)|[ui](?:8|16|32|64|128|size)|str)\b/],function:/\b[a-z_]\w*(?=\s*(?:::\s*<|\())/,macro:{pattern:/\b\w+!/,alias:"property"},constant:/\b[A-Z_][A-Z_\d]+\b/,"class-name":/\b[A-Z]\w*\b/,namespace:{pattern:/(?:\b[a-z][a-z_\d]*\s*::\s*)*\b[a-z][a-z_\d]*\s*::(?!\s*<)/,inside:{punctuation:/::/}},number:/\b(?:0x[\dA-Fa-f](?:_?[\dA-Fa-f])*|0o[0-7](?:_?[0-7])*|0b[01](?:_?[01])*|(?:(?:\d(?:_?\d)*)?\.)?\d(?:_?\d)*(?:[Ee][+-]?\d+)?)(?:_?(?:f32|f64|[iu](?:8|16|32|64|size)?))?\b/,boolean:/\b(?:false|true)\b/,punctuation:/->|\.\.=|\.{1,3}|::|[{}[\];(),:]/,operator:/[-+*\/%!^]=?|=[=>]?|&[&=]?|\|[|=]?|<<?=?|>>?=?|[@?]/},t.languages.rust["closure-params"].inside.rest=t.languages.rust,t.languages.rust.attribute.inside.string=t.languages.rust.string})(Prism);Prism.languages.sql={comment:{pattern:/(^|[^\\])(?:\/\*[\s\S]*?\*\/|(?:--|\/\/|#).*)/,lookbehind:!0},variable:[{pattern:/@(["'`])(?:\\[\s\S]|(?!\1)[^\\])+\1/,greedy:!0},/@[\w.$]+/],string:{pattern:/(^|[^@\\])("|')(?:\\[\s\S]|(?!\2)[^\\]|\2\2)*\2/,greedy:!0,lookbehind:!0},identifier:{pattern:/(^|[^@\\])`(?:\\[\s\S]|[^`\\]|``)*`/,greedy:!0,lookbehind:!0,inside:{punctuation:/^`|`$/}},function:/\b(?:AVG|COUNT|FIRST|FORMAT|LAST|LCASE|LEN|MAX|MID|MIN|MOD|NOW|ROUND|SUM|UCASE)(?=\s*\()/i,keyword:/\b(?:ACTION|ADD|AFTER|ALGORITHM|ALL|ALTER|ANALYZE|ANY|APPLY|AS|ASC|AUTHORIZATION|AUTO_INCREMENT|BACKUP|BDB|BEGIN|BERKELEYDB|BIGINT|BINARY|BIT|BLOB|BOOL|BOOLEAN|BREAK|BROWSE|BTREE|BULK|BY|CALL|CASCADED?|CASE|CHAIN|CHAR(?:ACTER|SET)?|CHECK(?:POINT)?|CLOSE|CLUSTERED|COALESCE|COLLATE|COLUMNS?|COMMENT|COMMIT(?:TED)?|COMPUTE|CONNECT|CONSISTENT|CONSTRAINT|CONTAINS(?:TABLE)?|CONTINUE|CONVERT|CREATE|CROSS|CURRENT(?:_DATE|_TIME|_TIMESTAMP|_USER)?|CURSOR|CYCLE|DATA(?:BASES?)?|DATE(?:TIME)?|DAY|DBCC|DEALLOCATE|DEC|DECIMAL|DECLARE|DEFAULT|DEFINER|DELAYED|DELETE|DELIMITERS?|DENY|DESC|DESCRIBE|DETERMINISTIC|DISABLE|DISCARD|DISK|DISTINCT|DISTINCTROW|DISTRIBUTED|DO|DOUBLE|DROP|DUMMY|DUMP(?:FILE)?|DUPLICATE|ELSE(?:IF)?|ENABLE|ENCLOSED|END|ENGINE|ENUM|ERRLVL|ERRORS|ESCAPED?|EXCEPT|EXEC(?:UTE)?|EXISTS|EXIT|EXPLAIN|EXTENDED|FETCH|FIELDS|FILE|FILLFACTOR|FIRST|FIXED|FLOAT|FOLLOWING|FOR(?: EACH ROW)?|FORCE|FOREIGN|FREETEXT(?:TABLE)?|FROM|FULL|FUNCTION|GEOMETRY(?:COLLECTION)?|GLOBAL|GOTO|GRANT|GROUP|HANDLER|HASH|HAVING|HOLDLOCK|HOUR|IDENTITY(?:COL|_INSERT)?|IF|IGNORE|IMPORT|INDEX|INFILE|INNER|INNODB|INOUT|INSERT|INT|INTEGER|INTERSECT|INTERVAL|INTO|INVOKER|ISOLATION|ITERATE|JOIN|KEYS?|KILL|LANGUAGE|LAST|LEAVE|LEFT|LEVEL|LIMIT|LINENO|LINES|LINESTRING|LOAD|LOCAL|LOCK|LONG(?:BLOB|TEXT)|LOOP|MATCH(?:ED)?|MEDIUM(?:BLOB|INT|TEXT)|MERGE|MIDDLEINT|MINUTE|MODE|MODIFIES|MODIFY|MONTH|MULTI(?:LINESTRING|POINT|POLYGON)|NATIONAL|NATURAL|NCHAR|NEXT|NO|NONCLUSTERED|NULLIF|NUMERIC|OFF?|OFFSETS?|ON|OPEN(?:DATASOURCE|QUERY|ROWSET)?|OPTIMIZE|OPTION(?:ALLY)?|ORDER|OUT(?:ER|FILE)?|OVER|PARTIAL|PARTITION|PERCENT|PIVOT|PLAN|POINT|POLYGON|PRECEDING|PRECISION|PREPARE|PREV|PRIMARY|PRINT|PRIVILEGES|PROC(?:EDURE)?|PUBLIC|PURGE|QUICK|RAISERROR|READS?|REAL|RECONFIGURE|REFERENCES|RELEASE|RENAME|REPEAT(?:ABLE)?|REPLACE|REPLICATION|REQUIRE|RESIGNAL|RESTORE|RESTRICT|RETURN(?:ING|S)?|REVOKE|RIGHT|ROLLBACK|ROUTINE|ROW(?:COUNT|GUIDCOL|S)?|RTREE|RULE|SAVE(?:POINT)?|SCHEMA|SECOND|SELECT|SERIAL(?:IZABLE)?|SESSION(?:_USER)?|SET(?:USER)?|SHARE|SHOW|SHUTDOWN|SIMPLE|SMALLINT|SNAPSHOT|SOME|SONAME|SQL|START(?:ING)?|STATISTICS|STATUS|STRIPED|SYSTEM_USER|TABLES?|TABLESPACE|TEMP(?:ORARY|TABLE)?|TERMINATED|TEXT(?:SIZE)?|THEN|TIME(?:STAMP)?|TINY(?:BLOB|INT|TEXT)|TOP?|TRAN(?:SACTIONS?)?|TRIGGER|TRUNCATE|TSEQUAL|TYPES?|UNBOUNDED|UNCOMMITTED|UNDEFINED|UNION|UNIQUE|UNLOCK|UNPIVOT|UNSIGNED|UPDATE(?:TEXT)?|USAGE|USE|USER|USING|VALUES?|VAR(?:BINARY|CHAR|CHARACTER|YING)|VIEW|WAITFOR|WARNINGS|WHEN|WHERE|WHILE|WITH(?: ROLLUP|IN)?|WORK|WRITE(?:TEXT)?|YEAR)\b/i,boolean:/\b(?:FALSE|NULL|TRUE)\b/i,number:/\b0x[\da-f]+\b|\b\d+(?:\.\d*)?|\B\.\d+\b/i,operator:/[-+*\/=%^~]|&&?|\|\|?|!=?|<(?:=>?|<|>)?|>[>=]?|\b(?:AND|BETWEEN|DIV|ILIKE|IN|IS|LIKE|NOT|OR|REGEXP|RLIKE|SOUNDS LIKE|XOR)\b/i,punctuation:/[;[\]()`,.]/};Prism.languages.json={property:{pattern:/(^|[^\\])"(?:\\.|[^\\"\r\n])*"(?=\s*:)/,lookbehind:!0,greedy:!0},string:{pattern:/(^|[^\\])"(?:\\.|[^\\"\r\n])*"(?!\s*:)/,lookbehind:!0,greedy:!0},comment:{pattern:/\/\/.*|\/\*[\s\S]*?(?:\*\/|$)/,greedy:!0},number:/-?\b\d+(?:\.\d+)?(?:e[+-]?\d+)?\b/i,punctuation:/[{}[\],]/,operator:/:/,boolean:/\b(?:false|true)\b/,null:{pattern:/\bnull\b/,alias:"keyword"}};Prism.languages.webmanifest=Prism.languages.json;(function(t){var n=/[*&][^\s[\]{},]+/,r=/!(?:<[\w\-%#;/?:@&=+$,.!~*'()[\]]+>|(?:[a-zA-Z\d-]*!)?[\w\-%#;/?:@&=+$.~*'()]+)?/,s="(?:"+r.source+"(?:[ 	]+"+n.source+")?|"+n.source+"(?:[ 	]+"+r.source+")?)",i=/(?:[^\s\x00-\x08\x0e-\x1f!"#%&'*,\-:>?@[\]`{|}\x7f-\x84\x86-\x9f\ud800-\udfff\ufffe\uffff]|[?:-]<PLAIN>)(?:[ \t]*(?:(?![#:])<PLAIN>|:<PLAIN>))*/.source.replace(/<PLAIN>/g,function(){return/[^\s\x00-\x08\x0e-\x1f,[\]{}\x7f-\x84\x86-\x9f\ud800-\udfff\ufffe\uffff]/.source}),l=/"(?:[^"\\\r\n]|\\.)*"|'(?:[^'\\\r\n]|\\.)*'/.source;function o(a,c){c=(c||"").replace(/m/g,"")+"m";var d=/([:\-,[{]\s*(?:\s<<prop>>[ \t]+)?)(?:<<value>>)(?=[ \t]*(?:$|,|\]|\}|(?:[\r\n]\s*)?#))/.source.replace(/<<prop>>/g,function(){return s}).replace(/<<value>>/g,function(){return a});return RegExp(d,c)}t.languages.yaml={scalar:{pattern:RegExp(/([\-:]\s*(?:\s<<prop>>[ \t]+)?[|>])[ \t]*(?:((?:\r?\n|\r)[ \t]+)\S[^\r\n]*(?:\2[^\r\n]+)*)/.source.replace(/<<prop>>/g,function(){return s})),lookbehind:!0,alias:"string"},comment:/#.*/,key:{pattern:RegExp(/((?:^|[:\-,[{\r\n?])[ \t]*(?:<<prop>>[ \t]+)?)<<key>>(?=\s*:\s)/.source.replace(/<<prop>>/g,function(){return s}).replace(/<<key>>/g,function(){return"(?:"+i+"|"+l+")"})),lookbehind:!0,greedy:!0,alias:"atrule"},directive:{pattern:/(^[ \t]*)%.+/m,lookbehind:!0,alias:"important"},datetime:{pattern:o(/\d{4}-\d\d?-\d\d?(?:[tT]|[ \t]+)\d\d?:\d{2}:\d{2}(?:\.\d*)?(?:[ \t]*(?:Z|[-+]\d\d?(?::\d{2})?))?|\d{4}-\d{2}-\d{2}|\d\d?:\d{2}(?::\d{2}(?:\.\d*)?)?/.source),lookbehind:!0,alias:"number"},boolean:{pattern:o(/false|true/.source,"i"),lookbehind:!0,alias:"important"},null:{pattern:o(/null|~/.source,"i"),lookbehind:!0,alias:"important"},string:{pattern:o(l),lookbehind:!0,greedy:!0},number:{pattern:o(/[+-]?(?:0x[\da-f]+|0o[0-7]+|(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?|\.inf|\.nan)/.source,"i"),lookbehind:!0},tag:r,important:n,punctuation:/---|[:[\]{}\-,|>?]|\.\.\./},t.languages.yml=t.languages.yaml})(Prism);(function(t){var n="\\b(?:BASH|BASHOPTS|BASH_ALIASES|BASH_ARGC|BASH_ARGV|BASH_CMDS|BASH_COMPLETION_COMPAT_DIR|BASH_LINENO|BASH_REMATCH|BASH_SOURCE|BASH_VERSINFO|BASH_VERSION|COLORTERM|COLUMNS|COMP_WORDBREAKS|DBUS_SESSION_BUS_ADDRESS|DEFAULTS_PATH|DESKTOP_SESSION|DIRSTACK|DISPLAY|EUID|GDMSESSION|GDM_LANG|GNOME_KEYRING_CONTROL|GNOME_KEYRING_PID|GPG_AGENT_INFO|GROUPS|HISTCONTROL|HISTFILE|HISTFILESIZE|HISTSIZE|HOME|HOSTNAME|HOSTTYPE|IFS|INSTANCE|JOB|LANG|LANGUAGE|LC_ADDRESS|LC_ALL|LC_IDENTIFICATION|LC_MEASUREMENT|LC_MONETARY|LC_NAME|LC_NUMERIC|LC_PAPER|LC_TELEPHONE|LC_TIME|LESSCLOSE|LESSOPEN|LINES|LOGNAME|LS_COLORS|MACHTYPE|MAILCHECK|MANDATORY_PATH|NO_AT_BRIDGE|OLDPWD|OPTERR|OPTIND|ORBIT_SOCKETDIR|OSTYPE|PAPERSIZE|PATH|PIPESTATUS|PPID|PS1|PS2|PS3|PS4|PWD|RANDOM|REPLY|SECONDS|SELINUX_INIT|SESSION|SESSIONTYPE|SESSION_MANAGER|SHELL|SHELLOPTS|SHLVL|SSH_AUTH_SOCK|TERM|UID|UPSTART_EVENTS|UPSTART_INSTANCE|UPSTART_JOB|UPSTART_SESSION|USER|WINDOWID|XAUTHORITY|XDG_CONFIG_DIRS|XDG_CURRENT_DESKTOP|XDG_DATA_DIRS|XDG_GREETER_DATA_DIR|XDG_MENU_PREFIX|XDG_RUNTIME_DIR|XDG_SEAT|XDG_SEAT_PATH|XDG_SESSION_DESKTOP|XDG_SESSION_ID|XDG_SESSION_PATH|XDG_SESSION_TYPE|XDG_VTNR|XMODIFIERS)\\b",r={pattern:/(^(["']?)\w+\2)[ \t]+\S.*/,lookbehind:!0,alias:"punctuation",inside:null},s={bash:r,environment:{pattern:RegExp("\\$"+n),alias:"constant"},variable:[{pattern:/\$?\(\([\s\S]+?\)\)/,greedy:!0,inside:{variable:[{pattern:/(^\$\(\([\s\S]+)\)\)/,lookbehind:!0},/^\$\(\(/],number:/\b0x[\dA-Fa-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:[Ee]-?\d+)?/,operator:/--|\+\+|\*\*=?|<<=?|>>=?|&&|\|\||[=!+\-*/%<>^&|]=?|[?~:]/,punctuation:/\(\(?|\)\)?|,|;/}},{pattern:/\$\((?:\([^)]+\)|[^()])+\)|`[^`]+`/,greedy:!0,inside:{variable:/^\$\(|^`|\)$|`$/}},{pattern:/\$\{[^}]+\}/,greedy:!0,inside:{operator:/:[-=?+]?|[!\/]|##?|%%?|\^\^?|,,?/,punctuation:/[\[\]]/,environment:{pattern:RegExp("(\\{)"+n),lookbehind:!0,alias:"constant"}}},/\$(?:\w+|[#?*!@$])/],entity:/\\(?:[abceEfnrtv\\"]|O?[0-7]{1,3}|U[0-9a-fA-F]{8}|u[0-9a-fA-F]{4}|x[0-9a-fA-F]{1,2})/};t.languages.bash={shebang:{pattern:/^#!\s*\/.*/,alias:"important"},comment:{pattern:/(^|[^"{\\$])#.*/,lookbehind:!0},"function-name":[{pattern:/(\bfunction\s+)[\w-]+(?=(?:\s*\(?:\s*\))?\s*\{)/,lookbehind:!0,alias:"function"},{pattern:/\b[\w-]+(?=\s*\(\s*\)\s*\{)/,alias:"function"}],"for-or-select":{pattern:/(\b(?:for|select)\s+)\w+(?=\s+in\s)/,alias:"variable",lookbehind:!0},"assign-left":{pattern:/(^|[\s;|&]|[<>]\()\w+(?:\.\w+)*(?=\+?=)/,inside:{environment:{pattern:RegExp("(^|[\\s;|&]|[<>]\\()"+n),lookbehind:!0,alias:"constant"}},alias:"variable",lookbehind:!0},parameter:{pattern:/(^|\s)-{1,2}(?:\w+:[+-]?)?\w+(?:\.\w+)*(?=[=\s]|$)/,alias:"variable",lookbehind:!0},string:[{pattern:/((?:^|[^<])<<-?\s*)(\w+)\s[\s\S]*?(?:\r?\n|\r)\2/,lookbehind:!0,greedy:!0,inside:s},{pattern:/((?:^|[^<])<<-?\s*)(["'])(\w+)\2\s[\s\S]*?(?:\r?\n|\r)\3/,lookbehind:!0,greedy:!0,inside:{bash:r}},{pattern:/(^|[^\\](?:\\\\)*)"(?:\\[\s\S]|\$\([^)]+\)|\$(?!\()|`[^`]+`|[^"\\`$])*"/,lookbehind:!0,greedy:!0,inside:s},{pattern:/(^|[^$\\])'[^']*'/,lookbehind:!0,greedy:!0},{pattern:/\$'(?:[^'\\]|\\[\s\S])*'/,greedy:!0,inside:{entity:s.entity}}],environment:{pattern:RegExp("\\$?"+n),alias:"constant"},variable:s.variable,function:{pattern:/(^|[\s;|&]|[<>]\()(?:add|apropos|apt|apt-cache|apt-get|aptitude|aspell|automysqlbackup|awk|basename|bash|bc|bconsole|bg|bzip2|cal|cargo|cat|cfdisk|chgrp|chkconfig|chmod|chown|chroot|cksum|clear|cmp|column|comm|composer|cp|cron|crontab|csplit|curl|cut|date|dc|dd|ddrescue|debootstrap|df|diff|diff3|dig|dir|dircolors|dirname|dirs|dmesg|docker|docker-compose|du|egrep|eject|env|ethtool|expand|expect|expr|fdformat|fdisk|fg|fgrep|file|find|fmt|fold|format|free|fsck|ftp|fuser|gawk|git|gparted|grep|groupadd|groupdel|groupmod|groups|grub-mkconfig|gzip|halt|head|hg|history|host|hostname|htop|iconv|id|ifconfig|ifdown|ifup|import|install|ip|java|jobs|join|kill|killall|less|link|ln|locate|logname|logrotate|look|lpc|lpr|lprint|lprintd|lprintq|lprm|ls|lsof|lynx|make|man|mc|mdadm|mkconfig|mkdir|mke2fs|mkfifo|mkfs|mkisofs|mknod|mkswap|mmv|more|most|mount|mtools|mtr|mutt|mv|nano|nc|netstat|nice|nl|node|nohup|notify-send|npm|nslookup|op|open|parted|passwd|paste|pathchk|ping|pkill|pnpm|podman|podman-compose|popd|pr|printcap|printenv|ps|pushd|pv|quota|quotacheck|quotactl|ram|rar|rcp|reboot|remsync|rename|renice|rev|rm|rmdir|rpm|rsync|scp|screen|sdiff|sed|sendmail|seq|service|sftp|sh|shellcheck|shuf|shutdown|sleep|slocate|sort|split|ssh|stat|strace|su|sudo|sum|suspend|swapon|sync|sysctl|tac|tail|tar|tee|time|timeout|top|touch|tr|traceroute|tsort|tty|umount|uname|unexpand|uniq|units|unrar|unshar|unzip|update-grub|uptime|useradd|userdel|usermod|users|uudecode|uuencode|v|vcpkg|vdir|vi|vim|virsh|vmstat|wait|watch|wc|wget|whereis|which|who|whoami|write|xargs|xdg-open|yarn|yes|zenity|zip|zsh|zypper)(?=$|[)\s;|&])/,lookbehind:!0},keyword:{pattern:/(^|[\s;|&]|[<>]\()(?:case|do|done|elif|else|esac|fi|for|function|if|in|select|then|until|while)(?=$|[)\s;|&])/,lookbehind:!0},builtin:{pattern:/(^|[\s;|&]|[<>]\()(?:\.|:|alias|bind|break|builtin|caller|cd|command|continue|declare|echo|enable|eval|exec|exit|export|getopts|hash|help|let|local|logout|mapfile|printf|pwd|read|readarray|readonly|return|set|shift|shopt|source|test|times|trap|type|typeset|ulimit|umask|unalias|unset)(?=$|[)\s;|&])/,lookbehind:!0,alias:"class-name"},boolean:{pattern:/(^|[\s;|&]|[<>]\()(?:false|true)(?=$|[)\s;|&])/,lookbehind:!0},"file-descriptor":{pattern:/\B&\d\b/,alias:"important"},operator:{pattern:/\d?<>|>\||\+=|=[=~]?|!=?|<<[<-]?|[&\d]?>>|\d[<>]&?|[<>][&=]?|&[>&]?|\|[&|]?/,inside:{"file-descriptor":{pattern:/^\d/,alias:"important"}}},punctuation:/\$?\(\(?|\)\)?|\.\.|[{}[\];\\]/,number:{pattern:/(^|\s)(?:[1-9]\d*|0)(?:[.,]\d+)?\b/,lookbehind:!0}},r.inside=t.languages.bash;for(var i=["comment","function-name","for-or-select","assign-left","parameter","string","environment","function","keyword","builtin","boolean","file-descriptor","operator","punctuation","number"],l=s.variable[1].inside,o=0;o<i.length;o++)l[i[o]]=t.languages.bash[i[o]];t.languages.sh=t.languages.bash,t.languages.shell=t.languages.bash})(Prism);qs.languages.bash&&!qs.languages.shell&&(qs.languages.shell=qs.languages.bash);function Xn({code:t,language:n="go",collapsible:r=!1}){const s=y.useRef(null),[i,l]=y.useState(!1),[o,a]=y.useState(!1),[c,d]=y.useState(0);y.useEffect(()=>{if(s.current){qs.highlightElement(s.current);const b=t.split(`
`).length;d(b),console.log("CodeBlock: Lines:",b,"Collapse?:",b>3)}},[t]);const u=async()=>{try{if(console.log("Attempting to copy code:",{codeLength:t.length,code:t.substring(0,100)}),navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(t),console.log("Successfully copied to clipboard"),a(!0),setTimeout(()=>a(!1),2e3);else{const b=document.createElement("textarea");b.value=t,b.style.position="fixed",b.style.left="-999999px",document.body.appendChild(b),b.focus(),b.select();const N=document.execCommand("copy");document.body.removeChild(b),N?(console.log("Successfully copied to clipboard (fallback)"),a(!0),setTimeout(()=>a(!1),2e3)):console.error("Fallback copy failed")}}catch(b){console.error("Failed to copy:",b)}},h=r&&c>3,m=n==="go"?"code-go":"code-block",x=`language-${n}`,j=`${m} ${h&&!i?"collapsed":""}`;return console.log("CodeBlock render:",{lineCount:c,shouldCollapse:h,isExpanded:i,preClassName:j}),e.jsxs("div",{className:"code-block-container",children:[e.jsxs("div",{className:"code-block-header",children:[e.jsx("div",{className:"code-block-info",children:h&&e.jsxs("button",{className:"code-block-toggle",onClick:()=>l(!i),"aria-label":i?"Collapse code":"Expand code",title:i?"Collapse":"Expand",children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:i?e.jsx("path",{d:"M2 5l6 6 6-6H2z"}):e.jsx("path",{d:"M6 2v12l6-6-6-6z"})}),e.jsx("span",{className:"code-block-line-count",children:i?"Collapse":`Show all (${c} lines)`})]})}),e.jsxs("button",{className:"code-copy-btn",onClick:u,"aria-label":"Copy code",title:"Copy to clipboard",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[e.jsx("path",{d:"M4 1.5H3a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v-1a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v1zm5-1v1H6v-1h3z"}),e.jsx("path",{d:"M4 5.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5H4.5a.5.5 0 0 1-.5-.5v-9z"})]}),e.jsx("span",{className:`copy-feedback ${o?"show":""}`,children:o?"Copied!":"Copy"})]})]}),e.jsx("pre",{className:j,children:e.jsx("code",{ref:s,className:x,children:t})})]})}const ny=y.createContext(null);function gP(){const t=Date.now().toString(36),n=Math.random().toString(36).substring(2,6);return`${t}-${n}`}function jP(t){const n=t.find(s=>s.role==="user");if(!n)return"Untitled Chat";const r=n.content.trim();return r.length<=60?r:r.substring(0,60)+"..."}function yP(t){return t.map(n=>{const r={role:n.role,content:n.content};return n.reasoning&&(r.reasoning=n.reasoning),n.attachments&&n.attachments.length>0&&(r.attachments=n.attachments.map(s=>({type:s.type,name:s.name}))),r})}function bP({children:t}){const[n,r]=y.useState([]),s=y.useRef(!1);y.useEffect(()=>{let c=!1;return oP().then(d=>{c||(r(d),s.current=!0)}),()=>{c=!0}},[]);const i=y.useCallback((c,d)=>{if(d.length===0)return;const u={id:gP(),title:jP(d),model:c,savedAt:Date.now(),messages:yP(d)};r(h=>[u,...h]),aP(u)},[]),l=y.useCallback(c=>{const d=new Set(c);r(u=>u.filter(h=>!d.has(h.id))),cP(c)},[]),o=y.useCallback(c=>n.find(d=>d.id===c),[n]),a=y.useCallback(()=>{r([]),dP()},[]);return e.jsx(ny.Provider,{value:{history:n,saveChat:i,deleteChats:l,getChat:o,clearHistory:a},children:t})}function ry(){const t=y.useContext(ny);if(!t)throw new Error("useChatHistory must be used within a ChatHistoryProvider");return t}function kP({isOpen:t,message:n,confirmLabel:r="Confirm",cancelLabel:s="Cancel",onConfirm:i,onCancel:l}){const o=y.useRef(null),a=y.useCallback(c=>{c.stopPropagation()},[]);return y.useEffect(()=>{var d;if(!t)return;(d=o.current)==null||d.focus();const c=u=>{u.key==="Escape"&&l()};return document.addEventListener("keydown",c),()=>document.removeEventListener("keydown",c)},[t,l]),t?e.jsx("div",{className:"modal-overlay",role:"dialog","aria-modal":"true",onClick:l,children:e.jsxs("div",{className:"modal-content confirm-dialog",onClick:a,children:[e.jsx("div",{className:"confirm-dialog-body",children:n}),e.jsxs("div",{className:"confirm-dialog-actions",children:[e.jsx("button",{ref:o,className:"btn btn-secondary btn-sm",onClick:l,children:s}),e.jsx("button",{className:"btn btn-primary btn-sm",onClick:i,children:r})]})]})}):null}function vP(t){const r=Date.now()-t,s=Math.floor(r/1e3),i=Math.floor(s/60),l=Math.floor(i/60),o=Math.floor(l/24),a=Math.floor(o/30);return s<60?"just now":i<60?`${i} min ago`:l<24?`${l} hr ago`:o<30?`${o} days ago`:`${a} months ago`}function wP(t){return t.map(n=>{const r=n.role==="user"?"USER":"MODEL";let s="";if(n.attachments&&n.attachments.length>0){const i=n.attachments.map(l=>l.name).join(", ");s+=`[Attached: ${i}]
`}return s+=n.content,`${r}:
${s}`}).join(`

`)}function NP({isOpen:t,onClose:n,onLoadChat:r}){const{history:s,deleteChats:i}=ry(),[l,o]=y.useState(new Set),[a,c]=y.useState(!1),d=y.useMemo(()=>[...s],[s]),u=y.useCallback(p=>{o(g=>{const k=new Set(g);return k.has(p)?k.delete(p):k.add(p),k})},[]),h=d.length>0&&l.size===d.length,m=y.useCallback(()=>{o(h?new Set:new Set(d.map(p=>p.id)))},[h,d]),x=y.useCallback(()=>{l.size!==0&&c(!0)},[l]),j=y.useCallback(()=>{i(Array.from(l)),o(new Set),c(!1)},[l,i]),b=y.useCallback(p=>{r(p.messages),n()},[r,n]),N=y.useCallback((p,g)=>{p.stopPropagation();const k=wP(g.messages);navigator.clipboard.writeText(k)},[]),f=`chat-history-panel${t?" chat-history-panel-open":""}`;return e.jsxs("div",{className:f,children:[e.jsxs("div",{className:"chat-history-header",children:[e.jsx("span",{children:"Chat History"}),e.jsx("button",{onClick:n,"aria-label":"Close chat history",children:""})]}),d.length>0&&e.jsxs("div",{className:"chat-history-toolbar",children:[e.jsxs("label",{className:"chat-history-select-all",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:m}),"Select All"]}),l.size>0&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[l.size," selected"]}),e.jsx("button",{className:"chat-history-delete-btn",onClick:x,children:"Delete"})]})]}),d.length===0?e.jsx("div",{className:"chat-history-empty",children:"No saved chats"}):e.jsx("div",{className:"chat-history-list",children:d.map(p=>{const g=l.has(p.id),k=`chat-history-item${g?" chat-history-item-selected":""}`;return e.jsxs("div",{className:k,onClick:()=>b(p),children:[e.jsx("input",{type:"checkbox",className:"chat-history-item-checkbox",checked:g,onChange:()=>u(p.id),onClick:S=>S.stopPropagation()}),e.jsxs("div",{className:"chat-history-item-info",children:[e.jsx("div",{className:"chat-history-item-title",children:p.title}),e.jsx("div",{className:"chat-history-item-model",children:p.model}),e.jsx("div",{className:"chat-history-item-date",children:vP(p.savedAt)})]}),e.jsx("button",{className:"chat-history-item-copy",onClick:S=>N(S,p),title:"Copy chat to clipboard",children:"Copy"})]},p.id)})}),e.jsx(kP,{isOpen:a,message:`Delete ${l.size} selected chat(s)?`,confirmLabel:"Delete",cancelLabel:"Cancel",onConfirm:j,onCancel:()=>c(!1)})]})}function SP(t){return(t.match(/```/g)||[]).length%2!==0?t+"\n```":t}const _P={code({node:t,className:n,children:r,...s}){const i=/language-(\w+)/.exec(n||"");if(!i&&!n)return e.jsx("code",{className:"inline-code",...s,children:r});const o=i?i[1]:"text",a=String(r).replace(/\n$/,"");return e.jsx("div",{className:"chat-code-block-wrapper",children:e.jsx(Xn,{code:a,language:o,collapsible:!0})})},h1:({children:t})=>e.jsx("h1",{className:"markdown-h1",children:t}),h2:({children:t})=>e.jsx("h2",{className:"markdown-h2",children:t}),h3:({children:t})=>e.jsx("h3",{className:"markdown-h3",children:t}),ul:({children:t})=>e.jsx("ul",{className:"markdown-list",children:t}),ol:({children:t})=>e.jsx("ol",{className:"markdown-list markdown-list-ordered",children:t}),li:({children:t})=>e.jsx("li",{className:"markdown-list-item",children:t}),p:({children:t})=>e.jsx("p",{className:"markdown-paragraph",children:t}),strong:({children:t})=>e.jsx("strong",{className:"markdown-bold",children:t}),em:({children:t})=>e.jsx("em",{className:"markdown-italic",children:t}),blockquote:({children:t})=>e.jsx("blockquote",{className:"markdown-blockquote",children:t}),a:({href:t,children:n})=>e.jsx("a",{href:t,className:"markdown-link",target:"_blank",rel:"noopener noreferrer",children:n})};function Jp(t){const n=SP(t);return e.jsx(O1,{remarkPlugins:[XC],components:_P,children:n})}const Zp="kronk_chat_history_enabled";function TP(){var mt,yt;const{models:t,loading:n,loadModels:r}=Ma(),{messages:s,setMessages:i,clearMessages:l}=uP(),{sampling:o,setSampling:a}=pP(),{saveChat:c}=ry(),[d,u]=y.useState(()=>localStorage.getItem("kronk_chat_model")||""),[h,m]=y.useState(""),[x,j]=y.useState(!1),[b,N]=y.useState(null),[f,p]=y.useState(!1),[g,k]=y.useState([]),[S,_]=y.useState(!1),[E,D]=y.useState(null),[L,T]=y.useState(""),[P,I]=y.useState(!1),[O,X]=y.useState([]),[J,re]=y.useState("none"),[ne,A]=y.useState(""),[B,v]=y.useState(()=>{const M=localStorage.getItem(Zp);return M===null?!0:M==="true"}),[F,z]=y.useState([]),[w,Z]=y.useState(null),K=y.useRef(null),Q=y.useRef(null),Y=y.useRef(null),ee=y.useRef(null),C=y.useRef(null),R=y.useRef(null),$=y.useRef(!0),ie=y.useRef(!1),ce=y.useRef(!1),[q,H]=y.useState(!1),le=y.useCallback(()=>{v(M=>{const de=!M;try{localStorage.setItem(Zp,String(de))}catch{}return de})},[]),me=y.useCallback(M=>({temperature:M.temperature??He.temperature,topK:M.top_k??He.topK,topP:M.top_p??He.topP,minP:M.min_p??He.minP,presencePenalty:M.presence_penalty??He.presencePenalty,maxTokens:M.max_tokens??He.maxTokens,repeatPenalty:M.repeat_penalty??He.repeatPenalty,repeatLastN:M.repeat_last_n??He.repeatLastN,dryMultiplier:M.dry_multiplier??He.dryMultiplier,dryBase:M.dry_base??He.dryBase,dryAllowedLen:M.dry_allowed_length??He.dryAllowedLen,dryPenaltyLast:M.dry_penalty_last_n??He.dryPenaltyLast,xtcProbability:M.xtc_probability??He.xtcProbability,xtcThreshold:M.xtc_threshold??He.xtcThreshold,xtcMinKeep:M.xtc_min_keep??He.xtcMinKeep,frequencyPenalty:M.frequency_penalty??He.frequencyPenalty,enableThinking:M.enable_thinking??He.enableThinking,reasoningEffort:M.reasoning_effort??He.reasoningEffort,returnPrompt:He.returnPrompt,includeUsage:He.includeUsage,logprobs:He.logprobs,topLogprobs:He.topLogprobs,grammar:M.grammar??He.grammar,systemPrompt:He.systemPrompt,cacheId:He.cacheId}),[]),ge=y.useCallback(M=>{if(M){const de=me(M),xe=de.grammar;xe&&xe.endsWith(".grm")?(re("preset"),A(xe),fe.getGrammarContent(xe).then(we=>{a({...de,grammar:we.content}),Z({...de,grammar:we.content})}).catch(()=>{a({...de,grammar:""}),Z({...de,grammar:""})})):xe?(re("custom"),A(""),a(de),Z(de)):(re("none"),A(""),a(de),Z(de))}else re("none"),A(""),Z(null)},[a,me]);y.useEffect(()=>{fe.listGrammars().then(M=>X(M.files||[])).catch(()=>X([]))},[]);const ve=y.useCallback(M=>{A(M),fe.getGrammarContent(M).then(de=>a({grammar:de.content})).catch(()=>a({grammar:""}))},[a]);y.useEffect(()=>{r(),fe.listModelsExtended().then(M=>{M!=null&&M.data&&z(M.data)}).catch(()=>{})},[r]),y.useEffect(()=>{if(t!=null&&t.data&&t.data.length>0){const M=t.data.filter(xe=>{const we=xe.id.toLowerCase();return!we.includes("embed")&&!we.includes("rerank")});!M.some(xe=>xe.id===d)&&M.length>0&&u(M[0].id)}},[t,d]),y.useEffect(()=>{if(d&&F.length>0){if(localStorage.setItem("kronk_chat_model",d),K.current!==d){const M=F.find(de=>de.id===d);ge(M==null?void 0:M.sampling)}K.current=d}},[d,F,ge]);const Se=y.useCallback(M=>{if(M.deltaY<0){const de=Y.current;if(!de)return;de.scrollHeight>de.clientHeight&&(ce.current=!0,$.current=!1,H(!0))}},[]),Re=y.useCallback(()=>{if(ie.current||!ce.current)return;const M=Y.current;if(!M)return;M.scrollHeight-M.scrollTop-M.clientHeight<100&&($.current=!0,H(!1))},[]),qe=y.useCallback(()=>{const M=Y.current;M&&(ie.current=!0,M.scrollTop=M.scrollHeight,$.current=!0,H(!1),requestAnimationFrame(()=>{ie.current=!1}))},[]);y.useEffect(()=>{if($.current){const M=Y.current;if(!M)return;ie.current=!0,M.scrollTop=M.scrollHeight,requestAnimationFrame(()=>{ie.current=!1})}},[s]),y.useEffect(()=>{var M;!x&&d&&((M=ee.current)==null||M.focus())},[x,d]);const Ke=y.useCallback((M,de)=>{if(de.length===0)return M;const xe=[];M&&xe.push({type:"text",text:M});for(const we of de)if(we.type==="image")xe.push({type:"image_url",image_url:{url:we.dataUrl}});else if(we.type==="audio"){const bt=we.dataUrl.match(/^data:audio\/(\w+);base64,(.+)$/);bt&&xe.push({type:"input_audio",input_audio:{data:bt[2],format:bt[1]}})}return xe},[]),et=y.useCallback(M=>{N(null),j(!0);let de="",xe="",we,bt=[];i(at=>[...at,{role:"assistant",content:"",reasoning:""}]),R.current=fe.streamChat({model:d,messages:M,max_tokens:o.maxTokens,temperature:o.temperature,top_p:o.topP,top_k:o.topK,min_p:o.minP,presence_penalty:o.presencePenalty,repeat_penalty:o.repeatPenalty,repeat_last_n:o.repeatLastN,dry_multiplier:o.dryMultiplier,dry_base:o.dryBase,dry_allowed_length:o.dryAllowedLen,dry_penalty_last_n:o.dryPenaltyLast,xtc_probability:o.xtcProbability,xtc_threshold:o.xtcThreshold,xtc_min_keep:o.xtcMinKeep,frequency_penalty:o.frequencyPenalty,enable_thinking:o.enableThinking||void 0,reasoning_effort:o.reasoningEffort||void 0,return_prompt:o.returnPrompt,stream_options:{include_usage:o.includeUsage},logprobs:o.logprobs,top_logprobs:o.topLogprobs,grammar:o.grammar||void 0},at=>{var Ct,dr,Pt,Bn,Yn,Ur,$e,hr;const Ue=(Ct=at.choices)==null?void 0:Ct[0];if((dr=Ue==null?void 0:Ue.delta)!=null&&dr.content&&(de+=Ue.delta.content),(Pt=Ue==null?void 0:Ue.delta)!=null&&Pt.reasoning_content&&(xe+=Ue.delta.reasoning_content),(Bn=Ue==null?void 0:Ue.delta)!=null&&Bn.tool_calls&&Ue.delta.tool_calls.length>0)for(const ht of Ue.delta.tool_calls){const Tn=ht.index??(bt.length>0?bt[bt.length-1].index:0),Cn=bt.find(Kr=>Kr.index===Tn);Cn?(ht.id&&!Cn.id&&(Cn.id=ht.id),(Yn=ht.function)!=null&&Yn.name&&!Cn.function.name&&(Cn.function.name=ht.function.name),(Ur=ht.function)!=null&&Ur.arguments&&(Cn.function.arguments+=ht.function.arguments)):bt.push({id:ht.id||"",index:Tn,type:ht.type||"function",function:{name:(($e=ht.function)==null?void 0:$e.name)||"",arguments:((hr=ht.function)==null?void 0:hr.arguments)||""}})}at.usage&&(we=at.usage),i(ht=>{const Tn=[...ht];return Tn[Tn.length-1]={role:"assistant",content:de,reasoning:xe,usage:we,toolCalls:bt.length?bt:void 0},Tn})},at=>{N(at),j(!1)},()=>{j(!1)},o.cacheId||void 0)},[d,o,i]),ze=M=>{if(M.preventDefault(),!h.trim()&&g.length===0||!d||x)return;const de={role:"user",content:h.trim(),attachments:g.length>0?[...g]:void 0};i(we=>[...we,de]),m(""),k([]);const xe=[...o.systemPrompt?[{role:"system",content:o.systemPrompt}]:[],...s.map(we=>({role:we.role,content:we.attachments?Ke(we.content,we.attachments):we.content})),{role:"user",content:Ke(h.trim(),g)}];et(xe)},G=M=>{D(M),T(s[M].content)},se=()=>{D(null),T("")},he=M=>{i(de=>de.map((xe,we)=>we===M?{...xe,content:L,originalContent:xe.originalContent??xe.content}:xe)),D(null),T("")},je=M=>{i(de=>de.map((xe,we)=>we===M&&xe.originalContent!=null?{...xe,content:xe.originalContent,originalContent:void 0}:xe))},Ne=M=>{if(!d||x)return;const de=s.slice(0,M+1).map((we,bt)=>bt===M?{...we,content:L}:we);i(de),D(null),T("");const xe=[...o.systemPrompt?[{role:"system",content:o.systemPrompt}]:[],...de.map(we=>({role:we.role,content:we.attachments?Ke(we.content,we.attachments):we.content}))];et(xe)},tt=()=>{R.current&&(R.current(),R.current=null,j(!1))},Nt=()=>{B&&s.length>0&&c(d,s),l(),N(null),k([])},jt=y.useCallback(M=>{const de=M.map(xe=>({role:xe.role,content:xe.content,reasoning:xe.reasoning}));i(de),N(null),k([])},[i]),Vt=M=>{const de=M.target.files;de&&(Array.from(de).forEach(xe=>{const we=new FileReader;we.onload=()=>{const bt=we.result,at=xe.type.startsWith("image/")?"image":"audio";k(Ue=>[...Ue,{type:at,name:xe.name,dataUrl:bt}])},we.readAsDataURL(xe)}),M.target.value="")},on=M=>{k(de=>de.filter((xe,we)=>we!==M))},st=M=>{M.key==="Enter"&&!M.shiftKey&&(M.preventDefault(),ze(M))};return e.jsxs("div",{className:"chat-layout",children:[e.jsx(NP,{isOpen:P,onClose:()=>I(!1),onLoadChat:jt}),e.jsxs("div",{className:"chat-container",children:[e.jsxs("div",{className:"chat-header",children:[e.jsxs("div",{className:"chat-header-left",children:[e.jsx("h2",{children:"Chat"}),e.jsxs("select",{value:d,onChange:M=>{const de=M.target.value;s.length>0&&(B&&c(d,s),l(),N(null),k([])),u(de)},disabled:n||x,className:"chat-model-select",children:[n&&e.jsx("option",{children:"Loading models..."}),!n&&((mt=t==null?void 0:t.data)==null?void 0:mt.length)===0&&e.jsx("option",{children:"No models available"}),(yt=t==null?void 0:t.data)==null?void 0:yt.filter(M=>{const de=M.id.toLowerCase();return!de.includes("embed")&&!de.includes("rerank")}).map(M=>e.jsx("option",{value:M.id,children:M.id},M.id))]})]}),e.jsxs("div",{className:"chat-header-right",children:[e.jsxs("button",{type:"button",className:`chat-history-toggle ${B?"chat-history-toggle-on":"chat-history-toggle-off"}`,onClick:le,title:B?"Chat history auto-save is on":"Chat history auto-save is off",children:["Chat History: ",B?"ON":"OFF"]}),e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>I(!P),children:"History"}),e.jsxs("button",{className:"btn btn-secondary btn-sm",onClick:()=>p(!f),children:["Settings",Xp(o,w)&&e.jsx("span",{className:"chat-setting-default",children:""})]}),e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:Nt,disabled:x||s.length===0,children:"Clear chat"})]})]}),f&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"chat-system-prompt",children:[e.jsx("label",{children:"System Prompt"}),e.jsx("textarea",{value:o.systemPrompt,onChange:M=>a({systemPrompt:M.target.value}),placeholder:"Enter a system prompt to set the model's behavior...",className:"chat-system-prompt-input",rows:3})]}),e.jsxs("div",{className:"chat-settings",children:[e.jsxs("div",{className:`chat-setting ${_e("maxTokens",o.maxTokens,w)?"chat-setting-changed":""}`,children:[e.jsxs("label",{children:["Max Tokens",e.jsx(be,{text:ye.max_tokens}),_e("maxTokens",o.maxTokens,w)&&e.jsx("span",{className:"chat-setting-default",title:`Default: ${ct("maxTokens",w)}`,children:""})]}),e.jsx("input",{type:"number",value:o.maxTokens,onChange:M=>a({maxTokens:Number(M.target.value)}),min:1,max:32768})]}),e.jsxs("div",{className:`chat-setting ${_e("temperature",o.temperature,w)?"chat-setting-changed":""}`,children:[e.jsxs("label",{children:["Temperature",e.jsx(be,{text:ye.temperature}),_e("temperature",o.temperature,w)&&e.jsx("span",{className:"chat-setting-default",title:`Default: ${ct("temperature",w)}`,children:""})]}),e.jsx("input",{type:"number",value:o.temperature,onChange:M=>a({temperature:Number(M.target.value)}),min:0,max:2,step:.1})]}),e.jsxs("div",{className:`chat-setting ${_e("topP",o.topP,w)?"chat-setting-changed":""}`,children:[e.jsxs("label",{children:["Top P",e.jsx(be,{text:ye.top_p}),_e("topP",o.topP,w)&&e.jsx("span",{className:"chat-setting-default",title:`Default: ${ct("topP",w)}`,children:""})]}),e.jsx("input",{type:"number",value:o.topP,onChange:M=>a({topP:Number(M.target.value)}),min:0,max:1,step:.05})]}),e.jsxs("div",{className:`chat-setting ${_e("topK",o.topK,w)?"chat-setting-changed":""}`,children:[e.jsxs("label",{children:["Top K",e.jsx(be,{text:ye.top_k}),_e("topK",o.topK,w)&&e.jsx("span",{className:"chat-setting-default",title:`Default: ${ct("topK",w)}`,children:""})]}),e.jsx("input",{type:"number",value:o.topK,onChange:M=>a({topK:Number(M.target.value)}),min:1,max:100})]}),e.jsxs("div",{className:"chat-setting",children:[e.jsx("label",{children:"Cache ID"}),e.jsx("input",{type:"text",value:o.cacheId,onChange:M=>a({cacheId:M.target.value}),placeholder:"e.g. user-123"})]}),e.jsxs("div",{className:"chat-setting chat-setting-grammar",children:[e.jsx("label",{children:"Grammar"}),e.jsxs("select",{value:J,onChange:M=>{const de=M.target.value;re(de),de==="none"?(a({grammar:""}),A("")):de==="preset"&&O.length>0?ve(O[0]):de==="custom"&&(a({grammar:""}),A(""))},children:[e.jsx("option",{value:"none",children:"None"}),e.jsx("option",{value:"preset",children:"Preset"}),e.jsx("option",{value:"custom",children:"Custom"})]})]}),J==="preset"&&e.jsxs("div",{className:"chat-setting chat-setting-grammar-preset",children:[e.jsx("label",{children:"Preset"}),e.jsx("select",{value:ne,onChange:M=>ve(M.target.value),children:O.map(M=>e.jsx("option",{value:M,children:M.replace(".grm","")},M))})]}),e.jsx("div",{className:"chat-setting chat-setting-button",children:e.jsxs("button",{type:"button",className:"chat-advanced-toggle",onClick:()=>_(!S),children:["Advanced ",S?"":"",fP(o,w)&&e.jsx("span",{className:"chat-setting-default",children:""})]})}),e.jsx("div",{className:"chat-setting chat-setting-button",children:Xp(o,w)&&w&&e.jsx("button",{type:"button",className:"chat-reset-defaults",onClick:()=>a(w),title:"Reset all sampling values to model defaults",children:"Reset to default"})})]}),(J==="preset"||J==="custom")&&e.jsx("div",{className:"chat-grammar-editor",children:e.jsx("textarea",{value:o.grammar,onChange:M=>a({grammar:M.target.value}),rows:4,placeholder:"Enter GBNF grammar...",className:"chat-system-prompt-input",style:{fontFamily:"monospace",fontSize:"12px"}})}),S&&e.jsx("div",{className:"chat-settings",children:e.jsxs("div",{className:"chat-advanced-settings",children:[e.jsxs("div",{className:`chat-setting ${_e("minP",o.minP,w)?"chat-setting-changed":""}`,children:[e.jsxs("label",{children:["Min P",e.jsx(be,{text:ye.min_p}),_e("minP",o.minP,w)&&e.jsx("span",{className:"chat-setting-default",title:`Default: ${ct("minP",w)}`,children:""})]}),e.jsx("input",{type:"number",value:o.minP,onChange:M=>a({minP:Number(M.target.value)}),min:0,max:1,step:.01})]}),e.jsxs("div",{className:`chat-setting ${_e("repeatPenalty",o.repeatPenalty,w)?"chat-setting-changed":""}`,children:[e.jsxs("label",{children:["Repeat Penalty",e.jsx(be,{text:ye.repeat_penalty}),_e("repeatPenalty",o.repeatPenalty,w)&&e.jsx("span",{className:"chat-setting-default",title:`Default: ${ct("repeatPenalty",w)}`,children:""})]}),e.jsx("input",{type:"number",value:o.repeatPenalty,onChange:M=>a({repeatPenalty:Number(M.target.value)}),min:0,max:2,step:.1})]}),e.jsxs("div",{className:`chat-setting ${_e("repeatLastN",o.repeatLastN,w)?"chat-setting-changed":""}`,children:[e.jsxs("label",{children:["Repeat Last N",e.jsx(be,{text:ye.repeat_last_n}),_e("repeatLastN",o.repeatLastN,w)&&e.jsx("span",{className:"chat-setting-default",title:`Default: ${ct("repeatLastN",w)}`,children:""})]}),e.jsx("input",{type:"number",value:o.repeatLastN,onChange:M=>a({repeatLastN:Number(M.target.value)}),min:-1,max:512})]}),e.jsxs("div",{className:`chat-setting ${_e("frequencyPenalty",o.frequencyPenalty,w)?"chat-setting-changed":""}`,children:[e.jsxs("label",{children:["Frequency Penalty",e.jsx(be,{text:ye.frequency_penalty}),_e("frequencyPenalty",o.frequencyPenalty,w)&&e.jsx("span",{className:"chat-setting-default",title:`Default: ${ct("frequencyPenalty",w)}`,children:""})]}),e.jsx("input",{type:"number",value:o.frequencyPenalty,onChange:M=>a({frequencyPenalty:Number(M.target.value)}),min:0,max:2,step:.1})]}),e.jsxs("div",{className:`chat-setting ${_e("presencePenalty",o.presencePenalty,w)?"chat-setting-changed":""}`,children:[e.jsxs("label",{children:["Presence Penalty",e.jsx(be,{text:ye.presence_penalty}),_e("presencePenalty",o.presencePenalty,w)&&e.jsx("span",{className:"chat-setting-default",title:`Default: ${ct("presencePenalty",w)}`,children:""})]}),e.jsx("input",{type:"number",value:o.presencePenalty,onChange:M=>a({presencePenalty:Number(M.target.value)}),min:0,max:2,step:.1})]}),e.jsxs("div",{className:`chat-setting ${_e("dryMultiplier",o.dryMultiplier,w)?"chat-setting-changed":""}`,children:[e.jsxs("label",{children:["DRY Multiplier",e.jsx(be,{text:ye.dry_multiplier}),_e("dryMultiplier",o.dryMultiplier,w)&&e.jsx("span",{className:"chat-setting-default",title:`Default: ${ct("dryMultiplier",w)}`,children:""})]}),e.jsx("input",{type:"number",value:o.dryMultiplier,onChange:M=>a({dryMultiplier:Number(M.target.value)}),min:0,step:.1})]}),e.jsxs("div",{className:`chat-setting ${_e("dryBase",o.dryBase,w)?"chat-setting-changed":""}`,children:[e.jsxs("label",{children:["DRY Base",e.jsx(be,{text:ye.dry_base}),_e("dryBase",o.dryBase,w)&&e.jsx("span",{className:"chat-setting-default",title:`Default: ${ct("dryBase",w)}`,children:""})]}),e.jsx("input",{type:"number",value:o.dryBase,onChange:M=>a({dryBase:Number(M.target.value)}),min:1,step:.05})]}),e.jsxs("div",{className:`chat-setting ${_e("dryAllowedLen",o.dryAllowedLen,w)?"chat-setting-changed":""}`,children:[e.jsxs("label",{children:["DRY Allowed Length",e.jsx(be,{text:ye.dry_allowed_length}),_e("dryAllowedLen",o.dryAllowedLen,w)&&e.jsx("span",{className:"chat-setting-default",title:`Default: ${ct("dryAllowedLen",w)}`,children:""})]}),e.jsx("input",{type:"number",value:o.dryAllowedLen,onChange:M=>a({dryAllowedLen:Number(M.target.value)}),min:0})]}),e.jsxs("div",{className:`chat-setting ${_e("dryPenaltyLast",o.dryPenaltyLast,w)?"chat-setting-changed":""}`,children:[e.jsxs("label",{children:["DRY Penalty Last N",e.jsx(be,{text:ye.dry_penalty_last_n}),_e("dryPenaltyLast",o.dryPenaltyLast,w)&&e.jsx("span",{className:"chat-setting-default",title:`Default: ${ct("dryPenaltyLast",w)}`,children:""})]}),e.jsx("input",{type:"number",value:o.dryPenaltyLast,onChange:M=>a({dryPenaltyLast:Number(M.target.value)}),min:-1})]}),e.jsxs("div",{className:`chat-setting ${_e("xtcProbability",o.xtcProbability,w)?"chat-setting-changed":""}`,children:[e.jsxs("label",{children:["XTC Probability",e.jsx(be,{text:ye.xtc_probability}),_e("xtcProbability",o.xtcProbability,w)&&e.jsx("span",{className:"chat-setting-default",title:`Default: ${ct("xtcProbability",w)}`,children:""})]}),e.jsx("input",{type:"number",value:o.xtcProbability,onChange:M=>a({xtcProbability:Number(M.target.value)}),min:0,max:1,step:.01})]}),e.jsxs("div",{className:`chat-setting ${_e("xtcThreshold",o.xtcThreshold,w)?"chat-setting-changed":""}`,children:[e.jsxs("label",{children:["XTC Threshold",e.jsx(be,{text:ye.xtc_threshold}),_e("xtcThreshold",o.xtcThreshold,w)&&e.jsx("span",{className:"chat-setting-default",title:`Default: ${ct("xtcThreshold",w)}`,children:""})]}),e.jsx("input",{type:"number",value:o.xtcThreshold,onChange:M=>a({xtcThreshold:Number(M.target.value)}),min:0,max:1,step:.01})]}),e.jsxs("div",{className:`chat-setting ${_e("xtcMinKeep",o.xtcMinKeep,w)?"chat-setting-changed":""}`,children:[e.jsxs("label",{children:["XTC Min Keep",e.jsx(be,{text:ye.xtc_min_keep}),_e("xtcMinKeep",o.xtcMinKeep,w)&&e.jsx("span",{className:"chat-setting-default",title:`Default: ${ct("xtcMinKeep",w)}`,children:""})]}),e.jsx("input",{type:"number",value:o.xtcMinKeep,onChange:M=>a({xtcMinKeep:Number(M.target.value)}),min:1})]}),e.jsxs("div",{className:`chat-setting ${_e("enableThinking",o.enableThinking,w)?"chat-setting-changed":""}`,children:[e.jsxs("label",{children:["Enable Thinking",e.jsx(be,{text:ye.enable_thinking}),_e("enableThinking",o.enableThinking,w)&&e.jsx("span",{className:"chat-setting-default",title:`Default: ${ct("enableThinking",w)}`,children:""})]}),e.jsxs("select",{value:o.enableThinking,onChange:M=>a({enableThinking:M.target.value}),children:[e.jsx("option",{value:"",children:"Default"}),e.jsx("option",{value:"true",children:"Enabled"}),e.jsx("option",{value:"false",children:"Disabled"})]})]}),e.jsxs("div",{className:`chat-setting ${_e("reasoningEffort",o.reasoningEffort,w)?"chat-setting-changed":""}`,children:[e.jsxs("label",{children:["Reasoning Effort",e.jsx(be,{text:ye.reasoning_effort}),_e("reasoningEffort",o.reasoningEffort,w)&&e.jsx("span",{className:"chat-setting-default",title:`Default: ${ct("reasoningEffort",w)}`,children:""})]}),e.jsxs("select",{value:o.reasoningEffort,onChange:M=>a({reasoningEffort:M.target.value}),children:[e.jsx("option",{value:"",children:"Default"}),e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]}),e.jsxs("div",{className:`chat-setting ${_e("topLogprobs",o.topLogprobs,w)?"chat-setting-changed":""}`,children:[e.jsxs("label",{children:["Top Logprobs",_e("topLogprobs",o.topLogprobs,w)&&e.jsx("span",{className:"chat-setting-default",title:`Default: ${ct("topLogprobs",w)}`,children:""})]}),e.jsx("input",{type:"number",value:o.topLogprobs,onChange:M=>a({topLogprobs:Number(M.target.value)}),min:0,max:20})]}),e.jsx("div",{className:`chat-setting chat-setting-checkbox ${_e("returnPrompt",o.returnPrompt,w)?"chat-setting-changed":""}`,children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:o.returnPrompt,onChange:M=>a({returnPrompt:M.target.checked})}),"Return Prompt",_e("returnPrompt",o.returnPrompt,w)&&e.jsx("span",{className:"chat-setting-default",title:`Default: ${ct("returnPrompt",w)}`,children:""})]})}),e.jsx("div",{className:`chat-setting chat-setting-checkbox ${_e("includeUsage",o.includeUsage,w)?"chat-setting-changed":""}`,children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:o.includeUsage,onChange:M=>a({includeUsage:M.target.checked})}),"Include Usage",_e("includeUsage",o.includeUsage,w)&&e.jsx("span",{className:"chat-setting-default",title:`Default: ${ct("includeUsage",w)}`,children:""})]})}),e.jsx("div",{className:`chat-setting chat-setting-checkbox ${_e("logprobs",o.logprobs,w)?"chat-setting-changed":""}`,children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:o.logprobs,onChange:M=>a({logprobs:M.target.checked})}),"Logprobs",_e("logprobs",o.logprobs,w)&&e.jsx("span",{className:"chat-setting-default",title:`Default: ${ct("logprobs",w)}`,children:""})]})})]})})]}),b&&e.jsx("div",{className:"alert alert-error",children:b}),e.jsxs("div",{className:"chat-messages-wrapper",children:[e.jsxs("div",{className:"chat-messages",ref:Y,onScroll:Re,onWheel:Se,children:[s.length===0&&e.jsxs("div",{className:"chat-empty",children:[e.jsx("p",{children:"Select a model and start chatting"}),e.jsx("p",{className:"chat-empty-hint",children:"Type a message below to begin"})]}),s.map((M,de)=>e.jsxs("div",{className:`chat-message chat-message-${M.role}`,children:[e.jsxs("div",{className:"chat-message-header",children:[e.jsx("span",{children:M.role==="user"?"USER":"MODEL"}),!x&&E===null&&e.jsxs("span",{className:"chat-header-actions",children:[M.originalContent!=null&&e.jsx("button",{className:"chat-edit-btn",onClick:()=>je(de),title:"Revert to original message",children:"Undo"}),e.jsx("button",{className:"chat-edit-btn",onClick:()=>G(de),title:"Edit message",children:"Edit"})]})]}),M.attachments&&M.attachments.length>0&&e.jsx("div",{className:"chat-message-attachments",children:M.attachments.map((xe,we)=>e.jsx("div",{className:"chat-attachment-preview",children:xe.type==="image"?e.jsx("img",{src:xe.dataUrl,alt:xe.name,className:"chat-attachment-image"}):e.jsx("div",{className:"chat-attachment-audio",children:e.jsxs("span",{children:[" ",xe.name]})})},we))}),M.reasoning&&e.jsxs("details",{className:"chat-message-reasoning",open:x&&de===s.length-1,children:[e.jsxs("summary",{className:"chat-reasoning-summary",children:["Reasoning (",M.reasoning.length.toLocaleString()," chars)"]}),e.jsx("div",{className:"chat-reasoning-content",children:Jp(M.reasoning)})]}),e.jsx("div",{className:"chat-message-content",children:E===de?e.jsxs("div",{className:"chat-edit-area",children:[e.jsx("textarea",{className:"chat-edit-textarea",value:L,onChange:xe=>T(xe.target.value),rows:Math.max(4,L.split(`
`).length),autoFocus:!0}),e.jsxs("div",{className:"chat-edit-actions",children:[e.jsx("button",{className:"btn btn-primary btn-sm",onClick:()=>M.role==="assistant"?he(de):Ne(de),disabled:!L.trim(),children:M.role==="assistant"?"Save":"Send"}),e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:se,children:"Cancel"})]})]}):M.content?Jp(M.content):x&&de===s.length-1?"...":""}),M.toolCalls&&M.toolCalls.length>0&&e.jsx("div",{className:"chat-message-tool-calls",children:M.toolCalls.map(xe=>e.jsxs("div",{className:"chat-tool-call",children:["Tool call ",xe.id,": ",xe.function.name,"(",xe.function.arguments,")"]},xe.id))}),M.usage&&e.jsxs("div",{className:"chat-message-usage",children:["Input: ",M.usage.prompt_tokens," | Reasoning: ",M.usage.reasoning_tokens," | Completion: ",M.usage.completion_tokens," | Output: ",M.usage.output_tokens," | TPS: ",M.usage.tokens_per_second.toFixed(2)]})]},de)),e.jsx("div",{ref:Q})]}),q&&e.jsx("button",{className:"chat-scroll-bottom-btn",onClick:qe,title:"Scroll to bottom",children:""})]}),e.jsx("form",{onSubmit:ze,className:"chat-input-form",children:e.jsxs("div",{className:"chat-input-row",children:[g.length>0&&e.jsx("div",{className:"chat-attachments-bar",children:g.map((M,de)=>e.jsxs("div",{className:"chat-attachment-chip",children:[M.type==="image"?e.jsx("img",{src:M.dataUrl,alt:M.name,className:"chat-attachment-chip-image"}):e.jsx("span",{className:"chat-attachment-chip-audio",children:""}),e.jsx("span",{className:"chat-attachment-chip-name",children:M.name}),e.jsx("button",{type:"button",className:"chat-attachment-chip-remove",onClick:()=>on(de),children:""})]},de))}),e.jsx("textarea",{ref:ee,value:h,onChange:M=>m(M.target.value),onKeyDown:st,placeholder:"Type your message... (Enter to send, Shift+Enter for new line)",disabled:x||!d,className:"chat-input",rows:3}),e.jsxs("div",{className:"chat-input-buttons",children:[e.jsx("input",{ref:C,type:"file",accept:"image/*,audio/*",multiple:!0,onChange:Vt,style:{display:"none"}}),e.jsx("button",{type:"button",className:"btn btn-secondary chat-attach-btn",onClick:()=>{var M;return(M=C.current)==null?void 0:M.click()},disabled:x||!d,children:""}),x?e.jsx("button",{type:"button",className:"btn btn-danger",onClick:tt,children:"Stop"}):e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:!h.trim()&&g.length===0||!d,children:"Send"})]})]})})]})]})}function CP(){return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"SDK Documentation"}),e.jsx("p",{children:"Documentation for the Kronk SDK"})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:" Under Construction"}),e.jsx("p",{children:"SDK documentation is coming soon."})]})})]})}function PP(){return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"Kronk Package"}),e.jsx("p",{children:"Package kronk provides support for working with models using llama.cpp via yzma."})]}),e.jsxs("div",{className:"doc-layout",children:[e.jsxs("div",{className:"doc-content",children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Import"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'import "github.com/ardanlabs/kronk/sdk/kronk"'})})]}),e.jsxs("div",{className:"card",id:"functions",children:[e.jsx("h3",{children:"Functions"}),e.jsxs("div",{className:"doc-section",id:"func-init",children:[e.jsx("h4",{children:"Init"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func Init(opts ...InitOption) error"})}),e.jsx("p",{className:"doc-description",children:"Init initializes the Kronk backend support."})]}),e.jsxs("div",{className:"doc-section",id:"func-setfmtloggertraceid",children:[e.jsx("h4",{children:"SetFmtLoggerTraceID"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func SetFmtLoggerTraceID(ctx context.Context, traceID string) context.Context"})}),e.jsx("p",{className:"doc-description",children:"SetFmtLoggerTraceID allows you to set a trace id in the content that can be part of the output of the FmtLogger."})]}),e.jsxs("div",{className:"doc-section",id:"func-new",children:[e.jsx("h4",{children:"New"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func New(cfg model.Config, opts ...Option) (*Kronk, error)"})}),e.jsx("p",{className:"doc-description",children:"New provides the ability to use models in a concurrently safe way."})]})]}),e.jsxs("div",{className:"card",id:"types",children:[e.jsx("h3",{children:"Types"}),e.jsxs("div",{className:"doc-section",id:"type-incompletedetail",children:[e.jsx("h4",{children:"IncompleteDetail"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type IncompleteDetail struct {\n	Reason string `json:"reason"`\n}'})}),e.jsx("p",{className:"doc-description",children:"IncompleteDetail provides details about why a response is incomplete."})]}),e.jsxs("div",{className:"doc-section",id:"type-initoption",children:[e.jsx("h4",{children:"InitOption"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"type InitOption func(*initOptions)"})}),e.jsx("p",{className:"doc-description",children:"InitOption represents options for configuring Init."})]}),e.jsxs("div",{className:"doc-section",id:"type-inputtokensdetails",children:[e.jsx("h4",{children:"InputTokensDetails"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type InputTokensDetails struct {\n	CachedTokens int `json:"cached_tokens"`\n}'})}),e.jsx("p",{className:"doc-description",children:"InputTokensDetails provides breakdown of input tokens."})]}),e.jsxs("div",{className:"doc-section",id:"type-kronk",children:[e.jsx("h4",{children:"Kronk"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`type Kronk struct {
	// Has unexported fields.
}`})}),e.jsx("p",{className:"doc-description",children:"Kronk provides a concurrently safe api for using llama.cpp to access models."})]}),e.jsxs("div",{className:"doc-section",id:"type-loglevel",children:[e.jsx("h4",{children:"LogLevel"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"type LogLevel int"})}),e.jsx("p",{className:"doc-description",children:"LogLevel represents the logging level."})]}),e.jsxs("div",{className:"doc-section",id:"type-logger",children:[e.jsx("h4",{children:"Logger"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"type Logger func(ctx context.Context, msg string, args ...any)"})}),e.jsx("p",{className:"doc-description",children:"Logger provides a function for logging messages from different APIs."})]}),e.jsxs("div",{className:"doc-section",id:"type-option",children:[e.jsx("h4",{children:"Option"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"type Option func(*options)"})}),e.jsx("p",{className:"doc-description",children:"Option represents options for configuring Kronk."})]}),e.jsxs("div",{className:"doc-section",id:"type-outputtokensdetails",children:[e.jsx("h4",{children:"OutputTokensDetails"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type OutputTokensDetails struct {\n	ReasoningTokens int `json:"reasoning_tokens"`\n}'})}),e.jsx("p",{className:"doc-description",children:"OutputTokensDetails provides breakdown of output tokens."})]}),e.jsxs("div",{className:"doc-section",id:"type-responsecontentitem",children:[e.jsx("h4",{children:"ResponseContentItem"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type ResponseContentItem struct {\n	Type        string   `json:"type"`\n	Text        string   `json:"text"`\n	Annotations []string `json:"annotations"`\n}'})}),e.jsx("p",{className:"doc-description",children:"ResponseContentItem represents a content item within an output message."})]}),e.jsxs("div",{className:"doc-section",id:"type-responseerror",children:[e.jsx("h4",{children:"ResponseError"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type ResponseError struct {\n	Code    string `json:"code"`\n	Message string `json:"message"`\n}'})}),e.jsx("p",{className:"doc-description",children:"ResponseError represents an error in the response."})]}),e.jsxs("div",{className:"doc-section",id:"type-responseformattype",children:[e.jsx("h4",{children:"ResponseFormatType"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type ResponseFormatType struct {\n	Type string `json:"type"`\n}'})}),e.jsx("p",{className:"doc-description",children:"ResponseFormatType specifies the format type."})]}),e.jsxs("div",{className:"doc-section",id:"type-responseoutputitem",children:[e.jsx("h4",{children:"ResponseOutputItem"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type ResponseOutputItem struct {\n	Type      string                `json:"type"`\n	ID        string                `json:"id"`\n	Status    string                `json:"status,omitempty"`\n	Role      string                `json:"role,omitempty"`\n	Content   []ResponseContentItem `json:"content,omitempty"`\n	CallID    string                `json:"call_id,omitempty"`\n	Name      string                `json:"name,omitempty"`\n	Arguments string                `json:"arguments,omitempty"`\n}'})}),e.jsx("p",{className:"doc-description",children:'ResponseOutputItem represents an item in the output array. For type="message": ID, Status, Role, Content are used. For type="function_call": ID, Status, CallID, Name, Arguments are used.'})]}),e.jsxs("div",{className:"doc-section",id:"type-responsereasoning",children:[e.jsx("h4",{children:"ResponseReasoning"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type ResponseReasoning struct {\n	Effort  *string `json:"effort"`\n	Summary *string `json:"summary"`\n}'})}),e.jsx("p",{className:"doc-description",children:"ResponseReasoning contains reasoning configuration/output."})]}),e.jsxs("div",{className:"doc-section",id:"type-responseresponse",children:[e.jsx("h4",{children:"ResponseResponse"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type ResponseResponse struct {\n	ID               string               `json:"id"`\n	Object           string               `json:"object"`\n	CreatedAt        int64                `json:"created_at"`\n	Status           string               `json:"status"`\n	CompletedAt      *int64               `json:"completed_at"`\n	Error            *ResponseError       `json:"error"`\n	IncompleteDetail *IncompleteDetail    `json:"incomplete_details"`\n	Instructions     *string              `json:"instructions"`\n	MaxOutputTokens  *int                 `json:"max_output_tokens"`\n	Model            string               `json:"model"`\n	Output           []ResponseOutputItem `json:"output"`\n	ParallelToolCall bool                 `json:"parallel_tool_calls"`\n	PrevResponseID   *string              `json:"previous_response_id"`\n	Reasoning        ResponseReasoning    `json:"reasoning"`\n	Store            bool                 `json:"store"`\n	Temperature      float64              `json:"temperature"`\n	Text             ResponseTextFormat   `json:"text"`\n	ToolChoice       string               `json:"tool_choice"`\n	Tools            []any                `json:"tools"`\n	TopP             float64              `json:"top_p"`\n	Truncation       string               `json:"truncation"`\n	Usage            ResponseUsage        `json:"usage"`\n	User             *string              `json:"user"`\n	Metadata         map[string]any       `json:"metadata"`\n}'})}),e.jsx("p",{className:"doc-description",children:"ResponseResponse represents the OpenAI Responses API response format."})]}),e.jsxs("div",{className:"doc-section",id:"type-responsestreamevent",children:[e.jsx("h4",{children:"ResponseStreamEvent"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type ResponseStreamEvent struct {\n	Type           string               `json:"type"`\n	SequenceNumber int                  `json:"sequence_number"`\n	Response       *ResponseResponse    `json:"response,omitempty"`\n	OutputIndex    *int                 `json:"output_index,omitempty"`\n	ContentIndex   *int                 `json:"content_index,omitempty"`\n	ItemID         string               `json:"item_id,omitempty"`\n	Item           *ResponseOutputItem  `json:"item,omitempty"`\n	Part           *ResponseContentItem `json:"part,omitempty"`\n	Delta          string               `json:"delta,omitempty"`\n	Text           string               `json:"text,omitempty"`\n	Arguments      string               `json:"arguments,omitempty"`\n	Name           string               `json:"name,omitempty"`\n}'})}),e.jsx("p",{className:"doc-description",children:"ResponseStreamEvent represents a streaming event for the Responses API."})]}),e.jsxs("div",{className:"doc-section",id:"type-responsetextformat",children:[e.jsx("h4",{children:"ResponseTextFormat"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type ResponseTextFormat struct {\n	Format ResponseFormatType `json:"format"`\n}'})}),e.jsx("p",{className:"doc-description",children:"ResponseTextFormat specifies the text format configuration."})]}),e.jsxs("div",{className:"doc-section",id:"type-responseusage",children:[e.jsx("h4",{children:"ResponseUsage"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type ResponseUsage struct {\n	InputTokens        int                 `json:"input_tokens"`\n	InputTokensDetails InputTokensDetails  `json:"input_tokens_details"`\n	OutputTokens       int                 `json:"output_tokens"`\n	OutputTokenDetail  OutputTokensDetails `json:"output_tokens_details"`\n	TotalTokens        int                 `json:"total_tokens"`\n}'})}),e.jsx("p",{className:"doc-description",children:"ResponseUsage contains token usage information."})]})]}),e.jsxs("div",{className:"card",id:"methods",children:[e.jsx("h3",{children:"Methods"}),e.jsxs("div",{className:"doc-section",id:"method-kronk-activestreams",children:[e.jsx("h4",{children:"Kronk.ActiveStreams"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (krn *Kronk) ActiveStreams() int"})}),e.jsx("p",{className:"doc-description",children:"ActiveStreams returns the number of active streams."})]}),e.jsxs("div",{className:"doc-section",id:"method-kronk-chat",children:[e.jsx("h4",{children:"Kronk.Chat"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (krn *Kronk) Chat(ctx context.Context, d model.D) (model.ChatResponse, error)"})}),e.jsx("p",{className:"doc-description",children:"Chat provides support to interact with an inference model. For text models, NSeqMax controls parallel sequence processing within a single model instance. For vision/audio models, NSeqMax creates multiple model instances in a pool for concurrent request handling."})]}),e.jsxs("div",{className:"doc-section",id:"method-kronk-chatstreaming",children:[e.jsx("h4",{children:"Kronk.ChatStreaming"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (krn *Kronk) ChatStreaming(ctx context.Context, d model.D) (<-chan model.ChatResponse, error)"})}),e.jsx("p",{className:"doc-description",children:"ChatStreaming provides support to interact with an inference model. For text models, NSeqMax controls parallel sequence processing within a single model instance. For vision/audio models, NSeqMax creates multiple model instances in a pool for concurrent request handling."})]}),e.jsxs("div",{className:"doc-section",id:"method-kronk-chatstreaminghttp",children:[e.jsx("h4",{children:"Kronk.ChatStreamingHTTP"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (krn *Kronk) ChatStreamingHTTP(ctx context.Context, w http.ResponseWriter, d model.D) (model.ChatResponse, error)"})}),e.jsx("p",{className:"doc-description",children:"ChatStreamingHTTP provides http handler support for a chat/completions call. For text models, NSeqMax controls parallel sequence processing within a single model instance. For vision/audio models, NSeqMax creates multiple model instances in a pool for concurrent request handling."})]}),e.jsxs("div",{className:"doc-section",id:"method-kronk-embeddings",children:[e.jsx("h4",{children:"Kronk.Embeddings"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (krn *Kronk) Embeddings(ctx context.Context, d model.D) (model.EmbedReponse, error)"})}),e.jsx("p",{className:"doc-description",children:'Embeddings provides support to interact with an embedding model. Supported options in d: - input (string): the text to embed (required) - truncate (bool): if true, truncate input to fit context window (default: false) - truncate_direction (string): "right" (default) or "left" - dimensions (int): reduce output to first N dimensions (for Matryoshka models) Each model instance processes calls sequentially (llama.cpp only supports sequence 0 for embedding extraction). Use NSeqMax > 1 to create multiple model instances for concurrent request handling. Batch multiple texts in the input parameter for better performance within a single request.'})]}),e.jsxs("div",{className:"doc-section",id:"method-kronk-embeddingshttp",children:[e.jsx("h4",{children:"Kronk.EmbeddingsHTTP"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (krn *Kronk) EmbeddingsHTTP(ctx context.Context, log Logger, w http.ResponseWriter, d model.D) (model.EmbedReponse, error)"})}),e.jsx("p",{className:"doc-description",children:"EmbeddingsHTTP provides http handler support for an embeddings call."})]}),e.jsxs("div",{className:"doc-section",id:"method-kronk-modelconfig",children:[e.jsx("h4",{children:"Kronk.ModelConfig"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (krn *Kronk) ModelConfig() model.Config"})}),e.jsx("p",{className:"doc-description",children:"ModelConfig returns a copy of the configuration being used. This may be different from the configuration passed to New() if the model has overridden any of the settings."})]}),e.jsxs("div",{className:"doc-section",id:"method-kronk-modelinfo",children:[e.jsx("h4",{children:"Kronk.ModelInfo"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (krn *Kronk) ModelInfo() model.ModelInfo"})}),e.jsx("p",{className:"doc-description",children:"ModelInfo returns the model information."})]}),e.jsxs("div",{className:"doc-section",id:"method-kronk-rerank",children:[e.jsx("h4",{children:"Kronk.Rerank"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (krn *Kronk) Rerank(ctx context.Context, d model.D) (model.RerankResponse, error)"})}),e.jsx("p",{className:"doc-description",children:"Rerank provides support to interact with a reranker model. Supported options in d: - query (string): the query to rank documents against (required) - documents ([]string): the documents to rank (required) - top_n (int): return only the top N results (optional, default: all) - return_documents (bool): include document text in results (default: false) Each model instance processes calls sequentially (llama.cpp only supports sequence 0 for rerank extraction). Use NSeqMax > 1 to create multiple model instances for concurrent request handling. Batch multiple texts in the input parameter for better performance within a single request."})]}),e.jsxs("div",{className:"doc-section",id:"method-kronk-rerankhttp",children:[e.jsx("h4",{children:"Kronk.RerankHTTP"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (krn *Kronk) RerankHTTP(ctx context.Context, log Logger, w http.ResponseWriter, d model.D) (model.RerankResponse, error)"})}),e.jsx("p",{className:"doc-description",children:"RerankHTTP provides http handler support for a rerank call."})]}),e.jsxs("div",{className:"doc-section",id:"method-kronk-response",children:[e.jsx("h4",{children:"Kronk.Response"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (krn *Kronk) Response(ctx context.Context, d model.D) (ResponseResponse, error)"})}),e.jsx("p",{className:"doc-description",children:"Response provides support to interact with an inference model. For text models, NSeqMax controls parallel sequence processing within a single model instance. For vision/audio models, NSeqMax creates multiple model instances in a pool for concurrent request handling."})]}),e.jsxs("div",{className:"doc-section",id:"method-kronk-responsestreaming",children:[e.jsx("h4",{children:"Kronk.ResponseStreaming"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (krn *Kronk) ResponseStreaming(ctx context.Context, d model.D) (<-chan ResponseStreamEvent, error)"})}),e.jsx("p",{className:"doc-description",children:"ResponseStreaming provides streaming support for the Responses API. For text models, NSeqMax controls parallel sequence processing within a single model instance. For vision/audio models, NSeqMax creates multiple model instances in a pool for concurrent request handling."})]}),e.jsxs("div",{className:"doc-section",id:"method-kronk-responsestreaminghttp",children:[e.jsx("h4",{children:"Kronk.ResponseStreamingHTTP"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (krn *Kronk) ResponseStreamingHTTP(ctx context.Context, w http.ResponseWriter, d model.D) (ResponseResponse, error)"})}),e.jsx("p",{className:"doc-description",children:"ResponseStreamingHTTP provides http handler support for a responses call. For text models, NSeqMax controls parallel sequence processing within a single model instance. For vision/audio models, NSeqMax creates multiple model instances in a pool for concurrent request handling."})]}),e.jsxs("div",{className:"doc-section",id:"method-kronk-systeminfo",children:[e.jsx("h4",{children:"Kronk.SystemInfo"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (krn *Kronk) SystemInfo() map[string]string"})}),e.jsx("p",{className:"doc-description",children:"SystemInfo returns system information."})]}),e.jsxs("div",{className:"doc-section",id:"method-kronk-tokenize",children:[e.jsx("h4",{children:"Kronk.Tokenize"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (krn *Kronk) Tokenize(ctx context.Context, d model.D) (model.TokenizeResponse, error)"})}),e.jsx("p",{className:"doc-description",children:"Tokenize returns the token count for a text input. Supported options in d: - input (string): the text to tokenize (required) - apply_template (bool): if true, wrap input as a user message and apply the model's chat template before tokenizing (default: false) - add_generation_prompt (bool): when apply_template is true, controls whether the assistant role prefix is appended to the prompt (default: true) When apply_template is true, the returned count includes all template overhead (role markers, separators, generation prompt). This reflects the actual number of tokens that would be fed to the model."})]}),e.jsxs("div",{className:"doc-section",id:"method-kronk-tokenizehttp",children:[e.jsx("h4",{children:"Kronk.TokenizeHTTP"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (krn *Kronk) TokenizeHTTP(ctx context.Context, log Logger, w http.ResponseWriter, d model.D) (model.TokenizeResponse, error)"})}),e.jsx("p",{className:"doc-description",children:"TokenizeHTTP provides http handler support for a tokenize call."})]}),e.jsxs("div",{className:"doc-section",id:"method-kronk-unload",children:[e.jsx("h4",{children:"Kronk.Unload"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (krn *Kronk) Unload(ctx context.Context) error"})}),e.jsx("p",{className:"doc-description",children:"Unload will close down the loaded model. You should call this only when you are completely done using Kronk."})]}),e.jsxs("div",{className:"doc-section",id:"method-loglevel-int",children:[e.jsx("h4",{children:"LogLevel.Int"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (ll LogLevel) Int() int"})}),e.jsx("p",{className:"doc-description",children:"Int returns the integer value."})]})]}),e.jsxs("div",{className:"card",id:"constants",children:[e.jsx("h3",{children:"Constants"}),e.jsxs("div",{className:"doc-section",id:"const-version",children:[e.jsx("h4",{children:"Version"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'const Version = "1.20.8"'})}),e.jsx("p",{className:"doc-description",children:"Version contains the current version of the kronk package."})]})]}),e.jsxs("div",{className:"card",id:"variables",children:[e.jsx("h3",{children:"Variables"}),e.jsxs("div",{className:"doc-section",id:"var-discardlogger",children:[e.jsx("h4",{children:"DiscardLogger"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`var DiscardLogger = func(ctx context.Context, msg string, args ...any) {
}`})}),e.jsx("p",{className:"doc-description",children:"DiscardLogger discards logging."})]}),e.jsxs("div",{className:"doc-section",id:"var-fmtlogger",children:[e.jsx("h4",{children:"FmtLogger"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`var FmtLogger = func(ctx context.Context, msg string, args ...any) {
	traceID, ok := ctx.Value(traceIDKey(1)).(string)
	switch ok {
	case true:
		fmt.Printf("traceID: %s: %s:", traceID, msg)
	default:
		fmt.Printf("%s:", msg)
	}

	for i := 0; i < len(args); i += 2 {
		if i+1 < len(args) {
			fmt.Printf(" %v[%v]", args[i], args[i+1])
		}
	}

	if len(msg) > 0 && msg[0] != '\\r' {
		fmt.Println()
	}
}`})}),e.jsx("p",{className:"doc-description",children:"FmtLogger provides a basic logger that writes to stdout."})]})]})]}),e.jsx("nav",{className:"doc-sidebar",children:e.jsxs("div",{className:"doc-sidebar-content",children:[e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#functions",className:"doc-index-header",children:"Functions"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#func-init",children:"Init"})}),e.jsx("li",{children:e.jsx("a",{href:"#func-setfmtloggertraceid",children:"SetFmtLoggerTraceID"})}),e.jsx("li",{children:e.jsx("a",{href:"#func-new",children:"New"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#types",className:"doc-index-header",children:"Types"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#type-incompletedetail",children:"IncompleteDetail"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-initoption",children:"InitOption"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-inputtokensdetails",children:"InputTokensDetails"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-kronk",children:"Kronk"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-loglevel",children:"LogLevel"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-logger",children:"Logger"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-option",children:"Option"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-outputtokensdetails",children:"OutputTokensDetails"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-responsecontentitem",children:"ResponseContentItem"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-responseerror",children:"ResponseError"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-responseformattype",children:"ResponseFormatType"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-responseoutputitem",children:"ResponseOutputItem"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-responsereasoning",children:"ResponseReasoning"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-responseresponse",children:"ResponseResponse"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-responsestreamevent",children:"ResponseStreamEvent"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-responsetextformat",children:"ResponseTextFormat"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-responseusage",children:"ResponseUsage"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#methods",className:"doc-index-header",children:"Methods"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#method-kronk-activestreams",children:"Kronk.ActiveStreams"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-kronk-chat",children:"Kronk.Chat"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-kronk-chatstreaming",children:"Kronk.ChatStreaming"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-kronk-chatstreaminghttp",children:"Kronk.ChatStreamingHTTP"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-kronk-embeddings",children:"Kronk.Embeddings"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-kronk-embeddingshttp",children:"Kronk.EmbeddingsHTTP"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-kronk-modelconfig",children:"Kronk.ModelConfig"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-kronk-modelinfo",children:"Kronk.ModelInfo"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-kronk-rerank",children:"Kronk.Rerank"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-kronk-rerankhttp",children:"Kronk.RerankHTTP"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-kronk-response",children:"Kronk.Response"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-kronk-responsestreaming",children:"Kronk.ResponseStreaming"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-kronk-responsestreaminghttp",children:"Kronk.ResponseStreamingHTTP"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-kronk-systeminfo",children:"Kronk.SystemInfo"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-kronk-tokenize",children:"Kronk.Tokenize"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-kronk-tokenizehttp",children:"Kronk.TokenizeHTTP"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-kronk-unload",children:"Kronk.Unload"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-loglevel-int",children:"LogLevel.Int"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#constants",className:"doc-index-header",children:"Constants"}),e.jsx("ul",{children:e.jsx("li",{children:e.jsx("a",{href:"#const-version",children:"Version"})})})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#variables",className:"doc-index-header",children:"Variables"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#var-discardlogger",children:"DiscardLogger"})}),e.jsx("li",{children:e.jsx("a",{href:"#var-fmtlogger",children:"FmtLogger"})})]})]})]})})]})]})}function EP(){return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"Model Package"}),e.jsx("p",{children:"Package model provides the low-level api for working with models."})]}),e.jsxs("div",{className:"doc-layout",children:[e.jsxs("div",{className:"doc-content",children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Import"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'import "github.com/ardanlabs/kronk/sdk/kronk/model"'})})]}),e.jsxs("div",{className:"card",id:"functions",children:[e.jsx("h3",{children:"Functions"}),e.jsxs("div",{className:"doc-section",id:"func-addparams",children:[e.jsx("h4",{children:"AddParams"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func AddParams(params Params, d D)"})}),e.jsx("p",{className:"doc-description",children:"AddParams adds the values from the Params struct into the provided D map. Only non-zero values are added."})]}),e.jsxs("div",{className:"doc-section",id:"func-checkmodel",children:[e.jsx("h4",{children:"CheckModel"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func CheckModel(modelFile string, checkSHA bool) error"})}),e.jsx("p",{className:"doc-description",children:"CheckModel is check if the downloaded model is valid based on it's sha file. If no sha file exists, this check will return with no error."})]}),e.jsxs("div",{className:"doc-section",id:"func-inityzmaworkarounds",children:[e.jsx("h4",{children:"InitYzmaWorkarounds"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func InitYzmaWorkarounds(libPath string) error"})}),e.jsx("p",{className:"doc-description",children:"InitYzmaWorkarounds loads the mtmd library and preps our fixed FFI functions. This is safe to call multiple times; it only initializes once."})]}),e.jsxs("div",{className:"doc-section",id:"func-newgrammarsampler",children:[e.jsx("h4",{children:"NewGrammarSampler"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func NewGrammarSampler(vocab llama.Vocab, grammar string) *grammarSampler"})}),e.jsx("p",{className:"doc-description",children:"NewGrammarSampler creates a grammar sampler that will be managed separately from the main sampler chain."})]}),e.jsxs("div",{className:"doc-section",id:"func-parseggmltype",children:[e.jsx("h4",{children:"ParseGGMLType"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func ParseGGMLType(s string) (GGMLType, error)"})}),e.jsx("p",{className:"doc-description",children:'ParseGGMLType parses a string into a GGMLType. Supported values: "f32", "f16", "q4_0", "q4_1", "q5_0", "q5_1", "q8_0", "bf16", "auto".'})]}),e.jsxs("div",{className:"doc-section",id:"func-newmodel",children:[e.jsx("h4",{children:"NewModel"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func NewModel(ctx context.Context, cataloger Cataloger, cfg Config) (*Model, error)"})})]}),e.jsxs("div",{className:"doc-section",id:"func-detectmodeltypefromfiles",children:[e.jsx("h4",{children:"DetectModelTypeFromFiles"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func DetectModelTypeFromFiles(modelFiles []string) (ModelType, string, error)"})}),e.jsx("p",{className:"doc-description",children:"DetectModelTypeFromFiles loads a model from the given GGUF files, determines the architecture type, and immediately frees the model. It returns the ModelType, the raw general.architecture string from the GGUF metadata, and any error encountered during loading."})]}),e.jsxs("div",{className:"doc-section",id:"func-parseropescalingtype",children:[e.jsx("h4",{children:"ParseRopeScalingType"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func ParseRopeScalingType(s string) (RopeScalingType, error)"})}),e.jsx("p",{className:"doc-description",children:'ParseRopeScalingType parses a string into a RopeScalingType. Supported values: "none", "linear", "yarn".'})]}),e.jsxs("div",{className:"doc-section",id:"func-parsesplitmode",children:[e.jsx("h4",{children:"ParseSplitMode"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func ParseSplitMode(s string) (SplitMode, error)"})}),e.jsx("p",{className:"doc-description",children:'ParseSplitMode parses a string into a SplitMode. Supported values: "none", "layer", "row", "expert-parallel", "tensor-parallel".'})]})]}),e.jsxs("div",{className:"card",id:"types",children:[e.jsx("h3",{children:"Types"}),e.jsxs("div",{className:"doc-section",id:"type-cataloger",children:[e.jsx("h4",{children:"Cataloger"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`type Cataloger interface {
	RetrieveTemplate(modelID string) (Template, error)
	RetrieveConfig(modelID string) (Config, error)
}`})}),e.jsx("p",{className:"doc-description",children:"Cataloger provides support to retrieve catalog config and template information."})]}),e.jsxs("div",{className:"doc-section",id:"type-chatresponse",children:[e.jsx("h4",{children:"ChatResponse"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type ChatResponse struct {\n	ID      string   `json:"id"`\n	Object  string   `json:"object"`\n	Created int64    `json:"created"`\n	Model   string   `json:"model"`\n	Choice  []Choice `json:"choices"`\n	Usage   *Usage   `json:"usage,omitempty"`\n	Prompt  string   `json:"prompt,omitempty"`\n}'})}),e.jsx("p",{className:"doc-description",children:"ChatResponse represents output for inference models."})]}),e.jsxs("div",{className:"doc-section",id:"type-choice",children:[e.jsx("h4",{children:"Choice"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type Choice struct {\n	Index           int              `json:"index"`\n	Message         *ResponseMessage `json:"message,omitempty"`\n	Delta           *ResponseMessage `json:"delta,omitempty"`\n	Logprobs        *Logprobs        `json:"logprobs,omitempty"`\n	FinishReasonPtr *string          `json:"finish_reason"`\n}'})}),e.jsx("p",{className:"doc-description",children:"Choice represents a single choice in a response."})]}),e.jsxs("div",{className:"doc-section",id:"type-config",children:[e.jsx("h4",{children:"Config"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`type Config struct {
	CacheMinTokens       int
	CacheSlotTimeout     int
	CacheTypeK           GGMLType
	CacheTypeV           GGMLType
	ContextWindow        int
	DefaultParams        Params
	Device               string
	FlashAttention       FlashAttentionType
	IgnoreIntegrityCheck bool
	IncrementalCache     bool
	InsecureLogging      bool
	JinjaFile            string
	Log                  Logger
	ModelFiles           []string
	NBatch               int
	NGpuLayers           *int
	NSeqMax              int
	NThreads             int
	NThreadsBatch        int
	NUBatch              int
	OffloadKQV           *bool
	OpOffload            *bool
	ProjFile             string
	RopeFreqBase         *float32
	RopeFreqScale        *float32
	RopeScaling          RopeScalingType
	SplitMode            SplitMode
	SystemPromptCache    bool
	UseDirectIO          bool
	YarnAttnFactor       *float32
	YarnBetaFast         *float32
	YarnBetaSlow         *float32
	YarnExtFactor        *float32
	YarnOrigCtx          *int
	DraftModel           *DraftModelConfig
}`})})]}),e.jsxs("div",{className:"doc-section",id:"type-contentlogprob",children:[e.jsx("h4",{children:"ContentLogprob"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type ContentLogprob struct {\n	Token       string       `json:"token"`\n	Logprob     float32      `json:"logprob"`\n	Bytes       []byte       `json:"bytes,omitempty"`\n	TopLogprobs []TopLogprob `json:"top_logprobs,omitempty"`\n}'})}),e.jsx("p",{className:"doc-description",children:"ContentLogprob represents log probability information for a single token."})]}),e.jsxs("div",{className:"doc-section",id:"type-d",children:[e.jsx("h4",{children:"D"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"type D map[string]any"})}),e.jsx("p",{className:"doc-description",children:"D represents a generic docment of fields and values."})]}),e.jsxs("div",{className:"doc-section",id:"type-draftmodelconfig",children:[e.jsx("h4",{children:"DraftModelConfig"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`type DraftModelConfig struct {
	ModelFiles []string // Path to the draft model GGUF file(s)
	NDraft     int      // Number of tokens to draft per step (default 5)
	NGpuLayers *int     // GPU layers for draft model (nil = all layers on GPU)
	Device     string   // Device for draft model (e.g., "GPU1") to pin to a specific GPU
}`})}),e.jsx("p",{className:"doc-description",children:"DraftModelConfig configures a draft model for speculative decoding. A smaller, faster model generates candidate tokens that the target model verifies in a single forward pass. This can improve generation throughput when the draft model's predictions frequently match the target's. Requirements: - Draft and target models must share the same vocabulary (same tokenizer) - NSeqMax must be 1 (single-slot mode) - Draft model should be significantly smaller than the target (e.g., 0.6B draft for 8B target)"})]}),e.jsxs("div",{className:"doc-section",id:"type-embeddata",children:[e.jsx("h4",{children:"EmbedData"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type EmbedData struct {\n	Object    string    `json:"object"`\n	Index     int       `json:"index"`\n	Embedding []float32 `json:"embedding"`\n}'})}),e.jsx("p",{className:"doc-description",children:"EmbedData represents the data associated with an embedding call."})]}),e.jsxs("div",{className:"doc-section",id:"type-embedreponse",children:[e.jsx("h4",{children:"EmbedReponse"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type EmbedReponse struct {\n	Object  string      `json:"object"`\n	Created int64       `json:"created"`\n	Model   string      `json:"model"`\n	Data    []EmbedData `json:"data"`\n	Usage   EmbedUsage  `json:"usage"`\n}'})}),e.jsx("p",{className:"doc-description",children:"EmbedReponse represents the output for an embedding call."})]}),e.jsxs("div",{className:"doc-section",id:"type-embedusage",children:[e.jsx("h4",{children:"EmbedUsage"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type EmbedUsage struct {\n	PromptTokens int `json:"prompt_tokens"`\n	TotalTokens  int `json:"total_tokens"`\n}'})}),e.jsx("p",{className:"doc-description",children:"EmbedUsage provides token usage information for embeddings."})]}),e.jsxs("div",{className:"doc-section",id:"type-flashattentiontype",children:[e.jsx("h4",{children:"FlashAttentionType"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"type FlashAttentionType int32"})}),e.jsx("p",{className:"doc-description",children:"FlashAttentionType controls when to enable Flash Attention. Flash Attention reduces memory usage and speeds up attention computation, especially beneficial for large context windows."})]}),e.jsxs("div",{className:"doc-section",id:"type-ggmltype",children:[e.jsx("h4",{children:"GGMLType"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"type GGMLType int32"})}),e.jsx("p",{className:"doc-description",children:"GGMLType represents a ggml data type for the KV cache. These values correspond to the ggml_type enum in llama.cpp."})]}),e.jsxs("div",{className:"doc-section",id:"type-logger",children:[e.jsx("h4",{children:"Logger"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"type Logger func(ctx context.Context, msg string, args ...any)"})}),e.jsx("p",{className:"doc-description",children:"Logger provides a function for logging messages from different APIs."})]}),e.jsxs("div",{className:"doc-section",id:"type-logprobs",children:[e.jsx("h4",{children:"Logprobs"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type Logprobs struct {\n	Content []ContentLogprob `json:"content,omitempty"`\n}'})}),e.jsx("p",{className:"doc-description",children:"Logprobs contains log probability information for the response."})]}),e.jsxs("div",{className:"doc-section",id:"type-mediatype",children:[e.jsx("h4",{children:"MediaType"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"type MediaType int"})})]}),e.jsxs("div",{className:"doc-section",id:"type-model",children:[e.jsx("h4",{children:"Model"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`type Model struct {
	// Has unexported fields.
}`})}),e.jsx("p",{className:"doc-description",children:"Model represents a model and provides a low-level API for working with it."})]}),e.jsxs("div",{className:"doc-section",id:"type-modelinfo",children:[e.jsx("h4",{children:"ModelInfo"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`type ModelInfo struct {
	ID            string
	HasProjection bool
	Desc          string
	Size          uint64
	VRAMTotal     int64
	SlotMemory    int64
	Type          ModelType
	IsGPTModel    bool
	IsEmbedModel  bool
	IsRerankModel bool
	Metadata      map[string]string
	Template      Template
}`})}),e.jsx("p",{className:"doc-description",children:"ModelInfo represents the model's card information."})]}),e.jsxs("div",{className:"doc-section",id:"type-modeltype",children:[e.jsx("h4",{children:"ModelType"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"type ModelType uint8"})}),e.jsx("p",{className:"doc-description",children:"ModelType represents the model architecture for batch engine state management."})]}),e.jsxs("div",{className:"doc-section",id:"type-params",children:[e.jsx("h4",{children:"Params"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`type Params struct {
	// AdaptivePDecay controls how quickly the Adaptive-P sampler adjusts.
	// Default is 0.0.
	AdaptivePDecay float32 \`json:"adaptive_p_decay"\`

	// AdaptivePTarget is the target probability threshold for Adaptive-P
	// sampling. When > 0, enables adaptive sampling that dynamically adjusts
	// based on the probability distribution to prevent predictable patterns.
	// Default is 0.0 (disabled).
	AdaptivePTarget float32 \`json:"adaptive_p_target"\`

	// DryAllowedLen is the minimum n-gram length before DRY applies. Default is 2.
	DryAllowedLen int32 \`json:"dry_allowed_length"\`

	// DryBase is the base for exponential penalty growth in DRY. Default is 1.75.
	DryBase float32 \`json:"dry_base"\`

	// DryMultiplier controls the DRY (Don't Repeat Yourself) sampler which
	// penalizes n-gram pattern repetition. 0.8 - Light repetition penalty,
	// 1.01.5 - Moderate (typical starting point), 2.03.0 - Aggressive.
	// Default is 1.05.
	DryMultiplier float32 \`json:"dry_multiplier"\`

	// DryPenaltyLast limits how many recent tokens DRY considers. Default of 0
	// means full context.
	DryPenaltyLast int32 \`json:"dry_penalty_last_n"\`

	// FrequencyPenalty penalizes tokens proportionally to how often they have
	// appeared in the output. Higher values more strongly discourage frequent
	// repetition. Default is 0.0 (disabled).
	FrequencyPenalty float32 \`json:"frequency_penalty"\`

	// Grammar constrains output to match a GBNF grammar specification.
	// When set, the model output will be forced to conform to this grammar.
	// Use preset grammars like GrammarJSON or generate from JSON Schema.
	Grammar string \`json:"grammar"\`

	// IncludeUsage determines whether to include token usage information in
	// streaming responses. Default is true.
	IncludeUsage bool \`json:"include_usage"\`

	// Logprobs determines whether to return log probabilities of output tokens.
	// When enabled, the response includes probability data for each generated
	// token. Default is false.
	Logprobs bool \`json:"logprobs"\`

	// MaxTokens is the maximum tokens for generation when not derived from the
	// model's context window. Default is 4096.
	MaxTokens int \`json:"max_tokens"\`

	// MinP is a dynamic sampling threshold that helps balance the coherence
	// (quality) and diversity (creativity) of the generated text. Default is 0.0.
	MinP float32 \`json:"min_p"\`

	// PresencePenalty applies a flat penalty to any token that has already
	// appeared in the output, regardless of frequency. Higher values encourage
	// the model to introduce new topics. Default is 0.0 (disabled).
	PresencePenalty float32 \`json:"presence_penalty"\`

	// ReasoningEffort is a string that specifies the level of reasoning effort
	// to use for GPT models. Default is ReasoningEffortMedium.
	ReasoningEffort string \`json:"reasoning_effort"\`

	// RepeatLastN specifies how many recent tokens to consider when applying
	// the repetition penalty. A larger value considers more context but may be
	// slower. Default is 64.
	RepeatLastN int32 \`json:"repeat_last_n"\`

	// RepeatPenalty applies a penalty to tokens that have already appeared in
	// the output, reducing repetitive text. A value of 1.0 means no penalty.
	// Values above 1.0 reduce repetition (e.g., 1.1 is a mild penalty, 1.5 is
	// strong). Default is 1.0 which turns it off.
	RepeatPenalty float32 \`json:"repeat_penalty"\`

	// ReturnPrompt determines whether to include the prompt in the final
	// response. When set to true, the prompt will be included. Default is false.
	ReturnPrompt bool \`json:"return_prompt"\`

	// Stream determines whether to stream the response.
	Stream bool \`json:"stream"\`

	// Temperature controls the randomness of the output. It rescales the
	// probability distribution of possible next tokens. Default is 0.8.
	Temperature float32 \`json:"temperature"\`

	// Thinking determines if the model should think or not. It is used for most
	// non-GPT models. It accepts 1, t, T, TRUE, true, True, 0, f, F, FALSE,
	// false, False. Default is "true".
	Thinking string \`json:"enable_thinking"\`

	// TopK limits the pool of possible next tokens to the K number of most
	// probable tokens. If a model predicts 10,000 possible next tokens, setting
	// top_k to 50 means only the 50 tokens with the highest probabilities are
	// considered for selection (after temperature scaling). Default is 40.
	TopK int32 \`json:"top_k"\`

	// TopLogprobs specifies how many of the most likely tokens to return at
	// each position, along with their log probabilities. Must be between 0 and
	// 5. Setting this to a value > 0 implicitly enables logprobs. Default is 0.
	TopLogprobs int \`json:"top_logprobs"\`

	// TopP, also known as nucleus sampling, works differently than top_k by
	// selecting a dynamic pool of tokens whose cumulative probability exceeds a
	// threshold P. Instead of a fixed number of tokens (K), it selects the
	// minimum number of most probable tokens required to reach the cumulative
	// probability P. Default is 0.9.
	TopP float32 \`json:"top_p"\`

	// XtcMinKeep is the minimum tokens to keep after XTC culling. Default is 1.
	XtcMinKeep uint32 \`json:"xtc_min_keep"\`

	// XtcProbability controls XTC (eXtreme Token Culling) which randomly removes
	// tokens close to top probability. Must be > 0 to activate. Default is 0.0
	// (disabled).
	XtcProbability float32 \`json:"xtc_probability"\`

	// XtcThreshold is the probability threshold for XTC culling. Default is 0.1.
	XtcThreshold float32 \`json:"xtc_threshold"\`
}`})})]}),e.jsxs("div",{className:"doc-section",id:"type-rerankresponse",children:[e.jsx("h4",{children:"RerankResponse"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type RerankResponse struct {\n	Object  string         `json:"object"`\n	Created int64          `json:"created"`\n	Model   string         `json:"model"`\n	Data    []RerankResult `json:"data"`\n	Usage   RerankUsage    `json:"usage"`\n}'})}),e.jsx("p",{className:"doc-description",children:"RerankResponse represents the output for a reranking call."})]}),e.jsxs("div",{className:"doc-section",id:"type-rerankresult",children:[e.jsx("h4",{children:"RerankResult"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type RerankResult struct {\n	Index          int     `json:"index"`\n	RelevanceScore float32 `json:"relevance_score"`\n	Document       string  `json:"document,omitempty"`\n}'})}),e.jsx("p",{className:"doc-description",children:"RerankResult represents a single document's reranking result."})]}),e.jsxs("div",{className:"doc-section",id:"type-rerankusage",children:[e.jsx("h4",{children:"RerankUsage"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type RerankUsage struct {\n	PromptTokens int `json:"prompt_tokens"`\n	TotalTokens  int `json:"total_tokens"`\n}'})}),e.jsx("p",{className:"doc-description",children:"RerankUsage provides token usage information for reranking."})]}),e.jsxs("div",{className:"doc-section",id:"type-responsemessage",children:[e.jsx("h4",{children:"ResponseMessage"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type ResponseMessage struct {\n	Role      string             `json:"role,omitempty"`\n	Content   string             `json:"content,omitempty"`\n	Reasoning string             `json:"reasoning_content,omitempty"`\n	ToolCalls []ResponseToolCall `json:"tool_calls,omitempty"`\n}'})}),e.jsx("p",{className:"doc-description",children:"ResponseMessage represents a single message in a response."})]}),e.jsxs("div",{className:"doc-section",id:"type-responsetoolcall",children:[e.jsx("h4",{children:"ResponseToolCall"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type ResponseToolCall struct {\n	ID       string                   `json:"id"`\n	Index    int                      `json:"index"`\n	Type     string                   `json:"type"`\n	Function ResponseToolCallFunction `json:"function"`\n	Status   int                      `json:"status,omitempty"`\n	Raw      string                   `json:"raw,omitempty"`\n	Error    string                   `json:"error,omitempty"`\n}'})})]}),e.jsxs("div",{className:"doc-section",id:"type-responsetoolcallfunction",children:[e.jsx("h4",{children:"ResponseToolCallFunction"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type ResponseToolCallFunction struct {\n	Name      string            `json:"name"`\n	Arguments ToolCallArguments `json:"arguments"`\n}'})})]}),e.jsxs("div",{className:"doc-section",id:"type-ropescalingtype",children:[e.jsx("h4",{children:"RopeScalingType"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"type RopeScalingType int32"})}),e.jsx("p",{className:"doc-description",children:"RopeScalingType controls RoPE (Rotary Position Embedding) scaling method. This enables extended context windows beyond the model's native training length. For example, Qwen3 models trained on 32k can support 131k with YaRN scaling."})]}),e.jsxs("div",{className:"doc-section",id:"type-splitmode",children:[e.jsx("h4",{children:"SplitMode"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"type SplitMode int32"})}),e.jsx("p",{className:"doc-description",children:"SplitMode controls how the model is split across multiple GPUs. This is particularly important for Mixture of Experts (MoE) models."})]}),e.jsxs("div",{className:"doc-section",id:"type-streamingresponselogger",children:[e.jsx("h4",{children:"StreamingResponseLogger"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`type StreamingResponseLogger struct {
	// Has unexported fields.
}`})}),e.jsx("p",{className:"doc-description",children:"StreamingResponseLogger captures the final streaming response for logging. It must capture data before forwarding since the caller may mutate the response."})]}),e.jsxs("div",{className:"doc-section",id:"type-template",children:[e.jsx("h4",{children:"Template"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`type Template struct {
	FileName string
	Script   string
}`})}),e.jsx("p",{className:"doc-description",children:"Template provides the template file name."})]}),e.jsxs("div",{className:"doc-section",id:"type-tokenizeresponse",children:[e.jsx("h4",{children:"TokenizeResponse"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type TokenizeResponse struct {\n	Object  string `json:"object"`\n	Created int64  `json:"created"`\n	Model   string `json:"model"`\n	Tokens  int    `json:"tokens"`\n}'})}),e.jsx("p",{className:"doc-description",children:"TokenizeResponse represents the output for a tokenize call."})]}),e.jsxs("div",{className:"doc-section",id:"type-toolcallarguments",children:[e.jsx("h4",{children:"ToolCallArguments"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"type ToolCallArguments map[string]any"})}),e.jsx("p",{className:"doc-description",children:"ToolCallArguments represents tool call arguments that marshal to a JSON string per OpenAI API spec, but can unmarshal from either a string or object."})]}),e.jsxs("div",{className:"doc-section",id:"type-toplogprob",children:[e.jsx("h4",{children:"TopLogprob"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type TopLogprob struct {\n	Token   string  `json:"token"`\n	Logprob float32 `json:"logprob"`\n	Bytes   []byte  `json:"bytes,omitempty"`\n}'})}),e.jsx("p",{className:"doc-description",children:"TopLogprob represents a single token with its log probability."})]}),e.jsxs("div",{className:"doc-section",id:"type-usage",children:[e.jsx("h4",{children:"Usage"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'type Usage struct {\n	PromptTokens       int     `json:"prompt_tokens"`\n	ReasoningTokens    int     `json:"reasoning_tokens"`\n	CompletionTokens   int     `json:"completion_tokens"`\n	OutputTokens       int     `json:"output_tokens"`\n	TotalTokens        int     `json:"total_tokens"`\n	TokensPerSecond    float64 `json:"tokens_per_second"`\n	TimeToFirstTokenMS float64 `json:"time_to_first_token_ms"`\n}'})}),e.jsx("p",{className:"doc-description",children:"Usage provides details usage information for the request."})]})]}),e.jsxs("div",{className:"card",id:"methods",children:[e.jsx("h3",{children:"Methods"}),e.jsxs("div",{className:"doc-section",id:"method-choice-finishreason",children:[e.jsx("h4",{children:"Choice.FinishReason"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (c Choice) FinishReason() string"})}),e.jsx("p",{className:"doc-description",children:"FinishReason return the finish reason as an empty string if it is nil."})]}),e.jsxs("div",{className:"doc-section",id:"method-config-string",children:[e.jsx("h4",{children:"Config.String"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (cfg Config) String() string"})})]}),e.jsxs("div",{className:"doc-section",id:"method-d-clone",children:[e.jsx("h4",{children:"D.Clone"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (d D) Clone() D"})}),e.jsx("p",{className:"doc-description",children:"Clone creates a copy of the document. Top-level keys are copied into a new map. Values that are D or []D are cloned recursively so that nested message maps can be mutated independently across concurrent requests. Other value types (strings, numbers, etc.) are shared."})]}),e.jsxs("div",{className:"doc-section",id:"method-d-messages",children:[e.jsx("h4",{children:"D.Messages"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (d D) Messages() string"})})]}),e.jsxs("div",{className:"doc-section",id:"method-d-shallowclone",children:[e.jsx("h4",{children:"D.ShallowClone"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (d D) ShallowClone() D"})}),e.jsx("p",{className:"doc-description",children:"ShallowClone creates a copy of the top-level map and the messages slice. Individual message maps are shared with the original. Use this when downstream code treats message maps as read-only or performs its own copy-on-write when mutation is needed."})]}),e.jsxs("div",{className:"doc-section",id:"method-d-string",children:[e.jsx("h4",{children:"D.String"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (d D) String() string"})}),e.jsx("p",{className:"doc-description",children:"String returns a string representation of the document containing only fields that are safe to log. This excludes sensitive fields like messages and input which may contain private user data."})]}),e.jsxs("div",{className:"doc-section",id:"method-flashattentiontype-marshaljson",children:[e.jsx("h4",{children:"FlashAttentionType.MarshalJSON"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (t FlashAttentionType) MarshalJSON() ([]byte, error)"})})]}),e.jsxs("div",{className:"doc-section",id:"method-flashattentiontype-marshalyaml",children:[e.jsx("h4",{children:"FlashAttentionType.MarshalYAML"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (t FlashAttentionType) MarshalYAML() (any, error)"})})]}),e.jsxs("div",{className:"doc-section",id:"method-flashattentiontype-string",children:[e.jsx("h4",{children:"FlashAttentionType.String"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (t FlashAttentionType) String() string"})})]}),e.jsxs("div",{className:"doc-section",id:"method-flashattentiontype-unmarshaljson",children:[e.jsx("h4",{children:"FlashAttentionType.UnmarshalJSON"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (t *FlashAttentionType) UnmarshalJSON(data []byte) error"})})]}),e.jsxs("div",{className:"doc-section",id:"method-flashattentiontype-unmarshalyaml",children:[e.jsx("h4",{children:"FlashAttentionType.UnmarshalYAML"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (t *FlashAttentionType) UnmarshalYAML(unmarshal func(any) error) error"})}),e.jsx("p",{className:"doc-description",children:"UnmarshalYAML implements yaml.Unmarshaler to parse string values."})]}),e.jsxs("div",{className:"doc-section",id:"method-ggmltype-marshaljson",children:[e.jsx("h4",{children:"GGMLType.MarshalJSON"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (t GGMLType) MarshalJSON() ([]byte, error)"})})]}),e.jsxs("div",{className:"doc-section",id:"method-ggmltype-marshalyaml",children:[e.jsx("h4",{children:"GGMLType.MarshalYAML"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (t GGMLType) MarshalYAML() (any, error)"})})]}),e.jsxs("div",{className:"doc-section",id:"method-ggmltype-string",children:[e.jsx("h4",{children:"GGMLType.String"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (t GGMLType) String() string"})}),e.jsx("p",{className:"doc-description",children:"String returns the string representation of a GGMLType."})]}),e.jsxs("div",{className:"doc-section",id:"method-ggmltype-toyzmatype",children:[e.jsx("h4",{children:"GGMLType.ToYZMAType"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (t GGMLType) ToYZMAType() llama.GGMLType"})})]}),e.jsxs("div",{className:"doc-section",id:"method-ggmltype-unmarshaljson",children:[e.jsx("h4",{children:"GGMLType.UnmarshalJSON"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (t *GGMLType) UnmarshalJSON(data []byte) error"})})]}),e.jsxs("div",{className:"doc-section",id:"method-ggmltype-unmarshalyaml",children:[e.jsx("h4",{children:"GGMLType.UnmarshalYAML"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (t *GGMLType) UnmarshalYAML(unmarshal func(any) error) error"})}),e.jsx("p",{className:"doc-description",children:'UnmarshalYAML implements yaml.Unmarshaler to parse string values like "f16".'})]}),e.jsxs("div",{className:"doc-section",id:"method-model-chat",children:[e.jsx("h4",{children:"Model.Chat"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (m *Model) Chat(ctx context.Context, d D) (ChatResponse, error)"})}),e.jsx("p",{className:"doc-description",children:"Chat performs a chat request and returns the final response. All requests (including vision/audio) use batch processing and can run concurrently based on the NSeqMax config value, which controls parallel sequence processing."})]}),e.jsxs("div",{className:"doc-section",id:"method-model-chatstreaming",children:[e.jsx("h4",{children:"Model.ChatStreaming"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (m *Model) ChatStreaming(ctx context.Context, d D) <-chan ChatResponse"})}),e.jsx("p",{className:"doc-description",children:"ChatStreaming performs a chat request and streams the response. All requests (including vision/audio) use batch processing and can run concurrently based on the NSeqMax config value, which controls parallel sequence processing."})]}),e.jsxs("div",{className:"doc-section",id:"method-model-config",children:[e.jsx("h4",{children:"Model.Config"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (m *Model) Config() Config"})})]}),e.jsxs("div",{className:"doc-section",id:"method-model-embeddings",children:[e.jsx("h4",{children:"Model.Embeddings"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (m *Model) Embeddings(ctx context.Context, d D) (EmbedReponse, error)"})}),e.jsx("p",{className:"doc-description",children:'Embeddings performs embedding for one or more inputs. Supported options in d: - input ([]string): the texts to embed (required) - truncate (bool): if true, truncate inputs to fit context window (default: false) - truncate_direction (string): "right" (default) or "left" - dimensions (int): reduce output to first N dimensions (for Matryoshka models) When NSeqMax > 1, multiple concurrent requests can be processed in parallel, each using one context from the internal pool.'})]}),e.jsxs("div",{className:"doc-section",id:"method-model-modelinfo",children:[e.jsx("h4",{children:"Model.ModelInfo"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (m *Model) ModelInfo() ModelInfo"})})]}),e.jsxs("div",{className:"doc-section",id:"method-model-rerank",children:[e.jsx("h4",{children:"Model.Rerank"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (m *Model) Rerank(ctx context.Context, d D) (RerankResponse, error)"})}),e.jsx("p",{className:"doc-description",children:"Rerank performs reranking for a query against multiple documents. It scores each document's relevance to the query and returns results sorted by relevance score (highest first). Supported options in d: - query (string): the query to rank documents against (required) - documents ([]string): the documents to rank (required) - top_n (int): return only the top N results (optional, default: all) - return_documents (bool): include document text in results (default: false) When NSeqMax > 1, multiple concurrent requests can be processed in parallel, each using one context from the internal pool."})]}),e.jsxs("div",{className:"doc-section",id:"method-model-tokenize",children:[e.jsx("h4",{children:"Model.Tokenize"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (m *Model) Tokenize(ctx context.Context, d D) (TokenizeResponse, error)"})}),e.jsx("p",{className:"doc-description",children:"Tokenize returns the token count for a text input. Supported options in d: - input (string): the text to tokenize (required) - apply_template (bool): if true, wrap input as a user message and apply the model's chat template before tokenizing (default: false) - add_generation_prompt (bool): when apply_template is true, controls whether the assistant role prefix is appended to the prompt (default: true) When apply_template is true, the returned count includes all template overhead (role markers, separators, generation prompt). This reflects the actual number of tokens that would be fed to the model."})]}),e.jsxs("div",{className:"doc-section",id:"method-model-unload",children:[e.jsx("h4",{children:"Model.Unload"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (m *Model) Unload(ctx context.Context) error"})})]}),e.jsxs("div",{className:"doc-section",id:"method-modelinfo-string",children:[e.jsx("h4",{children:"ModelInfo.String"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (mi ModelInfo) String() string"})})]}),e.jsxs("div",{className:"doc-section",id:"method-modeltype-string",children:[e.jsx("h4",{children:"ModelType.String"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (mt ModelType) String() string"})}),e.jsx("p",{className:"doc-description",children:"String returns a human-readable name for the model type."})]}),e.jsxs("div",{className:"doc-section",id:"method-params-string",children:[e.jsx("h4",{children:"Params.String"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (p Params) String() string"})}),e.jsx("p",{className:"doc-description",children:"String returns a string representation of the Params containing only non-zero values in the format key[value]\\nkey[value]\\n ..."})]}),e.jsxs("div",{className:"doc-section",id:"method-ropescalingtype-marshaljson",children:[e.jsx("h4",{children:"RopeScalingType.MarshalJSON"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (r RopeScalingType) MarshalJSON() ([]byte, error)"})})]}),e.jsxs("div",{className:"doc-section",id:"method-ropescalingtype-marshalyaml",children:[e.jsx("h4",{children:"RopeScalingType.MarshalYAML"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (r RopeScalingType) MarshalYAML() (any, error)"})})]}),e.jsxs("div",{className:"doc-section",id:"method-ropescalingtype-string",children:[e.jsx("h4",{children:"RopeScalingType.String"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (r RopeScalingType) String() string"})}),e.jsx("p",{className:"doc-description",children:"String returns the string representation of a RopeScalingType."})]}),e.jsxs("div",{className:"doc-section",id:"method-ropescalingtype-toyzmatype",children:[e.jsx("h4",{children:"RopeScalingType.ToYZMAType"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (r RopeScalingType) ToYZMAType() llama.RopeScalingType"})}),e.jsx("p",{className:"doc-description",children:"ToYZMAType converts to the yzma/llama.cpp RopeScalingType."})]}),e.jsxs("div",{className:"doc-section",id:"method-ropescalingtype-unmarshaljson",children:[e.jsx("h4",{children:"RopeScalingType.UnmarshalJSON"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (r *RopeScalingType) UnmarshalJSON(data []byte) error"})})]}),e.jsxs("div",{className:"doc-section",id:"method-ropescalingtype-unmarshalyaml",children:[e.jsx("h4",{children:"RopeScalingType.UnmarshalYAML"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (r *RopeScalingType) UnmarshalYAML(unmarshal func(any) error) error"})}),e.jsx("p",{className:"doc-description",children:"UnmarshalYAML implements yaml.Unmarshaler to parse string values."})]}),e.jsxs("div",{className:"doc-section",id:"method-splitmode-marshaljson",children:[e.jsx("h4",{children:"SplitMode.MarshalJSON"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (s SplitMode) MarshalJSON() ([]byte, error)"})})]}),e.jsxs("div",{className:"doc-section",id:"method-splitmode-marshalyaml",children:[e.jsx("h4",{children:"SplitMode.MarshalYAML"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (s SplitMode) MarshalYAML() (any, error)"})})]}),e.jsxs("div",{className:"doc-section",id:"method-splitmode-string",children:[e.jsx("h4",{children:"SplitMode.String"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (s SplitMode) String() string"})}),e.jsx("p",{className:"doc-description",children:"String returns the string representation of a SplitMode."})]}),e.jsxs("div",{className:"doc-section",id:"method-splitmode-toyzmatype",children:[e.jsx("h4",{children:"SplitMode.ToYZMAType"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (s SplitMode) ToYZMAType() llama.SplitMode"})}),e.jsx("p",{className:"doc-description",children:"ToYZMAType converts to the yzma/llama.cpp SplitMode type."})]}),e.jsxs("div",{className:"doc-section",id:"method-splitmode-unmarshaljson",children:[e.jsx("h4",{children:"SplitMode.UnmarshalJSON"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (s *SplitMode) UnmarshalJSON(data []byte) error"})})]}),e.jsxs("div",{className:"doc-section",id:"method-splitmode-unmarshalyaml",children:[e.jsx("h4",{children:"SplitMode.UnmarshalYAML"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (s *SplitMode) UnmarshalYAML(unmarshal func(any) error) error"})}),e.jsx("p",{className:"doc-description",children:"UnmarshalYAML implements yaml.Unmarshaler to parse string values."})]}),e.jsxs("div",{className:"doc-section",id:"method-streamingresponselogger-capture",children:[e.jsx("h4",{children:"StreamingResponseLogger.Capture"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (l *StreamingResponseLogger) Capture(resp ChatResponse)"})}),e.jsx("p",{className:"doc-description",children:"Capture captures data from a streaming response. Call this for each response before forwarding it. It only captures from the final response (when FinishReason is set)."})]}),e.jsxs("div",{className:"doc-section",id:"method-streamingresponselogger-string",children:[e.jsx("h4",{children:"StreamingResponseLogger.String"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (l *StreamingResponseLogger) String() string"})}),e.jsx("p",{className:"doc-description",children:"String returns a formatted string for logging."})]}),e.jsxs("div",{className:"doc-section",id:"method-toolcallarguments-marshaljson",children:[e.jsx("h4",{children:"ToolCallArguments.MarshalJSON"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (a ToolCallArguments) MarshalJSON() ([]byte, error)"})})]}),e.jsxs("div",{className:"doc-section",id:"method-toolcallarguments-unmarshaljson",children:[e.jsx("h4",{children:"ToolCallArguments.UnmarshalJSON"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"func (a *ToolCallArguments) UnmarshalJSON(data []byte) error"})})]})]}),e.jsxs("div",{className:"card",id:"constants",children:[e.jsx("h3",{children:"Constants"}),e.jsxs("div",{className:"doc-section",id:"const-objectchatunknown",children:[e.jsx("h4",{children:"ObjectChatUnknown"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`const (
	ObjectChatUnknown   = "chat.unknown"
	ObjectChatText      = "chat.completion.chunk"
	ObjectChatTextFinal = "chat.completion"
	ObjectChatMedia     = "chat.media"
)`})}),e.jsx("p",{className:"doc-description",children:"Objects represent the different types of data that is being processed."})]}),e.jsxs("div",{className:"doc-section",id:"const-roleuser",children:[e.jsx("h4",{children:"RoleUser"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`const (
	RoleUser      = "user"
	RoleAssistant = "assistant"
	RoleSystem    = "system"
)`})}),e.jsx("p",{className:"doc-description",children:"Roles represent the different roles that can be used in a chat."})]}),e.jsxs("div",{className:"doc-section",id:"const-finishreasonstop",children:[e.jsx("h4",{children:"FinishReasonStop"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`const (
	FinishReasonStop  = "stop"
	FinishReasonTool  = "tool_calls"
	FinishReasonError = "error"
)`})}),e.jsx("p",{className:"doc-description",children:"FinishReasons represent the different reasons a response can be finished."})]}),e.jsxs("div",{className:"doc-section",id:"const-defadaptivepdecay",children:[e.jsx("h4",{children:"DefAdaptivePDecay"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`const (
	// DefAdaptivePDecay controls how quickly the Adaptive-P sampler adjusts.
	DefAdaptivePDecay = 0.0

	// DefAdaptivePTarget is the target probability threshold for Adaptive-P
	// sampling. When > 0, enables adaptive sampling that dynamically adjusts
	// based on the probability distribution to prevent predictable patterns.
	DefAdaptivePTarget = 0.0

	// DefDryAllowedLen is the minimum n-gram length before DRY applies.
	DefDryAllowedLen = 2

	// DefDryBase is the base for exponential penalty growth in DRY.
	DefDryBase = 1.75

	// DefDryMultiplier controls the DRY (Don't Repeat Yourself) sampler which penalizes
	// n-gram pattern repetition. 0.8 - Light repetition penalty,
	// 1.01.5 - Moderate (typical starting point), 2.03.0 - Aggressive.
	DefDryMultiplier = 1.05

	// DefDryPenaltyLast limits how many recent tokens DRY considers.
	DefDryPenaltyLast = 0.0

	// DefEnableThinking determines if the model should think or not. It is used for
	// most non-GPT models. It accepts 1, t, T, TRUE, true, True, 0, f, F, FALSE,
	// false, False.
	DefEnableThinking = ThinkingEnabled

	// DefFrequencyPenalty penalizes tokens proportionally to how often they have
	// appeared in the output. Higher values more strongly discourage frequent
	// repetition. Default is 0.0 (disabled).
	DefFrequencyPenalty float32 = 0.0

	// DefIncludeUsage determines whether to include token usage information in
	// streaming responses.
	DefIncludeUsage = true

	// DefLogprobs determines whether to return log probabilities of output tokens.
	// When enabled, the response includes probability data for each generated token.
	DefLogprobs = false

	// DefMaxTokens is the default maximum tokens for generation when not
	// derived from the model's context window.
	DefMaxTokens = 4096

	// DefMaxTopLogprobs defines the number of maximum logprobs to use.
	DefMaxTopLogprobs = 5

	// DefMinP is a dynamic sampling threshold that helps balance the coherence
	// (quality) and diversity (creativity) of the generated text.
	DefMinP = 0.0

	// DefPresencePenalty applies a flat penalty to any token that has already
	// appeared in the output, regardless of frequency. Higher values encourage
	// the model to introduce new topics. Default is 0.0 (disabled).
	DefPresencePenalty float32 = 0.0

	// DefReasoningEffort is a string that specifies the level of reasoning effort to
	// use for GPT models.
	DefReasoningEffort = ReasoningEffortMedium

	// DefRepeatLastN specifies how many recent tokens to consider when applying the
	// repetition penalty. A larger value considers more context but may be slower.
	DefRepeatLastN = 64

	// DefRepeatPenalty applies a penalty to tokens that have already appeared in the
	// output, reducing repetitive text. A value of 1.0 means no penalty. Values
	// above 1.0 reduce repetition (e.g., 1.1 is a mild penalty, 1.5 is strong).
	DefRepeatPenalty = 1.0

	// DefReturnPrompt determines whether to include the prompt in the final response.
	// When set to true, the prompt will be included.
	DefReturnPrompt = false

	// DefTemp controls the randomness of the output. It rescales the probability
	// distribution of possible next tokens.
	DefTemp = 0.8

	// DefTopK limits the pool of possible next tokens to the K number of most
	// probable tokens. A value of 0 means no limit (all tokens are considered).
	DefTopK = 0

	// DefTopLogprobs specifies how many of the most likely tokens to return at each
	// position, along with their log probabilities. Must be between 0 and 5.
	// Setting this to a value > 0 implicitly enables logprobs.
	DefTopLogprobs = 0

	// DefTopP, also known as nucleus sampling, works differently than top_k by
	// selecting a dynamic pool of tokens whose cumulative probability exceeds a
	// threshold P. Instead of a fixed number of tokens (K), it selects the minimum
	// number of most probable tokens required to reach the cumulative probability P.
	DefTopP = 0.9

	// DefXtcMinKeep is the minimum tokens to keep after XTC culling.
	DefXtcMinKeep = 1

	// DefXtcProbability controls XTC (eXtreme Token Culling) which randomly removes
	// tokens close to top probability. Must be > 0 to activate.
	DefXtcProbability = 0.0

	// DefXtcThreshold is the probability threshold for XTC culling.
	DefXtcThreshold = 0.1
)`})})]}),e.jsxs("div",{className:"doc-section",id:"const-thinkingenabled",children:[e.jsx("h4",{children:"ThinkingEnabled"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`const (
	// The model will perform thinking. This is the default setting.
	ThinkingEnabled = "true"

	// The model will not perform thinking.
	ThinkingDisabled = "false"
)`})})]}),e.jsxs("div",{className:"doc-section",id:"const-reasoningeffortnone",children:[e.jsx("h4",{children:"ReasoningEffortNone"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`const (
	// The model does not perform reasoning This setting is fastest and lowest
	// cost, ideal for latency-sensitive tasks that do not require complex logic,
	// such as simple translation or data reformatting.
	ReasoningEffortNone = "none"

	// GPT: A very low amount of internal reasoning, optimized for throughput
	// and speed.
	ReasoningEffortMinimal = "minimal"

	// GPT: Light reasoning that favors speed and lower token usage, suitable
	// for triage or short answers.
	ReasoningEffortLow = "low"

	// GPT: The default setting, providing a balance between speed and reasoning
	// accuracy. This is a good general-purpose choice for most tasks like
	// content drafting or standard Q&A.
	ReasoningEffortMedium = "medium"

	// GPT: Extensive reasoning for complex, multi-step problems. This setting
	// leads to the most thorough and accurate analysis but increases latency
	// and cost due to a larger number of internal reasoning tokens used.
	ReasoningEffortHigh = "high"
)`})})]})]})]}),e.jsx("nav",{className:"doc-sidebar",children:e.jsxs("div",{className:"doc-sidebar-content",children:[e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#functions",className:"doc-index-header",children:"Functions"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#func-addparams",children:"AddParams"})}),e.jsx("li",{children:e.jsx("a",{href:"#func-checkmodel",children:"CheckModel"})}),e.jsx("li",{children:e.jsx("a",{href:"#func-inityzmaworkarounds",children:"InitYzmaWorkarounds"})}),e.jsx("li",{children:e.jsx("a",{href:"#func-newgrammarsampler",children:"NewGrammarSampler"})}),e.jsx("li",{children:e.jsx("a",{href:"#func-parseggmltype",children:"ParseGGMLType"})}),e.jsx("li",{children:e.jsx("a",{href:"#func-newmodel",children:"NewModel"})}),e.jsx("li",{children:e.jsx("a",{href:"#func-detectmodeltypefromfiles",children:"DetectModelTypeFromFiles"})}),e.jsx("li",{children:e.jsx("a",{href:"#func-parseropescalingtype",children:"ParseRopeScalingType"})}),e.jsx("li",{children:e.jsx("a",{href:"#func-parsesplitmode",children:"ParseSplitMode"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#types",className:"doc-index-header",children:"Types"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#type-cataloger",children:"Cataloger"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-chatresponse",children:"ChatResponse"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-choice",children:"Choice"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-config",children:"Config"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-contentlogprob",children:"ContentLogprob"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-d",children:"D"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-draftmodelconfig",children:"DraftModelConfig"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-embeddata",children:"EmbedData"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-embedreponse",children:"EmbedReponse"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-embedusage",children:"EmbedUsage"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-flashattentiontype",children:"FlashAttentionType"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-ggmltype",children:"GGMLType"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-logger",children:"Logger"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-logprobs",children:"Logprobs"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-mediatype",children:"MediaType"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-model",children:"Model"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-modelinfo",children:"ModelInfo"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-modeltype",children:"ModelType"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-params",children:"Params"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-rerankresponse",children:"RerankResponse"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-rerankresult",children:"RerankResult"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-rerankusage",children:"RerankUsage"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-responsemessage",children:"ResponseMessage"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-responsetoolcall",children:"ResponseToolCall"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-responsetoolcallfunction",children:"ResponseToolCallFunction"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-ropescalingtype",children:"RopeScalingType"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-splitmode",children:"SplitMode"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-streamingresponselogger",children:"StreamingResponseLogger"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-template",children:"Template"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-tokenizeresponse",children:"TokenizeResponse"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-toolcallarguments",children:"ToolCallArguments"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-toplogprob",children:"TopLogprob"})}),e.jsx("li",{children:e.jsx("a",{href:"#type-usage",children:"Usage"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#methods",className:"doc-index-header",children:"Methods"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#method-choice-finishreason",children:"Choice.FinishReason"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-config-string",children:"Config.String"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-d-clone",children:"D.Clone"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-d-messages",children:"D.Messages"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-d-shallowclone",children:"D.ShallowClone"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-d-string",children:"D.String"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-flashattentiontype-marshaljson",children:"FlashAttentionType.MarshalJSON"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-flashattentiontype-marshalyaml",children:"FlashAttentionType.MarshalYAML"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-flashattentiontype-string",children:"FlashAttentionType.String"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-flashattentiontype-unmarshaljson",children:"FlashAttentionType.UnmarshalJSON"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-flashattentiontype-unmarshalyaml",children:"FlashAttentionType.UnmarshalYAML"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-ggmltype-marshaljson",children:"GGMLType.MarshalJSON"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-ggmltype-marshalyaml",children:"GGMLType.MarshalYAML"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-ggmltype-string",children:"GGMLType.String"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-ggmltype-toyzmatype",children:"GGMLType.ToYZMAType"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-ggmltype-unmarshaljson",children:"GGMLType.UnmarshalJSON"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-ggmltype-unmarshalyaml",children:"GGMLType.UnmarshalYAML"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-model-chat",children:"Model.Chat"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-model-chatstreaming",children:"Model.ChatStreaming"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-model-config",children:"Model.Config"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-model-embeddings",children:"Model.Embeddings"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-model-modelinfo",children:"Model.ModelInfo"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-model-rerank",children:"Model.Rerank"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-model-tokenize",children:"Model.Tokenize"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-model-unload",children:"Model.Unload"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-modelinfo-string",children:"ModelInfo.String"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-modeltype-string",children:"ModelType.String"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-params-string",children:"Params.String"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-ropescalingtype-marshaljson",children:"RopeScalingType.MarshalJSON"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-ropescalingtype-marshalyaml",children:"RopeScalingType.MarshalYAML"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-ropescalingtype-string",children:"RopeScalingType.String"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-ropescalingtype-toyzmatype",children:"RopeScalingType.ToYZMAType"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-ropescalingtype-unmarshaljson",children:"RopeScalingType.UnmarshalJSON"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-ropescalingtype-unmarshalyaml",children:"RopeScalingType.UnmarshalYAML"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-splitmode-marshaljson",children:"SplitMode.MarshalJSON"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-splitmode-marshalyaml",children:"SplitMode.MarshalYAML"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-splitmode-string",children:"SplitMode.String"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-splitmode-toyzmatype",children:"SplitMode.ToYZMAType"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-splitmode-unmarshaljson",children:"SplitMode.UnmarshalJSON"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-splitmode-unmarshalyaml",children:"SplitMode.UnmarshalYAML"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-streamingresponselogger-capture",children:"StreamingResponseLogger.Capture"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-streamingresponselogger-string",children:"StreamingResponseLogger.String"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-toolcallarguments-marshaljson",children:"ToolCallArguments.MarshalJSON"})}),e.jsx("li",{children:e.jsx("a",{href:"#method-toolcallarguments-unmarshaljson",children:"ToolCallArguments.UnmarshalJSON"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#constants",className:"doc-index-header",children:"Constants"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#const-objectchatunknown",children:"ObjectChatUnknown"})}),e.jsx("li",{children:e.jsx("a",{href:"#const-roleuser",children:"RoleUser"})}),e.jsx("li",{children:e.jsx("a",{href:"#const-finishreasonstop",children:"FinishReasonStop"})}),e.jsx("li",{children:e.jsx("a",{href:"#const-defadaptivepdecay",children:"DefAdaptivePDecay"})}),e.jsx("li",{children:e.jsx("a",{href:"#const-thinkingenabled",children:"ThinkingEnabled"})}),e.jsx("li",{children:e.jsx("a",{href:"#const-reasoningeffortnone",children:"ReasoningEffortNone"})})]})]})]})})]})]})}const RP=`// This example shows you how to execute a simple prompt against an audio model.
//
// The first time you run this program the system will download and install
// the model and libraries.
//
// Run the example like this from the root of the project:
// $ make example-audio

package main

import (
	"context"
	"fmt"
	"os"
	"time"

	"github.com/ardanlabs/kronk/sdk/kronk"
	"github.com/ardanlabs/kronk/sdk/kronk/model"
	"github.com/ardanlabs/kronk/sdk/tools/catalog"
	"github.com/ardanlabs/kronk/sdk/tools/defaults"
	"github.com/ardanlabs/kronk/sdk/tools/libs"
	"github.com/ardanlabs/kronk/sdk/tools/models"
)

// modelSpec defines how to obtain the model to download.
// - SourceURL: Download the model file directly from a HuggingFace URL
// - ProjURL  : Download the projection file directly from a HuggingFace URL
// - ModelID  : Download the model from the catalog by model ID
//
// To use a catalog model, comment out SourceURL/ProjURL and set ModelID.
// To use direct URLs, comment out ModelID and set SourceURL/ProjURL.
type modelSpec struct {
	SourceURL string
	ProjURL   string
	ModelID   string
}

// Configure this to switch between URL and catalog downloads.
// Set either (SourceURL and ProjURL) or ModelID, not both.
var modelSpecConfig = modelSpec{
	SourceURL: "https://huggingface.co/mradermacher/Qwen2-Audio-7B-GGUF/resolve/main/Qwen2-Audio-7B.Q8_0.gguf",
	ProjURL:   "https://huggingface.co/mradermacher/Qwen2-Audio-7B-GGUF/resolve/main/Qwen2-Audio-7B.mmproj-Q8_0.gguf",
	// ModelID: "Qwen2-Audio-7B-Q8_0",
}

const audioFile = "examples/samples/jfk.wav"

func main() {
	if err := run(); err != nil {
		fmt.Printf("\\nERROR: %s\\n", err)
		os.Exit(1)
	}
}

func run() error {
	info, err := installSystem()
	if err != nil {
		return fmt.Errorf("unable to install system: %w", err)
	}

	krn, err := newKronk(info)
	if err != nil {
		return fmt.Errorf("unable to init kronk: %w", err)
	}

	defer func() {
		fmt.Println("\\nUnloading Kronk")
		if err := krn.Unload(context.Background()); err != nil {
			fmt.Printf("failed to unload model: %v", err)
		}
	}()

	if err := audio(krn); err != nil {
		return err
	}

	return nil
}

func installSystem() (models.Path, error) {
	ctx, cancel := context.WithTimeout(context.Background(), 15*time.Minute)
	defer cancel()

	libs, err := libs.New(
		libs.WithVersion(defaults.LibVersion("")),
	)
	if err != nil {
		return models.Path{}, err
	}

	if _, err := libs.Download(ctx, kronk.FmtLogger); err != nil {
		return models.Path{}, fmt.Errorf("unable to install llama.cpp: %w", err)
	}

	// -------------------------------------------------------------------------

	ctlg, err := catalog.New()
	if err != nil {
		return models.Path{}, fmt.Errorf("unable to create catalog system: %w", err)
	}

	if err := ctlg.Download(ctx); err != nil {
		return models.Path{}, fmt.Errorf("unable to download catalog: %w", err)
	}

	// -------------------------------------------------------------------------

	mdls, err := models.New()
	if err != nil {
		return models.Path{}, fmt.Errorf("unable to install llama.cpp: %w", err)
	}

	// Download model based on spec config using switch/case
	var mp models.Path

	switch {
	case modelSpecConfig.SourceURL != "":
		fmt.Println("Downloading model from URL:", modelSpecConfig.SourceURL)
		fmt.Println("Downloading projection file:", modelSpecConfig.ProjURL)
		mp, err = mdls.Download(ctx, kronk.FmtLogger, modelSpecConfig.SourceURL, modelSpecConfig.ProjURL)

	case modelSpecConfig.ModelID != "":
		fmt.Println("Downloading model from catalog:", modelSpecConfig.ModelID)
		mp, err = ctlg.DownloadModel(ctx, kronk.FmtLogger, modelSpecConfig.ModelID)

	default:
		return models.Path{}, fmt.Errorf("modelSpecConfig requires either (SourceURL and ProjURL) or ModelID to be set")
	}

	if err != nil {
		return models.Path{}, fmt.Errorf("unable to install model: %w", err)
	}

	return mp, nil
}

func newKronk(mp models.Path) (*kronk.Kronk, error) {
	fmt.Println("loading model...")

	if err := kronk.Init(); err != nil {
		return nil, fmt.Errorf("unable to init kronk: %w", err)
	}

	cfg := model.Config{
		ModelFiles: mp.ModelFiles,
		ProjFile:   mp.ProjFile,
	}

	krn, err := kronk.New(cfg)
	if err != nil {
		return nil, fmt.Errorf("unable to create inference model: %w", err)
	}

	fmt.Print("- system info:\\n\\t")
	for k, v := range krn.SystemInfo() {
		fmt.Printf("%s:%v, ", k, v)
	}
	fmt.Println()

	fmt.Println("- contextWindow:", krn.ModelConfig().ContextWindow)
	fmt.Printf("- k/v          : %s/%s\\n", krn.ModelConfig().CacheTypeK, krn.ModelConfig().CacheTypeV)
	fmt.Println("- nBatch       :", krn.ModelConfig().NBatch)
	fmt.Println("- nuBatch      :", krn.ModelConfig().NUBatch)
	fmt.Println("- embeddings   :", krn.ModelInfo().IsEmbedModel)
	fmt.Println("- modelType    :", krn.ModelInfo().Type)
	fmt.Println("- isGPT        :", krn.ModelInfo().IsGPTModel)
	fmt.Println("- template     :", krn.ModelInfo().Template.FileName)

	return krn, nil
}

func audio(krn *kronk.Kronk) error {
	question := "Please describe what you hear in the following audio clip."

	ctx, cancel := context.WithTimeout(context.Background(), 120*time.Second)
	defer cancel()

	ch, err := performChat(ctx, krn, question, audioFile)
	if err != nil {
		return fmt.Errorf("perform chat: %w", err)
	}

	if err := modelResponse(krn, ch); err != nil {
		return fmt.Errorf("model response: %w", err)
	}

	return nil
}

func performChat(ctx context.Context, krn *kronk.Kronk, question string, audioFile string) (<-chan model.ChatResponse, error) {
	audio, err := readImage(audioFile)
	if err != nil {
		return nil, fmt.Errorf("read image: %w", err)
	}

	fmt.Printf("\\nQuestion: %s\\n", question)

	d := model.D{
		"messages":    model.RawMediaMessage(question, audio),
		"max_tokens":  2048,
		"temperature": 0.7,
		"top_p":       0.9,
		"top_k":       40,
	}

	ch, err := krn.ChatStreaming(ctx, d)
	if err != nil {
		return nil, fmt.Errorf("chat streaming: %w", err)
	}

	return ch, nil
}

func modelResponse(krn *kronk.Kronk, ch <-chan model.ChatResponse) error {
	fmt.Print("\\nMODEL> ")

	var reasoning bool
	var lr model.ChatResponse

loop:
	for resp := range ch {
		lr = resp

		switch resp.Choice[0].FinishReason() {
		case model.FinishReasonStop:
			break loop

		case model.FinishReasonError:
			return fmt.Errorf("error from model: %s", resp.Choice[0].Delta.Content)
		}

		if resp.Choice[0].Delta.Reasoning != "" {
			fmt.Printf("\\u001b[91m%s\\u001b[0m", resp.Choice[0].Delta.Reasoning)
			reasoning = true
			continue
		}

		if reasoning {
			reasoning = false
			fmt.Print("\\n\\n")
		}

		fmt.Printf("%s", resp.Choice[0].Delta.Content)
	}

	// -------------------------------------------------------------------------

	contextTokens := lr.Usage.PromptTokens + lr.Usage.CompletionTokens
	contextWindow := krn.ModelConfig().ContextWindow
	percentage := (float64(contextTokens) / float64(contextWindow)) * 100
	of := float32(contextWindow) / float32(1024)

	fmt.Printf("\\n\\n\\u001b[90mInput: %d  Reasoning: %d  Completion: %d  Output: %d  Window: %d (%.0f%% of %.0fK) TPS: %.2f\\u001b[0m\\n",
		lr.Usage.PromptTokens, lr.Usage.ReasoningTokens, lr.Usage.CompletionTokens, lr.Usage.OutputTokens, contextTokens, percentage, of, lr.Usage.TokensPerSecond)

	return nil
}

func readImage(imageFile string) ([]byte, error) {
	if _, err := os.Stat(imageFile); err != nil {
		return nil, fmt.Errorf("error accessing file %q: %w", imageFile, err)
	}

	image, err := os.ReadFile(imageFile)
	if err != nil {
		return nil, fmt.Errorf("error reading file %q: %w", imageFile, err)
	}

	return image, nil
}
`,MP=`// This example shows you how to create a simple chat application against an
// inference model using kronk. Thanks to Kronk and yzma, reasoning and tool
// calling is enabled.
//
// The first time you run this program the system will download and install
// the model and libraries.
//
// Run the example like this from the root of the project:
// $ make example-chat

package main

import (
	"bufio"
	"context"
	"errors"
	"fmt"
	"io"
	"os"
	"time"

	"github.com/ardanlabs/kronk/sdk/kronk"
	"github.com/ardanlabs/kronk/sdk/kronk/model"
	"github.com/ardanlabs/kronk/sdk/tools/catalog"
	"github.com/ardanlabs/kronk/sdk/tools/defaults"
	"github.com/ardanlabs/kronk/sdk/tools/libs"
	"github.com/ardanlabs/kronk/sdk/tools/models"
)

// modelSpec defines how to obtain the model to download.
// - SourceURL: Download the model file directly from a HuggingFace URL
// - ModelID  : Download the model from the catalog by model ID
//
// To use a catalog model, comment out SourceURL and set ModelID.
// To use a direct URL, comment out ModelID and set SourceURL.
type modelSpec struct {
	SourceURL string
	ModelID   string
}

// Configure this to switch between URL and catalog downloads.
// Set either SourceURL or ModelID, not both.
var modelSpecConfig = modelSpec{
	SourceURL: "https://huggingface.co/Qwen/Qwen3-8B-GGUF/resolve/main/Qwen3-8B-Q8_0.gguf",
	// ModelID: "Qwen3-8B-Q8_0",
}

func main() {
	if err := run(); err != nil {
		fmt.Printf("\\nERROR: %s\\n", err)
		os.Exit(1)
	}
}

func run() error {
	mp, err := installSystem()
	if err != nil {
		return fmt.Errorf("run: unable to installation system: %w", err)
	}

	krn, err := newKronk(mp)
	if err != nil {
		return fmt.Errorf("unable to init kronk: %w", err)
	}

	defer func() {
		fmt.Println("\\nUnloading Kronk")
		if err := krn.Unload(context.Background()); err != nil {
			fmt.Printf("run: failed to unload model: %v", err)
		}
	}()

	if err := chat(krn); err != nil {
		return err
	}

	return nil
}

func installSystem() (models.Path, error) {
	ctx, cancel := context.WithTimeout(context.Background(), 25*time.Minute)
	defer cancel()

	libs, err := libs.New(
		libs.WithVersion(defaults.LibVersion("")),
	)
	if err != nil {
		return models.Path{}, err
	}

	if _, err := libs.Download(ctx, kronk.FmtLogger); err != nil {
		return models.Path{}, fmt.Errorf("unable to install llama.cpp: %w", err)
	}

	// -------------------------------------------------------------------------
	// This is not mandatory if you won't be using models from the catalog. That
	// being said, if you are using a model that is part of the catalog with
	// a corrected jinja file, having the catalog system up to date will allow
	// the system to pull that jinja file.

	ctlg, err := catalog.New()
	if err != nil {
		return models.Path{}, fmt.Errorf("unable to create catalog system: %w", err)
	}

	if err := ctlg.Download(ctx); err != nil {
		return models.Path{}, fmt.Errorf("unable to download catalog: %w", err)
	}

	// -------------------------------------------------------------------------

	mdls, err := models.New()
	if err != nil {
		return models.Path{}, fmt.Errorf("unable to install llama.cpp: %w", err)
	}

	// Download model based on spec config using switch/case
	var mp models.Path

	switch {
	case modelSpecConfig.SourceURL != "":
		fmt.Println("Downloading model from URL:", modelSpecConfig.SourceURL)
		mp, err = mdls.Download(ctx, kronk.FmtLogger, modelSpecConfig.SourceURL, "")

	case modelSpecConfig.ModelID != "":
		fmt.Println("Downloading model from catalog:", modelSpecConfig.ModelID)
		mp, err = ctlg.DownloadModel(ctx, kronk.FmtLogger, modelSpecConfig.ModelID)

	default:
		return models.Path{}, fmt.Errorf("modelSpecConfig requires either SourceURL or ModelID to be set")
	}

	if err != nil {
		return models.Path{}, fmt.Errorf("unable to install model: %w", err)
	}

	return mp, nil
}

func newKronk(mp models.Path) (*kronk.Kronk, error) {
	fmt.Println("loading model...")

	if err := kronk.Init(); err != nil {
		return nil, fmt.Errorf("unable to init kronk: %w", err)
	}

	cfg := model.Config{
		ModelFiles: mp.ModelFiles,
	}

	krn, err := kronk.New(cfg)
	if err != nil {
		return nil, fmt.Errorf("unable to create inference model: %w", err)
	}

	fmt.Print("- system info:\\n\\t")
	for k, v := range krn.SystemInfo() {
		fmt.Printf("%s:%v, ", k, v)
	}
	fmt.Println()

	fmt.Println("- contextWindow:", krn.ModelConfig().ContextWindow)
	fmt.Printf("- k/v          : %s/%s\\n", krn.ModelConfig().CacheTypeK, krn.ModelConfig().CacheTypeV)
	fmt.Println("- nBatch       :", krn.ModelConfig().NBatch)
	fmt.Println("- nuBatch      :", krn.ModelConfig().NUBatch)
	fmt.Println("- embeddings   :", krn.ModelInfo().IsEmbedModel)
	fmt.Println("- modelType    :", krn.ModelInfo().Type)
	fmt.Println("- isGPT        :", krn.ModelInfo().IsGPTModel)
	fmt.Println("- template     :", krn.ModelInfo().Template.FileName)
	fmt.Println("- grammar      :", krn.ModelConfig().DefaultParams.Grammar != "")

	return krn, nil
}

func chat(krn *kronk.Kronk) error {
	messages := model.DocumentArray()

	var systemPrompt = \`
		You are a helpful AI assistant. You are designed to help users answer
		questions, create content, and provide information in a helpful and
		accurate manner. Always follow the user's instructions carefully and
		respond with clear, concise, and well-structured answers. You are a
		helpful AI assistant. You are designed to help users answer questions,
		create content, and provide information in a helpful and accurate manner.
		Always follow the user's instructions carefully and respond with clear,
		concise, and well-structured answers. You are a helpful AI assistant.
		You are designed to help users answer questions, create content, and
		provide information in a helpful and accurate manner. Always follow the
		user's instructions carefully and respond with clear, concise, and
		well-structured answers.\`

	messages = append(messages,
		model.TextMessage(model.RoleSystem, systemPrompt),
	)

	for {
		var err error
		messages, err = userInput(messages)
		if err != nil {
			if errors.Is(err, io.EOF) {
				return nil
			}
			return fmt.Errorf("run:user input: %w", err)
		}

		messages, err = func() ([]model.D, error) {
			ctx, cancel := context.WithTimeout(context.Background(), 120*time.Second)
			defer cancel()

			d := model.D{
				"messages":   messages,
				"tools":      toolDocuments(),
				"max_tokens": 2048,
			}

			ch, err := performChat(ctx, krn, d)
			if err != nil {
				return nil, fmt.Errorf("run: unable to perform chat: %w", err)
			}

			messages, err = modelResponse(krn, messages, ch)
			if err != nil {
				return nil, fmt.Errorf("run: model response: %w", err)
			}

			return messages, nil
		}()

		if err != nil {
			return fmt.Errorf("run: unable to perform chat: %w", err)
		}
	}
}

func userInput(messages []model.D) ([]model.D, error) {
	fmt.Print("\\nUSER> ")

	reader := bufio.NewReader(os.Stdin)

	userInput, err := reader.ReadString('\\n')
	if err != nil {
		return messages, fmt.Errorf("unable to read user input: %w", err)
	}

	if userInput == "quit\\n" {
		return nil, io.EOF
	}

	messages = append(messages,
		model.TextMessage(model.RoleUser, userInput),
	)

	return messages, nil
}

func toolDocuments() []model.D {
	return model.DocumentArray(
		model.D{
			"type": "function",
			"function": model.D{
				"name":        "get_weather",
				"description": "Get the current weather for a location",
				"parameters": model.D{
					"type": "object",
					"properties": model.D{
						"location": model.D{
							"type":        "string",
							"description": "The location to get the weather for, e.g. San Francisco, CA",
						},
					},
					"required": []any{"location"},
				},
			},
		},
	)
}

func performChat(ctx context.Context, krn *kronk.Kronk, d model.D) (<-chan model.ChatResponse, error) {
	ch, err := krn.ChatStreaming(ctx, d)
	if err != nil {
		return nil, fmt.Errorf("chat streaming: %w", err)
	}

	return ch, nil
}

func modelResponse(krn *kronk.Kronk, messages []model.D, ch <-chan model.ChatResponse) ([]model.D, error) {
	fmt.Print("\\nMODEL> ")

	var reasoning bool
	var lr model.ChatResponse

loop:
	for resp := range ch {
		lr = resp

		if len(resp.Choice) == 0 {
			continue
		}

		switch resp.Choice[0].FinishReason() {
		case model.FinishReasonError:
			return messages, fmt.Errorf("error from model: %s", resp.Choice[0].Delta.Content)

		case model.FinishReasonStop:
			break loop

		case model.FinishReasonTool:
			fmt.Println()
			if krn.ModelInfo().IsGPTModel {
				fmt.Println()
			}

			fmt.Printf("\\u001b[92mModel Asking For Tool Calls:\\n\\u001b[0m")

			for _, tool := range resp.Choice[0].Delta.ToolCalls {
				fmt.Printf("\\u001b[92mToolID[%s]: %s(%s)\\n\\u001b[0m",
					tool.ID,
					tool.Function.Name,
					tool.Function.Arguments,
				)

				messages = append(messages,
					model.TextMessage("tool", fmt.Sprintf("Tool call %s: %s(%v)\\n",
						tool.ID,
						tool.Function.Name,
						tool.Function.Arguments),
					),
				)
			}

			break loop

		default:
			if resp.Choice[0].Delta.Reasoning != "" {
				fmt.Printf("\\u001b[91m%s\\u001b[0m", resp.Choice[0].Delta.Reasoning)
				reasoning = true
				continue
			}

			if reasoning {
				reasoning = false

				fmt.Println()
				if krn.ModelInfo().IsGPTModel {
					fmt.Println()
				}
			}

			fmt.Printf("%s", resp.Choice[0].Delta.Content)
		}
	}

	// -------------------------------------------------------------------------

	contextTokens := lr.Usage.PromptTokens + lr.Usage.CompletionTokens
	contextWindow := krn.ModelConfig().ContextWindow
	percentage := (float64(contextTokens) / float64(contextWindow)) * 100
	of := float32(contextWindow) / float32(1024)

	fmt.Printf("\\n\\n\\u001b[90mInput: %d  Reasoning: %d  Completion: %d  Output: %d  Window: %d (%.0f%% of %.0fK) TPS: %.2f\\u001b[0m\\n",
		lr.Usage.PromptTokens, lr.Usage.ReasoningTokens, lr.Usage.CompletionTokens, lr.Usage.OutputTokens, contextTokens, percentage, of, lr.Usage.TokensPerSecond)

	return messages, nil
}
`,IP=`// This example shows you how to use an embedding model.
//
// The first time you run this program the system will download and install
// the model and libraries.
//
// Run the example like this from the root of the project:
// $ make example-embedding

package main

import (
	"context"
	"fmt"
	"os"
	"time"

	"github.com/ardanlabs/kronk/sdk/kronk"
	"github.com/ardanlabs/kronk/sdk/kronk/model"
	"github.com/ardanlabs/kronk/sdk/tools/catalog"
	"github.com/ardanlabs/kronk/sdk/tools/defaults"
	"github.com/ardanlabs/kronk/sdk/tools/libs"
	"github.com/ardanlabs/kronk/sdk/tools/models"
)

// modelSpec defines how to obtain the model to download.
// - SourceURL: Download the model file directly from a HuggingFace URL
// - ModelID  : Download the model from the catalog by model ID
//
// To use a catalog model, comment out SourceURL and set ModelID.
// To use a direct URL, comment out ModelID and set SourceURL.
type modelSpec struct {
	SourceURL string
	ModelID   string
}

// Configure this to switch between URL and catalog downloads.
// Set either SourceURL or ModelID, not both.
var modelSpecConfig = modelSpec{
	SourceURL: "https://huggingface.co/ggml-org/embeddinggemma-300m-qat-q8_0-GGUF/resolve/main/embeddinggemma-300m-qat-Q8_0.gguf",
	// ModelID: "embeddinggemma-300m-qat-Q8_0",
}

func main() {
	if err := run(); err != nil {
		fmt.Printf("\\nERROR: %s\\n", err)
		os.Exit(1)
	}
}

func run() error {
	mp, err := installSystem()
	if err != nil {
		return fmt.Errorf("unable to installation system: %w", err)
	}

	krn, err := newKronk(mp)
	if err != nil {
		return fmt.Errorf("unable to init kronk: %w", err)
	}

	defer func() {
		fmt.Println("\\nUnloading Kronk")
		if err := krn.Unload(context.Background()); err != nil {
			fmt.Printf("failed to unload model: %v", err)
		}
	}()

	if err := embedding(krn); err != nil {
		return err
	}

	return nil
}

func installSystem() (models.Path, error) {
	ctx, cancel := context.WithTimeout(context.Background(), 15*time.Minute)
	defer cancel()

	libs, err := libs.New(
		libs.WithVersion(defaults.LibVersion("")),
	)
	if err != nil {
		return models.Path{}, err
	}

	if _, err := libs.Download(ctx, kronk.FmtLogger); err != nil {
		return models.Path{}, fmt.Errorf("unable to install llama.cpp: %w", err)
	}

	// -------------------------------------------------------------------------

	ctlg, err := catalog.New()
	if err != nil {
		return models.Path{}, fmt.Errorf("unable to create catalog system: %w", err)
	}

	if err := ctlg.Download(ctx); err != nil {
		return models.Path{}, fmt.Errorf("unable to download catalog: %w", err)
	}

	// -------------------------------------------------------------------------

	mdls, err := models.New()
	if err != nil {
		return models.Path{}, fmt.Errorf("unable to install llama.cpp: %w", err)
	}

	// Download model based on spec config using switch/case
	var mp models.Path

	switch {
	case modelSpecConfig.SourceURL != "":
		fmt.Println("Downloading model from URL:", modelSpecConfig.SourceURL)
		mp, err = mdls.Download(ctx, kronk.FmtLogger, modelSpecConfig.SourceURL, "")

	case modelSpecConfig.ModelID != "":
		fmt.Println("Downloading model from catalog:", modelSpecConfig.ModelID)
		mp, err = ctlg.DownloadModel(ctx, kronk.FmtLogger, modelSpecConfig.ModelID)

	default:
		return models.Path{}, fmt.Errorf("modelSpecConfig requires either SourceURL or ModelID to be set")
	}

	if err != nil {
		return models.Path{}, fmt.Errorf("unable to install model: %w", err)
	}

	return mp, nil
}

func newKronk(mp models.Path) (*kronk.Kronk, error) {
	fmt.Println("loading model...")

	if err := kronk.Init(); err != nil {
		return nil, fmt.Errorf("unable to init kronk: %w", err)
	}

	cfg := model.Config{
		ModelFiles: mp.ModelFiles,
	}

	krn, err := kronk.New(cfg)
	if err != nil {
		return nil, fmt.Errorf("unable to create inference model: %w", err)
	}

	fmt.Print("- system info:\\n\\t")
	for k, v := range krn.SystemInfo() {
		fmt.Printf("%s:%v, ", k, v)
	}
	fmt.Println()

	fmt.Println("- contextWindow:", krn.ModelConfig().ContextWindow)
	fmt.Printf("- k/v          : %s/%s\\n", krn.ModelConfig().CacheTypeK, krn.ModelConfig().CacheTypeV)
	fmt.Println("- nBatch       :", krn.ModelConfig().NBatch)
	fmt.Println("- nuBatch      :", krn.ModelConfig().NUBatch)
	fmt.Println("- embeddings   :", krn.ModelInfo().IsEmbedModel)
	fmt.Println("- modelType    :", krn.ModelInfo().Type)
	fmt.Println("- isGPT        :", krn.ModelInfo().IsGPTModel)
	fmt.Println("- template     :", krn.ModelInfo().Template.FileName)

	return krn, nil
}

func embedding(krn *kronk.Kronk) error {
	ctx, cancel := context.WithTimeout(context.Background(), 120*time.Second)
	defer cancel()

	d := model.D{
		"input":              "Why is the sky blue?",
		"truncate":           true,
		"truncate_direction": "right",
	}

	resp, err := krn.Embeddings(ctx, d)
	if err != nil {
		return err
	}

	fmt.Println()
	fmt.Println("Model  :", resp.Model)
	fmt.Println("Object :", resp.Object)
	fmt.Println("Created:", time.UnixMilli(resp.Created))
	fmt.Println("  Index    :", resp.Data[0].Index)
	fmt.Println("  Object   :", resp.Data[0].Object)
	fmt.Printf("  Embedding: [%v...%v]\\n", resp.Data[0].Embedding[:3], resp.Data[0].Embedding[len(resp.Data[0].Embedding)-3:])

	return nil
}
`,AP=`// This example shows how to use GBNF grammars to constrain model output.
// Grammars force the model to only produce tokens that match the specified
// pattern, guaranteeing structured output.
//
// Run the example like this from the root of the project:
// $ make example-grammar

package main

import (
	"context"
	"fmt"
	"os"
	"time"

	"github.com/ardanlabs/kronk/sdk/kronk"
	"github.com/ardanlabs/kronk/sdk/kronk/model"
	"github.com/ardanlabs/kronk/sdk/tools/catalog"
	"github.com/ardanlabs/kronk/sdk/tools/defaults"
	"github.com/ardanlabs/kronk/sdk/tools/libs"
	"github.com/ardanlabs/kronk/sdk/tools/models"
)

var grammarJSONObject = \`root ::= object
value ::= object | array | string | number | "true" | "false" | "null"
object ::= "{" ws ( string ":" ws value ("," ws string ":" ws value)* )? ws "}"
array ::= "[" ws ( value ("," ws value)* )? ws "]"
string ::= "\\"" ([^"\\\\] | "\\\\" ["\\\\bfnrt/] | "\\\\u" [0-9a-fA-F]{4})* "\\""
number ::= "-"? ("0" | [1-9][0-9]*) ("." [0-9]+)? ([eE] [+-]? [0-9]+)?
ws ::= [ \\t\\n\\r]*\`

// modelSpec defines how to obtain the model to download.
// - SourceURL: Download the model file directly from a HuggingFace URL
// - ModelID  : Download the model from the catalog by model ID
//
// To use a catalog model, comment out SourceURL and set ModelID.
// To use a direct URL, comment out ModelID and set SourceURL.
type modelSpec struct {
	SourceURL string
	ModelID   string
}

// Configure this to switch between URL and catalog downloads.
// Set either SourceURL or ModelID, not both.
var modelSpecConfig = modelSpec{
	SourceURL: "https://huggingface.co/Qwen/Qwen3-8B-GGUF/resolve/main/Qwen3-8B-Q8_0.gguf",
	// ModelID: "Qwen3-8B-Q8_0",
}

func main() {
	if err := run(); err != nil {
		fmt.Printf("\\nERROR: %s\\n", err)
		os.Exit(1)
	}
}

func run() error {
	mp, err := installSystem()
	if err != nil {
		return fmt.Errorf("unable to installation system: %w", err)
	}

	krn, err := newKronk(mp)
	if err != nil {
		return fmt.Errorf("unable to init kronk: %w", err)
	}

	defer func() {
		fmt.Println("\\nUnloading Kronk")
		if err := krn.Unload(context.Background()); err != nil {
			fmt.Printf("failed to unload model: %v", err)
		}
	}()

	// -------------------------------------------------------------------------
	// Example 1: Using a grammar preset (GrammarJSONObject)

	fmt.Println("=== Example 1: Grammar Preset (JSON Object) ===")
	if err := grammarPreset(krn); err != nil {
		fmt.Println(err)
	}

	// -------------------------------------------------------------------------
	// Example 2: Using a JSON Schema to auto-generate grammar

	fmt.Println("\\n=== Example 2: JSON Schema ===")
	if err := jsonSchema(krn); err != nil {
		fmt.Println(err)
	}

	// -------------------------------------------------------------------------
	// Example 3: Custom grammar for constrained choices

	fmt.Println("\\n=== Example 3: Custom Grammar (Sentiment Analysis) ===")
	if err := customGrammar(krn); err != nil {
		fmt.Println(err)
	}

	return nil
}

func installSystem() (models.Path, error) {
	ctx, cancel := context.WithTimeout(context.Background(), 15*time.Minute)
	defer cancel()

	libs, err := libs.New(
		libs.WithVersion(defaults.LibVersion("")),
	)
	if err != nil {
		return models.Path{}, err
	}

	if _, err := libs.Download(ctx, kronk.FmtLogger); err != nil {
		return models.Path{}, fmt.Errorf("unable to install llama.cpp: %w", err)
	}

	ctlg, err := catalog.New()
	if err != nil {
		return models.Path{}, fmt.Errorf("unable to create catalog system: %w", err)
	}

	if err := ctlg.Download(ctx); err != nil {
		return models.Path{}, fmt.Errorf("unable to download catalog: %w", err)
	}

	// -------------------------------------------------------------------------

	mdls, err := models.New()
	if err != nil {
		return models.Path{}, fmt.Errorf("unable to install llama.cpp: %w", err)
	}

	// Download model based on spec config using switch/case
	var mp models.Path

	switch {
	case modelSpecConfig.SourceURL != "":
		fmt.Println("Downloading model from URL:", modelSpecConfig.SourceURL)
		mp, err = mdls.Download(ctx, kronk.FmtLogger, modelSpecConfig.SourceURL, "")

	case modelSpecConfig.ModelID != "":
		fmt.Println("Downloading model from catalog:", modelSpecConfig.ModelID)
		mp, err = ctlg.DownloadModel(ctx, kronk.FmtLogger, modelSpecConfig.ModelID)

	default:
		return models.Path{}, fmt.Errorf("modelSpecConfig requires either SourceURL or ModelID to be set")
	}

	if err != nil {
		return models.Path{}, fmt.Errorf("unable to install model: %w", err)
	}

	return mp, nil
}

func newKronk(mp models.Path) (*kronk.Kronk, error) {
	fmt.Println("loading model...")

	if err := kronk.Init(); err != nil {
		return nil, fmt.Errorf("unable to init kronk: %w", err)
	}

	cfg := model.Config{
		ModelFiles: mp.ModelFiles,
	}

	krn, err := kronk.New(cfg)
	if err != nil {
		return nil, fmt.Errorf("unable to create inference model: %w", err)
	}

	fmt.Print("- system info:\\n\\t")
	for k, v := range krn.SystemInfo() {
		fmt.Printf("%s:%v, ", k, v)
	}
	fmt.Println()

	fmt.Println("- contextWindow:", krn.ModelConfig().ContextWindow)
	fmt.Printf("- k/v          : %s/%s\\n", krn.ModelConfig().CacheTypeK, krn.ModelConfig().CacheTypeV)
	fmt.Println("- nBatch       :", krn.ModelConfig().NBatch)
	fmt.Println("- nuBatch      :", krn.ModelConfig().NUBatch)
	fmt.Println("- embeddings   :", krn.ModelInfo().IsEmbedModel)
	fmt.Println("- modelType    :", krn.ModelInfo().Type)
	fmt.Println("- isGPT        :", krn.ModelInfo().IsGPTModel)
	fmt.Println("- template     :", krn.ModelInfo().Template.FileName)

	return krn, nil
}

// grammarPreset demonstrates using a built-in grammar preset to force JSON output.
func grammarPreset(krn *kronk.Kronk) error {
	ctx, cancel := context.WithTimeout(context.Background(), 120*time.Second)
	defer cancel()

	prompt := "List 3 programming languages with their year of creation. Respond in JSON format."

	fmt.Println("PROMPT:", prompt)
	fmt.Println()

	d := model.D{
		"messages": model.DocumentArray(
			model.TextMessage(model.RoleUser, prompt),
		),
		"grammar":     grammarJSONObject,
		"temperature": 0.7,
		"max_tokens":  512,
	}

	ch, err := krn.ChatStreaming(ctx, d)
	if err != nil {
		return fmt.Errorf("chat streaming: %w", err)
	}

	fmt.Print("RESPONSE: ")

	for resp := range ch {
		switch resp.Choice[0].FinishReason() {
		case model.FinishReasonError:
			return fmt.Errorf("error from model: %s", resp.Choice[0].Delta.Content)

		case model.FinishReasonStop:
			fmt.Println()
			return nil

		default:
			fmt.Print(resp.Choice[0].Delta.Content)
		}
	}

	return nil
}

// jsonSchema demonstrates using a JSON Schema to auto-generate a grammar.
// This gives you more control over the exact structure of the output.
func jsonSchema(krn *kronk.Kronk) error {
	ctx, cancel := context.WithTimeout(context.Background(), 120*time.Second)
	defer cancel()

	prompt := "Describe the Go programming language."

	fmt.Println("PROMPT:", prompt)
	fmt.Println()

	// Define the expected output structure using JSON Schema.
	schema := model.D{
		"type": "object",
		"properties": model.D{
			"name": model.D{
				"type": "string",
			},
			"year": model.D{
				"type": "integer",
			},
			"paradigm": model.D{
				"type": "string",
				"enum": []string{"procedural", "object-oriented", "functional", "concurrent"},
			},
			"compiled": model.D{
				"type": "boolean",
			},
		},
		"required": []string{"name", "year", "paradigm", "compiled"},
	}

	d := model.D{
		"messages": model.DocumentArray(
			model.TextMessage(model.RoleUser, prompt),
		),
		"json_schema":     schema,
		"enable_thinking": false, // Grammar requires output to match from first token
		"temperature":     0.7,
		"max_tokens":      256,
	}

	ch, err := krn.ChatStreaming(ctx, d)
	if err != nil {
		return fmt.Errorf("chat streaming: %w", err)
	}

	fmt.Print("RESPONSE: ")

	for resp := range ch {
		switch resp.Choice[0].FinishReason() {
		case model.FinishReasonError:
			return fmt.Errorf("error from model: %s", resp.Choice[0].Delta.Content)

		case model.FinishReasonStop:
			fmt.Println()
			return nil

		default:
			fmt.Print(resp.Choice[0].Delta.Content)
		}
	}

	return nil
}

// customGrammar demonstrates writing a custom GBNF grammar to constrain
// output to specific choices. This is useful for classification tasks.
func customGrammar(krn *kronk.Kronk) error {
	ctx, cancel := context.WithTimeout(context.Background(), 120*time.Second)
	defer cancel()

	// Custom grammar that only allows specific sentiment values.
	// The model MUST output one of these exact strings.
	sentimentGrammar := \`root ::= sentiment
sentiment ::= "positive" | "negative" | "neutral"\`

	prompt := \`Analyze the sentiment of this text and respond with exactly one word.

Text: "I absolutely love this product! It exceeded all my expectations and I would recommend it to everyone."

Sentiment:\`

	fmt.Println("PROMPT:", prompt)
	fmt.Println()

	d := model.D{
		"messages": model.DocumentArray(
			model.TextMessage(model.RoleUser, prompt),
		),
		"grammar":         sentimentGrammar,
		"enable_thinking": false, // Grammar requires output to match from first token
		"temperature":     0.0,
		"max_tokens":      16,
	}

	ch, err := krn.ChatStreaming(ctx, d)
	if err != nil {
		return fmt.Errorf("chat streaming: %w", err)
	}

	fmt.Print("RESPONSE: ")

	for resp := range ch {
		switch resp.Choice[0].FinishReason() {
		case model.FinishReasonError:
			return fmt.Errorf("error from model: %s", resp.Choice[0].Delta.Content)

		case model.FinishReasonStop:
			fmt.Println()
			return nil

		default:
			fmt.Print(resp.Choice[0].Delta.Content)
		}
	}

	return nil
}
`,DP=`// This example shows you a basic program of using Kronk to ask a model a question.
//
// The first time you run this program the system will download and install
// the model and libraries.
//
// Run the example like this from the root of the project:
// $ make example-question

package main

import (
	"context"
	"fmt"
	"os"
	"time"

	"github.com/ardanlabs/kronk/sdk/kronk"
	"github.com/ardanlabs/kronk/sdk/kronk/model"
	"github.com/ardanlabs/kronk/sdk/tools/defaults"
	"github.com/ardanlabs/kronk/sdk/tools/libs"
	"github.com/ardanlabs/kronk/sdk/tools/models"
)

const modelURL = "https://huggingface.co/Qwen/Qwen3-8B-GGUF/resolve/main/Qwen3-8B-Q8_0.gguf"

func main() {
	if err := run(); err != nil {
		fmt.Printf("\\nERROR: %s\\n", err)
		os.Exit(1)
	}
}

func run() error {
	mp, err := installSystem()
	if err != nil {
		return fmt.Errorf("unable to installation system: %w", err)
	}

	krn, err := newKronk(mp)
	if err != nil {
		return fmt.Errorf("unable to init kronk: %w", err)
	}

	defer func() {
		fmt.Println("\\nUnloading Kronk")
		if err := krn.Unload(context.Background()); err != nil {
			fmt.Printf("failed to unload model: %v", err)
		}
	}()

	if err := question(krn); err != nil {
		fmt.Println(err)
	}

	return nil
}

func installSystem() (models.Path, error) {
	ctx, cancel := context.WithTimeout(context.Background(), 15*time.Minute)
	defer cancel()

	libs, err := libs.New(
		libs.WithVersion(defaults.LibVersion("")),
	)
	if err != nil {
		return models.Path{}, err
	}

	if _, err := libs.Download(ctx, kronk.FmtLogger); err != nil {
		return models.Path{}, fmt.Errorf("unable to install llama.cpp: %w", err)
	}

	// -------------------------------------------------------------------------

	mdls, err := models.New()
	if err != nil {
		return models.Path{}, fmt.Errorf("unable to install llama.cpp: %w", err)
	}

	mp, err := mdls.Download(ctx, kronk.FmtLogger, modelURL, "")
	if err != nil {
		return models.Path{}, fmt.Errorf("unable to install model: %w", err)
	}

	// -------------------------------------------------------------------------
	// You could also download this model using the catalog system.
	// mp, err := templates.Catalog().DownloadModel(ctx, kronk.FmtLogger, "Qwen3-8B-Q8_0")
	// if err != nil {
	// 	return models.Path{}, fmt.Errorf("unable to download model: %w", err)
	// }

	return mp, nil
}

func newKronk(mp models.Path) (*kronk.Kronk, error) {
	fmt.Println("loading model...")

	if err := kronk.Init(); err != nil {
		return nil, fmt.Errorf("unable to init kronk: %w", err)
	}

	cfg := model.Config{
		ModelFiles: mp.ModelFiles,
	}

	krn, err := kronk.New(cfg)
	if err != nil {
		return nil, fmt.Errorf("unable to create inference model: %w", err)
	}

	fmt.Print("- system info:\\n\\t")
	for k, v := range krn.SystemInfo() {
		fmt.Printf("%s:%v, ", k, v)
	}
	fmt.Println()

	fmt.Println("- contextWindow:", krn.ModelConfig().ContextWindow)
	fmt.Printf("- k/v          : %s/%s\\n", krn.ModelConfig().CacheTypeK, krn.ModelConfig().CacheTypeV)
	fmt.Println("- nBatch       :", krn.ModelConfig().NBatch)
	fmt.Println("- nuBatch      :", krn.ModelConfig().NUBatch)
	fmt.Println("- embeddings   :", krn.ModelInfo().IsEmbedModel)
	fmt.Println("- modelType    :", krn.ModelInfo().Type)
	fmt.Println("- isGPT        :", krn.ModelInfo().IsGPTModel)
	fmt.Println("- template     :", krn.ModelInfo().Template.FileName)

	return krn, nil
}

func question(krn *kronk.Kronk) error {
	ctx, cancel := context.WithTimeout(context.Background(), 120*time.Second)
	defer cancel()

	question := "Hello model"

	fmt.Println()
	fmt.Println("QUESTION:", question)
	fmt.Println()

	d := model.D{
		"messages": model.DocumentArray(
			model.TextMessage(model.RoleUser, question),
		),
		"temperature": 0.7,
		"top_p":       0.9,
		"top_k":       40,
		"max_tokens":  2048,
	}

	ch, err := krn.ChatStreaming(ctx, d)
	if err != nil {
		return fmt.Errorf("chat streaming: %w", err)
	}

	// -------------------------------------------------------------------------

	var reasoning bool

	for resp := range ch {
		switch resp.Choice[0].FinishReason() {
		case model.FinishReasonError:
			return fmt.Errorf("error from model: %s", resp.Choice[0].Delta.Content)

		case model.FinishReasonStop:
			return nil

		default:
			if resp.Choice[0].Delta.Reasoning != "" {
				reasoning = true
				fmt.Printf("\\u001b[91m%s\\u001b[0m", resp.Choice[0].Delta.Reasoning)
				continue
			}

			if reasoning {
				reasoning = false
				fmt.Println()
				continue
			}

			fmt.Printf("%s", resp.Choice[0].Delta.Content)
		}
	}

	return nil
}
`,LP=`// This example shows you how to use a reranker model.
//
// The first time you run this program the system will download and install
// the model and libraries.
//
// Run the example like this from the root of the project:
// $ make example-rerank

package main

import (
	"context"
	"fmt"
	"os"
	"time"

	"github.com/ardanlabs/kronk/sdk/kronk"
	"github.com/ardanlabs/kronk/sdk/kronk/model"
	"github.com/ardanlabs/kronk/sdk/tools/catalog"
	"github.com/ardanlabs/kronk/sdk/tools/defaults"
	"github.com/ardanlabs/kronk/sdk/tools/libs"
	"github.com/ardanlabs/kronk/sdk/tools/models"
)

// modelSpec defines how to obtain the model to download.
// - SourceURL: Download the model file directly from a HuggingFace URL
// - ModelID  : Download the model from the catalog by model ID
//
// To use a catalog model, comment out SourceURL and set ModelID.
// To use a direct URL, comment out ModelID and set SourceURL.
type modelSpec struct {
	SourceURL string
	ModelID   string
}

// Configure this to switch between URL and catalog downloads.
// Set either SourceURL or ModelID, not both.
var modelSpecConfig = modelSpec{
	SourceURL: "https://huggingface.co/gpustack/bge-reranker-v2-m3-GGUF/resolve/main/bge-reranker-v2-m3-Q8_0.gguf",
	// ModelID: "bge-reranker-v2-m3-Q8_0",
}

func main() {
	if err := run(); err != nil {
		fmt.Printf("\\nERROR: %s\\n", err)
		os.Exit(1)
	}
}

func run() error {
	mp, err := installSystem()
	if err != nil {
		return fmt.Errorf("unable to installation system: %w", err)
	}

	krn, err := newKronk(mp)
	if err != nil {
		return fmt.Errorf("unable to init kronk: %w", err)
	}

	defer func() {
		fmt.Println("\\nUnloading Kronk")
		if err := krn.Unload(context.Background()); err != nil {
			fmt.Printf("failed to unload model: %v", err)
		}
	}()

	if err := rerank(krn); err != nil {
		return err
	}

	return nil
}

func installSystem() (models.Path, error) {
	ctx, cancel := context.WithTimeout(context.Background(), 15*time.Minute)
	defer cancel()

	libs, err := libs.New(
		libs.WithVersion(defaults.LibVersion("")),
	)
	if err != nil {
		return models.Path{}, err
	}

	if _, err := libs.Download(ctx, kronk.FmtLogger); err != nil {
		return models.Path{}, fmt.Errorf("unable to install llama.cpp: %w", err)
	}

	// -------------------------------------------------------------------------

	ctlg, err := catalog.New()
	if err != nil {
		return models.Path{}, fmt.Errorf("unable to create catalog system: %w", err)
	}

	if err := ctlg.Download(ctx); err != nil {
		return models.Path{}, fmt.Errorf("unable to download catalog: %w", err)
	}

	// -------------------------------------------------------------------------

	mdls, err := models.New()
	if err != nil {
		return models.Path{}, fmt.Errorf("unable to install llama.cpp: %w", err)
	}

	// Download model based on spec config using switch/case
	var mp models.Path

	switch {
	case modelSpecConfig.SourceURL != "":
		fmt.Println("Downloading model from URL:", modelSpecConfig.SourceURL)
		mp, err = mdls.Download(ctx, kronk.FmtLogger, modelSpecConfig.SourceURL, "")

	case modelSpecConfig.ModelID != "":
		fmt.Println("Downloading model from catalog:", modelSpecConfig.ModelID)
		mp, err = ctlg.DownloadModel(ctx, kronk.FmtLogger, modelSpecConfig.ModelID)

	default:
		return models.Path{}, fmt.Errorf("modelSpecConfig requires either SourceURL or ModelID to be set")
	}

	if err != nil {
		return models.Path{}, fmt.Errorf("unable to install model: %w", err)
	}

	return mp, nil
}

func newKronk(mp models.Path) (*kronk.Kronk, error) {
	fmt.Println("loading model...")

	if err := kronk.Init(); err != nil {
		return nil, fmt.Errorf("unable to init kronk: %w", err)
	}

	cfg := model.Config{
		ModelFiles: mp.ModelFiles,
	}

	krn, err := kronk.New(cfg)
	if err != nil {
		return nil, fmt.Errorf("unable to create reranker model: %w", err)
	}

	fmt.Print("- system info:\\n\\t")
	for k, v := range krn.SystemInfo() {
		fmt.Printf("%s:%v, ", k, v)
	}
	fmt.Println()

	fmt.Println("- contextWindow:", krn.ModelConfig().ContextWindow)
	fmt.Printf("- k/v          : %s/%s\\n", krn.ModelConfig().CacheTypeK, krn.ModelConfig().CacheTypeV)
	fmt.Println("- nBatch       :", krn.ModelConfig().NBatch)
	fmt.Println("- nuBatch      :", krn.ModelConfig().NUBatch)
	fmt.Println("- embeddings   :", krn.ModelInfo().IsEmbedModel)
	fmt.Println("- modelType    :", krn.ModelInfo().Type)
	fmt.Println("- isGPT        :", krn.ModelInfo().IsGPTModel)
	fmt.Println("- template     :", krn.ModelInfo().Template.FileName)

	return krn, nil
}

func rerank(krn *kronk.Kronk) error {
	ctx, cancel := context.WithTimeout(context.Background(), 120*time.Second)
	defer cancel()

	d := model.D{
		"query": "What is the capital of France?",
		"documents": []string{
			"Paris is the capital and largest city of France.",
			"Berlin is the capital of Germany.",
			"The Eiffel Tower is located in Paris.",
			"London is the capital of England.",
			"France is a country in Western Europe.",
		},
		"top_n":            3,
		"return_documents": true,
	}

	resp, err := krn.Rerank(ctx, d)
	if err != nil {
		return err
	}

	fmt.Println()
	fmt.Println("Model  :", resp.Model)
	fmt.Println("Object :", resp.Object)
	fmt.Println("Created:", time.UnixMilli(resp.Created))
	fmt.Println()
	fmt.Println("Results (sorted by relevance):")
	for i, result := range resp.Data {
		fmt.Printf("  %d. Score: %.4f, Index: %d, Doc: %s\\n",
			i+1, result.RelevanceScore, result.Index, result.Document)
	}
	fmt.Println()
	fmt.Println("Usage:")
	fmt.Println("  Prompt Tokens:", resp.Usage.PromptTokens)
	fmt.Println("  Total Tokens :", resp.Usage.TotalTokens)

	return nil
}
`,FP=`// This example shows you how to create a simple chat application against an
// inference model using the kronk Response api. Thanks to Kronk and yzma,
// reasoning and tool calling is enabled.
//
// The first time you run this program the system will download and install
// the model and libraries.
//
// Run the example like this from the root of the project:
// $ make example-response

package main

import (
	"bufio"
	"context"
	"errors"
	"fmt"
	"io"
	"os"
	"time"

	"github.com/ardanlabs/kronk/sdk/kronk"
	"github.com/ardanlabs/kronk/sdk/kronk/model"
	"github.com/ardanlabs/kronk/sdk/tools/catalog"
	"github.com/ardanlabs/kronk/sdk/tools/defaults"
	"github.com/ardanlabs/kronk/sdk/tools/libs"
	"github.com/ardanlabs/kronk/sdk/tools/models"
)

// modelSpec defines how to obtain the model to download.
// - SourceURL: Download the model file directly from a HuggingFace URL
// - ModelID  : Download the model from the catalog by model ID
//
// To use a catalog model, comment out SourceURL and set ModelID.
// To use a direct URL, comment out ModelID and set SourceURL.
type modelSpec struct {
	SourceURL string
	ModelID   string
}

// Configure this to switch between URL and catalog downloads.
// Set either SourceURL or ModelID, not both.
var modelSpecConfig = modelSpec{
	SourceURL: "https://huggingface.co/Qwen/Qwen3-8B-GGUF/resolve/main/Qwen3-8B-Q8_0.gguf",
	// ModelID: "Qwen3-8B-Q8_0",
}

func main() {
	if err := run(); err != nil {
		fmt.Printf("\\nERROR: %s\\n", err)
		os.Exit(1)
	}
}

func run() error {
	mp, err := installSystem()
	if err != nil {
		return fmt.Errorf("run: unable to installation system: %w", err)
	}

	krn, err := newKronk(mp)
	if err != nil {
		return fmt.Errorf("unable to init kronk: %w", err)
	}

	defer func() {
		fmt.Println("\\nUnloading Kronk")
		if err := krn.Unload(context.Background()); err != nil {
			fmt.Printf("run: failed to unload model: %v", err)
		}
	}()

	if err := chat(krn); err != nil {
		return err
	}

	return nil
}

func installSystem() (models.Path, error) {
	ctx, cancel := context.WithTimeout(context.Background(), 25*time.Minute)
	defer cancel()

	libs, err := libs.New(
		libs.WithVersion(defaults.LibVersion("")),
	)
	if err != nil {
		return models.Path{}, err
	}

	if _, err := libs.Download(ctx, kronk.FmtLogger); err != nil {
		return models.Path{}, fmt.Errorf("unable to install llama.cpp: %w", err)
	}

	// -------------------------------------------------------------------------
	// This is not mandatory if you won't be using models from the catalog. That
	// being said, if you are using a model that is part of the catalog with
	// a corrected jinja file, having the catalog system up to date will allow
	// the system to pull that jinja file.

	ctlg, err := catalog.New()
	if err != nil {
		return models.Path{}, fmt.Errorf("unable to create catalog system: %w", err)
	}

	if err := ctlg.Download(ctx); err != nil {
		return models.Path{}, fmt.Errorf("unable to download catalog: %w", err)
	}

	// -------------------------------------------------------------------------

	mdls, err := models.New()
	if err != nil {
		return models.Path{}, fmt.Errorf("unable to install llama.cpp: %w", err)
	}

	// Download model based on spec config using switch/case
	var mp models.Path

	switch {
	case modelSpecConfig.SourceURL != "":
		fmt.Println("Downloading model from URL:", modelSpecConfig.SourceURL)
		mp, err = mdls.Download(ctx, kronk.FmtLogger, modelSpecConfig.SourceURL, "")

	case modelSpecConfig.ModelID != "":
		fmt.Println("Downloading model from catalog:", modelSpecConfig.ModelID)
		mp, err = ctlg.DownloadModel(ctx, kronk.FmtLogger, modelSpecConfig.ModelID)

	default:
		return models.Path{}, fmt.Errorf("modelSpecConfig requires either SourceURL or ModelID to be set")
	}

	if err != nil {
		return models.Path{}, fmt.Errorf("unable to install model: %w", err)
	}

	return mp, nil
}

func newKronk(mp models.Path) (*kronk.Kronk, error) {
	fmt.Println("loading model...")

	if err := kronk.Init(); err != nil {
		return nil, fmt.Errorf("unable to init kronk: %w", err)
	}

	cfg := model.Config{
		ModelFiles: mp.ModelFiles,
	}

	krn, err := kronk.New(cfg)
	if err != nil {
		return nil, fmt.Errorf("unable to create inference model: %w", err)
	}

	fmt.Print("- system info:\\n\\t")
	for k, v := range krn.SystemInfo() {
		fmt.Printf("%s:%v, ", k, v)
	}
	fmt.Println()

	fmt.Println("- contextWindow:", krn.ModelConfig().ContextWindow)
	fmt.Printf("- k/v          : %s/%s\\n", krn.ModelConfig().CacheTypeK, krn.ModelConfig().CacheTypeV)
	fmt.Println("- nBatch       :", krn.ModelConfig().NBatch)
	fmt.Println("- nuBatch      :", krn.ModelConfig().NUBatch)
	fmt.Println("- embeddings   :", krn.ModelInfo().IsEmbedModel)
	fmt.Println("- modelType    :", krn.ModelInfo().Type)
	fmt.Println("- isGPT        :", krn.ModelInfo().IsGPTModel)
	fmt.Println("- template     :", krn.ModelInfo().Template.FileName)

	return krn, nil
}

func chat(krn *kronk.Kronk) error {
	messages := model.DocumentArray()

	for {
		var err error
		messages, err = userInput(messages)
		if err != nil {
			if errors.Is(err, io.EOF) {
				return nil
			}
			return fmt.Errorf("run:user input: %w", err)
		}

		messages, err = func() ([]model.D, error) {
			ctx, cancel := context.WithTimeout(context.Background(), 120*time.Second)
			defer cancel()

			d := model.D{
				"input":       messages,
				"tools":       toolDocuments(),
				"max_tokens":  2048,
				"temperature": 0.7,
				"top_p":       0.9,
				"top_k":       40,
			}

			ch, err := performChat(ctx, krn, d)
			if err != nil {
				return nil, fmt.Errorf("run: unable to perform chat: %w", err)
			}

			messages, err = modelResponse(krn, messages, ch)
			if err != nil {
				return nil, fmt.Errorf("run: model response: %w", err)
			}

			return messages, nil
		}()

		if err != nil {
			return fmt.Errorf("run: unable to perform chat: %w", err)
		}
	}
}

func userInput(messages []model.D) ([]model.D, error) {
	fmt.Print("\\nUSER> ")

	reader := bufio.NewReader(os.Stdin)

	userInput, err := reader.ReadString('\\n')
	if err != nil {
		return messages, fmt.Errorf("unable to read user input: %w", err)
	}

	if userInput == "quit\\n" {
		return nil, io.EOF
	}

	messages = append(messages,
		model.TextMessage(model.RoleUser, userInput),
	)

	return messages, nil
}

func toolDocuments() []model.D {
	return model.DocumentArray(
		model.D{
			"type": "function",
			"function": model.D{
				"name":        "get_weather",
				"description": "Get the current weather for a location",
				"parameters": model.D{
					"type": "object",
					"properties": model.D{
						"location": model.D{
							"type":        "string",
							"description": "The location to get the weather for, e.g. San Francisco, CA",
						},
					},
					"required": []any{"location"},
				},
			},
		},
	)
}

func performChat(ctx context.Context, krn *kronk.Kronk, d model.D) (<-chan kronk.ResponseStreamEvent, error) {
	ch, err := krn.ResponseStreaming(ctx, d)
	if err != nil {
		return nil, fmt.Errorf("response streaming: %w", err)
	}

	return ch, nil
}

func modelResponse(krn *kronk.Kronk, messages []model.D, ch <-chan kronk.ResponseStreamEvent) ([]model.D, error) {
	fmt.Print("\\nMODEL> ")

	var fullText string
	var finalResp *kronk.ResponseResponse
	var reasoning bool

	for event := range ch {
		switch event.Type {
		case "response.reasoning_summary_text.delta":
			fmt.Printf("\\u001b[91m%s\\u001b[0m", event.Delta)
			reasoning = true

		case "response.output_text.delta":
			if reasoning {
				reasoning = false
				fmt.Println()
				if krn.ModelInfo().IsGPTModel {
					fmt.Println()
				}
			}
			fmt.Printf("%s", event.Delta)

		case "response.output_text.done":
			fullText = event.Text

		case "response.function_call_arguments.done":
			fmt.Println()
			if krn.ModelInfo().IsGPTModel {
				fmt.Println()
			}

			fmt.Printf("\\u001b[92mModel Asking For Tool Calls:\\n\\u001b[0m")
			fmt.Printf("\\u001b[92mToolID[%s]: %s(%s)\\n\\u001b[0m",
				event.ItemID,
				event.Name,
				event.Arguments,
			)

			messages = append(messages,
				model.TextMessage("tool", fmt.Sprintf("Tool call %s: %s(%s)\\n",
					event.ItemID,
					event.Name,
					event.Arguments),
				),
			)

		case "response.completed":
			finalResp = event.Response
		}
	}

	if fullText != "" {
		messages = append(messages,
			model.TextMessage("assistant", fullText),
		)
	}

	// -------------------------------------------------------------------------

	if finalResp != nil {
		contextTokens := finalResp.Usage.InputTokens + finalResp.Usage.OutputTokens
		contextWindow := krn.ModelConfig().ContextWindow
		percentage := (float64(contextTokens) / float64(contextWindow)) * 100
		of := float32(contextWindow) / float32(1024)

		fmt.Printf("\\n\\n\\u001b[90mInput: %d  Reasoning: %d  Completion: %d  Output: %d  Window: %d (%.0f%% of %.0fK)\\u001b[0m\\n",
			finalResp.Usage.InputTokens,
			finalResp.Usage.OutputTokenDetail.ReasoningTokens,
			finalResp.Usage.OutputTokens,
			finalResp.Usage.OutputTokens,
			contextTokens,
			percentage,
			of,
		)
	}

	return messages, nil
}
`,OP=`// This example shows you how to execute a simple prompt against a vision model.
//
// The first time you run this program the system will download and install
// the model and libraries.
//
// Run the example like this from the root of the project:
// $ make example-vision

package main

import (
	"context"
	"fmt"
	"os"
	"time"

	"github.com/ardanlabs/kronk/sdk/kronk"
	"github.com/ardanlabs/kronk/sdk/kronk/model"
	"github.com/ardanlabs/kronk/sdk/tools/catalog"
	"github.com/ardanlabs/kronk/sdk/tools/defaults"
	"github.com/ardanlabs/kronk/sdk/tools/libs"
	"github.com/ardanlabs/kronk/sdk/tools/models"
)

// modelSpec defines how to obtain the model to download.
// - SourceURL: Download the model file directly from a HuggingFace URL
// - ProjURL  : Download the projection file directly from a HuggingFace URL
// - ModelID  : Download the model from the catalog by model ID
//
// To use a catalog model, comment out SourceURL and set ModelID.
// To use a direct URL, comment out ModelID and set SourceURL/ProjURL.
type modelSpec struct {
	SourceURL string
	ProjURL   string
	ModelID   string
}

// Configure this to switch between URL and catalog downloads.
// Set either SourceURL (with ProjURL) or ModelID, not both.
var modelSpecConfig = modelSpec{
	SourceURL: "https://huggingface.co/unsloth/LFM2.5-VL-1.6B-GGUF/resolve/main/LFM2.5-VL-1.6B-Q8_0.gguf",
	ProjURL:   "https://huggingface.co/unsloth/LFM2.5-VL-1.6B-GGUF/resolve/main/mmproj-F16.gguf",
	// ModelID: "LFM2.5-VL-1.6B-Q8_0",
}

const imageFile = "examples/samples/giraffe.jpg"

func main() {
	if err := run(); err != nil {
		fmt.Printf("\\nERROR: %s\\n", err)
		os.Exit(1)
	}
}

func run() error {
	info, err := installSystem()
	if err != nil {
		return fmt.Errorf("unable to install system: %w", err)
	}

	krn, err := newKronk(info)
	if err != nil {
		return fmt.Errorf("unable to init kronk: %w", err)
	}

	defer func() {
		fmt.Println("\\nUnloading Kronk")
		if err := krn.Unload(context.Background()); err != nil {
			fmt.Printf("failed to unload model: %v", err)
		}
	}()

	if err := vision(krn); err != nil {
		return err
	}

	return nil
}

func installSystem() (models.Path, error) {
	ctx, cancel := context.WithTimeout(context.Background(), 15*time.Minute)
	defer cancel()

	libs, err := libs.New(
		libs.WithVersion(defaults.LibVersion("")),
	)
	if err != nil {
		return models.Path{}, err
	}

	if _, err := libs.Download(ctx, kronk.FmtLogger); err != nil {
		return models.Path{}, fmt.Errorf("unable to install llama.cpp: %w", err)
	}

	// -------------------------------------------------------------------------

	ctlg, err := catalog.New()
	if err != nil {
		return models.Path{}, fmt.Errorf("unable to create catalog system: %w", err)
	}

	if err := ctlg.Download(ctx); err != nil {
		return models.Path{}, fmt.Errorf("unable to download catalog: %w", err)
	}

	// -------------------------------------------------------------------------

	mdls, err := models.New()
	if err != nil {
		return models.Path{}, fmt.Errorf("unable to install llama.cpp: %w", err)
	}

	// Download model based on spec config using switch/case
	var mp models.Path

	switch {
	case modelSpecConfig.SourceURL != "":
		fmt.Println("Downloading model from URL:", modelSpecConfig.SourceURL)
		fmt.Println("Downloading projection file:", modelSpecConfig.ProjURL)
		mp, err = mdls.Download(ctx, kronk.FmtLogger, modelSpecConfig.SourceURL, modelSpecConfig.ProjURL)

	case modelSpecConfig.ModelID != "":
		fmt.Println("Downloading model from catalog:", modelSpecConfig.ModelID)
		mp, err = ctlg.DownloadModel(ctx, kronk.FmtLogger, modelSpecConfig.ModelID)

	default:
		return models.Path{}, fmt.Errorf("modelSpecConfig requires either (SourceURL and ProjURL) or ModelID to be set")
	}

	if err != nil {
		return models.Path{}, fmt.Errorf("unable to install model: %w", err)
	}

	return mp, nil
}

func newKronk(mp models.Path) (*kronk.Kronk, error) {
	fmt.Println("loading model...")

	if err := kronk.Init(); err != nil {
		return nil, fmt.Errorf("unable to init kronk: %w", err)
	}

	cfg := model.Config{
		ModelFiles: mp.ModelFiles,
		ProjFile:   mp.ProjFile,
	}

	krn, err := kronk.New(cfg)
	if err != nil {
		return nil, fmt.Errorf("unable to create inference model: %w", err)
	}

	fmt.Print("- system info:\\n\\t")
	for k, v := range krn.SystemInfo() {
		fmt.Printf("%s:%v, ", k, v)
	}
	fmt.Println()

	fmt.Println("- contextWindow:", krn.ModelConfig().ContextWindow)
	fmt.Printf("- k/v          : %s/%s\\n", krn.ModelConfig().CacheTypeK, krn.ModelConfig().CacheTypeV)
	fmt.Println("- nBatch       :", krn.ModelConfig().NBatch)
	fmt.Println("- nuBatch      :", krn.ModelConfig().NUBatch)
	fmt.Println("- embeddings   :", krn.ModelInfo().IsEmbedModel)
	fmt.Println("- modelType    :", krn.ModelInfo().Type)
	fmt.Println("- isGPT        :", krn.ModelInfo().IsGPTModel)
	fmt.Println("- template     :", krn.ModelInfo().Template.FileName)

	return krn, nil
}

func vision(krn *kronk.Kronk) error {
	question := "What is in this picture?"

	ctx, cancel := context.WithTimeout(context.Background(), 120*time.Second)
	defer cancel()

	ch, err := performChat(ctx, krn, question, imageFile)
	if err != nil {
		return fmt.Errorf("perform chat: %w", err)
	}

	if err := modelResponse(krn, ch); err != nil {
		return fmt.Errorf("model response: %w", err)
	}

	return nil
}

func performChat(ctx context.Context, krn *kronk.Kronk, question string, imageFile string) (<-chan model.ChatResponse, error) {
	image, err := readImage(imageFile)
	if err != nil {
		return nil, fmt.Errorf("read image: %w", err)
	}

	fmt.Printf("\\nQuestion: %s\\n", question)

	d := model.D{
		"messages":    model.RawMediaMessage(question, image),
		"temperature": 0.7,
		"top_p":       0.9,
		"top_k":       40,
		"max_tokens":  2048,
	}

	ch, err := krn.ChatStreaming(ctx, d)
	if err != nil {
		return nil, fmt.Errorf("vision streaming: %w", err)
	}

	return ch, nil
}

func modelResponse(krn *kronk.Kronk, ch <-chan model.ChatResponse) error {
	fmt.Print("\\nMODEL> ")

	var reasoning bool
	var lr model.ChatResponse

loop:
	for resp := range ch {
		lr = resp

		switch resp.Choice[0].FinishReason() {
		case model.FinishReasonStop:
			break loop

		case model.FinishReasonError:
			return fmt.Errorf("error from model: %s", resp.Choice[0].Delta.Content)
		}

		if resp.Choice[0].Delta.Reasoning != "" {
			fmt.Printf("\\u001b[91m%s\\u001b[0m", resp.Choice[0].Delta.Reasoning)
			reasoning = true
			continue
		}

		if reasoning {
			reasoning = false
			fmt.Print("\\n\\n")
		}

		fmt.Printf("%s", resp.Choice[0].Delta.Content)
	}

	// -------------------------------------------------------------------------

	contextTokens := lr.Usage.PromptTokens + lr.Usage.CompletionTokens
	contextWindow := krn.ModelConfig().ContextWindow
	percentage := (float64(contextTokens) / float64(contextWindow)) * 100
	of := float32(contextWindow) / float32(1024)

	fmt.Printf("\\n\\n\\u001b[90mInput: %d  Reasoning: %d  Completion: %d  Output: %d  Window: %d (%.0f%% of %.0fK) TPS: %.2f\\u001b[0m\\n",
		lr.Usage.PromptTokens, lr.Usage.ReasoningTokens, lr.Usage.CompletionTokens, lr.Usage.OutputTokens, contextTokens, percentage, of, lr.Usage.TokensPerSecond)

	return nil
}

func readImage(imageFile string) ([]byte, error) {
	if _, err := os.Stat(imageFile); err != nil {
		return nil, fmt.Errorf("error accessing file %q: %w", imageFile, err)
	}

	image, err := os.ReadFile(imageFile)
	if err != nil {
		return nil, fmt.Errorf("error reading file %q: %w", imageFile, err)
	}

	return image, nil
}
`;function qP(){return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"SDK Examples"}),e.jsx("p",{children:"Complete working examples demonstrating how to use the Kronk SDK"})]}),e.jsxs("div",{className:"doc-layout",children:[e.jsxs("div",{className:"doc-content",children:[e.jsxs("div",{className:"card",id:"example-audio",children:[e.jsx("h3",{children:"Audio"}),e.jsx("p",{className:"doc-description",children:"This example shows you how to execute a simple prompt against an audio model."}),e.jsx(Xn,{code:RP,language:"go"})]}),e.jsxs("div",{className:"card",id:"example-chat",children:[e.jsx("h3",{children:"Chat"}),e.jsx("p",{className:"doc-description",children:"This example shows you how to create a simple chat application against an"}),e.jsx(Xn,{code:MP,language:"go"})]}),e.jsxs("div",{className:"card",id:"example-embedding",children:[e.jsx("h3",{children:"Embedding"}),e.jsx("p",{className:"doc-description",children:"This example shows you how to use an embedding model."}),e.jsx(Xn,{code:IP,language:"go"})]}),e.jsxs("div",{className:"card",id:"example-grammar",children:[e.jsx("h3",{children:"Grammar"}),e.jsx("p",{className:"doc-description",children:"This example shows how to use GBNF grammars to constrain model output."}),e.jsx(Xn,{code:AP,language:"go"})]}),e.jsxs("div",{className:"card",id:"example-question",children:[e.jsx("h3",{children:"Question"}),e.jsx("p",{className:"doc-description",children:"This example shows you a basic program of using Kronk to ask a model a question."}),e.jsx(Xn,{code:DP,language:"go"})]}),e.jsxs("div",{className:"card",id:"example-rerank",children:[e.jsx("h3",{children:"Rerank"}),e.jsx("p",{className:"doc-description",children:"This example shows you how to use a reranker model."}),e.jsx(Xn,{code:LP,language:"go"})]}),e.jsxs("div",{className:"card",id:"example-response",children:[e.jsx("h3",{children:"Response"}),e.jsx("p",{className:"doc-description",children:"This example shows you how to create a simple chat application against an"}),e.jsx(Xn,{code:FP,language:"go"})]}),e.jsxs("div",{className:"card",id:"example-vision",children:[e.jsx("h3",{children:"Vision"}),e.jsx("p",{className:"doc-description",children:"This example shows you how to execute a simple prompt against a vision model."}),e.jsx(Xn,{code:OP,language:"go"})]})]}),e.jsx("nav",{className:"doc-sidebar",children:e.jsx("div",{className:"doc-sidebar-content",children:e.jsxs("div",{className:"doc-index-section",children:[e.jsx("span",{className:"doc-index-header",children:"Examples"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#example-audio",children:"Audio"})}),e.jsx("li",{children:e.jsx("a",{href:"#example-chat",children:"Chat"})}),e.jsx("li",{children:e.jsx("a",{href:"#example-embedding",children:"Embedding"})}),e.jsx("li",{children:e.jsx("a",{href:"#example-grammar",children:"Grammar"})}),e.jsx("li",{children:e.jsx("a",{href:"#example-question",children:"Question"})}),e.jsx("li",{children:e.jsx("a",{href:"#example-rerank",children:"Rerank"})}),e.jsx("li",{children:e.jsx("a",{href:"#example-response",children:"Response"})}),e.jsx("li",{children:e.jsx("a",{href:"#example-vision",children:"Vision"})})]})]})})})]})]})}function BP(){return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"catalog"}),e.jsx("p",{children:"Manage model catalog - list and update available models."})]}),e.jsxs("div",{className:"doc-layout",children:[e.jsxs("div",{className:"doc-content",children:[e.jsxs("div",{className:"card",id:"usage",children:[e.jsx("h3",{children:"Usage"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk catalog <command> [flags]"})})]}),e.jsxs("div",{className:"card",id:"subcommands",children:[e.jsx("h3",{children:"Subcommands"}),e.jsxs("div",{className:"doc-section",id:"cmd-list",children:[e.jsx("h4",{children:"list"}),e.jsx("p",{className:"doc-description",children:"List catalog models."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk catalog list [flags]"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--local"})}),e.jsx("td",{children:"Run without the model server"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--base-path <string>"})}),e.jsx("td",{children:"Base path for kronk data (models, catalogs, templates)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--filter-category <string>"})}),e.jsx("td",{children:"Filter catalogs by category name (substring match)"})]})]})]}),e.jsx("h5",{children:"Environment Variables"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_TOKEN"})}),e.jsx("td",{}),e.jsx("td",{children:"Authentication token for the kronk server (required when auth enabled)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_WEB_API_HOST"})}),e.jsx("td",{children:"localhost:8080"}),e.jsx("td",{children:"IP Address for the kronk server (web mode)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_BASE_PATH"})}),e.jsx("td",{children:"$HOME/kronk"}),e.jsx("td",{children:"Base path for kronk data directories (local mode)"})]})]})]}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`# List all catalog models
kronk catalog list

# List models with local mode (no server required)
kronk catalog list --local

# Filter models by category
kronk catalog list --filter-category embedding`})})]}),e.jsxs("div",{className:"doc-section",id:"cmd-pull",children:[e.jsx("h4",{children:"pull"}),e.jsx("p",{className:"doc-description",children:"Pull a model from the catalog."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk catalog pull <MODEL_ID> [flags]"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--local"})}),e.jsx("td",{children:"Run without the model server"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--base-path <string>"})}),e.jsx("td",{children:"Base path for kronk data (models, catalogs, templates)"})]})]})]}),e.jsx("h5",{children:"Environment Variables"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_TOKEN"})}),e.jsx("td",{}),e.jsx("td",{children:"Authentication token for the kronk server (required when auth enabled)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_WEB_API_HOST"})}),e.jsx("td",{children:"localhost:8080"}),e.jsx("td",{children:"IP Address for the kronk server (web mode)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_BASE_PATH"})}),e.jsx("td",{children:"$HOME/kronk"}),e.jsx("td",{children:"Base path for kronk data directories (local mode)"})]})]})]}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`# Pull a model from the catalog
kronk catalog pull llama-3.2-1b-q4

# Pull with local mode
kronk catalog pull llama-3.2-1b-q4 --local`})})]}),e.jsxs("div",{className:"doc-section",id:"cmd-show",children:[e.jsx("h4",{children:"show"}),e.jsx("p",{className:"doc-description",children:"Show catalog model information."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk catalog show <MODEL_ID> [flags]"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--local"})}),e.jsx("td",{children:"Run without the model server"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--base-path <string>"})}),e.jsx("td",{children:"Base path for kronk data (models, catalogs, templates)"})]})]})]}),e.jsx("h5",{children:"Environment Variables"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_TOKEN"})}),e.jsx("td",{}),e.jsx("td",{children:"Authentication token for the kronk server (required when auth enabled)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_WEB_API_HOST"})}),e.jsx("td",{children:"localhost:8080"}),e.jsx("td",{children:"IP Address for the kronk server (web mode)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_BASE_PATH"})}),e.jsx("td",{children:"$HOME/kronk"}),e.jsx("td",{children:"Base path for kronk data directories (local mode)"})]})]})]}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`# Show details for a specific model
kronk catalog show llama-3.2-1b-q4

# Show with local mode
kronk catalog show llama-3.2-1b-q4 --local`})})]}),e.jsxs("div",{className:"doc-section",id:"cmd-update",children:[e.jsx("h4",{children:"update"}),e.jsx("p",{className:"doc-description",children:"Update the model catalog."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk catalog update [flags]"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--local"})}),e.jsx("td",{children:"Run without the model server"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--base-path <string>"})}),e.jsx("td",{children:"Base path for kronk data (models, catalogs, templates)"})]})]})]}),e.jsx("h5",{children:"Environment Variables"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_TOKEN"})}),e.jsx("td",{}),e.jsx("td",{children:"Authentication token for the kronk server (required when auth enabled)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_WEB_API_HOST"})}),e.jsx("td",{children:"localhost:8080"}),e.jsx("td",{children:"IP Address for the kronk server (web mode)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_BASE_PATH"})}),e.jsx("td",{children:"$HOME/kronk"}),e.jsx("td",{children:"Base path for kronk data directories (local mode)"})]})]})]}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`# Update the catalog from remote source
kronk catalog update

# Update with local mode
kronk catalog update --local`})})]})]})]}),e.jsx("nav",{className:"doc-sidebar",children:e.jsxs("div",{className:"doc-sidebar-content",children:[e.jsx("div",{className:"doc-index-section",children:e.jsx("a",{href:"#usage",className:"doc-index-header",children:"Usage"})}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#subcommands",className:"doc-index-header",children:"Subcommands"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#cmd-list",children:"list"})}),e.jsx("li",{children:e.jsx("a",{href:"#cmd-pull",children:"pull"})}),e.jsx("li",{children:e.jsx("a",{href:"#cmd-show",children:"show"})}),e.jsx("li",{children:e.jsx("a",{href:"#cmd-update",children:"update"})})]})]})]})})]})]})}function UP(){return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"libs"}),e.jsx("p",{children:"Install or upgrade llama.cpp libraries."})]}),e.jsxs("div",{className:"doc-layout",children:[e.jsxs("div",{className:"doc-content",children:[e.jsxs("div",{className:"card",id:"usage",children:[e.jsx("h3",{children:"Usage"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk libs [flags]"})})]}),e.jsxs("div",{className:"card",id:"subcommands",children:[e.jsx("h3",{children:"Subcommands"}),e.jsxs("div",{className:"doc-section",id:"cmd-(default)",children:[e.jsx("h4",{children:"(default)"}),e.jsx("p",{className:"doc-description",children:"Install or upgrade llama.cpp libraries."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk libs [flags]"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--local"})}),e.jsx("td",{children:"Run without the model server"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--no-upgrade"})}),e.jsx("td",{children:"Don't upgrade if libraries are already installed"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--version <string>"})}),e.jsxs("td",{children:["Download a specific llama.cpp version instead of latest (e.g. ",e.jsx("code",{children:"b5540"}),"). See ",e.jsx("a",{href:"https://github.com/ggml-org/llama.cpp/releases",target:"_blank",rel:"noopener noreferrer",children:"available releases"}),"."]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--base-path <string>"})}),e.jsx("td",{children:"Base path for kronk data (models, catalogs, templates)"})]})]})]}),e.jsx("h5",{children:"Environment Variables"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_TOKEN"})}),e.jsx("td",{}),e.jsx("td",{children:"Authentication token for the kronk server (required when auth enabled)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_WEB_API_HOST"})}),e.jsx("td",{children:"localhost:8080"}),e.jsx("td",{children:"IP Address for the kronk server (web mode)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_BASE_PATH"})}),e.jsx("td",{children:"$HOME/kronk"}),e.jsx("td",{children:"Base path for kronk data directories (local mode)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_ARCH"})}),e.jsx("td",{children:"runtime.GOARCH"}),e.jsx("td",{children:"The architecture to install (local mode)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_LIB_PATH"})}),e.jsx("td",{children:"$HOME/kronk/libraries"}),e.jsx("td",{children:"The path to the libraries directory (local mode)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_OS"})}),e.jsx("td",{children:"runtime.GOOS"}),e.jsx("td",{children:"The operating system to install (local mode)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_PROCESSOR"})}),e.jsx("td",{children:"cpu"}),e.jsx("td",{children:"Options: cpu, cuda, metal, rocm, vulkan (local mode)"})]})]})]}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`# Install libraries using the server
kronk libs

# Install libraries locally
kronk libs --local

# Install a specific version
kronk libs --version b5540
kronk libs --local --version b5540

# Install without upgrading existing libraries
kronk libs --local --no-upgrade

# Install with Metal support on macOS
KRONK_PROCESSOR=metal kronk libs --local`})})]})]})]}),e.jsx("nav",{className:"doc-sidebar",children:e.jsxs("div",{className:"doc-sidebar-content",children:[e.jsx("div",{className:"doc-index-section",children:e.jsx("a",{href:"#usage",className:"doc-index-header",children:"Usage"})}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#subcommands",className:"doc-index-header",children:"Subcommands"}),e.jsx("ul",{children:e.jsx("li",{children:e.jsx("a",{href:"#cmd-(default)",children:"(default)"})})})]})]})})]})]})}function KP(){return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"model"}),e.jsx("p",{children:"Manage models - list, pull, remove, show, and check running models."})]}),e.jsxs("div",{className:"doc-layout",children:[e.jsxs("div",{className:"doc-content",children:[e.jsxs("div",{className:"card",id:"usage",children:[e.jsx("h3",{children:"Usage"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk model <command> [flags]"})})]}),e.jsxs("div",{className:"card",id:"subcommands",children:[e.jsx("h3",{children:"Subcommands"}),e.jsxs("div",{className:"doc-section",id:"cmd-index",children:[e.jsx("h4",{children:"index"}),e.jsx("p",{className:"doc-description",children:"Rebuild the model index for fast model access."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk model index [flags]"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--local"})}),e.jsx("td",{children:"Run without the model server"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--base-path <string>"})}),e.jsx("td",{children:"Base path for kronk data (models, catalogs, templates)"})]})]})]}),e.jsx("h5",{children:"Environment Variables"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_TOKEN"})}),e.jsx("td",{}),e.jsx("td",{children:"Authentication token for the kronk server (required when auth enabled)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_WEB_API_HOST"})}),e.jsx("td",{children:"localhost:8080"}),e.jsx("td",{children:"IP Address for the kronk server (web mode)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_BASE_PATH"})}),e.jsx("td",{children:"$HOME/kronk"}),e.jsx("td",{children:"Base path for kronk data directories (local mode)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_MODELS"})}),e.jsx("td",{children:"$HOME/kronk/models"}),e.jsx("td",{children:"The path to the models directory (local mode)"})]})]})]}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`# Rebuild the model index
kronk model index

# Rebuild with local mode
kronk model index --local`})})]}),e.jsxs("div",{className:"doc-section",id:"cmd-list",children:[e.jsx("h4",{children:"list"}),e.jsx("p",{className:"doc-description",children:"List models."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk model list [flags]"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--local"})}),e.jsx("td",{children:"Run without the model server"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--base-path <string>"})}),e.jsx("td",{children:"Base path for kronk data (models, catalogs, templates)"})]})]})]}),e.jsx("h5",{children:"Environment Variables"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_TOKEN"})}),e.jsx("td",{}),e.jsx("td",{children:"Authentication token for the kronk server (required when auth enabled)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_WEB_API_HOST"})}),e.jsx("td",{children:"localhost:8080"}),e.jsx("td",{children:"IP Address for the kronk server (web mode)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_BASE_PATH"})}),e.jsx("td",{children:"$HOME/kronk"}),e.jsx("td",{children:"Base path for kronk data directories (local mode)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_MODELS"})}),e.jsx("td",{children:"$HOME/kronk/models"}),e.jsx("td",{children:"The path to the models directory (local mode)"})]})]})]}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`# List all models
kronk model list

# List with local mode
kronk model list --local`})})]}),e.jsxs("div",{className:"doc-section",id:"cmd-ps",children:[e.jsx("h4",{children:"ps"}),e.jsx("p",{className:"doc-description",children:"List running models."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk model ps"})}),e.jsx("h5",{children:"Environment Variables"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_TOKEN"})}),e.jsx("td",{}),e.jsx("td",{children:"Authentication token for the kronk server (required when auth enabled)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_WEB_API_HOST"})}),e.jsx("td",{children:"localhost:8080"}),e.jsx("td",{children:"IP Address for the kronk server"})]})]})]}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`# List running models
kronk model ps`})})]}),e.jsxs("div",{className:"doc-section",id:"cmd-pull",children:[e.jsx("h4",{children:"pull"}),e.jsx("p",{className:"doc-description",children:"Pull a model from the web."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk model pull <MODEL_URL> [MMPROJ_URL] [flags]"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--local"})}),e.jsx("td",{children:"Run without the model server"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--base-path <string>"})}),e.jsx("td",{children:"Base path for kronk data (models, catalogs, templates)"})]})]})]}),e.jsx("h5",{children:"Environment Variables"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_TOKEN"})}),e.jsx("td",{}),e.jsx("td",{children:"Authentication token for the kronk server (required when auth enabled)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_WEB_API_HOST"})}),e.jsx("td",{children:"localhost:8080"}),e.jsx("td",{children:"IP Address for the kronk server (web mode)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_BASE_PATH"})}),e.jsx("td",{children:"$HOME/kronk"}),e.jsx("td",{children:"Base path for kronk data directories (local mode)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_MODELS"})}),e.jsx("td",{children:"$HOME/kronk/models"}),e.jsx("td",{children:"The path to the models directory (local mode)"})]})]})]}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`# Pull a model from a URL
kronk model pull .../model.gguf

# Pull with local mode
kronk model pull .../model.gguf --local

# Pull a vision model with mmproj file
kronk model pull <MODEL_URL> <MMPROJ_URL>`})})]}),e.jsxs("div",{className:"doc-section",id:"cmd-remove",children:[e.jsx("h4",{children:"remove"}),e.jsx("p",{className:"doc-description",children:"Remove a model."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk model remove <MODEL_NAME> [flags]"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--local"})}),e.jsx("td",{children:"Run without the model server"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--base-path <string>"})}),e.jsx("td",{children:"Base path for kronk data (models, catalogs, templates)"})]})]})]}),e.jsx("h5",{children:"Environment Variables"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_TOKEN"})}),e.jsx("td",{}),e.jsx("td",{children:"Authentication token for the kronk server (required when auth enabled)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_WEB_API_HOST"})}),e.jsx("td",{children:"localhost:8080"}),e.jsx("td",{children:"IP Address for the kronk server (web mode)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_BASE_PATH"})}),e.jsx("td",{children:"$HOME/kronk"}),e.jsx("td",{children:"Base path for kronk data directories (local mode)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_MODELS"})}),e.jsx("td",{children:"$HOME/kronk/models"}),e.jsx("td",{children:"The path to the models directory (local mode)"})]})]})]}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`# Remove a model
kronk model remove llama-3.2-1b-q4

# Remove with local mode
kronk model remove llama-3.2-1b-q4 --local`})})]}),e.jsxs("div",{className:"doc-section",id:"cmd-show",children:[e.jsx("h4",{children:"show"}),e.jsx("p",{className:"doc-description",children:"Show information for a model."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk model show <MODEL_NAME> [flags]"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--local"})}),e.jsx("td",{children:"Run without the model server"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--base-path <string>"})}),e.jsx("td",{children:"Base path for kronk data (models, catalogs, templates)"})]})]})]}),e.jsx("h5",{children:"Environment Variables"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_TOKEN"})}),e.jsx("td",{}),e.jsx("td",{children:"Authentication token for the kronk server (required when auth enabled)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_WEB_API_HOST"})}),e.jsx("td",{children:"localhost:8080"}),e.jsx("td",{children:"IP Address for the kronk server (web mode)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_BASE_PATH"})}),e.jsx("td",{children:"$HOME/kronk"}),e.jsx("td",{children:"Base path for kronk data directories (local mode)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_MODELS"})}),e.jsx("td",{children:"$HOME/kronk/models"}),e.jsx("td",{children:"The path to the models directory (local mode)"})]})]})]}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`# Show model information
kronk model show llama-3.2-1b-q4

# Show with local mode
kronk model show llama-3.2-1b-q4 --local`})})]})]})]}),e.jsx("nav",{className:"doc-sidebar",children:e.jsxs("div",{className:"doc-sidebar-content",children:[e.jsx("div",{className:"doc-index-section",children:e.jsx("a",{href:"#usage",className:"doc-index-header",children:"Usage"})}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#subcommands",className:"doc-index-header",children:"Subcommands"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#cmd-index",children:"index"})}),e.jsx("li",{children:e.jsx("a",{href:"#cmd-list",children:"list"})}),e.jsx("li",{children:e.jsx("a",{href:"#cmd-ps",children:"ps"})}),e.jsx("li",{children:e.jsx("a",{href:"#cmd-pull",children:"pull"})}),e.jsx("li",{children:e.jsx("a",{href:"#cmd-remove",children:"remove"})}),e.jsx("li",{children:e.jsx("a",{href:"#cmd-show",children:"show"})})]})]})]})})]})]})}function zP(){return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"run"}),e.jsx("p",{children:"Run an interactive chat session with a model."})]}),e.jsxs("div",{className:"doc-layout",children:[e.jsxs("div",{className:"doc-content",children:[e.jsxs("div",{className:"card",id:"usage",children:[e.jsx("h3",{children:"Usage"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk run <MODEL_NAME> [flags]"})})]}),e.jsxs("div",{className:"card",id:"subcommands",children:[e.jsx("h3",{children:"Subcommands"}),e.jsxs("div",{className:"doc-section",id:"cmd-flags",children:[e.jsx("h4",{children:"flags"}),e.jsx("p",{className:"doc-description",children:"Available flags for the run command."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk run <MODEL_NAME> [flags]"})}),e.jsx("h5",{children:"Model Configuration"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--jinja-file <string>"})}),e.jsx("td",{children:"Path to a custom Jinja template file"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--context-window <int>"})}),e.jsx("td",{children:"Context window size in tokens"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--flash-attention <string>"})}),e.jsx("td",{children:"Flash attention mode (on, off, auto)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--ngpu-layers <int>"})}),e.jsx("td",{children:"Number of layers to offload to GPU (-1 = CPU only)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--cache-type-k <string>"})}),e.jsx("td",{children:"KV cache type for keys (f16, q8_0, q4_0, etc.)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--cache-type-v <string>"})}),e.jsx("td",{children:"KV cache type for values (f16, q8_0, q4_0, etc.)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--nbatch <int>"})}),e.jsx("td",{children:"Logical batch size for processing"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--nubatch <int>"})}),e.jsx("td",{children:"Physical micro-batch size for prompt ingestion"})]})]})]}),e.jsx("h5",{children:"Sampling Parameters"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--max-tokens <int>"})}),e.jsx("td",{children:"Maximum tokens for response"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--temperature <float>"})}),e.jsx("td",{children:"Temperature for sampling"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--top-p <float>"})}),e.jsx("td",{children:"Top-p for sampling"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--top-k <int>"})}),e.jsx("td",{children:"Top-k for sampling"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--min-p <float>"})}),e.jsx("td",{children:"Min-p for sampling"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--repeat-penalty <float>"})}),e.jsx("td",{children:"Repetition penalty"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--frequency-penalty <float>"})}),e.jsx("td",{children:"Frequency penalty"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--presence-penalty <float>"})}),e.jsx("td",{children:"Presence penalty"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--enable-thinking <string>"})}),e.jsx("td",{children:"Enable thinking/reasoning (true, false)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--reasoning-effort <string>"})}),e.jsx("td",{children:"Reasoning effort level (low, medium, high)"})]})]})]}),e.jsx("h5",{children:"General"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--base-path <string>"})}),e.jsx("td",{children:"Base path for kronk data (models, catalogs, templates)"})]})})]}),e.jsx("h5",{children:"Environment Variables"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_BASE_PATH"})}),e.jsx("td",{children:"$HOME/kronk"}),e.jsx("td",{children:"Base path for kronk data directories"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_MODELS"})}),e.jsx("td",{children:"$HOME/kronk/models"}),e.jsx("td",{children:"The path to the models directory"})]})]})]}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`# Start an interactive chat with a model
kronk run Qwen3-8B-Q8_0

# Run with a custom Jinja template
kronk run Qwen3-8B-Q8_0 --jinja-file /path/to/template.jinja

# Run with custom context window and flash attention
kronk run Qwen3-8B-Q8_0 --context-window 16384 --flash-attention auto

# Run with custom sampling parameters
kronk run Qwen3-8B-Q8_0 --temperature 0.5 --top-p 0.95

# Run with thinking enabled
kronk run Qwen3-8B-Q8_0 --enable-thinking true --reasoning-effort high

# Run with higher token limit
kronk run Qwen3-8B-Q8_0 --max-tokens 4096`})})]})]})]}),e.jsx("nav",{className:"doc-sidebar",children:e.jsxs("div",{className:"doc-sidebar-content",children:[e.jsx("div",{className:"doc-index-section",children:e.jsx("a",{href:"#usage",className:"doc-index-header",children:"Usage"})}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#subcommands",className:"doc-index-header",children:"Subcommands"}),e.jsx("ul",{children:e.jsx("li",{children:e.jsx("a",{href:"#cmd-flags",children:"flags"})})})]})]})})]})]})}function GP(){return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"security"}),e.jsx("p",{children:"Manage security - tokens and access control."})]}),e.jsxs("div",{className:"doc-layout",children:[e.jsxs("div",{className:"doc-content",children:[e.jsxs("div",{className:"card",id:"usage",children:[e.jsx("h3",{children:"Usage"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk security <command> [flags]"})})]}),e.jsxs("div",{className:"card",id:"subcommands",children:[e.jsx("h3",{children:"Subcommands"}),e.jsxs("div",{className:"doc-section",id:"cmd-key",children:[e.jsx("h4",{children:"key"}),e.jsx("p",{className:"doc-description",children:"Manage private keys - create and delete private keys."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk security key <command> [flags]"})}),e.jsxs("div",{className:"doc-section",id:"cmd-key-create",children:[e.jsx("h4",{children:"create"}),e.jsx("p",{className:"doc-description",children:"Create a new private key and add it to the keystore."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk security key create [flags]"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--local"})}),e.jsx("td",{children:"Run without the model server"})]})})]}),e.jsx("h5",{children:"Environment Variables"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_TOKEN"})}),e.jsx("td",{}),e.jsx("td",{children:"Admin token (required when auth enabled)"})]})})]}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`# Create a new private key
export KRONK_TOKEN=<admin-token>
kronk security key create`})})]}),e.jsxs("div",{className:"doc-section",id:"cmd-key-delete",children:[e.jsx("h4",{children:"delete"}),e.jsx("p",{className:"doc-description",children:"Delete a private key by its key ID."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk security key delete --keyid <KEY_ID> [flags]"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--keyid <string>"})}),e.jsx("td",{children:"The key ID to delete (required)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--local"})}),e.jsx("td",{children:"Run without the model server"})]})]})]}),e.jsx("h5",{children:"Environment Variables"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_TOKEN"})}),e.jsx("td",{}),e.jsx("td",{children:"Admin token (required when auth enabled)"})]})})]}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`# Delete a private key
export KRONK_TOKEN=<admin-token>
kronk security key delete --keyid abc123`})})]}),e.jsxs("div",{className:"doc-section",id:"cmd-key-list",children:[e.jsx("h4",{children:"list"}),e.jsx("p",{className:"doc-description",children:"List all private keys in the system."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk security key list [flags]"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--local"})}),e.jsx("td",{children:"Run without the model server"})]})})]}),e.jsx("h5",{children:"Environment Variables"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_TOKEN"})}),e.jsx("td",{}),e.jsx("td",{children:"Admin token (required when auth enabled)"})]})})]}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`# List all private keys
export KRONK_TOKEN=<admin-token>
kronk security key list`})})]})]}),e.jsxs("div",{className:"doc-section",id:"cmd-token",children:[e.jsx("h4",{children:"token"}),e.jsx("p",{className:"doc-description",children:"Manage tokens - create and manage security tokens."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk security token <command> [flags]"})}),e.jsxs("div",{className:"doc-section",id:"cmd-token-create",children:[e.jsx("h4",{children:"create"}),e.jsx("p",{className:"doc-description",children:"Create a security token."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk security token create [flags]"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--local"})}),e.jsx("td",{children:"Run without the model server"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--duration <duration>"})}),e.jsx("td",{children:"Token duration (e.g., 1h, 24h, 720h)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--endpoints <list>"})}),e.jsx("td",{children:"Endpoints with optional rate limits"})]})]})]}),e.jsx("h5",{children:"Environment Variables"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_TOKEN"})}),e.jsx("td",{}),e.jsx("td",{children:"Admin token (required when auth enabled)"})]})})]}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`# Create a token with 24 hour duration
export KRONK_TOKEN=<admin-token>
kronk security token create --duration 24h --endpoints chat-completions,embeddings

# Create a token with rate limits
kronk security token create --duration 720h --endpoints "chat-completions:1000/day,embeddings:unlimited"`})})]})]})]})]}),e.jsx("nav",{className:"doc-sidebar",children:e.jsxs("div",{className:"doc-sidebar-content",children:[e.jsx("div",{className:"doc-index-section",children:e.jsx("a",{href:"#usage",className:"doc-index-header",children:"Usage"})}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#subcommands",className:"doc-index-header",children:"Subcommands"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#cmd-key",children:"key"})}),e.jsx("li",{children:e.jsx("a",{href:"#cmd-key-create",children:"create"})}),e.jsx("li",{children:e.jsx("a",{href:"#cmd-key-delete",children:"delete"})}),e.jsx("li",{children:e.jsx("a",{href:"#cmd-key-list",children:"list"})}),e.jsx("li",{children:e.jsx("a",{href:"#cmd-token",children:"token"})}),e.jsx("li",{children:e.jsx("a",{href:"#cmd-token-create",children:"create"})})]})]})]})})]})]})}function VP(){return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"server"}),e.jsx("p",{children:"Manage model server - start, stop, logs."})]}),e.jsxs("div",{className:"doc-layout",children:[e.jsxs("div",{className:"doc-content",children:[e.jsxs("div",{className:"card",id:"usage",children:[e.jsx("h3",{children:"Usage"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk server <command> [flags]"})})]}),e.jsxs("div",{className:"card",id:"subcommands",children:[e.jsx("h3",{children:"Subcommands"}),e.jsxs("div",{className:"doc-section",id:"cmd-start",children:[e.jsx("h4",{children:"start"}),e.jsx("p",{className:"doc-description",children:"Start Kronk model server."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk server start [flags]"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"-d, --detach"})}),e.jsx("td",{children:"Run server in the background"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--api-host <string>"})}),e.jsx("td",{children:"API host address (e.g., localhost:8080)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--debug-host <string>"})}),e.jsx("td",{children:"Debug host address (e.g., localhost:8090)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--auth-enabled"})}),e.jsx("td",{children:"Enable local authentication"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--device <string>"})}),e.jsx("td",{children:"Device to use for inference (e.g., cuda, metal)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--max-instances <int>"})}),e.jsx("td",{children:"Maximum model instances"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--models-in-cache <int>"})}),e.jsx("td",{children:"Maximum models in cache"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--cache-ttl <duration>"})}),e.jsx("td",{children:"Cache TTL duration (e.g., 5m, 1h)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--model-config-file <string>"})}),e.jsx("td",{children:"Special config file for model specific config"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--llama-log <int>"})}),e.jsx("td",{children:"Llama log level (0=off, 1=on)"})]})]})]}),e.jsx("h5",{children:"Environment Variables"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_BASE_PATH"})}),e.jsx("td",{children:"$HOME/kronk"}),e.jsx("td",{children:"Base path for kronk data directories"})]})})]}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`# Start the server in foreground
kronk server start

# Start the server in background
kronk server start -d

# View all server environment settings
kronk server start --help`})})]}),e.jsxs("div",{className:"doc-section",id:"cmd-stop",children:[e.jsx("h4",{children:"stop"}),e.jsx("p",{className:"doc-description",children:"Stop the Kronk model server by sending SIGTERM."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk server stop"})}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`# Stop the server
kronk server stop`})})]}),e.jsxs("div",{className:"doc-section",id:"cmd-logs",children:[e.jsx("h4",{children:"logs"}),e.jsx("p",{className:"doc-description",children:"Stream the Kronk model server logs (tail -f)."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"kronk server logs"})}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`# Stream server logs
kronk server logs`})})]})]})]}),e.jsx("nav",{className:"doc-sidebar",children:e.jsxs("div",{className:"doc-sidebar-content",children:[e.jsx("div",{className:"doc-index-section",children:e.jsx("a",{href:"#usage",className:"doc-index-header",children:"Usage"})}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#subcommands",className:"doc-index-header",children:"Subcommands"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#cmd-start",children:"start"})}),e.jsx("li",{children:e.jsx("a",{href:"#cmd-stop",children:"stop"})}),e.jsx("li",{children:e.jsx("a",{href:"#cmd-logs",children:"logs"})})]})]})]})})]})]})}function HP(){return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"Chat Completions API"}),e.jsx("p",{children:"Generate chat completions using language models. Compatible with the OpenAI Chat Completions API."})]}),e.jsxs("div",{className:"doc-layout",children:[e.jsxs("div",{className:"doc-content",children:[e.jsxs("div",{className:"card",id:"overview",children:[e.jsx("h3",{children:"Overview"}),e.jsxs("p",{children:["All endpoints are prefixed with ",e.jsx("code",{children:"/v1"}),". Base URL: ",e.jsx("code",{children:"http://localhost:8080"})]}),e.jsx("h4",{children:"Authentication"}),e.jsx("p",{children:"When authentication is enabled, include the token in the Authorization header:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"Authorization: Bearer YOUR_TOKEN"})})]}),e.jsxs("div",{className:"card",id:"chat-completions",children:[e.jsx("h3",{children:"Chat Completions"}),e.jsx("p",{children:"Create chat completions with language models."}),e.jsxs("div",{className:"doc-section",id:"chat-completions-post--chat-completions",children:[e.jsxs("h4",{children:[e.jsx("span",{className:"method-post",children:"POST"})," /chat/completions"]}),e.jsx("p",{className:"doc-description",children:"Create a chat completion. Supports streaming responses."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Authentication:"})," Required when auth is enabled. Token must have 'chat-completions' endpoint access."]}),e.jsx("h5",{children:"Headers"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Header"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Authorization"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Bearer token for authentication"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Content-Type"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Must be application/json"})]})]})]}),e.jsx("h5",{children:"Request Body"}),e.jsx("p",{children:e.jsx("code",{children:"application/json"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Field"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"model"})}),e.jsx("td",{children:e.jsx("code",{children:"string"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Model ID to use for completion (e.g., 'qwen3-8b-q8_0')"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"messages"})}),e.jsx("td",{children:e.jsx("code",{children:"array"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Array of message objects. See Message Formats section below for supported formats."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"stream"})}),e.jsx("td",{children:e.jsx("code",{children:"boolean"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Enable streaming responses (default: false)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"tools"})}),e.jsx("td",{children:e.jsx("code",{children:"array"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Array of tool definitions for function calling. See Tool Definitions section below."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"temperature"})}),e.jsx("td",{children:e.jsx("code",{children:"float32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Controls randomness of output by rescaling probability distribution"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"top_k"})}),e.jsx("td",{children:e.jsx("code",{children:"int32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Limits token pool to K most probable tokens"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"top_p"})}),e.jsx("td",{children:e.jsx("code",{children:"float32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Nucleus sampling - selects tokens whose cumulative probability exceeds threshold"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"min_p"})}),e.jsx("td",{children:e.jsx("code",{children:"float32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Dynamic sampling threshold balancing coherence and diversity"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"max_tokens"})}),e.jsx("td",{children:e.jsx("code",{children:"int"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Maximum output tokens to generate"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"repeat_penalty"})}),e.jsx("td",{children:e.jsx("code",{children:"float32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Penalty for repeated tokens to reduce repetitive text"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"repeat_last_n"})}),e.jsx("td",{children:e.jsx("code",{children:"int32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Number of recent tokens to consider for repetition penalty"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"dry_multiplier"})}),e.jsx("td",{children:e.jsx("code",{children:"float32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"DRY sampler multiplier for n-gram repetition penalty (0 = disabled)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"dry_base"})}),e.jsx("td",{children:e.jsx("code",{children:"float32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Base for exponential penalty growth in DRY"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"dry_allowed_length"})}),e.jsx("td",{children:e.jsx("code",{children:"int32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Minimum n-gram length before DRY applies"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"dry_penalty_last_n"})}),e.jsx("td",{children:e.jsx("code",{children:"int32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Number of recent tokens DRY considers (0 = full context)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"xtc_probability"})}),e.jsx("td",{children:e.jsx("code",{children:"float32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"XTC probability for extreme token culling (0 = disabled)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"xtc_threshold"})}),e.jsx("td",{children:e.jsx("code",{children:"float32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Probability threshold for XTC culling"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"xtc_min_keep"})}),e.jsx("td",{children:e.jsx("code",{children:"uint32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Minimum tokens to keep after XTC culling"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"enable_thinking"})}),e.jsx("td",{children:e.jsx("code",{children:"string"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Enable model thinking/reasoning for non-GPT models"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"reasoning_effort"})}),e.jsx("td",{children:e.jsx("code",{children:"string"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Reasoning level for GPT models: none, minimal, low, medium, high"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"return_prompt"})}),e.jsx("td",{children:e.jsx("code",{children:"bool"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Include the prompt in the final response"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"include_usage"})}),e.jsx("td",{children:e.jsx("code",{children:"bool"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Include token usage information in streaming responses"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"logprobs"})}),e.jsx("td",{children:e.jsx("code",{children:"bool"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Return log probabilities of output tokens"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"top_logprobs"})}),e.jsx("td",{children:e.jsx("code",{children:"int"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Number of most likely tokens to return at each position (0-5)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"stream"})}),e.jsx("td",{children:e.jsx("code",{children:"bool"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Stream response as server-sent events (SSE)"})]})]})]}),e.jsx("h5",{children:"Response"}),e.jsx("p",{children:"Returns a chat completion object, or streams Server-Sent Events if stream=true."}),e.jsx("h5",{children:"Example"}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Simple text message:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/chat/completions \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "stream": true,
    "model": "qwen3-8b-q8_0",
    "messages": [
      {
        "role": "system",
        "content": "You are a helpful assistant."
      },
      {
        "role": "user",
        "content": "Hello, how are you?"
      }
    ]
  }'`})}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Multi-turn conversation:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/chat/completions \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "stream": true,
    "model": "qwen3-8b-q8_0",
    "messages": [
      {"role": "user", "content": "What is 2+2?"},
      {"role": "assistant", "content": "2+2 equals 4."},
      {"role": "user", "content": "And what is that multiplied by 3?"}
    ]
  }'`})}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Vision - image from URL (requires vision model):"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/chat/completions \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "stream": true,
    "model": "qwen2.5-vl-3b-instruct-q8_0",
    "messages": [
      {
        "role": "user",
        "content": [
          {"type": "text", "text": "What is in this image?"},
          {"type": "image_url", "image_url": {"url": "https://example.com/image.jpg"}}
        ]
      }
    ]
  }'`})}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Vision - base64 encoded image (requires vision model):"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/chat/completions \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "stream": true,
    "model": "qwen2.5-vl-3b-instruct-q8_0",
    "messages": [
      {
        "role": "user",
        "content": [
          {"type": "text", "text": "Describe this image"},
          {"type": "image_url", "image_url": {"url": "data:image/jpeg;base64,/9j/4AAQ..."}}
        ]
      }
    ]
  }'`})}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Audio - base64 encoded audio (requires audio model):"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/chat/completions \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "stream": true,
    "model": "qwen2-audio-7b-q8_0",
    "messages": [
      {
        "role": "user",
        "content": [
          {"type": "text", "text": "What is being said in this audio?"},
          {"type": "input_audio", "input_audio": {"data": "UklGRi...", "format": "wav"}}
        ]
      }
    ]
  }'`})}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Tool/Function calling - define tools and let the model call them:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/chat/completions \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "stream": true,
    "model": "qwen3-8b-q8_0",
    "messages": [
      {"role": "user", "content": "What is the weather in Tokyo?"}
    ],
    "tools": [
      {
        "type": "function",
        "function": {
          "name": "get_weather",
          "description": "Get the current weather for a location",
          "parameters": {
            "type": "object",
            "properties": {
              "location": {
                "type": "string",
                "description": "The location to get the weather for, e.g. San Francisco, CA"
              }
            },
            "required": ["location"]
          }
        }
      }
    ]
  }'`})})]})]}),e.jsxs("div",{className:"card",id:"response-formats",children:[e.jsx("h3",{children:"Response Formats"}),e.jsx("p",{children:"The response format differs between streaming and non-streaming requests."}),e.jsxs("div",{className:"doc-section",id:"response-formats--non-streaming-response",children:[e.jsx("h4",{children:"Non-Streaming Response"}),e.jsx("p",{className:"doc-description",children:"For non-streaming requests (stream=false or omitted), the response uses the 'message' field in each choice. The 'delta' field is empty."}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`{
  "id": "chatcmpl-abc123",
  "object": "chat.completion",
  "created": 1234567890,
  "model": "qwen3-8b-q8_0",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "Hello! I'm doing well, thank you for asking.",
        "reasoning": ""
      },
      "finish_reason": "stop"
    }
  ],
  "usage": {
    "prompt_tokens": 25,
    "reasoning_tokens": 0,
    "completion_tokens": 12,
    "output_tokens": 12,
    "total_tokens": 37,
    "tokens_per_second": 85.5
  }
}`})})]}),e.jsxs("div",{className:"doc-section",id:"response-formats--streaming-response",children:[e.jsx("h4",{children:"Streaming Response"}),e.jsx("p",{className:"doc-description",children:"For streaming requests (stream=true), the response uses the 'delta' field in each choice. Multiple chunks are sent as Server-Sent Events, with incremental content in each delta."}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`// Each chunk contains partial content in the delta field
data: {"id":"chatcmpl-abc123","choices":[{"index":0,"delta":{"role":"assistant","content":"Hello"},"finish_reason":""}]}
data: {"id":"chatcmpl-abc123","choices":[{"index":0,"delta":{"content":"!"},"finish_reason":""}]}
data: {"id":"chatcmpl-abc123","choices":[{"index":0,"delta":{"content":" How"},"finish_reason":""}]}
data: {"id":"chatcmpl-abc123","choices":[{"index":0,"delta":{"content":" are you?"},"finish_reason":""}]}
data: {"id":"chatcmpl-abc123","choices":[{"index":0,"delta":{},"finish_reason":"stop"}],"usage":{...}}
data: [DONE]`})})]})]}),e.jsxs("div",{className:"card",id:"message-formats",children:[e.jsx("h3",{children:"Message Formats"}),e.jsx("p",{children:"The messages array supports several formats depending on the content type and model capabilities."}),e.jsxs("div",{className:"doc-section",id:"message-formats--text-messages",children:[e.jsx("h4",{children:"Text Messages"}),e.jsx("p",{className:"doc-description",children:"Simple text content with role (system, user, or assistant) and content string."}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`{
  "role": "system",
  "content": "You are a helpful assistant."
}

{
  "role": "user",
  "content": "Hello, how are you?"
}

{
  "role": "assistant",
  "content": "I'm doing well, thank you!"
}`})})]}),e.jsxs("div",{className:"doc-section",id:"message-formats--multi-part-content-(vision)",children:[e.jsx("h4",{children:"Multi-part Content (Vision)"}),e.jsx("p",{className:"doc-description",children:"For vision models, content can be an array with text and image parts. Images can be URLs or base64-encoded data URIs."}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`{
  "role": "user",
  "content": [
    {"type": "text", "text": "What is in this image?"},
    {"type": "image_url", "image_url": {"url": "https://example.com/image.jpg"}}
  ]
}

// Base64 encoded image
{
  "role": "user",
  "content": [
    {"type": "text", "text": "Describe this image"},
    {"type": "image_url", "image_url": {"url": "data:image/jpeg;base64,/9j/4AAQ..."}}
  ]
}`})})]}),e.jsxs("div",{className:"doc-section",id:"message-formats--audio-content",children:[e.jsx("h4",{children:"Audio Content"}),e.jsx("p",{className:"doc-description",children:"For audio models, content can include audio data as base64-encoded input with format specification."}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`{
  "role": "user",
  "content": [
    {"type": "text", "text": "What is being said?"},
    {"type": "input_audio", "input_audio": {"data": "UklGRi...", "format": "wav"}}
  ]
}`})})]}),e.jsxs("div",{className:"doc-section",id:"message-formats--tool-definitions",children:[e.jsx("h4",{children:"Tool Definitions"}),e.jsx("p",{className:"doc-description",children:"Tools are defined in the 'tools' array field of the request (not in messages). Each tool specifies a function with name, description, and parameters schema."}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`// Tools are defined at the request level
{
  "model": "qwen3-8b-q8_0",
  "messages": [...],
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "get_weather",
        "description": "Get the current weather for a location",
        "parameters": {
          "type": "object",
          "properties": {
            "location": {
              "type": "string",
              "description": "The location to get the weather for, e.g. San Francisco, CA"
            }
          },
          "required": ["location"]
        }
      }
    }
  ]
}`})})]}),e.jsxs("div",{className:"doc-section",id:"message-formats--tool-call-response-(non-streaming)",children:[e.jsx("h4",{children:"Tool Call Response (Non-Streaming)"}),e.jsx("p",{className:"doc-description",children:"For non-streaming requests (stream=false), when the model calls a tool, the response uses the 'message' field with 'tool_calls' array. The finish_reason is 'tool_calls'."}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`{
  "id": "chatcmpl-abc123",
  "object": "chat.completion",
  "created": 1234567890,
  "model": "qwen3-8b-q8_0",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "",
        "tool_calls": [
          {
            "id": "call_xyz789",
            "index": 0,
            "type": "function",
            "function": {
              "name": "get_weather",
              "arguments": "{\\"location\\":\\"Tokyo\\"}"
            }
          }
        ]
      },
      "finish_reason": "tool_calls"
    }
  ],
  "usage": {
    "prompt_tokens": 50,
    "completion_tokens": 25,
    "total_tokens": 75
  }
}`})})]}),e.jsxs("div",{className:"doc-section",id:"message-formats--tool-call-response-(streaming)",children:[e.jsx("h4",{children:"Tool Call Response (Streaming)"}),e.jsx("p",{className:"doc-description",children:"For streaming requests (stream=true), tool calls are returned in the 'delta' field. Each chunk contains partial tool call data that should be accumulated."}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`// Streaming chunks with tool calls use delta instead of message
data: {"id":"chatcmpl-abc123","choices":[{"index":0,"delta":{"role":"assistant","tool_calls":[{"id":"call_xyz789","index":0,"type":"function","function":{"name":"get_weather","arguments":""}}]},"finish_reason":""}]}
data: {"id":"chatcmpl-abc123","choices":[{"index":0,"delta":{"tool_calls":[{"index":0,"function":{"arguments":"{\\"location\\":"}}]},"finish_reason":""}]}
data: {"id":"chatcmpl-abc123","choices":[{"index":0,"delta":{"tool_calls":[{"index":0,"function":{"arguments":"\\"Tokyo\\"}"}}]},"finish_reason":""}]}
data: {"id":"chatcmpl-abc123","choices":[{"index":0,"delta":{},"finish_reason":"tool_calls"}],"usage":{...}}
data: [DONE]`})})]})]})]}),e.jsx("nav",{className:"doc-sidebar",children:e.jsxs("div",{className:"doc-sidebar-content",children:[e.jsx("div",{className:"doc-index-section",children:e.jsx("a",{href:"#overview",className:"doc-index-header",children:"Overview"})}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#chat-completions",className:"doc-index-header",children:"Chat Completions"}),e.jsx("ul",{children:e.jsx("li",{children:e.jsx("a",{href:"#chat-completions-post--chat-completions",children:"POST /chat/completions"})})})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#response-formats",className:"doc-index-header",children:"Response Formats"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#response-formats--non-streaming-response",children:"Non-Streaming Response"})}),e.jsx("li",{children:e.jsx("a",{href:"#response-formats--streaming-response",children:"Streaming Response"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#message-formats",className:"doc-index-header",children:"Message Formats"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#message-formats--text-messages",children:"Text Messages"})}),e.jsx("li",{children:e.jsx("a",{href:"#message-formats--multi-part-content-(vision)",children:"Multi-part Content (Vision)"})}),e.jsx("li",{children:e.jsx("a",{href:"#message-formats--audio-content",children:"Audio Content"})}),e.jsx("li",{children:e.jsx("a",{href:"#message-formats--tool-definitions",children:"Tool Definitions"})}),e.jsx("li",{children:e.jsx("a",{href:"#message-formats--tool-call-response-(non-streaming)",children:"Tool Call Response (Non-Streaming)"})}),e.jsx("li",{children:e.jsx("a",{href:"#message-formats--tool-call-response-(streaming)",children:"Tool Call Response (Streaming)"})})]})]})]})})]})]})}function $P(){return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"Messages API"}),e.jsx("p",{children:"Generate messages using language models. Compatible with the Anthropic Messages API."})]}),e.jsxs("div",{className:"doc-layout",children:[e.jsxs("div",{className:"doc-content",children:[e.jsxs("div",{className:"card",id:"overview",children:[e.jsx("h3",{children:"Overview"}),e.jsxs("p",{children:["All endpoints are prefixed with ",e.jsx("code",{children:"/v1"}),". Base URL: ",e.jsx("code",{children:"http://localhost:8080"})]}),e.jsx("h4",{children:"Authentication"}),e.jsx("p",{children:"When authentication is enabled, include the token in the Authorization header:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"Authorization: Bearer YOUR_TOKEN"})})]}),e.jsxs("div",{className:"card",id:"messages",children:[e.jsx("h3",{children:"Messages"}),e.jsx("p",{children:"Create messages with language models using the Anthropic Messages API format."}),e.jsxs("div",{className:"doc-section",id:"messages-post--messages",children:[e.jsxs("h4",{children:[e.jsx("span",{className:"method-post",children:"POST"})," /messages"]}),e.jsx("p",{className:"doc-description",children:"Create a message. Supports streaming responses with Server-Sent Events using Anthropic's event format."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Authentication:"})," Required when auth is enabled. Token must have 'messages' endpoint access."]}),e.jsx("h5",{children:"Headers"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Header"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Authorization"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Bearer token for authentication"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Content-Type"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Must be application/json"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"anthropic-version"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"API version (optional)"})]})]})]}),e.jsx("h5",{children:"Request Body"}),e.jsx("p",{children:e.jsx("code",{children:"application/json"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Field"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"model"})}),e.jsx("td",{children:e.jsx("code",{children:"string"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"ID of the model to use"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"messages"})}),e.jsx("td",{children:e.jsx("code",{children:"array"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Array of message objects with role (user/assistant) and content"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"max_tokens"})}),e.jsx("td",{children:e.jsx("code",{children:"integer"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Maximum number of tokens to generate"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"system"})}),e.jsx("td",{children:e.jsx("code",{children:"string|array"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"System prompt as string or array of content blocks"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"stream"})}),e.jsx("td",{children:e.jsx("code",{children:"boolean"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Enable streaming responses (default: false)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"tools"})}),e.jsx("td",{children:e.jsx("code",{children:"array"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"List of tools the model can use"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"temperature"})}),e.jsx("td",{children:e.jsx("code",{children:"number"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Sampling temperature (0-1)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"top_p"})}),e.jsx("td",{children:e.jsx("code",{children:"number"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Nucleus sampling parameter"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"top_k"})}),e.jsx("td",{children:e.jsx("code",{children:"integer"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Top-k sampling parameter"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"stop_sequences"})}),e.jsx("td",{children:e.jsx("code",{children:"array"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Sequences where the API will stop generating"})]})]})]}),e.jsx("h5",{children:"Response"}),e.jsx("p",{children:"Returns a message object, or streams Server-Sent Events if stream=true. Response includes anthropic-request-id header."}),e.jsx("h5",{children:"Example"}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Basic message:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/messages \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "qwen3-8b-q8_0",
    "max_tokens": 1024,
    "messages": [
      {"role": "user", "content": "Hello, how are you?"}
    ]
  }'`})}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"With system prompt:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/messages \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "qwen3-8b-q8_0",
    "max_tokens": 1024,
    "system": "You are a helpful assistant.",
    "messages": [
      {"role": "user", "content": "What is the capital of France?"}
    ]
  }'`})}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Streaming response:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/messages \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "qwen3-8b-q8_0",
    "max_tokens": 1024,
    "stream": true,
    "messages": [
      {"role": "user", "content": "Write a haiku about coding"}
    ]
  }'`})}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Multi-turn conversation:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/messages \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "qwen3-8b-q8_0",
    "max_tokens": 1024,
    "messages": [
      {"role": "user", "content": "What is 2+2?"},
      {"role": "assistant", "content": "2+2 equals 4."},
      {"role": "user", "content": "What about 2+3?"}
    ]
  }'`})}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Vision with image URL (requires vision model):"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/messages \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "qwen2.5-vl-3b-instruct-q8_0",
    "max_tokens": 1024,
    "messages": [
      {
        "role": "user",
        "content": [
          {"type": "text", "text": "What is in this image?"},
          {"type": "image", "source": {"type": "url", "url": "https://example.com/image.jpg"}}
        ]
      }
    ]
  }'`})}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Vision with base64 image (requires vision model):"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/messages \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "qwen2.5-vl-3b-instruct-q8_0",
    "max_tokens": 1024,
    "messages": [
      {
        "role": "user",
        "content": [
          {"type": "text", "text": "Describe this image"},
          {
            "type": "image",
            "source": {
              "type": "base64",
              "media_type": "image/jpeg",
              "data": "/9j/4AAQ..."
            }
          }
        ]
      }
    ]
  }'`})}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Tool calling:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/messages \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "qwen3-8b-q8_0",
    "max_tokens": 1024,
    "messages": [
      {"role": "user", "content": "What is the weather in Paris?"}
    ],
    "tools": [
      {
        "name": "get_weather",
        "description": "Get the current weather for a location",
        "input_schema": {
          "type": "object",
          "properties": {
            "location": {
              "type": "string",
              "description": "City name"
            }
          },
          "required": ["location"]
        }
      }
    ]
  }'`})}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Tool result (continue conversation after tool call):"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/messages \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "qwen3-8b-q8_0",
    "max_tokens": 1024,
    "messages": [
      {"role": "user", "content": "What is the weather in Paris?"},
      {
        "role": "assistant",
        "content": [
          {
            "type": "tool_use",
            "id": "call_xyz789",
            "name": "get_weather",
            "input": {"location": "Paris"}
          }
        ]
      },
      {
        "role": "user",
        "content": [
          {
            "type": "tool_result",
            "tool_use_id": "call_xyz789",
            "content": "Sunny, 22C"
          }
        ]
      }
    ],
    "tools": [
      {
        "name": "get_weather",
        "description": "Get the current weather for a location",
        "input_schema": {
          "type": "object",
          "properties": {
            "location": {"type": "string"}
          },
          "required": ["location"]
        }
      }
    ]
  }'`})})]})]}),e.jsxs("div",{className:"card",id:"response-formats",children:[e.jsx("h3",{children:"Response Formats"}),e.jsx("p",{children:"The Messages API returns different formats for streaming and non-streaming responses."}),e.jsxs("div",{className:"doc-section",id:"response-formats--non-streaming-response",children:[e.jsx("h4",{children:"Non-Streaming Response"}),e.jsx("p",{className:"doc-description",children:"For non-streaming requests (stream=false or omitted), returns a complete message object."}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`{
  "id": "msg_abc123",
  "type": "message",
  "role": "assistant",
  "content": [
    {
      "type": "text",
      "text": "Hello! I'm doing well, thank you for asking. How can I help you today?"
    }
  ],
  "model": "qwen3-8b-q8_0",
  "stop_reason": "end_turn",
  "usage": {
    "input_tokens": 12,
    "output_tokens": 18
  }
}`})})]}),e.jsxs("div",{className:"doc-section",id:"response-formats--tool-use-response",children:[e.jsx("h4",{children:"Tool Use Response"}),e.jsx("p",{className:"doc-description",children:"When the model calls a tool, the content includes tool_use blocks with the tool call details."}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`{
  "id": "msg_abc123",
  "type": "message",
  "role": "assistant",
  "content": [
    {
      "type": "tool_use",
      "id": "call_xyz789",
      "name": "get_weather",
      "input": {
        "location": "Paris"
      }
    }
  ],
  "model": "qwen3-8b-q8_0",
  "stop_reason": "tool_use",
  "usage": {
    "input_tokens": 50,
    "output_tokens": 25
  }
}`})})]}),e.jsxs("div",{className:"doc-section",id:"response-formats--streaming-events",children:[e.jsx("h4",{children:"Streaming Events"}),e.jsx("p",{className:"doc-description",children:"For streaming requests (stream=true), the API returns Server-Sent Events with different event types following Anthropic's streaming format."}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`event: message_start
data: {"type":"message_start","message":{"id":"msg_abc123","type":"message","role":"assistant","content":[],"model":"qwen3-8b-q8_0","stop_reason":null,"usage":{"input_tokens":12,"output_tokens":0}}}

event: content_block_start
data: {"type":"content_block_start","index":0,"content_block":{"type":"text","text":""}}

event: content_block_delta
data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":"Hello"}}

event: content_block_delta
data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":"!"}}

event: content_block_stop
data: {"type":"content_block_stop","index":0}

event: message_delta
data: {"type":"message_delta","delta":{"stop_reason":"end_turn"},"usage":{"output_tokens":18}}

event: message_stop
data: {"type":"message_stop"}`})})]}),e.jsxs("div",{className:"doc-section",id:"response-formats--streaming-tool-calls",children:[e.jsx("h4",{children:"Streaming Tool Calls"}),e.jsx("p",{className:"doc-description",children:"When streaming tool calls, input_json_delta events provide incremental JSON for tool arguments."}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`event: message_start
data: {"type":"message_start","message":{...}}

event: content_block_start
data: {"type":"content_block_start","index":0,"content_block":{"type":"tool_use","id":"call_xyz789","name":"get_weather","input":{}}}

event: content_block_delta
data: {"type":"content_block_delta","index":0,"delta":{"type":"input_json_delta","partial_json":"{\\"location\\":"}}

event: content_block_delta
data: {"type":"content_block_delta","index":0,"delta":{"type":"input_json_delta","partial_json":"\\"Paris\\"}"}}

event: content_block_stop
data: {"type":"content_block_stop","index":0}

event: message_delta
data: {"type":"message_delta","delta":{"stop_reason":"tool_use"},"usage":{"output_tokens":25}}

event: message_stop
data: {"type":"message_stop"}`})})]})]})]}),e.jsx("nav",{className:"doc-sidebar",children:e.jsxs("div",{className:"doc-sidebar-content",children:[e.jsx("div",{className:"doc-index-section",children:e.jsx("a",{href:"#overview",className:"doc-index-header",children:"Overview"})}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#messages",className:"doc-index-header",children:"Messages"}),e.jsx("ul",{children:e.jsx("li",{children:e.jsx("a",{href:"#messages-post--messages",children:"POST /messages"})})})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#response-formats",className:"doc-index-header",children:"Response Formats"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#response-formats--non-streaming-response",children:"Non-Streaming Response"})}),e.jsx("li",{children:e.jsx("a",{href:"#response-formats--tool-use-response",children:"Tool Use Response"})}),e.jsx("li",{children:e.jsx("a",{href:"#response-formats--streaming-events",children:"Streaming Events"})}),e.jsx("li",{children:e.jsx("a",{href:"#response-formats--streaming-tool-calls",children:"Streaming Tool Calls"})})]})]})]})})]})]})}function WP(){return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"Responses API"}),e.jsx("p",{children:"Generate responses using language models. Compatible with the OpenAI Responses API."})]}),e.jsxs("div",{className:"doc-layout",children:[e.jsxs("div",{className:"doc-content",children:[e.jsxs("div",{className:"card",id:"overview",children:[e.jsx("h3",{children:"Overview"}),e.jsxs("p",{children:["All endpoints are prefixed with ",e.jsx("code",{children:"/v1"}),". Base URL: ",e.jsx("code",{children:"http://localhost:8080"})]}),e.jsx("h4",{children:"Authentication"}),e.jsx("p",{children:"When authentication is enabled, include the token in the Authorization header:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"Authorization: Bearer YOUR_TOKEN"})})]}),e.jsxs("div",{className:"card",id:"responses",children:[e.jsx("h3",{children:"Responses"}),e.jsx("p",{children:"Create responses with language models using the Responses API format."}),e.jsxs("div",{className:"doc-section",id:"responses-post--responses",children:[e.jsxs("h4",{children:[e.jsx("span",{className:"method-post",children:"POST"})," /responses"]}),e.jsx("p",{className:"doc-description",children:"Create a response. Supports streaming responses with Server-Sent Events."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Authentication:"})," Required when auth is enabled. Token must have 'responses' endpoint access."]}),e.jsx("h5",{children:"Headers"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Header"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Authorization"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Bearer token for authentication"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Content-Type"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Must be application/json"})]})]})]}),e.jsx("h5",{children:"Request Body"}),e.jsx("p",{children:e.jsx("code",{children:"application/json"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Field"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"model"})}),e.jsx("td",{children:e.jsx("code",{children:"string"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"ID of the model to use"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"input"})}),e.jsx("td",{children:e.jsx("code",{children:"array"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Array of input messages (same format as chat messages)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"stream"})}),e.jsx("td",{children:e.jsx("code",{children:"boolean"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Enable streaming responses (default: false)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"instructions"})}),e.jsx("td",{children:e.jsx("code",{children:"string"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"System instructions for the model"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"tools"})}),e.jsx("td",{children:e.jsx("code",{children:"array"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"List of tools the model can use"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"tool_choice"})}),e.jsx("td",{children:e.jsx("code",{children:"string"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"How the model should use tools: auto, none, or required"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"parallel_tool_calls"})}),e.jsx("td",{children:e.jsx("code",{children:"boolean"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Allow parallel tool calls (default: true)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"store"})}),e.jsx("td",{children:e.jsx("code",{children:"boolean"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Whether to store the response (default: true)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"truncation"})}),e.jsx("td",{children:e.jsx("code",{children:"string"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Truncation strategy: auto or disabled (default: disabled)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"temperature"})}),e.jsx("td",{children:e.jsx("code",{children:"float32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Controls randomness of output by rescaling probability distribution"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"top_k"})}),e.jsx("td",{children:e.jsx("code",{children:"int32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Limits token pool to K most probable tokens"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"top_p"})}),e.jsx("td",{children:e.jsx("code",{children:"float32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Nucleus sampling - selects tokens whose cumulative probability exceeds threshold"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"min_p"})}),e.jsx("td",{children:e.jsx("code",{children:"float32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Dynamic sampling threshold balancing coherence and diversity"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"max_tokens"})}),e.jsx("td",{children:e.jsx("code",{children:"int"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Maximum output tokens to generate"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"repeat_penalty"})}),e.jsx("td",{children:e.jsx("code",{children:"float32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Penalty for repeated tokens to reduce repetitive text"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"repeat_last_n"})}),e.jsx("td",{children:e.jsx("code",{children:"int32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Number of recent tokens to consider for repetition penalty"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"dry_multiplier"})}),e.jsx("td",{children:e.jsx("code",{children:"float32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"DRY sampler multiplier for n-gram repetition penalty (0 = disabled)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"dry_base"})}),e.jsx("td",{children:e.jsx("code",{children:"float32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Base for exponential penalty growth in DRY"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"dry_allowed_length"})}),e.jsx("td",{children:e.jsx("code",{children:"int32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Minimum n-gram length before DRY applies"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"dry_penalty_last_n"})}),e.jsx("td",{children:e.jsx("code",{children:"int32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Number of recent tokens DRY considers (0 = full context)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"xtc_probability"})}),e.jsx("td",{children:e.jsx("code",{children:"float32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"XTC probability for extreme token culling (0 = disabled)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"xtc_threshold"})}),e.jsx("td",{children:e.jsx("code",{children:"float32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Probability threshold for XTC culling"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"xtc_min_keep"})}),e.jsx("td",{children:e.jsx("code",{children:"uint32"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Minimum tokens to keep after XTC culling"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"enable_thinking"})}),e.jsx("td",{children:e.jsx("code",{children:"string"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Enable model thinking/reasoning for non-GPT models"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"reasoning_effort"})}),e.jsx("td",{children:e.jsx("code",{children:"string"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Reasoning level for GPT models: none, minimal, low, medium, high"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"return_prompt"})}),e.jsx("td",{children:e.jsx("code",{children:"bool"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Include the prompt in the final response"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"include_usage"})}),e.jsx("td",{children:e.jsx("code",{children:"bool"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Include token usage information in streaming responses"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"logprobs"})}),e.jsx("td",{children:e.jsx("code",{children:"bool"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Return log probabilities of output tokens"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"top_logprobs"})}),e.jsx("td",{children:e.jsx("code",{children:"int"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Number of most likely tokens to return at each position (0-5)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"stream"})}),e.jsx("td",{children:e.jsx("code",{children:"bool"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Stream response as server-sent events (SSE)"})]})]})]}),e.jsx("h5",{children:"Response"}),e.jsx("p",{children:"Returns a response object, or streams Server-Sent Events if stream=true."}),e.jsx("h5",{children:"Example"}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Basic response:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/responses \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "qwen3-8b-q8_0",
    "input": [
      {"role": "user", "content": "Hello, how are you?"}
    ]
  }'`})}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Streaming response:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/responses \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "qwen3-8b-q8_0",
    "input": [
      {"role": "user", "content": "Write a short poem about coding"}
    ],
    "stream": true
  }'`})}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"With tools:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/responses \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "qwen3-8b-q8_0",
    "input": [
      {"role": "user", "content": "What is the weather in London?"}
    ],
    "tools": [
      {
        "type": "function",
        "function": {
          "name": "get_weather",
          "description": "Get the current weather for a location",
          "parameters": {
            "type": "object",
            "properties": {
              "location": {"type": "string", "description": "City name"}
            },
            "required": ["location"]
          }
        }
      }
    ]
  }'`})})]})]}),e.jsxs("div",{className:"card",id:"response-format",children:[e.jsx("h3",{children:"Response Format"}),e.jsx("p",{children:"The Responses API returns a structured response object with output items."}),e.jsxs("div",{className:"doc-section",id:"response-format--response-object",children:[e.jsx("h4",{children:"Response Object"}),e.jsx("p",{className:"doc-description",children:"The response object contains metadata, output items, and usage information."}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`{
  "id": "resp_abc123",
  "object": "response",
  "created_at": 1234567890,
  "status": "completed",
  "model": "qwen3-8b-q8_0",
  "output": [
    {
      "type": "message",
      "id": "msg_xyz789",
      "status": "completed",
      "role": "assistant",
      "content": [
        {
          "type": "output_text",
          "text": "Hello! I'm doing well, thank you for asking.",
          "annotations": []
        }
      ]
    }
  ],
  "usage": {
    "input_tokens": 12,
    "output_tokens": 15,
    "total_tokens": 27
  }
}`})})]}),e.jsxs("div",{className:"doc-section",id:"response-format--streaming-events",children:[e.jsx("h4",{children:"Streaming Events"}),e.jsx("p",{className:"doc-description",children:"When stream=true, the API returns Server-Sent Events with different event types."}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`event: response.created
data: {"type":"response.created","response":{...}}

event: response.in_progress
data: {"type":"response.in_progress","response":{...}}

event: response.output_item.added
data: {"type":"response.output_item.added","item":{...}}

event: response.output_text.delta
data: {"type":"response.output_text.delta","delta":"Hello"}

event: response.output_text.done
data: {"type":"response.output_text.done","text":"Hello! How are you?"}

event: response.completed
data: {"type":"response.completed","response":{...}}`})})]}),e.jsxs("div",{className:"doc-section",id:"response-format--function-call-output",children:[e.jsx("h4",{children:"Function Call Output"}),e.jsx("p",{className:"doc-description",children:"When the model calls a tool, the output contains a function_call item instead of a message."}),e.jsx("h5",{children:"Example"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`{
  "output": [
    {
      "type": "function_call",
      "id": "fc_abc123",
      "call_id": "call_xyz789",
      "name": "get_weather",
      "arguments": "{\\"location\\":\\"London\\"}",
      "status": "completed"
    }
  ]
}`})})]})]})]}),e.jsx("nav",{className:"doc-sidebar",children:e.jsxs("div",{className:"doc-sidebar-content",children:[e.jsx("div",{className:"doc-index-section",children:e.jsx("a",{href:"#overview",className:"doc-index-header",children:"Overview"})}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#responses",className:"doc-index-header",children:"Responses"}),e.jsx("ul",{children:e.jsx("li",{children:e.jsx("a",{href:"#responses-post--responses",children:"POST /responses"})})})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#response-format",className:"doc-index-header",children:"Response Format"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#response-format--response-object",children:"Response Object"})}),e.jsx("li",{children:e.jsx("a",{href:"#response-format--streaming-events",children:"Streaming Events"})}),e.jsx("li",{children:e.jsx("a",{href:"#response-format--function-call-output",children:"Function Call Output"})})]})]})]})})]})]})}function QP(){return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"Embeddings API"}),e.jsx("p",{children:"Generate vector embeddings for text. Compatible with the OpenAI Embeddings API."})]}),e.jsxs("div",{className:"doc-layout",children:[e.jsxs("div",{className:"doc-content",children:[e.jsxs("div",{className:"card",id:"overview",children:[e.jsx("h3",{children:"Overview"}),e.jsxs("p",{children:["All endpoints are prefixed with ",e.jsx("code",{children:"/v1"}),". Base URL: ",e.jsx("code",{children:"http://localhost:8080"})]}),e.jsx("h4",{children:"Authentication"}),e.jsx("p",{children:"When authentication is enabled, include the token in the Authorization header:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"Authorization: Bearer YOUR_TOKEN"})})]}),e.jsxs("div",{className:"card",id:"embeddings",children:[e.jsx("h3",{children:"Embeddings"}),e.jsx("p",{children:"Create vector embeddings for semantic search and similarity."}),e.jsxs("div",{className:"doc-section",id:"embeddings-post--embeddings",children:[e.jsxs("h4",{children:[e.jsx("span",{className:"method-post",children:"POST"})," /embeddings"]}),e.jsx("p",{className:"doc-description",children:"Create embeddings for the given input text. The model must support embedding generation."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Authentication:"})," Required when auth is enabled. Token must have 'embeddings' endpoint access."]}),e.jsx("h5",{children:"Headers"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Header"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Authorization"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Bearer token for authentication"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Content-Type"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Must be application/json"})]})]})]}),e.jsx("h5",{children:"Request Body"}),e.jsx("p",{children:e.jsx("code",{children:"application/json"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Field"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"model"})}),e.jsx("td",{children:e.jsx("code",{children:"string"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Embedding model ID (e.g., 'embeddinggemma-300m-qat-Q8_0')"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"input"})}),e.jsx("td",{children:e.jsx("code",{children:"string|array"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Text to generate embeddings for. Can be a string or array of strings."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"dimensions"})}),e.jsx("td",{children:e.jsx("code",{children:"integer"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Reduce output to first N dimensions (for Matryoshka models). Must be <= model's native dimensions."})]})]})]}),e.jsx("h5",{children:"Response"}),e.jsx("p",{children:"Returns an embedding object with vector data."}),e.jsx("h5",{children:"Example"}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Generate embeddings for text:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/embeddings \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "embeddinggemma-300m-qat-Q8_0",
    "input": "Why is the sky blue?"
  }'`})})]})]})]}),e.jsx("nav",{className:"doc-sidebar",children:e.jsxs("div",{className:"doc-sidebar-content",children:[e.jsx("div",{className:"doc-index-section",children:e.jsx("a",{href:"#overview",className:"doc-index-header",children:"Overview"})}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#embeddings",className:"doc-index-header",children:"Embeddings"}),e.jsx("ul",{children:e.jsx("li",{children:e.jsx("a",{href:"#embeddings-post--embeddings",children:"POST /embeddings"})})})]})]})})]})]})}function YP(){return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"Rerank API"}),e.jsx("p",{children:"Rerank documents by relevance to a query. Used for semantic search result ordering."})]}),e.jsxs("div",{className:"doc-layout",children:[e.jsxs("div",{className:"doc-content",children:[e.jsxs("div",{className:"card",id:"overview",children:[e.jsx("h3",{children:"Overview"}),e.jsxs("p",{children:["All endpoints are prefixed with ",e.jsx("code",{children:"/v1"}),". Base URL: ",e.jsx("code",{children:"http://localhost:8080"})]}),e.jsx("h4",{children:"Authentication"}),e.jsx("p",{children:"When authentication is enabled, include the token in the Authorization header:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"Authorization: Bearer YOUR_TOKEN"})})]}),e.jsxs("div",{className:"card",id:"reranking",children:[e.jsx("h3",{children:"Reranking"}),e.jsx("p",{children:"Score and reorder documents by relevance to a query."}),e.jsxs("div",{className:"doc-section",id:"reranking-post--rerank",children:[e.jsxs("h4",{children:[e.jsx("span",{className:"method-post",children:"POST"})," /rerank"]}),e.jsx("p",{className:"doc-description",children:"Rerank documents by their relevance to a query. The model must support reranking."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Authentication:"})," Required when auth is enabled. Token must have 'rerank' endpoint access."]}),e.jsx("h5",{children:"Headers"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Header"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Authorization"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Bearer token for authentication"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Content-Type"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Must be application/json"})]})]})]}),e.jsx("h5",{children:"Request Body"}),e.jsx("p",{children:e.jsx("code",{children:"application/json"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Field"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"model"})}),e.jsx("td",{children:e.jsx("code",{children:"string"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Reranker model ID (e.g., 'bge-reranker-v2-m3-Q8_0')"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"query"})}),e.jsx("td",{children:e.jsx("code",{children:"string"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"The query to rank documents against."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"documents"})}),e.jsx("td",{children:e.jsx("code",{children:"array"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Array of document strings to rank."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"top_n"})}),e.jsx("td",{children:e.jsx("code",{children:"integer"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Return only the top N results. Defaults to all documents."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"return_documents"})}),e.jsx("td",{children:e.jsx("code",{children:"boolean"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Include document text in results. Defaults to false."})]})]})]}),e.jsx("h5",{children:"Response"}),e.jsx("p",{children:"Returns a list of reranked results with index and relevance_score, sorted by score descending."}),e.jsx("h5",{children:"Example"}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Rerank documents for a query:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/rerank \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "bge-reranker-v2-m3-Q8_0",
    "query": "What is machine learning?",
    "documents": [
      "Machine learning is a subset of artificial intelligence.",
      "The weather today is sunny.",
      "Deep learning uses neural networks."
    ],
    "top_n": 2
  }'`})})]})]})]}),e.jsx("nav",{className:"doc-sidebar",children:e.jsxs("div",{className:"doc-sidebar-content",children:[e.jsx("div",{className:"doc-index-section",children:e.jsx("a",{href:"#overview",className:"doc-index-header",children:"Overview"})}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#reranking",className:"doc-index-header",children:"Reranking"}),e.jsx("ul",{children:e.jsx("li",{children:e.jsx("a",{href:"#reranking-post--rerank",children:"POST /rerank"})})})]})]})})]})]})}function XP(){return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"Tokenize API"}),e.jsx("p",{children:"Get token counts for text input. Optionally apply the model's chat template before tokenizing."})]}),e.jsxs("div",{className:"doc-layout",children:[e.jsxs("div",{className:"doc-content",children:[e.jsxs("div",{className:"card",id:"overview",children:[e.jsx("h3",{children:"Overview"}),e.jsxs("p",{children:["All endpoints are prefixed with ",e.jsx("code",{children:"/v1"}),". Base URL: ",e.jsx("code",{children:"http://localhost:8080"})]}),e.jsx("h4",{children:"Authentication"}),e.jsx("p",{children:"When authentication is enabled, include the token in the Authorization header:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"Authorization: Bearer YOUR_TOKEN"})})]}),e.jsxs("div",{className:"card",id:"tokenize",children:[e.jsx("h3",{children:"Tokenize"}),e.jsx("p",{children:"Count the number of tokens for a given text input. Works with any model type."}),e.jsxs("div",{className:"doc-section",id:"tokenize-post--tokenize",children:[e.jsxs("h4",{children:[e.jsx("span",{className:"method-post",children:"POST"})," /tokenize"]}),e.jsx("p",{className:"doc-description",children:"Returns the token count for a text input. Optionally applies the model's chat template before tokenizing to get the actual token count that would be fed to the model."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Authentication:"})," Required when auth is enabled. Token must have 'tokenize' endpoint access."]}),e.jsx("h5",{children:"Headers"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Header"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Authorization"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Bearer token for authentication"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Content-Type"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Must be application/json"})]})]})]}),e.jsx("h5",{children:"Request Body"}),e.jsx("p",{children:e.jsx("code",{children:"application/json"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Field"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"model"})}),e.jsx("td",{children:e.jsx("code",{children:"string"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Model ID (e.g., 'Qwen3-8B-Q8_0'). Works with any model type."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"input"})}),e.jsx("td",{children:e.jsx("code",{children:"string"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"The text to tokenize."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"apply_template"})}),e.jsx("td",{children:e.jsx("code",{children:"boolean"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"If true, wraps the input as a user message and applies the model's chat template before tokenizing. The returned count includes template overhead (role markers, separators, generation prompt). Defaults to false."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"add_generation_prompt"})}),e.jsx("td",{children:e.jsx("code",{children:"boolean"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"When apply_template is true, controls whether the assistant role prefix is appended to the prompt. Defaults to true."})]})]})]}),e.jsx("h5",{children:"Response"}),e.jsx("p",{children:"Returns a tokenize object with the token count."}),e.jsx("h5",{children:"Examples"}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Tokenize raw text:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/tokenize \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "Qwen3-8B-Q8_0",
    "input": "The quick brown fox jumps over the lazy dog"
  }'`})}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Tokenize with chat template applied:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/tokenize \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "Qwen3-8B-Q8_0",
    "input": "The quick brown fox jumps over the lazy dog",
    "apply_template": true
  }'`})}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Response:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`{
  "object": "tokenize",
  "created": 1738857600,
  "model": "Qwen3-8B-Q8_0",
  "tokens": 11
}`})})]})]})]}),e.jsx("nav",{className:"doc-sidebar",children:e.jsxs("div",{className:"doc-sidebar-content",children:[e.jsx("div",{className:"doc-index-section",children:e.jsx("a",{href:"#overview",className:"doc-index-header",children:"Overview"})}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#tokenize",className:"doc-index-header",children:"Tokenize"}),e.jsx("ul",{children:e.jsx("li",{children:e.jsx("a",{href:"#tokenize-post--tokenize",children:"POST /tokenize"})})})]})]})})]})]})}function JP(){return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"Tools API"}),e.jsx("p",{children:"Manage libraries, models, catalog, and security. These endpoints handle server administration tasks."})]}),e.jsxs("div",{className:"doc-layout",children:[e.jsxs("div",{className:"doc-content",children:[e.jsxs("div",{className:"card",id:"overview",children:[e.jsx("h3",{children:"Overview"}),e.jsxs("p",{children:["All endpoints are prefixed with ",e.jsx("code",{children:"/v1"}),". Base URL: ",e.jsx("code",{children:"http://localhost:8080"})]}),e.jsx("h4",{children:"Authentication"}),e.jsx("p",{children:"When authentication is enabled, include the token in the Authorization header:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"Authorization: Bearer YOUR_TOKEN"})})]}),e.jsxs("div",{className:"card",id:"libs",children:[e.jsx("h3",{children:"Libs"}),e.jsx("p",{children:"Manage llama.cpp libraries installation and updates."}),e.jsxs("div",{className:"doc-section",id:"libs-get--libs",children:[e.jsxs("h4",{children:[e.jsx("span",{className:"method-get",children:"GET"})," /libs"]}),e.jsx("p",{className:"doc-description",children:"Get information about installed llama.cpp libraries."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Authentication:"})," Optional when auth is enabled."]}),e.jsx("h5",{children:"Headers"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Header"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Authorization"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Bearer token for authentication"})]})})]}),e.jsx("h5",{children:"Response"}),e.jsx("p",{children:"Returns version information including arch, os, processor, latest version, and current version."}),e.jsx("h5",{children:"Example"}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Get library information:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"curl -X GET http://localhost:8080/v1/libs"})})]}),e.jsxs("div",{className:"doc-section",id:"libs-post--libs-pull",children:[e.jsxs("h4",{children:[e.jsx("span",{className:"method-post",children:"POST"})," /libs/pull"]}),e.jsx("p",{className:"doc-description",children:"Download and install the latest llama.cpp libraries. Returns streaming progress updates."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Authentication:"})," Required when auth is enabled. Admin token required."]}),e.jsx("h5",{children:"Headers"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Header"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Authorization"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Bearer token for admin authentication"})]})})]}),e.jsx("h5",{children:"Response"}),e.jsx("p",{children:"Streams download progress as Server-Sent Events."}),e.jsx("h5",{children:"Example"}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Pull latest libraries:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"curl -X POST http://localhost:8080/v1/libs/pull"})})]})]}),e.jsxs("div",{className:"card",id:"models",children:[e.jsx("h3",{children:"Models"}),e.jsx("p",{children:"Manage models - list, pull, show, and remove models from the server."}),e.jsxs("div",{className:"doc-section",id:"models-get--models",children:[e.jsxs("h4",{children:[e.jsx("span",{className:"method-get",children:"GET"})," /models"]}),e.jsx("p",{className:"doc-description",children:"List all available models on the server."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Authentication:"})," Optional when auth is enabled."]}),e.jsx("h5",{children:"Headers"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Header"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Authorization"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Bearer token for authentication"})]})})]}),e.jsx("h5",{children:"Response"}),e.jsx("p",{children:"Returns a list of model objects with id, owned_by, model_family, size, and modified fields."}),e.jsx("h5",{children:"Example"}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"List all models:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"curl -X GET http://localhost:8080/v1/models"})})]}),e.jsxs("div",{className:"doc-section",id:"models-get--models-model",children:[e.jsxs("h4",{children:[e.jsx("span",{className:"method-get",children:"GET"})," /models/{model}"]}),e.jsx("p",{className:"doc-description",children:"Show detailed information about a specific model."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Authentication:"})," Optional when auth is enabled."]}),e.jsx("h5",{children:"Headers"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Header"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Authorization"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Bearer token for authentication"})]})})]}),e.jsx("h5",{children:"Response"}),e.jsx("p",{children:"Returns model details including metadata, capabilities, and configuration."}),e.jsx("h5",{children:"Example"}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Show model details:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"curl -X GET http://localhost:8080/v1/models/qwen3-8b-q8_0"})})]}),e.jsxs("div",{className:"doc-section",id:"models-get--models-ps",children:[e.jsxs("h4",{children:[e.jsx("span",{className:"method-get",children:"GET"})," /models/ps"]}),e.jsx("p",{className:"doc-description",children:"List currently loaded/running models in the cache."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Authentication:"})," Optional when auth is enabled."]}),e.jsx("h5",{children:"Headers"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Header"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Authorization"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Bearer token for authentication"})]})})]}),e.jsx("h5",{children:"Response"}),e.jsx("p",{children:"Returns a list of running models with id, owned_by, model_family, size, expires_at, and active_streams."}),e.jsx("h5",{children:"Example"}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"List running models:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"curl -X GET http://localhost:8080/v1/models/ps"})})]}),e.jsxs("div",{className:"doc-section",id:"models-post--models-index",children:[e.jsxs("h4",{children:[e.jsx("span",{className:"method-post",children:"POST"})," /models/index"]}),e.jsx("p",{className:"doc-description",children:"Rebuild the model index for fast model access."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Authentication:"})," Required when auth is enabled. Admin token required."]}),e.jsx("h5",{children:"Headers"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Header"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Authorization"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Bearer token for admin authentication"})]})})]}),e.jsx("h5",{children:"Response"}),e.jsx("p",{children:"Returns empty response on success."}),e.jsx("h5",{children:"Example"}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Rebuild model index:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"curl -X POST http://localhost:8080/v1/models/index"})})]}),e.jsxs("div",{className:"doc-section",id:"models-post--models-pull",children:[e.jsxs("h4",{children:[e.jsx("span",{className:"method-post",children:"POST"})," /models/pull"]}),e.jsx("p",{className:"doc-description",children:"Pull/download a model from a URL. Returns streaming progress updates."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Authentication:"})," Required when auth is enabled. Admin token required."]}),e.jsx("h5",{children:"Headers"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Header"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Authorization"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Bearer token for admin authentication"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Content-Type"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Must be application/json"})]})]})]}),e.jsx("h5",{children:"Request Body"}),e.jsx("p",{children:e.jsx("code",{children:"application/json"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Field"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"model_url"})}),e.jsx("td",{children:e.jsx("code",{children:"string"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"URL to the model GGUF file"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"proj_url"})}),e.jsx("td",{children:e.jsx("code",{children:"string"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"URL to the projection file (for vision/audio models)"})]})]})]}),e.jsx("h5",{children:"Response"}),e.jsx("p",{children:"Streams download progress as Server-Sent Events."}),e.jsx("h5",{children:"Example"}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Pull a model from HuggingFace:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/models/pull \\
  -H "Content-Type: application/json" \\
  -d '{
    "model_url": "Qwen/Qwen3-8B-GGUF/Qwen3-8B-Q8_0.gguf"
  }'`})})]}),e.jsxs("div",{className:"doc-section",id:"models-delete--models-model",children:[e.jsxs("h4",{children:[e.jsx("span",{className:"method-delete",children:"DELETE"})," /models/{model}"]}),e.jsx("p",{className:"doc-description",children:"Remove a model from the server."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Authentication:"})," Required when auth is enabled. Admin token required."]}),e.jsx("h5",{children:"Headers"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Header"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Authorization"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Bearer token for admin authentication"})]})})]}),e.jsx("h5",{children:"Response"}),e.jsx("p",{children:"Returns empty response on success."}),e.jsx("h5",{children:"Example"}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Remove a model:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"curl -X DELETE http://localhost:8080/v1/models/qwen3-8b-q8_0"})})]})]}),e.jsxs("div",{className:"card",id:"catalog",children:[e.jsx("h3",{children:"Catalog"}),e.jsx("p",{children:"Browse and pull models from the curated model catalog."}),e.jsxs("div",{className:"doc-section",id:"catalog-get--catalog",children:[e.jsxs("h4",{children:[e.jsx("span",{className:"method-get",children:"GET"})," /catalog"]}),e.jsx("p",{className:"doc-description",children:"List all models available in the catalog."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Authentication:"})," Optional when auth is enabled."]}),e.jsx("h5",{children:"Headers"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Header"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Authorization"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Bearer token for authentication"})]})})]}),e.jsx("h5",{children:"Response"}),e.jsx("p",{children:"Returns a list of catalog models with id, category, owned_by, model_family, and capabilities."}),e.jsx("h5",{children:"Example"}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"List catalog models:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"curl -X GET http://localhost:8080/v1/catalog"})})]}),e.jsxs("div",{className:"doc-section",id:"catalog-get--catalog-filter-filter",children:[e.jsxs("h4",{children:[e.jsx("span",{className:"method-get",children:"GET"})," /catalog/filter/{filter}"]}),e.jsx("p",{className:"doc-description",children:"List catalog models filtered by category."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Authentication:"})," Optional when auth is enabled."]}),e.jsx("h5",{children:"Headers"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Header"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Authorization"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Bearer token for authentication"})]})})]}),e.jsx("h5",{children:"Response"}),e.jsx("p",{children:"Returns a filtered list of catalog models."}),e.jsx("h5",{children:"Example"}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Filter catalog by category:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"curl -X GET http://localhost:8080/v1/catalog/filter/embedding"})})]}),e.jsxs("div",{className:"doc-section",id:"catalog-get--catalog-model",children:[e.jsxs("h4",{children:[e.jsx("span",{className:"method-get",children:"GET"})," /catalog/{model}"]}),e.jsx("p",{className:"doc-description",children:"Show detailed information about a catalog model."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Authentication:"})," Optional when auth is enabled."]}),e.jsx("h5",{children:"Headers"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Header"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Authorization"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Bearer token for authentication"})]})})]}),e.jsx("h5",{children:"Response"}),e.jsx("p",{children:"Returns full catalog model details including files, capabilities, and metadata."}),e.jsx("h5",{children:"Example"}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Show catalog model details:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"curl -X GET http://localhost:8080/v1/catalog/qwen3-8b-q8_0"})})]}),e.jsxs("div",{className:"doc-section",id:"catalog-post--catalog-pull-model",children:[e.jsxs("h4",{children:[e.jsx("span",{className:"method-post",children:"POST"})," /catalog/pull/{model}"]}),e.jsx("p",{className:"doc-description",children:"Pull a model from the catalog by ID. Returns streaming progress updates."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Authentication:"})," Optional when auth is enabled."]}),e.jsx("h5",{children:"Headers"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Header"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Authorization"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Bearer token for authentication"})]})})]}),e.jsx("h5",{children:"Response"}),e.jsx("p",{children:"Streams download progress as Server-Sent Events."}),e.jsx("h5",{children:"Example"}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Pull a catalog model:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"curl -X POST http://localhost:8080/v1/catalog/pull/qwen3-8b-q8_0"})})]})]}),e.jsxs("div",{className:"card",id:"security",children:[e.jsx("h3",{children:"Security"}),e.jsx("p",{children:"Manage security tokens and private keys for authentication."}),e.jsxs("div",{className:"doc-section",id:"security-post--security-token-create",children:[e.jsxs("h4",{children:[e.jsx("span",{className:"method-post",children:"POST"})," /security/token/create"]}),e.jsx("p",{className:"doc-description",children:"Create a new security token with specified permissions and duration."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Authentication:"})," Required when auth is enabled. Admin token required."]}),e.jsx("h5",{children:"Headers"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Header"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Authorization"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Bearer token for admin authentication"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Content-Type"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Must be application/json"})]})]})]}),e.jsx("h5",{children:"Request Body"}),e.jsx("p",{children:e.jsx("code",{children:"application/json"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Field"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"admin"})}),e.jsx("td",{children:e.jsx("code",{children:"boolean"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Whether the token has admin privileges"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"duration"})}),e.jsx("td",{children:e.jsx("code",{children:"duration"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Token validity duration (e.g., '24h', '720h')"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"endpoints"})}),e.jsx("td",{children:e.jsx("code",{children:"object"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Map of endpoint names to rate limit configurations"})]})]})]}),e.jsx("h5",{children:"Response"}),e.jsx("p",{children:"Returns the created token string."}),e.jsx("h5",{children:"Example"}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Create a token with chat-completions access:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/security/token/create \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "admin": false,
    "duration": "24h",
    "endpoints": {
      "chat-completions": {"limit": 1000, "window": "day"},
      "embeddings": {"limit": 0, "window": ""}
    }
  }'`})})]}),e.jsxs("div",{className:"doc-section",id:"security-get--security-keys",children:[e.jsxs("h4",{children:[e.jsx("span",{className:"method-get",children:"GET"})," /security/keys"]}),e.jsx("p",{className:"doc-description",children:"List all private keys in the system."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Authentication:"})," Required when auth is enabled. Admin token required."]}),e.jsx("h5",{children:"Headers"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Header"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Authorization"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Bearer token for admin authentication"})]})})]}),e.jsx("h5",{children:"Response"}),e.jsx("p",{children:"Returns a list of keys with id and created timestamp."}),e.jsx("h5",{children:"Example"}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"List all keys:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X GET http://localhost:8080/v1/security/keys \\
  -H "Authorization: Bearer $KRONK_TOKEN"`})})]}),e.jsxs("div",{className:"doc-section",id:"security-post--security-keys-add",children:[e.jsxs("h4",{children:[e.jsx("span",{className:"method-post",children:"POST"})," /security/keys/add"]}),e.jsx("p",{className:"doc-description",children:"Create a new private key and add it to the keystore."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Authentication:"})," Required when auth is enabled. Admin token required."]}),e.jsx("h5",{children:"Headers"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Header"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Authorization"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Bearer token for admin authentication"})]})})]}),e.jsx("h5",{children:"Response"}),e.jsx("p",{children:"Returns empty response on success."}),e.jsx("h5",{children:"Example"}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Add a new key:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/security/keys/add \\
  -H "Authorization: Bearer $KRONK_TOKEN"`})})]}),e.jsxs("div",{className:"doc-section",id:"security-post--security-keys-remove-keyid",children:[e.jsxs("h4",{children:[e.jsx("span",{className:"method-post",children:"POST"})," /security/keys/remove/{keyid}"]}),e.jsx("p",{className:"doc-description",children:"Remove a private key from the keystore by its ID."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Authentication:"})," Required when auth is enabled. Admin token required."]}),e.jsx("h5",{children:"Headers"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Header"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Authorization"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Bearer token for admin authentication"})]})})]}),e.jsx("h5",{children:"Response"}),e.jsx("p",{children:"Returns empty response on success."}),e.jsx("h5",{children:"Example"}),e.jsx("p",{className:"example-label",children:e.jsx("strong",{children:"Remove a key:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`curl -X POST http://localhost:8080/v1/security/keys/remove/abc123 \\
  -H "Authorization: Bearer $KRONK_TOKEN"`})})]})]})]}),e.jsx("nav",{className:"doc-sidebar",children:e.jsxs("div",{className:"doc-sidebar-content",children:[e.jsx("div",{className:"doc-index-section",children:e.jsx("a",{href:"#overview",className:"doc-index-header",children:"Overview"})}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#libs",className:"doc-index-header",children:"Libs"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#libs-get--libs",children:"GET /libs"})}),e.jsx("li",{children:e.jsx("a",{href:"#libs-post--libs-pull",children:"POST /libs/pull"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#models",className:"doc-index-header",children:"Models"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#models-get--models",children:"GET /models"})}),e.jsx("li",{children:e.jsx("a",{href:"#models-get--models-model",children:"GET /models/{model}"})}),e.jsx("li",{children:e.jsx("a",{href:"#models-get--models-ps",children:"GET /models/ps"})}),e.jsx("li",{children:e.jsx("a",{href:"#models-post--models-index",children:"POST /models/index"})}),e.jsx("li",{children:e.jsx("a",{href:"#models-post--models-pull",children:"POST /models/pull"})}),e.jsx("li",{children:e.jsx("a",{href:"#models-delete--models-model",children:"DELETE /models/{model}"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#catalog",className:"doc-index-header",children:"Catalog"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#catalog-get--catalog",children:"GET /catalog"})}),e.jsx("li",{children:e.jsx("a",{href:"#catalog-get--catalog-filter-filter",children:"GET /catalog/filter/{filter}"})}),e.jsx("li",{children:e.jsx("a",{href:"#catalog-get--catalog-model",children:"GET /catalog/{model}"})}),e.jsx("li",{children:e.jsx("a",{href:"#catalog-post--catalog-pull-model",children:"POST /catalog/pull/{model}"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#security",className:"doc-index-header",children:"Security"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#security-post--security-token-create",children:"POST /security/token/create"})}),e.jsx("li",{children:e.jsx("a",{href:"#security-get--security-keys",children:"GET /security/keys"})}),e.jsx("li",{children:e.jsx("a",{href:"#security-post--security-keys-add",children:"POST /security/keys/add"})}),e.jsx("li",{children:e.jsx("a",{href:"#security-post--security-keys-remove-keyid",children:"POST /security/keys/remove/{keyid}"})})]})]})]})})]})]})}function ZP(){const[t,n]=y.useState(""),r=fs();return y.useEffect(()=>{if(r.hash){const s=r.hash.slice(1),i=document.getElementById(s);i&&setTimeout(()=>{i.scrollIntoView({behavior:"smooth",block:"start"})},100)}},[r.hash]),y.useEffect(()=>{const s=()=>{const i=document.querySelectorAll(".manual-content h2, .manual-content h3");let l="";i.forEach(o=>{o.getBoundingClientRect().top<=100&&(l=o.id)}),n(l)};return window.addEventListener("scroll",s),()=>window.removeEventListener("scroll",s)},[]),e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"Kronk Manual"}),e.jsx("p",{children:"Complete documentation for the Kronk Model Server"})]}),e.jsxs("div",{className:"doc-layout",children:[e.jsxs("div",{className:"doc-content manual-content",children:[e.jsx("h2",{id:"chapter-1-introduction",children:"Chapter 1: Introduction"}),e.jsx("h3",{id:"11-what-is-kronk",children:"1.1 What is Kronk"}),e.jsxs("p",{children:["Kronk is a Go SDK and Model Server for running local inference with open-source GGUF models. Built on top of llama.cpp via the ",e.jsx("a",{href:"https://github.com/hybridgroup/yzma",children:"yzma"})," Go bindings (a non-CGO FFI layer), Kronk provides hardware-accelerated inference for text generation, vision, audio, embeddings, and reranking."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"The SDK is the foundation."}),' The Kronk Model Server is built entirely on top of the SDK  we "dog food" our own library. Everything the model server can do is available to you as a SDK developer to help you write your own applications.']}),e.jsxs("p",{children:[e.jsx("strong",{children:"You don't need a model server."})," The real power of Kronk is that you can embed model inference directly into your Go applications. Load models, run inference, manage caching, and handle concurrent requests  all without running the models in a separate server process. The ",e.jsx("a",{href:"examples/",children:"examples"})," directory demonstrates building standalone applications with the SDK."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"The Model Server is optional."})," When you do need an model server (for web UIs, multi-client access, or OpenAI-compatible endpoints), the Kronk Model Server provides:"]}),e.jsxs("ul",{children:[e.jsx("li",{children:"OpenAI and Anthropic compatible REST APIs"}),e.jsx("li",{children:"OpenWebUI integration"}),e.jsx("li",{children:"Agent and tool support for local models"}),e.jsx("li",{children:"Any OpenAI-compatible client"})]}),e.jsx("h3",{id:"12-key-features",children:"1.2 Key Features"}),e.jsx("p",{children:e.jsx("strong",{children:"Model Types"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Text Generation"})," - Chat completions and streaming responses with reasoning support."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Vision"})," - Image understanding and analysis."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Audio"})," - Speech-to-text and audio understanding."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Embeddings"})," - Vector embeddings for semantic search and RAG."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Reranking"})," - Document relevance scoring."]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Performance"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Batch Processing"})," - Process multiple requests concurrently within a set of partitioned KV cache sequences."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Message Caching"})," - System prompt and incremental message caching to reduce redundant computation."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"YaRN Context Extension"})," - Extend context windows 2-4x beyond native training length."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Model Pooling"})," - Keep a number of models loaded in memory with configurable TTL."]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Operations"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Catalog System"})," - Curated collection of verified models with one-command downloads."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Browser UI (BUI)"})," - Web interface for model management, downloads, and configuration."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Authentication"})," - JWT-based security with key management, endpoint authorization and rate limiting."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Observability"})," - Tracing and metrics integration with Grafana support."]})]}),e.jsx("h3",{id:"13-supported-platforms-and-hardware",children:"1.3 Supported Platforms and Hardware"}),e.jsx("p",{children:"Kronk supports full hardware acceleration across major platforms:"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx("strong",{children:"OS"})}),e.jsx("th",{children:e.jsx("strong",{children:"CPU"})}),e.jsx("th",{children:e.jsx("strong",{children:"GPU"})})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Linux"}),e.jsx("td",{children:"amd64, arm64"}),e.jsx("td",{children:"CUDA, Vulkan, HIP, ROCm, SYCL"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"macOS"}),e.jsx("td",{children:"arm64"}),e.jsx("td",{children:"Metal"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Windows"}),e.jsx("td",{children:"amd64"}),e.jsx("td",{children:"CUDA, Vulkan, HIP, SYCL, OpenCL"})]})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Hardware Requirements"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Minimum 8GB RAM for small models (1-3B parameters)"}),e.jsx("li",{children:"16GB+ RAM recommended for medium models (7-8B parameters)"}),e.jsx("li",{children:"32GB+ RAM or dedicated GPU VRAM for large models (30B+ parameters)"}),e.jsx("li",{children:"GPU with Metal, CUDA, or Vulkan support recommended for optimal performance"})]}),e.jsx("h3",{id:"14-architecture-overview",children:"1.4 Architecture Overview"}),e.jsx("p",{children:"Kronk is designed as a layered architecture where the SDK provides all core functionality and the Model Server is one application built on top of it."}),e.jsx("p",{children:e.jsx("img",{src:"https://github.com/ardanlabs/kronk/blob/main/images/design/sdk.png?raw=true",alt:"Kronk SDK Architecture"})}),e.jsx("p",{children:e.jsx("strong",{children:"Layer Breakdown:"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Layer"}),e.jsx("th",{children:"Component"}),e.jsx("th",{children:"Purpose"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Application"})}),e.jsx("td",{children:"Kronk Model Server"}),e.jsx("td",{children:"REST API server (or your own app)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"SDK Tools"})}),e.jsx("td",{children:"Models, Libs, Catalog, Template APIs"}),e.jsx("td",{children:"High-level APIs for common tasks"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"SDK Core"})}),e.jsx("td",{children:"Kronk SDK API, Model SDK API"}),e.jsx("td",{children:"Model loading, inference, pooling, caching"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Bindings"})}),e.jsx("td",{children:"yzma (non-CGO FFI via purego)"}),e.jsx("td",{children:"Go bindings to llama.cpp without CGO"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Engine"})}),e.jsx("td",{children:"llama.cpp"}),e.jsx("td",{children:"Hardware-accelerated inference"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Hardware"})}),e.jsx("td",{children:"Metal, CUDA, Vulkan, CPU"}),e.jsx("td",{children:"GPU/CPU acceleration"})]})]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"The Key Insight:"})," Your application sits at the same level as the Kronk Model Server. You have access to the exact same SDK APIs. Whether you're building a CLI tool, a web service, an embedded system, or a desktop app  you get the full power of local model inference without any server overhead."]}),e.jsx("p",{children:e.jsx("strong",{children:"SDK vs Server Usage:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-go",children:`// Direct SDK usage - no server needed
cfg := model.Config{
    ModelFiles: modelPath.ModelFiles,
    CacheTypeK: model.GGMLTypeQ8_0,
    CacheTypeV: model.GGMLTypeQ8_0,
}

krn, _ := kronk.New(cfg)
defer krn.Unload(ctx)

ch, _ := krn.ChatStreaming(ctx, model.D{
    "messages":   model.DocumentArray(model.TextMessage(model.RoleUser, "Hello")),
    "max_tokens": 2048,
})

for resp := range ch {
    fmt.Print(resp.Choice[0].Delta.Content)
}`})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`# Or use the Model Server for OpenAI-compatible API
kronk server start
curl http://localhost:8080/v1/chat/completions -d '{"model":"Qwen3-8B-Q8_0","messages":[...]}'`})}),e.jsx("hr",{}),e.jsx("h2",{id:"chapter-2-installation-quick-start",children:"Chapter 2: Installation & Quick Start"}),e.jsx("h3",{id:"21-prerequisites",children:"2.1 Prerequisites"}),e.jsx("p",{children:e.jsx("strong",{children:"Required"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Go 1.26 or later"}),e.jsx("li",{children:"Internet connection (for downloading libraries and models)"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Recommended"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"GPU with Metal (macOS), CUDA (NVIDIA), or Vulkan support"}),e.jsx("li",{children:"16GB+ system RAM (96GB+ Recommended)"})]}),e.jsx("h3",{id:"22-installing-the-cli",children:"2.2 Installing the CLI"}),e.jsx("p",{children:"Install Kronk using Go:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"go install github.com/ardanlabs/kronk/cmd/kronk@latest"})}),e.jsx("p",{children:"Verify the installation:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk --help"})}),e.jsx("p",{children:"You should see output listing available commands:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Kronk CLI - A tool for managing Kronk models

Usage:
  kronk [command]

Available Commands:
  catalog     Manage model catalog
  libs        Install or upgrade llama.cpp libraries
  model       Manage models
  run         Run a model directly for quick testing
  security    Manage security keys and tokens
  server      Manage Kronk model server
  help        Help about any command`})}),e.jsx("h3",{id:"23-installing-libraries",children:"2.3 Installing Libraries"}),e.jsx("p",{children:"Before running inference, you need the llama.cpp libraries for your machine. Kronk auto-detects your hardware and downloads the appropriate binaries."}),e.jsx("p",{children:e.jsx("strong",{children:"Option A: Via the Server (Recommended)"})}),e.jsx("p",{children:"Start the server and use the BUI to download libraries:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk server start"})}),e.jsx("p",{children:"Open http://localhost:8080 in your browser and navigate to the Libraries page."}),e.jsx("p",{children:e.jsx("strong",{children:"Option B: Via CLI"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk libs --local"})}),e.jsxs("p",{children:["This downloads libraries to ",e.jsx("code",{children:"~/.kronk/libraries/"})," using auto-detected settings."]}),e.jsx("p",{children:e.jsx("strong",{children:"Environment Variables for Library Installation"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"KRONK_LIB_PATH  - Library directory (default: `~/.kronk/libraries`)\nKRONK_PROCESSOR - `cpu`, `cuda`, `metal`, `rocm`, or `vulkan` (default: `cpu`)\nKRONK_ARCH      - Architecture override: `amd64`, `arm64`\nKRONK_OS        - OS override: `linux`, `darwin`, `windows`\nGITHUB_TOKEN    - GitHub personal access token for higher API rate limits"})}),e.jsx("p",{children:e.jsx("strong",{children:"Example: Install CUDA Libraries"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"KRONK_PROCESSOR=cuda kronk libs --local"})}),e.jsx("h3",{id:"24-downloading-your-first-model",children:"2.4 Downloading Your First Model"}),e.jsx("p",{children:"Kronk provides a curated catalog of verified models. List available models:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk catalog list --local"})}),e.jsx("p",{children:"Output:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`CATALOG              MODEL ID                            PULLED   ENDPOINT
Audio-Text-to-Text   Qwen2-Audio-7B.Q8_0                 no       chat_completion
Embedding            embeddinggemma-300m-qat-Q8_0        no       embeddings
Image-Text-to-Text   gemma-3-4b-it-q4_0                  no       chat_completion
Text-Generation      Qwen3-8B-Q8_0                       no       chat_completion
Text-Generation      Llama-3.3-70B-Instruct-Q8_0         no       chat_completion
...`})}),e.jsx("p",{children:"Download a model (recommended starter: Qwen3-8B):"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk catalog pull Qwen3-8B-Q8_0 --local"})}),e.jsxs("p",{children:["Models are stored in ",e.jsx("code",{children:"~/.kronk/models/"})," by default."]}),e.jsx("h3",{id:"25-starting-the-server",children:"2.5 Starting the Server"}),e.jsx("p",{children:"Start the Kronk Model Server:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk server start"})}),e.jsxs("p",{children:["The server starts on ",e.jsx("code",{children:"http://localhost:8080"})," by default. You'll see output like:"]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Kronk Model Server started
API: http://localhost:8080
BUI: http://localhost:8080`})}),e.jsx("p",{children:e.jsx("strong",{children:"Running in Background"})}),e.jsx("p",{children:"To run the server as a background process:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk server start -d"})}),e.jsx("p",{children:e.jsx("strong",{children:"Stopping the Server"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk server stop"})}),e.jsx("h3",{id:"26-verifying-the-installation",children:"2.6 Verifying the Installation"}),e.jsx("p",{children:e.jsx("strong",{children:"Test via curl"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"curl http://localhost:8080/v1/models"})}),e.jsx("p",{children:"You should see a list of available models."}),e.jsx("p",{children:e.jsx("strong",{children:"Test Chat Completion"})}),e.jsx("p",{children:e.jsx("em",{children:"Note: It might take a few seconds the first time you call this because the model needs to be loaded into memory first."})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`curl http://localhost:8080/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "Qwen3-8B-Q8_0",
    "messages": [{"role": "user", "content": "Hello!"}],
    "max_tokens": 100
  }'`})}),e.jsx("p",{children:e.jsx("strong",{children:"Test via BUI"})}),e.jsx("p",{children:"Open http://localhost:8080 in your browser and navigate to the Apps/Chat app. Select the model you want to try and chat away."}),e.jsx("h3",{id:"27-quick-start-summary",children:"2.7 Quick Start Summary"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`# 1. Install Kronk
go install github.com/ardanlabs/kronk/cmd/kronk@latest

# 2. Start the server (auto-installs libraries on first run)
kronk server start

# 3. Open BUI and download a model
open http://localhost:8080

# 4. Download via the BUI Catalog/List screen or use this CLI call
kronk catalog pull Qwen3-8B-Q8_0 --local

# 5. Test the API using this curl call or the BUI App/Chat screen
curl http://localhost:8080/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -d '{"model": "Qwen3-8B-Q8_0", "messages": [{"role": "user", "content": "Hello!"}]}'`})}),e.jsx("h3",{id:"28-nixos-setup",children:"2.8 NixOS Setup"}),e.jsxs("p",{children:["NixOS does not follow the Filesystem Hierarchy Standard (FHS), so shared libraries and binaries cannot be found in standard paths like ",e.jsx("code",{children:"/usr/lib"}),". Kronk requires llama.cpp shared libraries at runtime, which means on NixOS you need to provide them through Nix rather than using the built-in ",e.jsx("code",{children:"kronk libs"})," downloader."]}),e.jsxs("p",{children:["A ",e.jsx("code",{children:"flake.nix"})," is provided in ",e.jsx("code",{children:"zarf/nix/"})," with dev shells for development and build packages for producing a standalone ",e.jsx("code",{children:"kronk"})," binary, each per GPU backend."]}),e.jsx("p",{children:e.jsx("strong",{children:"Prerequisites"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"NixOS or Nix package manager with flakes enabled"}),e.jsx("li",{children:"A supported GPU (Vulkan or CUDA), or CPU-only mode"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Available Dev Shells"})}),e.jsx("p",{children:"The flake provides multiple shells, one per GPU backend:"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Command"}),e.jsx("th",{children:"Backend"}),e.jsx("th",{children:"GPU Required"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"nix develop ./zarf/nix"})}),e.jsx("td",{children:"CPU"}),e.jsx("td",{children:"None"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"nix develop ./zarf/nix#cpu"})}),e.jsx("td",{children:"CPU"}),e.jsx("td",{children:"None"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"nix develop ./zarf/nix#vulkan"})}),e.jsx("td",{children:"Vulkan"}),e.jsx("td",{children:"Vulkan-capable GPU"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"nix develop ./zarf/nix#cuda"})}),e.jsx("td",{children:"CUDA"}),e.jsx("td",{children:"NVIDIA GPU with CUDA"})]})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Building the Kronk CLI"})}),e.jsxs("p",{children:["The flake also provides build packages that produce a wrapped ",e.jsx("code",{children:"kronk"})," binary with the correct llama.cpp backend and runtime libraries baked in:"]}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Command"}),e.jsx("th",{children:"Backend"}),e.jsx("th",{children:"GPU Required"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"nix build ./zarf/nix"})}),e.jsx("td",{children:"CPU"}),e.jsx("td",{children:"None"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"nix build ./zarf/nix#cpu"})}),e.jsx("td",{children:"CPU"}),e.jsx("td",{children:"None"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"nix build ./zarf/nix#vulkan"})}),e.jsx("td",{children:"Vulkan"}),e.jsx("td",{children:"Vulkan-capable GPU"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"nix build ./zarf/nix#cuda"})}),e.jsx("td",{children:"CUDA"}),e.jsx("td",{children:"NVIDIA GPU with CUDA"})]})]})]}),e.jsxs("p",{children:["The Go binary is built once with ",e.jsx("code",{children:"CGO_ENABLED=0"}),", then wrapped per backend so that ",e.jsx("code",{children:"KRONK_LIB_PATH"}),", ",e.jsx("code",{children:"KRONK_ALLOW_UPGRADE"}),", and ",e.jsx("code",{children:"LD_LIBRARY_PATH"})," are set automatically. No dev shell is required to run the resulting binary."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"})," The ",e.jsx("code",{children:"vendorHash"})," in the flake must be updated whenever ",e.jsx("code",{children:"go.mod"})," or ",e.jsx("code",{children:"go.sum"})," changes. Build with a fake hash and Nix will report the correct one."]}),e.jsx("p",{children:e.jsx("strong",{children:"Environment Variables"})}),e.jsx("p",{children:"All shells and built packages automatically set the following:"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Variable"}),e.jsx("th",{children:"Value"}),e.jsx("th",{children:"Purpose"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_LIB_PATH"})}),e.jsx("td",{children:"Nix store path to the selected llama.cpp"}),e.jsx("td",{children:"Points Kronk to the Nix-managed llama.cpp libraries"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_ALLOW_UPGRADE"})}),e.jsx("td",{children:e.jsx("code",{children:"false"})}),e.jsx("td",{children:"Prevents Kronk from attempting to download libraries"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"LD_LIBRARY_PATH"})}),e.jsxs("td",{children:["Includes ",e.jsx("code",{children:"libffi"})," and ",e.jsx("code",{children:"libstdc++"})]}),e.jsx("td",{children:"Required for FFI runtime linking"})]})]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Important:"})," Because ",e.jsx("code",{children:"KRONK_ALLOW_UPGRADE"})," is set to ",e.jsx("code",{children:"false"}),", the ",e.jsx("code",{children:"kronk libs"})," command will not attempt to download or overwrite libraries. Library updates are managed through ",e.jsx("code",{children:"nix flake update"})," instead."]}),e.jsx("p",{children:e.jsx("strong",{children:"Troubleshooting"})}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Library not found errors:"})," Ensure you are inside the ",e.jsx("code",{children:"nix develop"})," shell"]})}),e.jsxs("p",{children:["or using a ",e.jsx("code",{children:"nix build"})," output. The required ",e.jsx("code",{children:"LD_LIBRARY_PATH"})," and ",e.jsx("code",{children:"KRONK_LIB_PATH"})," are only set within the shell or the wrapped binary."]}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Vulkan not detected:"})," Verify your GPU drivers are installed at the NixOS"]})}),e.jsxs("p",{children:["system level (",e.jsx("code",{children:"hardware.opengl.enable = true"})," and appropriate driver packages in your NixOS configuration)."]}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Go version mismatch:"})," The flake pins a specific Go version. If Kronk"]})}),e.jsxs("p",{children:["requires a newer version, update the ",e.jsx("code",{children:"go_1_26"})," package reference in ",e.jsx("code",{children:"flake.nix"}),"."]}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"vendorHash mismatch:"})," After updating Go dependencies, rebuild with a fake"]})}),e.jsxs("p",{children:["hash (e.g. ",e.jsx("code",{children:"lib.fakeHash"}),") and Nix will print the correct ",e.jsx("code",{children:"vendorHash"}),"."]}),e.jsx("hr",{}),e.jsx("h2",{id:"chapter-3-model-configuration",children:"Chapter 3: Model Configuration"}),e.jsx("p",{children:"Model configuration controls how Kronk configures models to run inference. Configuration can be set via model config files, catalog templates, or programmatically through the SDK."}),e.jsx("h3",{id:"31-basic-configuration",children:"3.1 Basic Configuration"}),e.jsx("p",{children:"For most models you will want to touch these basic settings. There are many more which will be presented later. Each model has GGUF metadata that Kronk can read for defaults like setting the context window size when not provided. Kronk also has default settings for things like temperature and top_p when not provided."}),e.jsx("p",{children:e.jsx("strong",{children:"Context Window"})}),e.jsx("p",{children:"The context window defines the maximum number of tokens the model can process in a single request. This would be the sum of all input tokens being provided at any given time."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:"context_window: 8192 # 8192 tokens (Kronk default if not specifed by the model and you)"})}),e.jsx("p",{children:e.jsx("em",{children:"Note: A common rule of thumb is that 1 token  0.75 words (or roughly 4 characters in English). So an 8K context window can handle approximately 6,000 words of combined input and output."})}),e.jsx("p",{children:"Larger context windows require more VRAM. A rough estimate:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"8K context"}),": ~2GB additional VRAM"]}),e.jsxs("li",{children:[e.jsx("code",{children:"32K context"}),": ~8GB additional VRAM"]}),e.jsxs("li",{children:[e.jsx("code",{children:"128K context"}),": ~32GB additional VRAM (requires YaRN scaling)"]})]}),e.jsx("p",{children:e.jsx("em",{children:"Note: YaRN is a way to extend the natural size of context windows for small models. Kronk supports YaRN and talked about in Chapter 6."})}),e.jsx("p",{children:e.jsx("strong",{children:"Batch Size Configuration"})}),e.jsx("p",{children:"When you send a prompt to a model, the model doesn't process all your input tokens at once. It breaks them into smaller chunks and processes each chunk through the GPU in a series of steps called forward passes. These two parameters control the size of those chunks:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"n_batch"})," - Maximum tokens in a single forward pass (kronk default: 2048)"]}),e.jsxs("li",{children:[e.jsx("code",{children:"n_ubatch"})," - Physical batch size for prompt processing (kronk default: 512)"]})]}),e.jsxs("p",{children:["Think of it like reading a book aloud. ",e.jsx("code",{children:"n_batch"})," is how many words you're willing to look at on the page at once, and ",e.jsx("code",{children:"n_ubatch"})," is how many words you actually read in one breath. You might glance at 2048 words, but you read them 512 at a time."]}),e.jsxs("p",{children:["For example, if you send a 4096-token prompt with the default settings, the model will process it in chunks: it takes up to 2048 tokens per forward pass (",e.jsx("code",{children:"n_batch"}),"), and within each pass, it physically processes 512 tokens at a time (",e.jsx("code",{children:"n_ubatch"}),"). Larger values mean faster prompt processing but use more VRAM. The ",e.jsx("code",{children:"n_ubatch"})," value must always be less than or equal to ",e.jsx("code",{children:"n_batch"}),"."]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`n_batch: 2048 # Logical batch size
n_ubatch: 512 # Physical batch size (must be  n_batch)`})}),e.jsx("p",{children:e.jsx("strong",{children:"Recommended settings by workload:"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Workload"}),e.jsx("th",{children:"n_batch"}),e.jsx("th",{children:"n_ubatch"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Interactive chat (single user)"}),e.jsx("td",{children:"512-1024"}),e.jsx("td",{children:"512"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Long prompts/RAG"}),e.jsx("td",{children:"2048-4096"}),e.jsx("td",{children:"512-1024"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Batch inference (multiple prompts)"}),e.jsx("td",{children:"2048-4096"}),e.jsx("td",{children:"512"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Low VRAM (<8GB)"}),e.jsx("td",{children:"512"}),e.jsx("td",{children:"256-512"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"High VRAM (24GB+)"}),e.jsx("td",{children:"4096+"}),e.jsx("td",{children:"1024+"})]})]})]}),e.jsx("h3",{id:"32-gpu-configuration",children:"3.2 GPU Configuration"}),e.jsx("p",{children:"A model is made up of layers, and each layer contains the weights (numbers) the model learned during training. When you run inference, the model processes your input through these layers one at a time. The key performance question is: where do those layers live  on the GPU or the CPU?"}),e.jsx("p",{children:"GPUs are dramatically faster at the math required for inference, but they have limited memory (VRAM). If your model doesn't fit entirely in VRAM, you can split the work: keep some layers on the GPU for speed and let the rest run on the CPU. This section covers how to control that split and other GPU-related settings."}),e.jsx("p",{children:e.jsx("strong",{children:"Layer Offloading"})}),e.jsx("p",{children:"A typical model might have anywhere from 28 to 80+ layers depending on its size. For example, a 7B parameter model usually has around 32 layers, while a 70B model might have 80. Each layer you place on the GPU runs significantly faster, but consumes VRAM. If your GPU doesn't have enough VRAM to hold every layer, you can choose how many to offload  the rest will run on the CPU, which is slower but has access to your full system RAM."}),e.jsx("p",{children:"The goal is to put as many layers on the GPU as your VRAM allows. If you run out of VRAM, lower this number until the model fits."}),e.jsx("p",{children:"Control how many model layers run on GPU:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`n_gpu_layers: 0      # 0 = all layers on GPU (default)
n_gpu_layers: -1     # All layers on CPU
n_gpu_layers: 20     # First 20 layers on GPU`})}),e.jsx("p",{children:e.jsx("strong",{children:"KV Cache Location"})}),e.jsx("p",{children:`As the model processes your conversation, it builds up a cache of intermediate calculations called the KV (Key-Value) cache. Think of it as the model's short-term memory  it stores what the model has already "read" so it doesn't have to reprocess the entire conversation for every new token it generates. The longer the conversation, the larger this cache grows.`}),e.jsx("p",{children:"By default the KV cache lives on the GPU for speed, but it can consume a significant amount of VRAM  especially with large context windows or multiple concurrent requests. If you're running low on VRAM, moving the KV cache to the CPU frees up GPU memory at the cost of slower inference."}),e.jsx("p",{children:"Control where the KV cache is stored:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`offload_kqv: true    # KV cache on GPU (default, faster)
offload_kqv: false   # KV cache on CPU (saves VRAM, slower)`})}),e.jsx("p",{children:e.jsx("strong",{children:"Tensor Operations Offload"})}),e.jsx("p",{children:"Beyond the model layers and KV cache, there are additional math operations (called tensor operations) that happen during inference  things like matrix multiplications and attention score calculations. These operations are separate from the layer weights themselves and can independently be placed on the GPU or CPU. By default they run on the GPU, but if VRAM is tight you can move them to the CPU while still keeping your model layers on the GPU."}),e.jsxs("p",{children:["_Note: Use ",e.jsx("code",{children:"op_offload: false"})," when you need to run the model on CPU but want to keep some layers on GPU for memory._"]}),e.jsx("p",{children:"Control where these tensor computations run:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`op_offload: true     # Tensor ops on GPU (default)
op_offload: false    # Tensor ops on CPU`})}),e.jsx("p",{children:e.jsx("strong",{children:"Multi-GPU Split Mode"})}),e.jsxs("p",{children:["If you have more than one GPU in your system, you can spread a model across them. This is useful when a model is too large to fit in a single GPU's VRAM. There are two strategies: ",e.jsx("code",{children:"layer"})," mode assigns entire layers to different GPUs (simple and works well for most models), while ",e.jsx("code",{children:"row"}),' mode splits individual tensor operations across GPUs in parallel (better for Mixture of Experts models like Qwen3-MoE, Mixtral, or DeepSeek where different "experts" can run simultaneously on different GPUs).']}),e.jsx("p",{children:e.jsx("em",{children:"Note: Use <code>row</code> for Mixture of Experts models like Qwen3-MoE, Mixtral, or DeepSeek."})}),e.jsx("p",{children:"Control how the model is distributed across GPUs:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`split_mode: none     # Single GPU (default)
split_mode: layer    # Split layers across GPUs
split_mode: row      # Tensor parallelism (best for MoE models)`})}),e.jsx("p",{children:e.jsx("strong",{children:"Configuration Reference"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Field"}),e.jsx("th",{children:"YAML Key"}),e.jsx("th",{children:"Values"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"NGpuLayers"}),e.jsx("td",{children:e.jsx("code",{children:"n_gpu_layers"})}),e.jsx("td",{children:"0, -1, N"}),e.jsx("td",{children:"0"}),e.jsx("td",{children:"Layers on GPU (0=all, -1=none)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"OffloadKQV"}),e.jsx("td",{children:e.jsx("code",{children:"offload_kqv"})}),e.jsx("td",{children:"true/false"}),e.jsx("td",{children:"true"}),e.jsx("td",{children:"KV cache on GPU"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"OpOffload"}),e.jsx("td",{children:e.jsx("code",{children:"op_offload"})}),e.jsx("td",{children:"true/false"}),e.jsx("td",{children:"true"}),e.jsx("td",{children:"Tensor ops on GPU"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"SplitMode"}),e.jsx("td",{children:e.jsx("code",{children:"split_mode"})}),e.jsx("td",{children:"none/layer/row"}),e.jsx("td",{children:"none"}),e.jsx("td",{children:"Multi-GPU distribution"})]})]})]}),e.jsx("h3",{id:"33-kv-cache-quantization",children:"3.3 KV Cache Quantization"}),e.jsxs("p",{children:["As discussed in the previous section, the KV cache is the model's short-term memory of your conversation. By default it stores values in half precision (f16), which gives the best accuracy but uses the most VRAM. Quantization reduces the precision of those stored values  using fewer bits to represent each number. It's a trade-off: you lose a small amount of accuracy in exchange for meaningful VRAM savings. For most use cases, ",e.jsx("code",{children:"q8_0"})," (8-bit) gives nearly identical output quality while cutting KV cache memory by about 25%. More aggressive options like ",e.jsx("code",{children:"q4_0"})," save even more but can start to affect generation quality."]}),e.jsx("p",{children:"Control the precision of the key and value caches independently:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`cache_type_k: q8_0 # Key cache precision
cache_type_v: q8_0 # Value cache precision`})}),e.jsx("p",{children:e.jsx("strong",{children:"Available types:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"f16"})," - Half precision (default, best quality)"]}),e.jsxs("li",{children:[e.jsx("code",{children:"q8_0"})," - 8-bit quantization (good balance)"]}),e.jsxs("li",{children:[e.jsx("code",{children:"q4_0"})," - 4-bit quantization (aggressive, may affect quality)"]}),e.jsxs("li",{children:[e.jsx("code",{children:"bf16"})," - Brain float 16 (for supported hardware)"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"VRAM savings with Q8_0 cache:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"8K context: ~25% reduction"}),e.jsx("li",{children:"32K context: ~25% reduction"}),e.jsx("li",{children:"Larger contexts benefit proportionally"})]}),e.jsx("p",{children:e.jsx("strong",{children:"When to Use F16 Cache (No Quantization):"})}),e.jsxs("p",{children:["Certain model architectures are sensitive to KV cache quantization and perform significantly better with ",e.jsx("code",{children:"f16"})," precision:"]}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Mixture of Experts (MoE) models"})," - Models like Qwen3-MoE, DeepSeek-MoE,"]})}),e.jsx("p",{children:"and Mixtral use sparse expert routing. The routing decisions depend on subtle attention patterns that degrade when the KV cache is quantized."}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Long-context reasoning"})," - Tasks requiring attention across many thousands"]})}),e.jsx("p",{children:"of tokens (legal documents, codebases, multi-turn conversations) accumulate small precision errors that compound over the sequence length."}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Code generation"})," - Precise variable tracking and syntax coherence benefit"]})}),e.jsx("p",{children:"from higher cache precision, especially in larger codebases."}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Math and logic"})," - Multi-step reasoning chains are sensitive to accumulated"]})}),e.jsx("p",{children:"quantization noise in earlier attention states."}),e.jsx("p",{children:e.jsx("strong",{children:"Example: MoE Model with F16 Cache"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  # MoE models benefit from f16 cache for routing accuracy
  Qwen_Qwen3.5-35B-A3B-Q8_0:
    context_window: 32768
    cache_type_k: f16 # Preserve routing precision
    cache_type_v: f16
    split_mode: row # Best for MoE multi-GPU

  # Dense models can often use q8_0 cache without issues
  Qwen3-8B-Q8_0:
    context_window: 32768
    cache_type_k: q8_0
    cache_type_v: q8_0`})}),e.jsxs("p",{children:[e.jsx("strong",{children:"Recommendation:"})," If you notice quality degradation (incoherent outputs, reasoning failures, or code bugs) with quantized cache, try ",e.jsx("code",{children:"f16"})," first before adjusting other parameters. The VRAM cost is typically 25-50% more for the cache, but the quality improvement for sensitive workloads is substantial."]}),e.jsx("h3",{id:"34-flash-attention",children:"3.4 Flash Attention"}),e.jsx("p",{children:'Attention is the core mechanism that lets a model figure out which parts of your input are relevant to each other. For example, in the sentence "The cat sat on the mat because it was tired," attention is how the model connects "it" back to "the cat." The standard attention algorithm needs to hold a large matrix of scores in memory  one score for every pair of tokens in your input. As context windows grow, this matrix grows quadratically and can become both slow and memory-hungry.'}),e.jsx("p",{children:"Flash Attention is an optimized implementation that computes the same result but processes the matrix in small tiles that fit in the GPU's fast on-chip memory (SRAM) instead of slower VRAM. The result is lower memory usage and faster computation  especially noticeable with large context windows (32K+). It's enabled by default and should rarely need to be changed."}),e.jsx("p",{children:"Control whether Flash Attention is used:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`flash_attention: enabled   # Default: enabled
flash_attention: disabled  # Disable if causing issues
flash_attention: auto      # Let llama.cpp decide`})}),e.jsx("h3",{id:"35-parallel-inference-nseqmax",children:"3.5 Parallel Inference (NSeqMax)"}),e.jsxs("p",{children:["When multiple users (or applications) send requests to the same model at the same time, the model needs a way to handle them concurrently. That's what ",e.jsx("code",{children:"NSeqMax"})," controls  it determines how many requests the model can process in parallel."]}),e.jsx("p",{children:"Behind the scenes, Kronk creates a processing slot for each concurrent request. Each slot gets its own isolated partition in the KV cache (the model's short-term memory from earlier sections). All slots share the same model weights and GPU, but each one maintains its own conversation state independently. When a batch decode runs on the GPU, tokens from all active slots are combined into a single operation  so the GPU does one large matrix multiply instead of several small ones. This is what makes parallel inference efficient."}),e.jsxs("p",{children:["The trade-off is VRAM. Each slot reserves its full KV cache partition when the model loads, whether or not it's actively handling a request. Setting ",e.jsx("code",{children:"n_seq_max: 4"})," means four KV cache partitions are allocated upfront. If each partition costs 3 GB, that's 12 GB of VRAM just for the cache  on top of the model weights. More slots means more concurrency but more VRAM."]}),e.jsx("p",{children:"Control how many requests can be processed in parallel:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:"n_seq_max: 4 # Process up to 4 requests concurrently"})}),e.jsx("p",{children:e.jsx("strong",{children:"How Caching Strategy Affects Slot Behavior"})}),e.jsx("p",{children:"All three caching strategies allocate the same number of slots with the same VRAM cost. The difference is what happens to the cached data in each slot between requests:"}),e.jsxs("p",{children:[e.jsx("strong",{children:"No Caching"}),"  The simplest mode. When a request finishes, the slot's KV cache is cleared. The next request that lands in that slot starts from scratch, processing the full prompt from the beginning. Every request pays the full cost of prompt processing regardless of how similar it is to a previous one."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"SPC (System Prompt Cache)"}),"  In many applications, every request starts with the same system prompt (the instructions that tell the model how to behave). SPC decodes the system prompt once into a temporary sequence, then externalizes the KV state to a byte buffer in RAM and frees the sequence. When a new request arrives, the KV state is restored into the slot's working sequence via StateSeqSetData before the rest of the prompt is processed. The slot is still cleared between requests. No dedicated cache sequence is permanently occupied, so SPC does not add any extra sequences to the VRAM allocation."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"IMC (Incremental Message Cache)"}),"  Designed for multi-turn conversations. A slot becomes dedicated to a conversation. The entire conversation history stays in the slot's KV cache between requests. When the user sends a new message, only the new tokens need to be processed  the model doesn't re-read the entire conversation. This gives the best performance for chat applications, but each active conversation permanently occupies a slot."]}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Mode"}),e.jsx("th",{children:"Slot Lifetime"}),e.jsx("th",{children:"Cache Strategy"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Off"}),e.jsx("td",{children:"Cleared after request"}),e.jsx("td",{children:"None"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"SPC"}),e.jsx("td",{children:"Cleared after request"}),e.jsx("td",{children:"System prompt decoded once, KV state stored in RAM, restored per request via StateSeqSetData"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"IMC"}),e.jsx("td",{children:"Persists across requests"}),e.jsx("td",{children:"Full conversation cached in the slot's KV cache sequence"})]})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Embedding and Reranking Models"})}),e.jsxs("p",{children:["Embedding and reranking models work differently. Instead of slots sharing a single context, ",e.jsx("code",{children:"NSeqMax"})," creates a pool of independent contexts. When a request contains multiple inputs (for example, 100 sentences to embed), those inputs are spread across the pool contexts and processed in parallel. Model weights are shared, but each context has its own KV cache memory."]}),e.jsx("h3",{id:"36-understanding-gguf-quantization",children:"3.6 Understanding GGUF Quantization"}),e.jsx("p",{children:"GGUF models come in various quantization formats that trade off between file size, VRAM usage, and output quality. Understanding these formats helps you choose the right model variant for your hardware and use case."}),e.jsx("h4",{id:"what-is-quantization?",children:"What is Quantization?"}),e.jsx("p",{children:"Quantization reduces model precision from the original 16-bit or 32-bit floating-point weights to lower bit representations. This dramatically decreases:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"File size"})," - A 7B model goes from ~14GB (FP16) to ~3GB (Q4)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"VRAM usage"})," - More aggressive quantization allows larger models on limited hardware"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Inference speed"})," - Smaller models load faster and may run faster on memory-constrained systems"]})]}),e.jsxs("p",{children:["The tradeoff is ",e.jsx("strong",{children:"quality degradation"})," - lower precision means less accurate representations of the original weights, which can affect output coherence, reasoning ability, and factual accuracy."]}),e.jsx("h4",{id:"what-are-k-quants?",children:"What are K-Quants?"}),e.jsxs("p",{children:["K-quants (introduced by llama.cpp) use ",e.jsx("strong",{children:"per-block scaling"})," with importance weighting. Instead of applying uniform quantization across all weights, K-quants:"]}),e.jsxs("ol",{children:[e.jsx("li",{children:"Divide weights into small blocks (typically 32 or 256 values)"}),e.jsx("li",{children:"Calculate optimal scale factors per block"}),e.jsx("li",{children:"Preserve more precision for important weights"})]}),e.jsx("p",{children:"This produces better quality than naive quantization at the same bit rate. K-quant variants include size suffixes:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"S"})," (Small) - Smallest file size, lowest quality within that bit level"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"M"})," (Medium) - Balanced size and quality"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"L"})," (Large) - Larger file, better quality"]})]}),e.jsx("h4",{id:"standard-quantization-formats",children:"Standard Quantization Formats"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Format"}),e.jsx("th",{children:"Bits/Weight"}),e.jsx("th",{children:"Quality"}),e.jsx("th",{children:"VRAM (7B Model)"}),e.jsx("th",{children:"Use Case"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Q4_0"})}),e.jsx("td",{children:"4.5"}),e.jsx("td",{children:"Low"}),e.jsx("td",{children:"~4 GB"}),e.jsx("td",{children:"Maximum compression, quality loss noticeable"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Q4_1"})}),e.jsx("td",{children:"5.0"}),e.jsx("td",{children:"Low-Med"}),e.jsx("td",{children:"~4.3 GB"}),e.jsx("td",{children:"Slightly better than Q4_0"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Q4_K_S"})}),e.jsx("td",{children:"4.5"}),e.jsx("td",{children:"Medium"}),e.jsx("td",{children:"~4 GB"}),e.jsx("td",{children:"K-quant, good balance for limited VRAM"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Q4_K_M"})}),e.jsx("td",{children:"4.8"}),e.jsx("td",{children:"Medium"}),e.jsx("td",{children:"~4.5 GB"}),e.jsx("td",{children:"K-quant, recommended 4-bit option"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Q5_K_S"})}),e.jsx("td",{children:"5.5"}),e.jsx("td",{children:"Medium-High"}),e.jsx("td",{children:"~5 GB"}),e.jsx("td",{children:"Good quality, moderate size"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Q5_K_M"})}),e.jsx("td",{children:"5.7"}),e.jsx("td",{children:"High"}),e.jsx("td",{children:"~5.3 GB"}),e.jsx("td",{children:"Recommended for most users"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Q6_K"})}),e.jsx("td",{children:"6.5"}),e.jsx("td",{children:"High"}),e.jsx("td",{children:"~6 GB"}),e.jsx("td",{children:"Near-original quality"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Q8_0"})}),e.jsx("td",{children:"8.5"}),e.jsx("td",{children:"Highest"}),e.jsx("td",{children:"~8 GB"}),e.jsx("td",{children:"Best quality, largest size"})]})]})]}),e.jsx("h4",{id:"iq-importance-matrix-quantization",children:"IQ (Importance Matrix) Quantization"}),e.jsxs("p",{children:["IQ formats use ",e.jsx("strong",{children:"learned importance matrices"})," to determine which weights matter most. They achieve extreme compression with minimal quality loss by:"]}),e.jsxs("ol",{children:[e.jsx("li",{children:"Analyzing weight importance during quantization"}),e.jsx("li",{children:"Allocating more bits to critical weights"}),e.jsx("li",{children:"Aggressively compressing less important weights"})]}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Format"}),e.jsx("th",{children:"Bits/Weight"}),e.jsx("th",{children:"Quality"}),e.jsx("th",{children:"Use Case"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"IQ1_S"})}),e.jsx("td",{children:"~1.5"}),e.jsx("td",{children:"Very Low"}),e.jsx("td",{children:"Extreme compression, experimental"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"IQ1_M"})}),e.jsx("td",{children:"~1.75"}),e.jsx("td",{children:"Low"}),e.jsx("td",{children:"Extreme compression, experimental"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"IQ2_XXS"})}),e.jsx("td",{children:"~2.0"}),e.jsx("td",{children:"Low"}),e.jsx("td",{children:"Ultra-low VRAM situations"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"IQ2_XS"})}),e.jsx("td",{children:"~2.3"}),e.jsx("td",{children:"Low-Med"}),e.jsx("td",{children:"Very constrained hardware"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"IQ2_S"})}),e.jsx("td",{children:"~2.5"}),e.jsx("td",{children:"Medium"}),e.jsx("td",{children:"Constrained hardware"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"IQ3_XXS"})}),e.jsx("td",{children:"~3.0"}),e.jsx("td",{children:"Medium"}),e.jsx("td",{children:"Good balance for low VRAM"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"IQ3_XS"})}),e.jsx("td",{children:"~3.3"}),e.jsx("td",{children:"Medium-High"}),e.jsx("td",{children:"Better quality low-bit option"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"IQ4_XS"})}),e.jsx("td",{children:"~4.0"}),e.jsx("td",{children:"High"}),e.jsx("td",{children:"Alternative to Q4_K variants"})]})]})]}),e.jsx("h4",{id:"ud-ultra-dynamic-quantization",children:"UD (Ultra-Dynamic) Quantization"}),e.jsxs("p",{children:["UD quantization applies ",e.jsx("strong",{children:"different precision levels per layer"}),". Neural network layers have varying sensitivity to quantization:"]}),e.jsxs("ul",{children:[e.jsx("li",{children:"Early layers (embeddings, first attention blocks) - More sensitive"}),e.jsx("li",{children:"Middle layers - Moderately sensitive"}),e.jsx("li",{children:"Later layers - Often more tolerant of compression"})]}),e.jsx("p",{children:"UD variants analyze each layer and assign optimal bit depths, achieving better quality than uniform quantization at similar average bits per weight."}),e.jsxs("p",{children:["Common UD naming: ",e.jsx("code",{children:"UD-Q5_K_XL"})," means Ultra-Dynamic with Q5 K-quant base, XL quality tier."]}),e.jsx("h4",{id:"choosing-the-right-quantization",children:"Choosing the Right Quantization"}),e.jsx("p",{children:e.jsx("strong",{children:"By Available VRAM:"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"VRAM"}),e.jsx("th",{children:"7B Model"}),e.jsx("th",{children:"13B Model"}),e.jsx("th",{children:"30B Model"}),e.jsx("th",{children:"70B Model"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"6 GB"}),e.jsx("td",{children:"Q4_K_M"}),e.jsx("td",{children:"IQ3_XXS"}),e.jsx("td",{children:"-"}),e.jsx("td",{children:"-"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"8 GB"}),e.jsx("td",{children:"Q6_K"}),e.jsx("td",{children:"Q4_K_M"}),e.jsx("td",{children:"IQ2_XXS"}),e.jsx("td",{children:"-"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"12 GB"}),e.jsx("td",{children:"Q8_0"}),e.jsx("td",{children:"Q5_K_M"}),e.jsx("td",{children:"IQ3_XXS"}),e.jsx("td",{children:"-"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"16 GB"}),e.jsx("td",{children:"Q8_0"}),e.jsx("td",{children:"Q8_0"}),e.jsx("td",{children:"Q4_K_M"}),e.jsx("td",{children:"-"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"24 GB"}),e.jsx("td",{children:"Q8_0"}),e.jsx("td",{children:"Q8_0"}),e.jsx("td",{children:"Q6_K"}),e.jsx("td",{children:"IQ3_XXS"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"48 GB"}),e.jsx("td",{children:"Q8_0"}),e.jsx("td",{children:"Q8_0"}),e.jsx("td",{children:"Q8_0"}),e.jsx("td",{children:"Q4_K_M"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"64 GB+"}),e.jsx("td",{children:"Q8_0"}),e.jsx("td",{children:"Q8_0"}),e.jsx("td",{children:"Q8_0"}),e.jsx("td",{children:"Q6_K/Q8_0"})]})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"By Use Case:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Production/Quality-Critical"}),": Q8_0 or Q6_K - Minimal quality loss"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"General Use"}),": Q5_K_M - Best balance of quality and efficiency"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"VRAM-Constrained"}),": Q4_K_M - Good quality at low VRAM cost"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Experimental/Testing"}),": IQ3_XXS or IQ2_XS - Run larger models on limited hardware"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Quality Guidelines:"})}),e.jsxs("ol",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Start with Q5_K_M"})," - It's the sweet spot for most use cases"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Use Q8_0 for reasoning-heavy tasks"})," - Math, code, complex logic benefit from higher precision"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Q4_K_M is the floor"})," - Below this, quality degrades noticeably for most models"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"IQ formats are specialized"})," - Great for running models that wouldn't otherwise fit, but expect some quality loss"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Larger models at lower quant often beat smaller models at higher quant"})," - A 70B Q4 may outperform a 7B Q8"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Example Configuration:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  # Quality-focused: Q8_0 for a model that fits in VRAM
  Qwen3-8B-Q8_0:
    context_window: 32768
    cache_type_k: q8_0
    cache_type_v: q8_0

  # VRAM-constrained: Q4_K_M to fit larger model
  Llama-3.3-70B-Instruct-Q4_K_M:
    context_window: 8192
    split_mode: row
    n_gpu_layers: 0`})}),e.jsx("h3",{id:"37-vram-estimation",children:"3.7 VRAM Estimation"}),e.jsx("p",{children:"Before loading a model, you need to know whether it will fit in your GPU's memory. VRAM usage comes from two things: the model weights (fixed cost determined by the model you chose) and the KV cache (variable cost determined by your configuration choices from the previous sections  context window size, number of slots, and cache precision). If the total exceeds your available VRAM, the model either won't load or will partially fall back to the CPU, which significantly slows inference. This section walks through how to estimate the total."}),e.jsx("p",{children:e.jsx("strong",{children:"Total VRAM = Model Weights + KV Cache"})}),e.jsx("p",{children:"Model weights are determined by the GGUF file size (e.g., ~8GB for a 7B Q8_0 model). The KV cache is the variable cost you control through configuration."}),e.jsx("p",{children:e.jsx("strong",{children:"Model Weights (Q8_0 quantization)"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"1-3B parameters: 2-4 GB"}),e.jsx("li",{children:"7-8B parameters: 8-10 GB"}),e.jsx("li",{children:"13B parameters: 14-16 GB"}),e.jsx("li",{children:"30B parameters: 32-36 GB"}),e.jsx("li",{children:"70B parameters: 72-80 GB"})]}),e.jsx("h4",{id:"slots-and-sequences",children:"Slots and Sequences"}),e.jsx("p",{children:"A slot is a processing unit that handles one request at a time. Each slot is assigned a unique sequence ID that maps to an isolated partition in the shared KV cache. The mapping is always 1:1:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`NSeqMax = 4 (set via n_seq_max in model config)

Slot 0    Sequence 0    KV cache partition 0
Slot 1    Sequence 1    KV cache partition 1
Slot 2    Sequence 2    KV cache partition 2
Slot 3    Sequence 3    KV cache partition 3`})}),e.jsxs("p",{children:[e.jsx("code",{children:"NSeqMax"})," controls how many slots (and sequences) are created. More slots means more concurrent requests, but each slot reserves its own KV cache partition in VRAM whether or not it is actively used."]}),e.jsx("h4",{id:"what-affects-kv-cache-memory-per-sequence",children:"What Affects KV Cache Memory Per Sequence"}),e.jsx("p",{children:"Each sequence's KV cache partition size is determined by three factors:"}),e.jsx("ol",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Context Window (<code>n_ctx</code>)"}),"  The maximum number of tokens the sequence can"]})}),e.jsx("p",{children:"hold. Larger context windows linearly increase memory. 32K context uses 4 the memory of 8K context."}),e.jsx("ol",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Number of Layers (<code>block_count</code>)"}),"  Every transformer layer stores its own"]})}),e.jsx("p",{children:"key and value tensors per token. More layers means more memory per token. A 70B model with 80 layers uses ~2.5 more per-token memory than a 7B model with 32 layers."}),e.jsx("ol",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"KV Cache Precision (<code>bytes_per_element</code>)"}),"  The data type used to store"]})}),e.jsxs("p",{children:["cached keys and values: - ",e.jsx("code",{children:"f16"})," = 2 bytes per element (default, best quality) - ",e.jsx("code",{children:"q8_0"})," = 1 byte per element (50% VRAM savings, good quality)"]}),e.jsxs("p",{children:["The head geometry (",e.jsx("code",{children:"head_count_kv"}),", ",e.jsx("code",{children:"key_length"}),", ",e.jsx("code",{children:"value_length"}),") is fixed by the model architecture and read from the GGUF header."]}),e.jsx("p",{children:"The formula:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`KV_Per_Token_Per_Layer = head_count_kv  (key_length + value_length)  bytes_per_element
KV_Per_Sequence        = n_ctx  n_layers  KV_Per_Token_Per_Layer`})}),e.jsx("h4",{id:"what-affects-total-kv-cache-slot-memory",children:"What Affects Total KV Cache (Slot Memory)"}),e.jsx("p",{children:"Total KV cache (Slot Memory) is the per-sequence cost multiplied by the number of slots:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Slot_Memory = NSeqMax  KV_Per_Sequence
Total_VRAM  = Model_Weights + Slot_Memory`})}),e.jsx("p",{children:"Memory is statically allocated upfront when the model loads. All slots reserve their full KV cache partition regardless of whether they are actively processing a request."}),e.jsx("h4",{id:"caching-modes-spc-imc",children:"Caching Modes (SPC / IMC)"}),e.jsx("p",{children:"Neither SPC nor IMC adds extra sequences to the VRAM calculation."}),e.jsx("p",{children:"SPC (System Prompt Cache) externalizes the decoded system prompt KV state to a byte buffer in RAM. On each request, the KV state is restored into the slot's sequence via StateSeqSetData. No dedicated cache sequence is permanently occupied."}),e.jsx("p",{children:"IMC (Incremental Message Cache) uses dedicated slot/seq binding  each slot's sequence IS the cache. No separate cache sequences."}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Mode"}),e.jsx("th",{children:"Slot Lifetime"}),e.jsx("th",{children:"Cache Strategy"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"off"}),e.jsx("td",{children:"Cleared after request"}),e.jsx("td",{children:"None"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"SPC"}),e.jsx("td",{children:"Cleared after request"}),e.jsx("td",{children:"System prompt decoded once, KV state stored in RAM, restored per request via StateSeqSetData"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"IMC"}),e.jsx("td",{children:"Persists across requests"}),e.jsx("td",{children:"Full conversation cached in the slot's KV cache sequence"})]})]})]}),e.jsx("h4",{id:"example-real-model-calculation",children:"Example: Real Model Calculation"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Model                   : Qwen_Qwen3.5-35B-A3B-Q8_0
Model Weights           : 36.0 GB
Context Window (n_ctx)  : 131,072 (128K)
Bytes Per Element       : 1 (q8_0)
block_count (n_layers)  : 48
attention.head_count_kv : 4
attention.key_length    : 128
attention.value_length  : 128

Step 1  Per-token-per-layer cost:

  KV_Per_Token_Per_Layer = 4  (128 + 128)  1 = 1,024 bytes

Step 2  Per-sequence cost:

  KV_Per_Sequence = 131,072  48  1,024 = ~6.4 GB

Step 3  Total KV cache (NSeqMax = 2):

  Slot_Memory = 2  6.4 GB = ~12.8 GB

Step 4  Total VRAM:

  Total_VRAM = 36.0 GB + 12.8 GB = ~48.8 GB`})}),e.jsx("h3",{id:"38-model-specific-tuning",children:"3.8 Model-Specific Tuning"}),e.jsx("p",{children:'The previous sections covered general configuration that applies to all models. However, different model architectures  vision, audio, Mixture of Experts (MoE), and embedding models  each have their own characteristics that benefit from specific tuning. A vision model processes images as large batches of tokens, which needs different batch settings than a text-only chat model. An MoE model routes tokens through specialized "expert" sub-networks, which affects how you split work across GPUs. This section provides recommended configurations for each model type so you can get the best performance out of the box.'}),e.jsx("p",{children:e.jsx("strong",{children:"Vision and Audio Models"})}),e.jsxs("p",{children:["Vision models process image tiles as large token batches. Low ",e.jsx("code",{children:"n_ubatch"})," values cause multiple decode passes per image, significantly slowing inference."]}),e.jsxs("p",{children:["Keep ",e.jsx("code",{children:"n_ubatch"})," high for efficient media token processing:"]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  Qwen2.5-VL-3B-Instruct-Q8_0:
    n_batch: 2048
    n_ubatch: 2048 # High for image/audio token batches
    n_seq_max: 2 # Process up to 2 requests concurrently`})}),e.jsx("p",{children:e.jsx("strong",{children:"Mixture of Experts (MoE) Models"})}),e.jsxs("p",{children:["MoE models like ",e.jsx("code",{children:"Qwen3-Coder-30B-A3B"}),' have many total parameters but only activate a small subset per token  the "A3B" means 30B total, 3B active. This saves compute on GPU clusters but has important implications for Apple Silicon and other memory-bandwidth-bound systems.']}),e.jsxs("p",{children:["On Apple Silicon (unified memory), inference speed is determined by how many ",e.jsx("strong",{children:"bytes must be read from memory per generated token"}),", not compute. MoE models create ",e.jsx("strong",{children:"scattered memory access patterns"}),"  the routing layer must select which experts to activate, and those expert weights are spread across memory. This scattered access underutilizes memory bandwidth compared to the sequential access pattern of dense models."]}),e.jsx("p",{children:"A dense model at Q4 quantization may outperform a smaller-active MoE model at Q8 quantization on Apple Silicon, even though the MoE activates fewer parameters. The dense model reads weights sequentially (ideal for bandwidth saturation) at 0.5 bytes per parameter, while the MoE reads scattered expert weights at 1 byte per parameter. The total bytes moved per token can be comparable  but the dense model's sequential pattern is more efficient."}),e.jsx("p",{children:"MoE also tends to produce lower quality per-token than a dense model with the same number of active parameters, because only a fraction of the model's knowledge is engaged per token. A dense model at Q4 with all parameters active has far more model capacity per token than an MoE with 3B active, even at Q8 precision."}),e.jsxs("p",{children:["MoE models can be sensitive to aggressive KV cache quantization. If you notice quality degradation, try ",e.jsx("code",{children:"f16"})," cache types."]}),e.jsx("p",{children:"Use row-based tensor parallelism for multi-GPU setups:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  Qwen3-MoE-30B-A3B-Q8_0:
    split_mode: row # Best for MoE architecture
    cache_type_k: q8_0 # Be cautious with aggressive quantization
    cache_type_v: q8_0`})}),e.jsx("p",{children:e.jsx("strong",{children:"Hybrid Models (Attention + Recurrent)"})}),e.jsx("p",{children:"Hybrid models like Qwen3-Coder-Next mix traditional Attention layers with recurrent layers (DeltaNet or SSM/Mamba). Unlike MoE models, hybrid models are dense  every parameter participates in every token. Kronk detects hybrid models automatically at load time."}),e.jsx("p",{children:"Hybrid models have specific constraints:"}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"KV cache must be f16"}),"  quantized cache types (",e.jsx("code",{children:"q8_0"}),") are incompatible"]})}),e.jsxs("p",{children:["with the recurrent layers. This doubles KV cache memory compared to models that support ",e.jsx("code",{children:"q8_0"}),"."]}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Flash attention is disabled"}),"  Kronk automatically disables flash"]})}),e.jsx("p",{children:"attention for hybrid models."}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"IMC uses snapshot/restore"}),"  see ",e.jsx("a",{href:"#imc-hybrid",children:"IMC Hybrid"})," for details"]})}),e.jsx("p",{children:"on how caching works with recurrent state."}),e.jsx("p",{children:"When choosing between a hybrid model and an MoE model for Apple Silicon, consider: the hybrid model's sequential memory access pattern and dense activation give it both better quality per token and better bandwidth utilization. The trade-off is total model size  hybrid models use all parameters, so you need enough unified memory to hold them plus the larger f16 KV cache."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  Qwen3-Coder-Next-UD-Q4_K_XL:
    cache_type_k: f16 # Required for hybrid models
    cache_type_v: f16 # Required for hybrid models
    incremental_cache: true`})}),e.jsx("p",{children:e.jsx("strong",{children:"Embedding Models"})}),e.jsxs("p",{children:["Embedding models process complete inputs in a single pass, so larger ",e.jsx("code",{children:"n_batch"})," values improve throughput."]}),e.jsx("p",{children:"Optimize batch size for your typical input lengths:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  embeddinggemma-300m-qat-Q8_0:
    n_batch: 8192 # Can equal context_window
    n_ubatch: 512 # Align with typical sliding window
    n_seq_max: 4 # 4 model instances for concurrency`})}),e.jsx("h3",{id:"39-speculative-decoding",children:"3.9 Speculative Decoding"}),e.jsx("p",{children:`Speculative decoding uses a small, fast "draft" model to predict candidate tokens, then verifies them against the full "target" model in a single forward pass. When the draft model's predictions match the target's, multiple tokens are accepted per decode step  improving throughput without changing output quality. The output distribution is mathematically guaranteed to match the target model exactly, regardless of draft quality (Leviathan et al., 2023).`}),e.jsx("p",{children:e.jsx("strong",{children:"How It Works"})}),e.jsxs("ol",{children:[e.jsx("li",{children:"The draft model auto-regressively generates N candidate tokens (default 5)"}),e.jsx("li",{children:"All candidates plus the last accepted token are added to the target model's"})]}),e.jsx("p",{children:"batch and decoded in one forward pass"}),e.jsx("ol",{children:e.jsx("li",{children:"Each candidate is verified using speculative sampling: accepted with"})}),e.jsxs("p",{children:["probability ",e.jsx("code",{children:"min(1, p_target / q_draft)"}),", where ",e.jsx("code",{children:"p_target"})," is the target's probability and ",e.jsx("code",{children:"q_draft"})," is the draft's probability for that token"]}),e.jsx("ol",{children:e.jsxs("li",{children:["On rejection, a corrective token is sampled from ",e.jsx("code",{children:"max(0, p_target - q_draft)"})]})}),e.jsx("p",{children:"normalized, and remaining candidates are discarded"}),e.jsx("ol",{children:e.jsx("li",{children:"If all candidates are accepted, a bonus token is sampled from the target"})}),e.jsx("p",{children:"The speedup depends on the draft model's acceptance rate. Higher acceptance means more tokens per forward pass. Acceptance rates depend on:"}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Draft model quality"}),"  A larger, more capable draft produces better"]})}),e.jsx("p",{children:"predictions. A Q4 quantization of the same architecture tends to outperform a much smaller model."}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Temperature"}),"  Lower temperatures (more deterministic) yield higher"]})}),e.jsx("p",{children:"acceptance rates. At temperature 0.8, expect ~30% of steps to accept zero draft tokens."}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Task type"}),"  Predictable text (boilerplate, common patterns) accepts"]})}),e.jsx("p",{children:"more often than creative or reasoning-heavy output."}),e.jsx("p",{children:e.jsx("strong",{children:"Requirements"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Draft and target models must share the ",e.jsx("strong",{children:"same vocabulary"})," (same tokenizer)"]}),e.jsxs("li",{children:[e.jsx("code",{children:"n_seq_max"})," must be ",e.jsx("code",{children:"1"})," (single-slot mode only)"]}),e.jsx("li",{children:"The draft model must be downloaded and available locally"}),e.jsx("li",{children:"Only text generation is supported (not vision/audio)"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Configuration"})}),e.jsxs("p",{children:["Speculative decoding is configured via the ",e.jsx("code",{children:"draft-model"})," block in catalog YAML or ",e.jsx("code",{children:"model_config.yaml"}),":"]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`# In a catalog YAML file
config:
  context-window: 32768
  nbatch: 2048
  nubatch: 512
  cache-type-k: q8_0
  cache-type-v: q8_0
  nseq-max: 1
  incremental-cache: true
  draft-model:
    model-id: Qwen3-0.6B-Q8_0 # Draft model ID (must be downloaded)
    ndraft: 5 # Candidates per step (default: 5)
    ngpu-layers: 0 # GPU layers (0=all, -1=none)
    device: "" # Pin to specific GPU (e.g., "GPU1")`})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`# In model_config.yaml
Qwen3-8B-Q8_0:
  incremental-cache: true
  nseq-max: 1
  draft-model:
    model-id: Qwen3-0.6B-Q8_0
    ndraft: 5`})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Field"}),e.jsx("th",{children:"YAML Key"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"ModelID"}),e.jsx("td",{children:e.jsx("code",{children:"model-id"})}),e.jsx("td",{children:"(none)"}),e.jsx("td",{children:"Draft model ID (must be downloaded)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"NDraft"}),e.jsx("td",{children:e.jsx("code",{children:"ndraft"})}),e.jsx("td",{children:"5"}),e.jsx("td",{children:"Number of candidate tokens per step"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"NGpuLayers"}),e.jsx("td",{children:e.jsx("code",{children:"ngpu-layers"})}),e.jsx("td",{children:"0 (all)"}),e.jsx("td",{children:"GPU layers for draft model"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Device"}),e.jsx("td",{children:e.jsx("code",{children:"device"})}),e.jsx("td",{children:'""'}),e.jsx("td",{children:"Pin draft model to a specific GPU"})]})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Draft Model Selection"})}),e.jsx("p",{children:"Choose a draft model that shares the same tokenizer family as the target. A quantized version of the same architecture at lower precision works well:"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Target Model"}),e.jsx("th",{children:"Recommended Draft"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Qwen3-8B-Q8_0"}),e.jsx("td",{children:"Qwen3-0.6B-Q8_0"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Qwen_Qwen3.5-35B-A3B-Q8_0"}),e.jsx("td",{children:"Qwen3-Coder-30B-A3B-Instruct-UD-Q4_K_XL"})]})]})]}),e.jsx("p",{children:"The second example uses the same MoE architecture at lower quantization, which shares more of the target's weight structure and produces higher acceptance rates than a smaller dense model."}),e.jsx("p",{children:e.jsx("strong",{children:"Performance Characteristics"})}),e.jsx("p",{children:"Speculative decoding helps most when the target model is large relative to the draft. For dense models where the target is already fast (e.g., 8B at 33+ TPS), the overhead of running a draft model may not provide a net speedup. MoE models with large parameter counts but sparse activation (e.g., 30B-A3B) are better candidates, but only when using a high-quality draft."}),e.jsxs("p",{children:["The ",e.jsx("code",{children:"ndraft"})," parameter controls how many candidates to generate. Higher values increase the potential speedup but also increase wasted work when predictions are rejected. The default of 5 is a good starting point; tune based on your observed acceptance rates."]}),e.jsx("h3",{id:"310-sampling-parameters",children:"3.10 Sampling Parameters"}),e.jsx("p",{children:"Sampling parameters control the randomness and quality of generated text. These are set per-request in the API call."}),e.jsx("p",{children:"For most models you will want to touch these basic sampling parameters. There are many more which will be presented later."}),e.jsx("p",{children:e.jsx("strong",{children:"Temperature"})}),e.jsx("p",{children:"Controls randomness. Lower values produce more deterministic output."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "temperature": 0.8
}`})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"0.0-0.3"})," - Focused, deterministic (good for code, factual Q&A)"]}),e.jsxs("li",{children:[e.jsx("code",{children:"0.5-0.8"})," - Balanced (good for general chat)"]}),e.jsxs("li",{children:[e.jsx("code",{children:"0.9-1.2"})," - Creative (good for storytelling, brainstorming)"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Top-K and Top-P"})}),e.jsx("p",{children:"Limit the token selection pool:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "top_k": 40,
  "top_p": 0.9
}`})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"top_k"})," - Consider only the K most probable tokens (default: 40)"]}),e.jsxs("li",{children:[e.jsx("code",{children:"top_p"})," - Consider tokens until cumulative probability reaches P (default: 0.9)"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Repetition Control"})}),e.jsx("p",{children:"Reduce repetitive output:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "repeat_penalty": 1.1,
  "repeat_last_n": 64
}`})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"repeat_penalty"})," - Penalty for repeated tokens (1.0 = off, 1.1 = mild)"]}),e.jsxs("li",{children:[e.jsx("code",{children:"repeat_last_n"})," - How many recent tokens to check (default: 64)"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"DRY Sampler (Don't Repeat Yourself)"})}),e.jsx("p",{children:"Advanced n-gram repetition penalty:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "dry_multiplier": 1.05,
  "dry_base": 1.75,
  "dry_allowed_length": 2
}`})}),e.jsx("p",{children:e.jsx("strong",{children:"Max Tokens"})}),e.jsx("p",{children:"Limit the response length:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "max_tokens": 2048
}`})}),e.jsx("h3",{id:"311-model-config-file-example",children:"3.11 Model Config File Example"}),e.jsx("p",{children:"Create a YAML config file for custom model settings:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`# model-config.yaml
models:
  Qwen3-8B-Q8_0:
    context_window: 32768
    n_batch: 2048
    n_ubatch: 512
    n_seq_max: 2
    cache_type_k: q8_0
    cache_type_v: q8_0
    flash_attention: enabled
    system_prompt_cache: true

  Llama-3.3-70B-Instruct-Q8_0:
    context_window: 8192
    n_gpu_layers: 0
    split_mode: row
    offload_kqv: true`})}),e.jsx("p",{children:"Start the server with custom config:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk server start --model-config-file=model-config.yaml"})}),e.jsx("hr",{}),e.jsx("h2",{id:"chapter-4-batch-processing",children:"Chapter 4: Batch Processing"}),e.jsx("p",{children:"Batch processing allows Kronk to handle multiple concurrent requests efficiently by sharing model resources. This chapter explains the architecture and how to optimize for your workload."}),e.jsx("h3",{id:"41-architecture-overview",children:"4.1 Architecture Overview"}),e.jsxs("p",{children:["For text inference models (including vision/audio), Kronk always creates a batch engine with ",e.jsx("code",{children:"NSeqMax"})," slots (defaulting to 1). ",e.jsx("code",{children:"NSeqMax"})," controls how many sequences are processed in parallel within a single model instance."]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`                    
   Request 1                                    
                              Request Queue            
   Request 2       (capacity: NSeqMax  2)      
                                                       
   Request 3                                    
                    
                                     
                                     
                    
                               Batch Engine            
                                                       
                                 
                       Slot 0     Slot 1    ...    
                       seqID=0    seqID=1          
                                
                                                    
                               
                                                      
                              Shared KV Cache          
                        
                       seq 0  seq 1  seq 2  ...   
                        
                    
                                      
                                      
                    
                            llama.cpp Backend          
                           (GPU/CPU Inference)         
                    `})}),e.jsx("h3",{id:"42-slots-and-sequences",children:"4.2 Slots and Sequences"}),e.jsx("p",{children:"The batch engine divides its capacity into slots and sequences. Together they provide the mechanism for processing multiple requests concurrently while keeping each request's data isolated inside the shared KV cache."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Slots"})," are processing units that handle individual requests. Each slot tracks its own state: prompt tokens, decode position, sampler, and response channel."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Sequences"})," are isolated partitions in the shared KV cache. Each slot is assigned a unique sequence ID, ensuring requests don't interfere with each other's attention state."]}),e.jsx("p",{children:"The slot/sequence layout is the same for all caching strategies:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`NSeqMax = 4

Slot 0    seqID = 0    KV cache partition 0
Slot 1    seqID = 1    KV cache partition 1
Slot 2    seqID = 2    KV cache partition 2
Slot 3    seqID = 3    KV cache partition 3`})}),e.jsxs("p",{children:["How a slot uses its sequence depends on the caching strategy. Without caching, the sequence is cleared between requests. With SPC or IMC, the sequence retains cached tokens to avoid redundant processing. See ",e.jsx("a",{href:"#35-parallel-inference-nseqmax",children:"Section 3.5"})," for details on how each caching strategy affects slot behavior."]}),e.jsx("h3",{id:"43-request-flow",children:"4.3 Request Flow"}),e.jsx("p",{children:"Each request moves through the batch engine in the following stages:"}),e.jsxs("ol",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Queue"}),": Request enters the queue (backpressure if full)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Assign"}),": Available slot picks up the request"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Cache Setup"}),": Prepare the slot's sequence based on caching strategy:",e.jsxs("ul",{children:[e.jsx("li",{children:"Clear the sequence (no caching)"}),e.jsx("li",{children:"Clear the sequence, then copy cached KV state from dedicated SPC sequence (SPC)"}),e.jsx("li",{children:"Extend or rebuild the conversation cache in place (IMC)"})]})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Prefill"}),": Tokenize and process remaining prompt tokens"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Decode"}),": Generate tokens one at a time, streaming to client"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Complete"}),": Release the slot:",e.jsxs("ul",{children:[e.jsx("li",{children:"Clear the entire sequence (no caching or SPC)"}),e.jsx("li",{children:"Dense/MoE with IMC: Trim generated tokens via partial range delete,"})]})]})]}),e.jsxs("p",{children:["keep cached conversation prefix - Hybrid with IMC: Full clear + restore snapshot from byte buffer, keep cached conversation prefix (see ",e.jsx("a",{href:"#49-model-types-and-state-management",children:"Section 4.9"}),")"]}),e.jsx("h3",{id:"44-configuring-batch-processing",children:"4.4 Configuring Batch Processing"}),e.jsxs("p",{children:["Batch processing is controlled primarily through the model configuration. The key setting is ",e.jsx("code",{children:"NSeqMax"}),", which determines how many slots the batch engine creates and therefore how many requests can be processed in parallel. Increasing ",e.jsx("code",{children:"NSeqMax"})," improves concurrency but requires proportionally more KV cache memory, so it's important to balance throughput against available VRAM."]}),e.jsx("p",{children:e.jsx("strong",{children:"Enable Batch Processing"})}),e.jsxs("p",{children:["Set ",e.jsx("code",{children:"NSeqMax > 1"})," in your model config:"]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  Qwen3-8B-Q8_0:
    n_seq_max: 4 # 4 concurrent requests`})}),e.jsx("p",{children:e.jsx("strong",{children:"Queue Depth"})}),e.jsxs("p",{children:["The request queue holds ",e.jsx("code",{children:"NSeqMax  2"})," requests by default. With ",e.jsx("code",{children:"NSeqMax=4"}),", up to 8 requests can be in-flight: 4 actively processing in slots and 4 waiting in the queue. This multiplier is configurable via ",e.jsx("code",{children:"WithQueueDepth"})," when using the SDK:"]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-go",children:"krn, err := kronk.New(ctx, cfg, kronk.WithQueueDepth(3))"})}),e.jsx("p",{children:"When all slots and queue positions are occupied, new requests block until a slot completes or the request's context is cancelled. If the engine is shutting down, queued requests receive an immediate error. This backpressure mechanism prevents the system from accepting more work than it can process within a reasonable time."}),e.jsx("p",{children:e.jsx("strong",{children:"Memory and Caching"})}),e.jsxs("p",{children:["Each slot reserves its own KV cache partition, so increasing ",e.jsx("code",{children:"NSeqMax"})," increases VRAM usage proportionally. Neither SPC nor IMC adds extra sequences. For details on how slot memory is allocated and how to estimate total VRAM, see ",e.jsx("a",{href:"#35-parallel-inference-nseqmax",children:"Section 3.5"})," and ",e.jsx("a",{href:"#37-vram-estimation",children:"Section 3.7"}),"."]}),e.jsx("h3",{id:"45-concurrency-by-model-type",children:"4.5 Concurrency by Model Type"}),e.jsx("p",{children:"Not all model types achieve concurrency the same way. Text inference models (including vision and audio) use the batch engine described in the previous sections, where multiple slots share a single model context and their tokens are combined into one decode call. Embedding and reranking models take a different approach  they create a pool of independent contexts that each process requests separately. The table below summarizes the distinction, and the diagrams that follow show the request flow for each approach."}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Model Type"}),e.jsx("th",{children:"NSeqMax Behavior"}),e.jsx("th",{children:"Concurrency Method"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Text (chat, completion)"}),e.jsx("td",{children:"Batch parallelism"}),e.jsx("td",{children:"Shared model, multiple slots"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Vision/Audio"}),e.jsx("td",{children:"Batch parallelism"}),e.jsx("td",{children:"Shared model, multiple slots"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Embedding"}),e.jsx("td",{children:"Context pool"}),e.jsx("td",{children:"Shared weights, multiple contexts"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Reranking"}),e.jsx("td",{children:"Context pool"}),e.jsx("td",{children:"Shared weights, multiple contexts"})]})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Chat Request Flow (NSeqMax=4)"})}),e.jsx("p",{children:"When multiple users send chat requests at the same time, each request is assigned to its own slot inside the batch engine. Rather than processing each request in isolation, the engine combines tokens from all active slots into a single GPU operation. This is what makes batch processing efficient  one large decode call instead of several small ones. The following diagram shows this flow with four concurrent requests:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Request 1  acquireModel(Qwen3-8B)  ChatStreaming()  batch.Submit()
Request 2  acquireModel(Qwen3-8B)  ChatStreaming()  batch.Submit()
Request 3  acquireModel(Qwen3-8B)  ChatStreaming()  batch.Submit()
Request 4  acquireModel(Qwen3-8B)  ChatStreaming()  batch.Submit()
                                                                   
                                               
                                                     Batch Engine         
                                                 
                                                Slot0Slot1Slot2Slot3 
                                                 R1   R2   R3   R4   
                                                 
                                                                         
                                                  Single batched decode   
                                                  (all 4 in parallel)     
                                               `})}),e.jsx("p",{children:"From the outside, each request behaves as if it has the model to itself  it receives its own stream of generated tokens. Internally, the batch engine is doing the work for all four requests in lockstep, which uses the GPU far more efficiently than handling them one at a time."}),e.jsx("p",{children:e.jsx("strong",{children:"Embedding/Rerank Request Flow (NSeqMax=4)"})}),e.jsxs("p",{children:["Embedding and reranking models don't use the batch engine. Instead, Kronk creates a pool of independent contexts  one per ",e.jsx("code",{children:"NSeqMax"})," slot. When a request arrives, it acquires a context from the pool, processes its inputs, and releases the context back. If all contexts are in use, the request blocks until one becomes available. The following diagram shows this flow:"]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Request 1  acquireModel()  pool.acquire()  Context 1  decode  results
Request 2  acquireModel()  pool.acquire()  Context 2  decode  results
Request 3  acquireModel()  pool.acquire()  Context 3  decode  results
Request 4  acquireModel()  pool.acquire()  Context 4  decode  results
                                       
                          All 4 run in parallel
                          (separate decode calls)`})}),e.jsx("p",{children:"Unlike the batch engine, each request runs its own separate decode call  there is no combining of work across requests. The efficiency comes from sharing the model weights across all contexts, so only the KV cache memory is duplicated."}),e.jsx("h3",{id:"46-performance-tuning",children:"4.6 Performance Tuning"}),e.jsxs("p",{children:["The right ",e.jsx("code",{children:"NSeqMax"})," value depends on your workload. More slots increase throughput by serving more requests in parallel, but each additional slot shares the same GPU, so individual requests may take slightly longer to complete. The goal is to find the balance point where you have enough concurrency for your users without saturating the GPU or running out of VRAM."]}),e.jsx("p",{children:e.jsx("strong",{children:"Throughput vs Latency"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Higher ",e.jsx("code",{children:"NSeqMax"}),": Better throughput, potentially higher per-request latency"]}),e.jsxs("li",{children:["Lower ",e.jsx("code",{children:"NSeqMax"}),": Lower latency, less concurrent capacity"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Recommended Settings"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Single user, interactive: ",e.jsx("code",{children:"n_seq_max: 1-2"})]}),e.jsxs("li",{children:["Multi-user API server: ",e.jsx("code",{children:"n_seq_max: 4-8"})]}),e.jsxs("li",{children:["High-throughput batch jobs: ",e.jsx("code",{children:"n_seq_max: 8-16"})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Monitoring"})}),e.jsxs("p",{children:["Use request tracing to watch for long ",e.jsx("code",{children:"queue-wait"})," spans, which indicate requests are waiting for an available slot. If you see consistently long queue waits, consider:"]}),e.jsxs("ol",{children:[e.jsxs("li",{children:["Increasing ",e.jsx("code",{children:"NSeqMax"})," (if VRAM allows)"]}),e.jsxs("li",{children:["Reducing ",e.jsx("code",{children:"context_window"})," to fit more slots"]}),e.jsxs("li",{children:["Using KV cache quantization (",e.jsx("code",{children:"cache_type_k/v: q8_0"}),")"]})]}),e.jsxs("p",{children:["See ",e.jsx("a",{href:"#chapter-14-observability",children:"Chapter 14: Observability"})," for details on tracing and metrics."]}),e.jsx("h3",{id:"47-example-configuration",children:"4.7 Example Configuration"}),e.jsx("p",{children:"High-throughput server configuration:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  Qwen3-8B-Q8_0:
    context_window: 8192
    n_seq_max: 8
    n_batch: 2048
    n_ubatch: 512
    cache_type_k: q8_0
    cache_type_v: q8_0
    system_prompt_cache: true`})}),e.jsxs("p",{children:["This configuration handles 8 concurrent requests, uses quantized KV cache to reduce memory, and caches the system prompt for faster prefill. Here is the VRAM estimate (see ",e.jsx("a",{href:"#37-vram-estimation",children:"Section 3.7"})," for the full formula):"]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Model                   : Qwen3-8B-Q8_0
Model Weights           : ~9 GB
Context Window (n_ctx)  : 8,192
Bytes Per Element       : 1 (q8_0)
block_count (n_layers)  : 36
attention.head_count_kv : 8
attention.key_length    : 128
attention.value_length  : 128

Step 1  Per-token-per-layer cost:

  KV_Per_Token_Per_Layer = 8  (128 + 128)  1 = 2,048 bytes

Step 2  Per-sequence cost:

  KV_Per_Sequence = 8,192  36  2,048 = ~0.6 GB

Step 3  Total KV cache (NSeqMax = 8):

  Slot_Memory = 8  0.6 GB = ~4.8 GB

Step 4  Total VRAM:

  Total_VRAM = 9.0 GB + 4.8 GB = ~13.8 GB`})}),e.jsx("h3",{id:"48-imc-slot-scheduling",children:"4.8 IMC Slot Scheduling"}),e.jsxs("p",{children:["When IMC is enabled, the batch engine uses a specialized scheduling algorithm (",e.jsx("code",{children:"fillSlotsIMC"}),") that handles the constraint of routing requests to specific slots. This section explains how IMC scheduling differs from normal slot assignment and the mechanisms that prevent requests from stalling."]}),e.jsx("p",{children:e.jsx("strong",{children:"Normal Scheduling (No Caching / SPC)"})}),e.jsxs("p",{children:["Without IMC, ",e.jsx("code",{children:"fillSlots"})," assigns the next queued request to any available slot. If all slots are busy, the request stays in the queue until a slot finishes. This is simple and works well because requests have no slot affinity."]}),e.jsx("p",{children:e.jsx("strong",{children:"IMC Scheduling"})}),e.jsxs("p",{children:["IMC routes each request to a specific target slot based on cache matching (see ",e.jsx("a",{href:"#53-incremental-message-cache-imc",children:"Section 5.3"}),"). This creates a problem: a request's target slot may be busy generating for another request, even though other slots are free. ",e.jsx("code",{children:"fillSlotsIMC"})," handles this with two mechanisms: ",e.jsx("strong",{children:"deferred jobs"})," and ",e.jsx("strong",{children:"slot preemption"}),"."]}),e.jsx("p",{children:e.jsx("strong",{children:"Deferred Jobs"})}),e.jsxs("p",{children:["When ",e.jsx("code",{children:"fillSlotsIMC"})," dequeues a request but its target slot is busy, the request is stored in a ",e.jsx("code",{children:"deferredJob"})," field instead of being put back on the queue. On the next iteration of the batch processing loop, ",e.jsx("code",{children:"fillSlotsIMC"})," checks the deferred job first  if the target slot has finished, the job is assigned immediately. This avoids a critical stall: putting a job back on the queue could cause the processing loop to go idle (no active slots, empty queue) and never wake up until a new external request arrives."]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Request dequeued  target slot busy  defer (not requeue)
                                          
Next iteration  target slot free? Yes startSlot
                                     
                                     No  keep deferred, check again next iteration`})}),e.jsx("p",{children:e.jsx("strong",{children:"Slot Preemption"})}),e.jsxs("p",{children:["If a deferred job waits longer than ",e.jsx("code",{children:"CacheSlotTimeout"})," seconds (default: 30) for its target slot to finish, ",e.jsx("code",{children:"fillSlotsIMC"})," triggers preemption. This is a safety mechanism for pathologically long generations  under normal operation, the target slot finishes before the timeout and the deferred job picks it up naturally."]}),e.jsx("p",{children:"Preemption uses a two-phase approach for safety:"}),e.jsx("ol",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Schedule"}),"  ",e.jsx("code",{children:"fillSlotsIMC"})," sets ",e.jsx("code",{children:"pendingPreempt"})," to the victim slot"]})}),e.jsx("p",{children:"and defers the waiting job. No slot state is modified yet."}),e.jsx("ol",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Execute"}),"  At the top of the next ",e.jsx("code",{children:"processBatch"})," iteration, after"]})}),e.jsxs("p",{children:[e.jsx("code",{children:"batch.Clear()"})," but before any tokens are added, the victim slot is finished with a preemption error. This ordering is critical  the victim slot must have no tokens in the current batch, otherwise cleaning up its KV state could corrupt a subsequent decode."]}),e.jsx("p",{children:"The preempted request receives an error response and the client can retry. The waiting job is then assigned to the freed slot."}),e.jsx("p",{children:"For IMC cache-hit requests, the specific target slot is preempted. For requests with no cache hit (assigned to any slot), the longest-running slot is preempted."}),e.jsx("p",{children:e.jsx("strong",{children:"Timeout Measurement"})}),e.jsxs("p",{children:["The preemption timeout is measured from the moment the job enters the batch engine queue  not from when the HTTP request arrived. Time spent in earlier phases (such as ",e.jsx("code",{children:"waitForIMCSlot"})," during cache builds) does not count against the preemption timeout. This prevents false preemptions when a request waits for a long cache build before entering the queue."]}),e.jsx("p",{children:e.jsx("strong",{children:"CacheSlotTimeout"})}),e.jsxs("p",{children:["The ",e.jsx("code",{children:"cache_slot_timeout"})," setting (default: 30 seconds) controls two distinct timeout scenarios in the IMC scheduling path:"]}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Scenario"}),e.jsx("th",{children:"Where"}),e.jsx("th",{children:"What Happens at Timeout"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Wait for slot available"}),e.jsx("td",{children:e.jsx("code",{children:"waitForIMCSlot"})}),e.jsx("td",{children:'Error returned: "server busy"'})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Deferred job waiting"}),e.jsx("td",{children:e.jsx("code",{children:"fillSlotsIMC"})}),e.jsx("td",{children:"Target slot preempted, deferred job assigned"})]})]})]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`                          CacheSlotTimeout (30s)
                          
                                                                
       
      waitForIMCSlot                           fillSlotsIMC                
                                                                           
      All slots have                            Target slot                
      cache builds                              is busy                    
      in-flight      Error                    generating  Preempt      
                         "server busy"                         victim slot   
       `})}),e.jsxs("p",{children:["The first scenario fires before the job enters the batch engine  it blocks during ",e.jsx("code",{children:"processIMC"})," when all IMC slots have pending cache builds in-flight. The second scenario fires inside the batch engine  the job is already queued but its target slot is actively generating tokens for another request."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Important:"})," The preemption timeout is measured from when the job enters the batch engine queue (",e.jsx("code",{children:"time.Now()"})," at submit), not from when the HTTP request arrived. This means time spent waiting in ",e.jsx("code",{children:"waitForIMCSlot"})," for cache builds does not count against the preemption budget."]}),e.jsx("p",{children:e.jsx("strong",{children:"Debugging IMC Scheduling"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Log Message"}),e.jsx("th",{children:"Meaning"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"all slots pending, waiting for slot"})}),e.jsxs("td",{children:["Entering ",e.jsx("code",{children:"waitForIMCSlot"})," (timeout 1)"]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"slot became available, retrying"})}),e.jsxs("td",{children:[e.jsx("code",{children:"waitForIMCSlot"})," succeeded, retrying scan"]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"server busy"})}),e.jsxs("td",{children:[e.jsx("code",{children:"waitForIMCSlot"})," timed out (timeout 1)"]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"preempting-slot"})}),e.jsx("td",{children:"Preemption scheduled (timeout 2, shows wait time)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"preempted by queued request"})}),e.jsx("td",{children:"Victim slot finished with preemption error"})]}),e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("code",{children:"slot-finished"})," (after preemption)"]}),e.jsx("td",{children:"Victim cleaned up, slot available for deferred job"})]})]})]}),e.jsx("h3",{id:"49-model-types-and-state-management",children:"4.9 Model Types and State Management"}),e.jsxs("p",{children:["Kronk supports three model architectures. The model type is detected automatically at load time and determines how the batch engine manages sequence state between requests when IMC is enabled. The caching system (",e.jsx("code",{children:"caching_imc.go"}),") handles slot matching and cache building  it is unaffected by model type. The difference is in the batch engine's slot lifecycle code (",e.jsx("code",{children:"batch_slot_start.go"})," and ",e.jsx("code",{children:"batch_finish.go"}),")."]}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Model Type"}),e.jsx("th",{children:"Architecture"}),e.jsx("th",{children:"State Management"}),e.jsx("th",{children:"Detection"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Dense"}),e.jsx("td",{children:"Standard transformer"}),e.jsx("td",{children:"Partial range delete"}),e.jsx("td",{children:"Default (not MoE, not Hybrid)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"MoE"}),e.jsx("td",{children:"Mixture of Experts"}),e.jsx("td",{children:"Partial range delete"}),e.jsxs("td",{children:["GGUF ",e.jsx("code",{children:"expert_count"})," metadata"]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Hybrid"}),e.jsx("td",{children:"Attention + Recurrent (DeltaNet/SSM)"}),e.jsx("td",{children:"Snapshot/Restore"}),e.jsx("td",{children:e.jsx("code",{children:"llama.ModelIsHybrid"})})]})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Partial Range Delete (Dense and MoE)"})}),e.jsxs("p",{children:["After a request completes, the batch engine trims the generated tokens from the KV cache using ",e.jsx("code",{children:"MemorySeqRm(seq, trimPos, -1)"}),". This removes only the tokens produced during generation, leaving the cached conversation prefix intact for the next request. This is cheap and fast  the cached prefix is never re-decoded."]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Before:  [cached prefix tokens] [generated tokens]
After:   [cached prefix tokens]                      trimmed`})}),e.jsx("p",{children:e.jsx("strong",{children:"Snapshot/Restore (Hybrid)"})}),e.jsx("p",{children:'Hybrid models mix Attention layers with recurrent layers (DeltaNet/SSM). Recurrent layers store a hidden state that cannot be "rewound" by partial range delete  a partial delete corrupts the recurrent state, causing decode errors on subsequent requests.'}),e.jsx("p",{children:"Instead, the batch engine uses a snapshot/restore approach:"}),e.jsx("ol",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Snapshot"})," (",e.jsx("code",{children:"batch_slot_start.go"}),"): After the IMC cache is built or"]})}),e.jsxs("p",{children:["extended but before suffix tokens are decoded, the engine captures the full sequence state (KV cache + recurrent hidden state) into a byte buffer in RAM using ",e.jsx("code",{children:"StateSeqGetData"}),"."]}),e.jsx("ol",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Restore"})," (",e.jsx("code",{children:"batch_finish.go"}),"): After the request completes, the engine"]})}),e.jsxs("p",{children:["performs a full sequence clear (",e.jsx("code",{children:"MemorySeqRm(seq, -1, -1)"}),") and restores the snapshot using ",e.jsx("code",{children:"StateSeqSetData"}),". This returns the sequence to the exact state it was in after the cached prefix, with the recurrent hidden state perfectly preserved."]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Standard (Dense/MoE):  Trim generated tokens (partial delete)
Hybrid:                Full clear  Restore snapshot (memory copy)`})}),e.jsx("p",{children:"The snapshot/restore is a memory copy operation, typically 10-30ms depending on conversation size."}),e.jsx("p",{children:e.jsx("strong",{children:"Partial prefix rebuilds (Hybrid):"})}),e.jsx("p",{children:"When a request matches a partial token prefix (the Non-Deterministic fallback path), Dense/MoE models trim from the divergence point. Hybrid models cannot do partial trims, so the engine performs a full sequence clear and re-decodes the entire cached token sequence from position 0. This is more expensive but guarantees the recurrent state is built correctly."}),e.jsx("p",{children:e.jsx("strong",{children:"MoE Performance Characteristics"})}),e.jsx("p",{children:"MoE models use the same state management as Dense (partial range delete), but have different performance profiles that affect configuration:"}),e.jsx("ul",{children:e.jsx("li",{children:"Lower tokens/sec than comparably-sized dense models on Apple Silicon"})}),e.jsx("p",{children:"due to scattered memory access patterns from expert routing"}),e.jsx("ul",{children:e.jsxs("li",{children:["Sensitive to aggressive KV cache quantization  use ",e.jsx("code",{children:"f16"})," cache types"]})}),e.jsxs("p",{children:["if quality degrades with ",e.jsx("code",{children:"q8_0"})]}),e.jsx("ul",{children:e.jsxs("li",{children:["Use ",e.jsx("code",{children:"split_mode: row"})," for multi-GPU setups to enable expert-parallel"]})}),e.jsx("p",{children:"execution"}),e.jsx("p",{children:e.jsx("strong",{children:"Hybrid Constraints:"})}),e.jsx("ul",{children:e.jsxs("li",{children:["KV cache must use ",e.jsx("code",{children:"f16"}),"  quantized cache types (e.g., ",e.jsx("code",{children:"q8_0"}),") are"]})}),e.jsx("p",{children:"incompatible with recurrent layers"}),e.jsx("ul",{children:e.jsx("li",{children:"Flash attention is automatically disabled"})}),e.jsx("p",{children:e.jsx("strong",{children:"Hybrid Guardrails:"})}),e.jsxs("p",{children:["If a snapshot restore fails, Kronk clears the slot's IMC metadata (",e.jsx("code",{children:"cachedMsgsHash"}),", ",e.jsx("code",{children:"totalTokensCached"}),", ",e.jsx("code",{children:"lastMsgIdxCached"}),") so the slot is not reused with a corrupted sequence. The next request to that slot triggers a full cache rebuild from scratch."]}),e.jsx("p",{children:e.jsx("strong",{children:"Debugging State Management:"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Log Message"}),e.jsx("th",{children:"Meaning"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"imc-hybrid-snapshot"})}),e.jsx("td",{children:"State captured after cache build (shows snapshot_bytes)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"imc-hybrid-snapshot-failed"})}),e.jsx("td",{children:"StateSeqGetData returned 0 bytes"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"imc-hybrid-restore"})}),e.jsx("td",{children:"Snapshot restored after request (shows restored_bytes)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"imc-hybrid-restore-failed"})}),e.jsx("td",{children:"StateSeqSetData failed, slot metadata cleared"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"imc-hybrid-no-snapshot"})}),e.jsx("td",{children:"No snapshot available, full clear + metadata invalidation"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"imc-hybrid-rebuild"})}),e.jsx("td",{children:"Partial prefix: full clear + re-decode from position 0"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"imc-hybrid-trim-rebuild"})}),e.jsx("td",{children:"Trim-only prefix: full clear + re-decode truncated sequence"})]})]})]}),e.jsx("hr",{}),e.jsx("h2",{id:"chapter-5-message-caching",children:"Chapter 5: Message Caching"}),e.jsx("p",{children:"Message caching reduces redundant computation by storing and reusing KV cache state from previous requests. Kronk provides two caching modes (SPC and IMC) optimized for different use cases."}),e.jsx("h3",{id:"51-overview",children:"5.1 Overview"}),e.jsx("p",{children:"When processing a chat request, the model must compute attention for every token in the conversation. Without caching, the entire prompt is prefilled on every request  even tokens the model has already seen."}),e.jsx("p",{children:e.jsx("em",{children:"Note: Prefill is the phase where the model processes all input tokens (system prompt, conversation history, and the new message) before it begins generating a response. This is the most computationally expensive part of a request, and its cost grows with the number of input tokens."})}),e.jsx("p",{children:"Kronk provides two caching modes that reduce redundant prefill work:"}),e.jsx("ul",{children:e.jsx("li",{children:"SPC (System Prompt Cache) decodes the system prompt once, externalizes the KV state to a byte buffer in RAM, and restores it into each slot via StateSeqSetData per request."})}),e.jsx("ul",{children:e.jsx("li",{children:"IMC (Incremental Message Cache) dedicates each slot to a user and caches the full conversation in the slot's KV cache sequence, so only the new message needs to be prefilled."})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`No Caching:

 System Prompt  Message 1  Message 2  New Message 
   (prefill)    (prefill)  (prefill)   (prefill)  

                                              
                                           Generate

SPC (System Prompt Cache):

 System Prompt  Message 1  Message 2  New Message 
   (cached)     (prefill)  (prefill)   (prefill)  

                                              
                                           Generate

IMC (Incremental Message Cache):

 System Prompt  Message 1  Message 2  New Message 
   (cached)     (cached)   (cached)    (prefill)  

                                              
                                           Generate`})}),e.jsx("h3",{id:"52-system-prompt-cache-spc",children:"5.2 System Prompt Cache (SPC)"}),e.jsx("p",{children:"System Prompt Cache decodes the system prompt once into a temporary sequence, externalizes the KV state to a byte buffer in RAM, and frees the sequence. On each request, the KV state is restored into the slot's working sequence via StateSeqSetData. This avoids re-decoding the system prompt on every request. No dedicated cache sequence is permanently occupied, so SPC does not add any extra sequences to the VRAM allocation."}),e.jsx("p",{children:e.jsx("strong",{children:"Best for:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"OpenWebUI and similar chat interfaces"}),e.jsx("li",{children:"Applications with a consistent system prompt"}),e.jsx("li",{children:"Multi-user scenarios with different system prompts"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Enable SPC:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  Qwen3-8B-Q8_0:
    system_prompt_cache: true`})}),e.jsx("p",{children:e.jsx("strong",{children:"How It Works:"})}),e.jsx("ol",{children:e.jsx("li",{children:"First request: System prompt is templated, tokenized, and decoded into a"})}),e.jsx("p",{children:"temporary sequence"}),e.jsxs("ol",{children:[e.jsx("li",{children:"The KV state is extracted into a byte buffer in RAM and the sequence is freed"}),e.jsx("li",{children:"The KV state is restored into the slot's working sequence via StateSeqSetData"}),e.jsx("li",{children:"Remaining messages are prefilled after the cached system prompt tokens"}),e.jsx("li",{children:"Subsequent requests: KV state is restored from the RAM buffer (no"})]}),e.jsx("p",{children:"re-decoding needed)"}),e.jsx("p",{children:e.jsx("strong",{children:"Cache Invalidation:"})}),e.jsx("p",{children:"The cache is automatically invalidated when:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"The system prompt content changes (detected by hash comparison)"}),e.jsx("li",{children:"The system prompt role changes"}),e.jsx("li",{children:"The server restarts"})]}),e.jsx("h3",{id:"53-incremental-message-cache-imc",children:"5.3 Incremental Message Cache (IMC)"}),e.jsx("p",{children:"Incremental Message Cache is designed for agentic workflows where conversations grow monotonically. It caches all messages except the last one and extends the cache incrementally on each turn."}),e.jsx("p",{children:"IMC has two matching strategies. You don't choose a strategy  Kronk always tries hash matching first and automatically falls back to token prefix matching when the hash doesn't match."}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Strategy"}),e.jsx("th",{children:"When It Runs"}),e.jsx("th",{children:"How It Matches"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Deterministic"}),e.jsx("td",{children:"Hash of cached messages matches"}),e.jsx("td",{children:"Hash-based"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Non-Deterministic"}),e.jsx("td",{children:"Hash fails, falls back automatically"}),e.jsx("td",{children:"Token prefix fallback"})]})]})]}),e.jsxs("p",{children:["The matching strategy is independent of the model type (Dense, MoE, Hybrid). Any model type can use either strategy  it depends on the template, not the architecture. What changes per model type is how the batch engine manages state between requests  see ",e.jsx("a",{href:"#49-model-types-and-state-management",children:"Section 4.9"}),"."]}),e.jsx("p",{children:"The table below shows the real models and which strategy their templates produce. Note that MoE appears in both columns  Qwen3-VL (MoE) has a deterministic template, while GPT-OSS (also MoE) has a non-deterministic one."}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Model"}),e.jsx("th",{children:"Architecture"}),e.jsx("th",{children:"Template"}),e.jsx("th",{children:"Modality"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Qwen3-8B-Q8_0"}),e.jsx("td",{children:"Dense"}),e.jsx("td",{children:"Deterministic"}),e.jsx("td",{children:"Text"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Qwen2.5-VL-3B-Instruct-Q8_0"}),e.jsx("td",{children:"Dense"}),e.jsx("td",{children:"Deterministic"}),e.jsx("td",{children:"Vision"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Qwen3-VL-30B-A3B-Instruct-Q8_0"}),e.jsx("td",{children:"MoE"}),e.jsx("td",{children:"Deterministic"}),e.jsx("td",{children:"Vision"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Qwen3.5-35B-A3B-Q8_0"}),e.jsx("td",{children:"Hybrid"}),e.jsx("td",{children:"Deterministic"}),e.jsx("td",{children:"Vision"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"gpt-oss-20b-Q8_0"}),e.jsx("td",{children:"MoE"}),e.jsx("td",{children:"Non-Deterministic"}),e.jsx("td",{children:"Text"})]})]})]}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Deterministic"})," is the fastest path  hash matching finds the right slot"]})}),e.jsx("p",{children:"instantly with no tokenization overhead."}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Non-Deterministic"})," exists because some model templates produce different"]})}),e.jsx("p",{children:"token sequences for the same messages. Hash matching fails, so IMC falls back to token-level comparison to salvage as much of the cache as possible."}),e.jsx("p",{children:e.jsx("strong",{children:"Best for:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"AI coding agents"}),e.jsx("li",{children:"Long-running agent conversations"}),e.jsx("li",{children:"Any workflow where messages are appended, not edited"}),e.jsx("li",{children:"Sub-agent architectures with multiple concurrent agents"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Enable IMC:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  Qwen3-8B-Q8_0:
    incremental_cache: true
    cache_min_tokens: 100 # Minimum tokens before caching`})}),e.jsx("p",{children:e.jsx("strong",{children:"Multi-Slot Architecture:"})}),e.jsxs("p",{children:["All ",e.jsx("code",{children:"NSeqMax"})," slots are available for IMC. Each slot independently tracks its own conversation branch  its own message hash, token count, and message index. Sub-agents are routed to different slots via hash matching, allowing them to maintain independent caches and run concurrently."]}),e.jsxs("p",{children:["With ",e.jsx("code",{children:"n_seq_max: 3"}),", three sub-agents can each have their own cached conversation branch. Without multi-slot IMC, every sub-agent request would cause a prefix mismatch and rebuild the cache from scratch because different sub-agents send different system prompts and conversation content."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Important:"})," Set ",e.jsx("code",{children:"n_seq_max"})," to at least the number of concurrent sub-agents your agent framework spawns. If ",e.jsx("code",{children:"n_seq_max"})," is smaller than the number of sub-agents, cache thrashing occurs  each new sub-agent evicts a slot, and when the evicted sub-agent returns, it evicts another. Every request triggers a full rebuild from scratch, eliminating the caching benefit entirely. The trade-off is VRAM  each additional slot reserves its full KV cache partition at model load time."]}),e.jsx("p",{children:e.jsx("strong",{children:"How It Works:"})}),e.jsx("p",{children:"First request (2 messages: system + user):"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Messages: [system, user]
Cache:    [system]            Cache all except last
Prefill:  [user + gen_prompt]`})}),e.jsx("p",{children:"Second request (4 messages):"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Messages: [system, user, assistant, user2]
Cache:    [system, user, assistant]   Extend cache
Prefill:  [user2 + gen_prompt]`})}),e.jsx("p",{children:"Third request (6 messages):"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Messages: [system, user, assistant, user2, assistant2, user3]
Cache:    [system, user, assistant, user2, assistant2]   Extend
Prefill:  [user3 + gen_prompt]`})}),e.jsx("p",{children:e.jsx("strong",{children:"Slot Selection Algorithm:"})}),e.jsx("p",{children:"When a request arrives, IMC scans all slots to find the best match. Steps 1-2 apply to both strategies. Step 3 is the Non-Deterministic fallback path. Step 4 is the universal last resort."}),e.jsx("ol",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Scan all slots"}),"  For each slot:",e.jsxs("ul",{children:[e.jsx("li",{children:"Skip slots with a build in-flight (pending flag set)"}),e.jsx("li",{children:"Skip empty slots (track the first empty slot as a fallback)"}),e.jsx("li",{children:"Skip slots with more cached messages than the request has total"}),e.jsxs("li",{children:["Hash ",e.jsx("code",{children:"messages[:slot.lastMsgIdxCached]"})," and compare to the slot's"]})]})]})}),e.jsx("p",{children:"stored hash"}),e.jsx("ol",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"On match"}),"  Pick the slot with the best prefix coverage (most cached"]})}),e.jsx("p",{children:"messages). If the request has new messages to cache, extend the slot's cache. If the messages are identical, it's a pure cache hit."}),e.jsx("ol",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"No hash match  token prefix fallback (Non-Deterministic mode)"})," "]})}),e.jsxs("p",{children:["Tokenize the incoming messages and compare the resulting token sequence element-by-element against each non-empty slot's stored ",e.jsx("code",{children:"cachedTokens"}),". Pick the slot with the longest common prefix that meets ",e.jsx("code",{children:"cache_min_tokens"}),". Trim the KV cache from the divergence point and decode only the new tokens from there forward. See ",e.jsx("a",{href:"#imc-non-deterministic",children:"IMC Non-Deterministic"})," for details."]}),e.jsx("ol",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"No match at all"}),"  Pick an empty slot if one exists, otherwise evict"]})}),e.jsx("p",{children:"the least-recently-used (LRU) slot and rebuild from scratch."}),e.jsx("p",{children:e.jsx("strong",{children:"Concurrent Build Protection:"})}),e.jsx("p",{children:"When two requests arrive simultaneously and both need to build a cache from scratch, a race condition could cause both to pick the same empty slot. IMC prevents this with a pending flag: when a slot begins a deferred cache build, it is marked pending. Concurrent scanners skip pending slots, so the second request picks a different slot. The pending flag is cleared after the cache decode completes (or on error)."}),e.jsx("h4",{id:"imc-deterministic",children:"IMC Deterministic"}),e.jsx("p",{children:"The default and fastest matching strategy. Used automatically for models with consistent templates  where the same messages always produce identical token sequences regardless of conversation length."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Why this strategy exists:"})," Most models have deterministic templates (see the model table above). When the template is consistent, a simple hash of the message prefix is enough to identify a matching slot. This avoids tokenization overhead entirely."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"When it's used:"})," Automatically when ",e.jsx("code",{children:"incremental_cache: true"})," and the template produces consistent token sequences. This is the default path."]}),e.jsx("p",{children:e.jsx("strong",{children:"How it works:"})}),e.jsxs("ol",{children:[e.jsx("li",{children:"Hash the incoming message prefix"}),e.jsx("li",{children:"Compare against each slot's stored hash"}),e.jsx("li",{children:"On match: extend the cache with new messages, or return a pure cache hit"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Models:"})," QWEN, Llama, Qwen3-Coder (MoE), Qwen3-Coder-Next (Hybrid), and most model architectures."]}),e.jsx("h4",{id:"imc-non-deterministic",children:"IMC Non-Deterministic"}),e.jsx("p",{children:"A fallback mode that activates automatically when hash matching fails due to template non-determinism. Some model templates produce different token sequences for identical messages across requests  even though the semantic content is the same."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Why this mode exists:"})," GPT-OSS, for example, injects tool call formatting that varies between template invocations. This causes message hash mismatches even though the conversation hasn't changed, which would normally force a full cache rebuild from scratch. The Non-Deterministic mode salvages 70-80% of the cached tokens instead."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"When it's used:"})," Automatically when no hash match is found during the slot scan. IMC falls back to comparing the actual cached token arrays against the incoming request's tokens. Only candidates with compatible message counts are considered  the request must have at least as many messages as the slot cached."]}),e.jsx("p",{children:e.jsx("strong",{children:"How it works  Token-Level Partial Prefix Matching:"})}),e.jsx("p",{children:"When no hash match is found, IMC tokenizes the incoming messages and compares them element-by-element against each non-empty slot's stored token sequence to find the longest common prefix."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Cached tokens:   [T1, T2, T3, T4, T5, T6, T7, T8]
Incoming tokens: [T1, T2, T3, T4, T5, T9, T10, T11, T12]
                                       
                              Divergence point (pos 5)

Common prefix: 5 tokens (salvaged from KV cache)
Trimmed:       3 tokens (T6-T8 removed via MemorySeqRm)
New decode:    4 tokens (T9-T12, from divergence point forward)`})}),e.jsxs("p",{children:["If the common prefix meets the ",e.jsx("code",{children:"cache_min_tokens"})," threshold, IMC:"]}),e.jsxs("ol",{children:[e.jsx("li",{children:"Reserves the matching slot (marks it pending)"}),e.jsxs("li",{children:["Trims the divergent suffix from the KV cache (",e.jsx("code",{children:"MemorySeqRm(seq, trimPos, -1)"}),")"]}),e.jsx("li",{children:"Decodes only the new tokens from the divergence point forward"}),e.jsx("li",{children:"Updates the slot's hash and cached token sequence"})]}),e.jsx("p",{children:"Once the partial rebuild completes, subsequent requests in the same conversation use normal hash-based extending. The token prefix path is only triggered at conversation boundaries  when the template non-determinism causes the initial mismatch."}),e.jsx("p",{children:"Real-world testing with GPT-OSS showed 77-80% cache salvage rates when switching conversations. Instead of decoding ~8400 tokens from scratch, the system kept ~6800 cached and only decoded ~1600."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Models:"})," GPT-OSS, GLM, and any model whose template produces variable token sequences for identical messages (see the model table above)."]}),e.jsx("p",{children:e.jsx("strong",{children:"Debugging Non-Deterministic IMC:"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Log Message"}),e.jsx("th",{children:"Meaning"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"no slot matched, trying token prefix match"})}),e.jsx("td",{children:"Hash match failed, entering token comparison"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"slot[N] common-prefix X/Y tokens (Z% salvageable)"})}),e.jsx("td",{children:"Per-slot comparison result"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"token prefix match found"})}),e.jsx("td",{children:"Usable prefix found, will trim and extend"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"imc-trim-prefix"})}),e.jsx("td",{children:"KV cache trim in progress (shows cached_tokens, trim_pos)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"imc-partial-rebuilt"})}),e.jsx("td",{children:"Rebuild complete (shows total_cached, salvaged_prefix, salvaged_pct)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"no usable token prefix match"})}),e.jsxs("td",{children:["All prefixes below ",e.jsx("code",{children:"cache_min_tokens"}),", falling back to empty/LRU slot"]})]})]})]}),e.jsx("h4",{id:"model-type-interactions",children:"Model Type Interactions"}),e.jsxs("p",{children:["The IMC matching strategy (Deterministic or Non-Deterministic) is independent of the model type (Dense, MoE, Hybrid). The caching system works the same way for all model types  only the batch engine's state management differs. See ",e.jsx("a",{href:"#49-model-types-and-state-management",children:"Section 4.9"})," for how each model type manages state between requests."]}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Model Type"}),e.jsx("th",{children:"Matching Strategy"}),e.jsx("th",{children:"State Management"}),e.jsx("th",{children:"Configuration Notes"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Dense"}),e.jsx("td",{children:"Deterministic or Non-Det"}),e.jsx("td",{children:"Partial range delete"}),e.jsx("td",{children:"No special requirements"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"MoE"}),e.jsx("td",{children:"Deterministic or Non-Det"}),e.jsx("td",{children:"Partial range delete"}),e.jsx("td",{children:"f16 cache, split_mode: row"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Hybrid"}),e.jsx("td",{children:"Deterministic or Non-Det"}),e.jsx("td",{children:"Snapshot/Restore"}),e.jsx("td",{children:"f16 cache required, no flash attn"})]})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"MoE Configuration:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  Qwen3-Coder-30B-A3B-Q8_0:
    incremental_cache: true
    split_mode: row # Best for MoE architecture
    cache_type_k: f16 # Safer for MoE routing accuracy
    cache_type_v: f16`})}),e.jsx("p",{children:e.jsx("strong",{children:"Hybrid Configuration:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  Qwen3-Coder-Next-UD-Q4_K_XL:
    incremental_cache: true
    cache_type_k: f16 # Required for hybrid models
    cache_type_v: f16 # Required for hybrid models`})}),e.jsx("h3",{id:"54-single-user-caching",children:"5.4 Single-User Caching"}),e.jsxs("p",{children:["IMC is designed for single-user use. All ",e.jsx("code",{children:"NSeqMax"})," slots are available, with each slot independently tracking its own conversation branch via hash matching. This design is optimized for agentic workflows where multiple sub-agents send independent conversations (different system prompts, different message histories)."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"SPC:"})," All requests share the same externalized KV state buffer. The cached KV state is restored into each slot via StateSeqSetData. If the system prompt changes, the cache is rebuilt automatically."]}),e.jsx("h3",{id:"55-spc-vs-imc",children:"5.5 SPC vs IMC"}),e.jsx("p",{children:"Both caching modes eliminate redundant work, but they target different parts of the prompt and suit different workloads. SPC is the simpler option  it caches just the system prompt and works with any model template. IMC is more aggressive  it caches the entire conversation history and works with all templates (deterministic templates use fast hash matching, non-deterministic templates fall back to token prefix matching). The table below summarizes the trade-offs to help you choose."}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Feature"}),e.jsx("th",{children:"System Prompt Cache"}),e.jsx("th",{children:"Incremental Message Cache"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Caches"}),e.jsx("td",{children:"System prompt only"}),e.jsx("td",{children:"All messages except last"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Extends"}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Yes, incrementally"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Multi-user"}),e.jsx("td",{children:"Single shared cache sequence"}),e.jsx("td",{children:"Single-user, all slots available"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Sub-agents"}),e.jsx("td",{children:"All share same SPC sequence"}),e.jsx("td",{children:"Each gets own slot via hash matching"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Best for"}),e.jsx("td",{children:"Chat UIs"}),e.jsx("td",{children:"Agentic workflows"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Memory"}),e.jsx("td",{children:"Zero extra VRAM (KV state in RAM)"}),e.jsx("td",{children:"Zero extra VRAM overhead"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Template req"}),e.jsx("td",{children:"Any"}),e.jsx("td",{children:"Any (hash match or token prefix fallback)"})]})]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Important:"})," SPC and IMC are mutually exclusive. Choose based on your workload:"]}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Agentic workflows:"})," Use IMC  works with all templates. Most models get"]})}),e.jsx("p",{children:"the fastest hash-based path. Non-deterministic templates (GPT-OSS, GLM) use token prefix fallback with 70-80% cache salvage."}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Chat UIs / multi-client:"})," Use SPC  simpler model, no slot dedication"]})}),e.jsx("h3",{id:"56-cache-invalidation",children:"5.6 Cache Invalidation"}),e.jsx("p",{children:"Cached state doesn't last forever. Kronk uses hash comparisons to detect when cached tokens no longer match the incoming request, and automatically rebuilds the cache when a mismatch is found. Understanding what triggers invalidation helps you avoid unexpected prefill costs."}),e.jsx("p",{children:e.jsx("strong",{children:"SPC Invalidation:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"System prompt content changes  cache rebuilt"}),e.jsx("li",{children:"System prompt hash mismatch  cache rebuilt"})]}),e.jsx("p",{children:e.jsx("strong",{children:"IMC Invalidation:"})}),e.jsx("ul",{children:e.jsx("li",{children:"Message prefix hash mismatch  token prefix fallback attempted first. If a"})}),e.jsxs("p",{children:["common prefix  ",e.jsx("code",{children:"cache_min_tokens"})," is found, only the divergent suffix is trimmed and rebuilt. Otherwise, cache is rebuilt from scratch."]}),e.jsx("ul",{children:e.jsx("li",{children:"User starts new conversation  token prefix fallback salvages shared prefix"})}),e.jsx("p",{children:"(e.g., system prompt tokens), then extends from there"}),e.jsx("ul",{children:e.jsx("li",{children:"Earlier message edited  cache rebuilt (hash and token prefix both fail)"})}),e.jsx("p",{children:e.jsx("strong",{children:"Automatic Invalidation:"})}),e.jsx("p",{children:"Caches are cleared when:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Model is unloaded"}),e.jsx("li",{children:"Server restarts"})]}),e.jsx("h3",{id:"57-configuration-reference",children:"5.7 Configuration Reference"}),e.jsx("p",{children:"Both caching modes are enabled through the model configuration. Remember that SPC and IMC are mutually exclusive  enable one or the other, not both."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  Qwen3-8B-Q8_0:
    # System Prompt Cache
    system_prompt_cache: true

    # OR Incremental Message Cache (mutually exclusive)
    incremental_cache: true

    # Shared settings
    cache_min_tokens: 100 # Don't cache if < 100 tokens`})}),e.jsx("p",{children:e.jsx("strong",{children:"cache_min_tokens"})}),e.jsx("p",{children:"Minimum token count threshold. For SPC, caching doesn't activate if the system prompt is shorter than this. For IMC, this is the minimum common prefix length required for token-level partial prefix matching  if no slot's cached tokens share at least this many tokens with the incoming request, the fallback is skipped and the cache is rebuilt from scratch."}),e.jsx("p",{children:"Default: 100 tokens"}),e.jsx("h3",{id:"58-performance-and-limitations",children:"5.8 Performance and Limitations"}),e.jsx("p",{children:"Caching improves request latency by skipping redundant prefill work, but each mode has its own costs and constraints. SPC trades a small per-request decode cost for broad compatibility. IMC delivers larger savings but imposes restrictions on template behavior and session management."}),e.jsx("p",{children:e.jsx("strong",{children:"SPC Performance:"})}),e.jsx("p",{children:"SPC restores the externalized KV state into each slot via StateSeqSetData. This is a memory copy from RAM into the KV cache, typically taking 10-30ms depending on system prompt size and memory bus load. No extra VRAM is consumed since the KV state lives in regular RAM."}),e.jsx("p",{children:e.jsx("strong",{children:"IMC Prefill Savings:"})}),e.jsx("p",{children:"For a 2000-token cached conversation prefix:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Without cache: ~200ms prefill (varies by hardware)"}),e.jsx("li",{children:"With IMC: ~5ms for new tokens only"})]}),e.jsx("p",{children:"Cache extensions (adding new messages to an existing cached prefix) are especially fast because only the delta tokens are decoded. In production logs, sequential extensions typically take ~3ms each."}),e.jsx("p",{children:e.jsx("strong",{children:"IMC Memory Overhead:"})}),e.jsxs("p",{children:["IMC adds no extra VRAM. llama.cpp partitions the KV cache across sequences, so each slot gets ",e.jsx("code",{children:"context_window / NSeqMax"})," tokens:"]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`8K context, n_seq_max=4, IMC:
  KV cache per slot: ~200 MB (8B model, F16)
  Total KV cache: 4  200 MB = ~800 MB`})}),e.jsx("p",{children:e.jsx("strong",{children:"IMC Token Prefix Fallback Performance:"})}),e.jsx("p",{children:"When IMC falls back to token-level prefix matching (non-deterministic templates), there is a one-time cost to tokenize the incoming messages for comparison. This is typically fast (< 5ms for most conversations). The savings from salvaging 70-80% of the cached tokens far outweigh this cost compared to a full rebuild."}),e.jsx("p",{children:e.jsx("strong",{children:"IMC with Vision/Audio Models:"})}),e.jsx("p",{children:"IMC fully supports vision and audio models (models configured with a projection file). Text-only requests are cached normally. When a message containing media (image, video, or audio) appears in the conversation history, IMC caches the entire conversation  including the media embeddings  in the KV cache. The image or audio is encoded through the projection model once and remains in the KV cache across subsequent requests. Text-only follow-up messages extend the cache without re-encoding the media."}),e.jsx("p",{children:"For example, in a conversation like:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Request 1 (image request):
[system]         cached by IMC (text tokens)
[user + image]   cached by IMC (text + image embeddings via mtmd pipeline)
[user]           prefill (generation target)

Request 2 (text follow-up about the image):
[system]         cached (KV cache hit)
[user + image]   cached (image stays in KV cache, no re-encode)
[assistant]      extended (new text tokens decoded into cache)
[user]           prefill (generation target)

Request 3 (unrelated text question):
[system]         cached (KV cache hit)
[user + image]   cached (image stays in KV cache)
[assistant]      cached (KV cache hit)
[user]           extended (new text tokens decoded into cache)
[assistant]      extended
[user]           prefill (generation target)

Request 4 (back to asking about the image):
[system]         cached (KV cache hit)
[user + image]   cached (image STILL in KV cache, no re-encode)
[assistant]      cached (KV cache hit)
[user]           cached (KV cache hit)
[assistant]      cached (KV cache hit)
[user]           extended (new text tokens decoded into cache)
[assistant]      extended
[user]           prefill (generation target)`})}),e.jsx("p",{children:"When an image appears mid-conversation (after text-only messages), IMC preserves the existing text cache and extends it with media instead of rebuilding from scratch:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Text-only conversation, then image appears mid-conversation:

Requests 13 (text-only):
[system]         cached by IMC (text tokens)
[user]           cached / extended normally
[assistant]      cached / extended normally
...              conversation grows, all text cached incrementally

Request 4 (image appears mid-conversation):
[system]         cached (text tokens skipped via imcMediaSkipTextTokens)
[earlier msgs]   cached (text tokens skipped)
[asst + user]    media extend from text (new text decoded from skip point)
[user + image]   media extend from text (image encoded through projection model)
[user]           prefill (generation target)

Request 5 (text follow-up about the image):
[all prior]      cached (KV cache hit, image stays in KV cache)
[assistant]      extended (text tokens only, no image re-encode)
[user]           prefill (generation target)`})}),e.jsx("p",{children:e.jsx("strong",{children:"How media caching works internally:"})}),e.jsx("ol",{children:e.jsxs("li",{children:["When ",e.jsx("code",{children:"buildIMCCacheFromScratch"})," detects media content, it defers the build"]})}),e.jsxs("p",{children:["to ",e.jsx("code",{children:"startSlot"})," where the mtmd pipeline (projection model) is available. The cache result carries ",e.jsx("code",{children:"imcMediaBuild: true"}),"."]}),e.jsx("ol",{children:e.jsx("li",{children:"When media first appears in a conversation that started text-only,"})}),e.jsxs("p",{children:[e.jsx("code",{children:"extendIMCTextCacheWithMedia"})," preserves the existing text prefix in the KV cache. It sets ",e.jsx("code",{children:"imcMediaSkipTextTokens"})," to the number of already-cached text tokens, so ",e.jsx("code",{children:"decodeMediaIntoCache"})," skips them and only decodes the new text plus media embeddings. This avoids re-decoding potentially tens of thousands of cached text tokens when an image is first introduced mid-conversation."]}),e.jsx("ol",{children:e.jsxs("li",{children:[e.jsx("code",{children:"decodeMediaIntoCache"})," processes the prompt as interleaved chunks  text"]})}),e.jsxs("p",{children:["chunks are tokenized and decoded normally, while image/audio chunks are encoded through the projection model and their embeddings are decoded into the KV cache. When ",e.jsx("code",{children:"imcMediaSkipTextTokens"})," is set, the first text chunk is partially skipped (only tokens beyond the skip point are decoded). For models using M-RoPE (e.g., Qwen2.5-VL), 2D spatial positions are assigned to image tokens."]}),e.jsx("ol",{children:e.jsxs("li",{children:["The slot tracks ",e.jsx("code",{children:"mediaKVCounts"}),"  the number of KV positions consumed by"]})}),e.jsx("p",{children:"each media chunk. This is needed because media embeddings occupy a different number of KV positions than the text marker tokens they replace in the tokenized prompt."}),e.jsx("ol",{children:e.jsxs("li",{children:["On text-only follow-ups, ",e.jsx("code",{children:"extendIMCMediaSlotWithText"})," uses the"]})}),e.jsxs("p",{children:[e.jsx("code",{children:"mediaKVCounts"})," to compute the correct offset between text token indices and KV positions, then decodes only the new text tokens at the right position  no image re-encoding occurs."]}),e.jsx("ol",{children:e.jsx("li",{children:"If a new message being added contains media (a second image, for example),"})}),e.jsxs("p",{children:[e.jsx("code",{children:"rebuildIMCWithMedia"})," triggers a full rebuild through the mtmd pipeline."]}),e.jsx("ol",{children:e.jsx("li",{children:"Token prefix matching is skipped when the incoming request contains media"})}),e.jsx("p",{children:"messages, since the tokenization path would mutate media content and corrupt downstream processing."}),e.jsx("p",{children:e.jsx("strong",{children:"IMC Limitations:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Conversations must grow monotonically (append-only)"}),e.jsx("li",{children:"Editing earlier messages triggers full cache rebuild"}),e.jsx("li",{children:"Designed for single-user use"}),e.jsx("li",{children:"Max concurrent conversation branches = NSeqMax; when all slots are"})]}),e.jsx("p",{children:"occupied, the least-recently-used slot is evicted"}),e.jsx("hr",{}),e.jsx("h2",{id:"chapter-6-yarn-extended-context",children:"Chapter 6: YaRN Extended Context"}),e.jsx("p",{children:"YaRN (Yet another RoPE extensioN) allows models to handle context windows beyond their native training length. This is essential for long documents, extended conversations, and complex agentic workflows."}),e.jsx("h3",{id:"61-understanding-context-extension",children:"6.1 Understanding Context Extension"}),e.jsx("p",{children:"Language models are trained with a fixed context length (e.g., 8K, 32K tokens). RoPE (Rotary Position Embedding) encodes position information, but naive extension beyond training length causes quality degradation."}),e.jsx("p",{children:"YaRN applies frequency-dependent interpolation with attention scaling to maintain quality at extended lengths."}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Native Context:     32K tokens (training length)
Extended Context:   131K tokens (4x extension with YaRN)`})}),e.jsx("h3",{id:"62-when-to-use-yarn",children:"6.2 When to Use YaRN"}),e.jsx("p",{children:e.jsx("strong",{children:"Good candidates for YaRN:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Qwen3 models (trained at 32K, support 131K with YaRN)"}),e.jsx("li",{children:"Llama models with RoPE scaling support"}),e.jsx("li",{children:"Any model where you need 2-4x the native context"})]}),e.jsx("p",{children:e.jsx("strong",{children:"When NOT to use YaRN:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"If native context is sufficient for your use case"}),e.jsx("li",{children:"Extensions beyond 4x (quality degrades significantly)"}),e.jsx("li",{children:"Models without RoPE (older architectures)"})]}),e.jsx("h3",{id:"63-configuration",children:"6.3 Configuration"}),e.jsx("p",{children:e.jsx("strong",{children:"Basic YaRN Setup:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  Qwen3-8B-Q8_0:
    context_window: 131072 # Extended context (131K)
    rope_scaling: yarn # Enable YaRN`})}),e.jsx("p",{children:"That's often all you needKronk auto-calculates the other YaRN parameters from the context extension ratio."}),e.jsx("p",{children:e.jsx("strong",{children:"Full Configuration (Advanced):"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  Qwen3-8B-Q8_0:
    context_window: 131072
    rope_scaling: yarn
    rope_freq_base: 1000000 # Model-specific (Qwen3 uses 1M)
    rope_freq_scale: null # Auto-calculate
    yarn_ext_factor: null # Auto-calculate
    yarn_attn_factor: 1.0 # Attention scaling
    yarn_beta_fast: 32.0 # Low correction dimension
    yarn_beta_slow: 1.0 # High correction dimension
    yarn_orig_ctx: 32768 # Original training context`})}),e.jsx("h3",{id:"64-scaling-types",children:"6.4 Scaling Types"}),e.jsx("p",{children:"Kronk supports three RoPE scaling methods:"}),e.jsx("p",{children:e.jsx("strong",{children:"None (Default)"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:"rope_scaling: none"})}),e.jsx("p",{children:"Uses native context length. No scaling applied."}),e.jsx("p",{children:e.jsx("strong",{children:"Linear"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:"rope_scaling: linear"})}),e.jsx("p",{children:"Simple linear interpolation. Works but quality degrades faster than YaRN at high extension ratios."}),e.jsx("p",{children:e.jsx("strong",{children:"YaRN (Recommended)"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:"rope_scaling: yarn"})}),e.jsx("p",{children:"Frequency-dependent interpolation with attention scaling. Maintains quality better at 2-4x extensions."}),e.jsx("h3",{id:"65-parameter-reference",children:"6.5 Parameter Reference"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Parameter"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"rope_scaling"})}),e.jsx("td",{children:"none"}),e.jsxs("td",{children:["Scaling method: ",e.jsx("code",{children:"none"}),", ",e.jsx("code",{children:"linear"}),", ",e.jsx("code",{children:"yarn"})]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"rope_freq_base"})}),e.jsx("td",{children:"model default"}),e.jsx("td",{children:"Base frequency (10000 for Llama, 1000000 for Qwen3)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"rope_freq_scale"})}),e.jsx("td",{children:"auto"}),e.jsx("td",{children:"Frequency scaling factor"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"yarn_ext_factor"})}),e.jsx("td",{children:"auto"}),e.jsx("td",{children:"Extrapolation mix factor (0 = disable)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"yarn_attn_factor"})}),e.jsx("td",{children:"1.0"}),e.jsx("td",{children:"Attention magnitude scaling"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"yarn_beta_fast"})}),e.jsx("td",{children:"32.0"}),e.jsx("td",{children:"Low correction dimension"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"yarn_beta_slow"})}),e.jsx("td",{children:"1.0"}),e.jsx("td",{children:"High correction dimension"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"yarn_orig_ctx"})}),e.jsx("td",{children:"model metadata"}),e.jsx("td",{children:"Original training context size"})]})]})]}),e.jsx("h3",{id:"66-model-specific-examples",children:"6.6 Model-Specific Examples"}),e.jsx("p",{children:e.jsx("strong",{children:"Qwen3 (32K  131K)"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  Qwen3-8B-Q8_0:
    context_window: 131072
    rope_scaling: yarn`})}),e.jsx("p",{children:"Qwen3 models are specifically designed to support 131K context with YaRN. The default parameters work well."}),e.jsx("p",{children:e.jsx("strong",{children:"Llama 3 (8K  32K)"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  Llama-3-8B-Q8_0:
    context_window: 32768
    rope_scaling: yarn
    rope_freq_base: 10000`})}),e.jsx("p",{children:"4x extension from 8K to 32K is within the recommended range."}),e.jsx("h3",{id:"67-memory-impact",children:"6.7 Memory Impact"}),e.jsx("p",{children:"Extended context significantly increases memory requirements:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Qwen3-8B with F16 KV cache:

32K context:   ~1.6 GB KV cache
64K context:   ~3.2 GB KV cache
131K context:  ~6.5 GB KV cache`})}),e.jsx("p",{children:e.jsx("strong",{children:"Mitigation strategies:"})}),e.jsx("ol",{children:e.jsx("li",{children:"Use KV cache quantization:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`cache_type_k: q8_0
cache_type_v: q8_0`})}),e.jsx("ol",{children:e.jsx("li",{children:"Reduce batch parallelism:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:"n_seq_max: 1 # Fewer concurrent requests"})}),e.jsx("ol",{children:e.jsx("li",{children:"Keep KV cache on CPU (slower but saves VRAM):"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:"offload_kqv: false"})}),e.jsx("h3",{id:"68-quality-considerations",children:"6.8 Quality Considerations"}),e.jsx("p",{children:e.jsx("strong",{children:"Extension ratio guidelines:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"2x extension: Minimal quality loss"}),e.jsx("li",{children:"3x extension: Slight degradation, usually acceptable"}),e.jsx("li",{children:"4x extension: Noticeable but often usable"}),e.jsx("li",{children:"> 4x extension: Not recommended"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Testing your configuration:"})}),e.jsxs("ol",{children:[e.jsx("li",{children:"Start with a known-good prompt at native context"}),e.jsx("li",{children:"Extend to your target length"}),e.jsx("li",{children:"Compare output quality"}),e.jsx("li",{children:"Adjust if needed (reduce extension or try different parameters)"})]}),e.jsx("h3",{id:"69-example-long-document-processing",children:"6.9 Example: Long Document Processing"}),e.jsx("p",{children:"Configuration for processing long documents:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  Qwen3-8B-Q8_0:
    context_window: 65536 # 64K context
    rope_scaling: yarn
    n_batch: 4096 # Larger batch for long prompts
    n_ubatch: 1024
    cache_type_k: q8_0
    cache_type_v: q8_0
    n_seq_max: 1 # Single request (memory intensive)`})}),e.jsx("p",{children:"This configuration can process documents up to ~50K tokens while leaving room for generation."}),e.jsx("hr",{}),e.jsx("h2",{id:"chapter-7-model-server",children:"Chapter 7: Model Server"}),e.jsx("p",{children:"The Kronk Model Server provides an OpenAI-compatible REST API for inference. This chapter covers server configuration, management, and the catalog system."}),e.jsx("p",{children:e.jsx("strong",{children:"CLI Modes: Web vs Local"})}),e.jsx("p",{children:"Most CLI commands communicate with a running server by default:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`kronk catalog list                # Talks to server at localhost:8080
kronk catalog pull Qwen3-8B-Q8_0  # Downloads via server`})}),e.jsxs("p",{children:["Add ",e.jsx("code",{children:"--local"})," to run commands directly without a server:"]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`kronk catalog list --local        # Direct file access
kronk catalog pull Qwen3-8B-Q8_0 --local
kronk libs --local`})}),e.jsxs("p",{children:["Use ",e.jsx("code",{children:"--local"})," when:"]}),e.jsxs("ul",{children:[e.jsx("li",{children:"The server isn't running yet"}),e.jsx("li",{children:"You're setting up on the same machine where the server will run"}),e.jsx("li",{children:"You prefer direct file operations"})]}),e.jsx("p",{children:"Use web mode (no flag) when:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"The server is running"}),e.jsx("li",{children:"You want progress streaming in the BUI"}),e.jsxs("li",{children:["You're managing a remote server via ",e.jsx("code",{children:"KRONK_WEB_API_HOST"})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Environment Variables"})}),e.jsxs("p",{children:["Every command-line flag has a corresponding environment variable. The naming convention is ",e.jsx("code",{children:"KRONK_"})," followed by the flag name in uppercase with hyphens replaced by underscores:"]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`--api-host          KRONK_WEB_API_HOST
--models-in-cache   KRONK_MODELS_IN_CACHE
--cache-ttl         KRONK_CACHE_TTL
--processor         KRONK_PROCESSOR
--hf-token          KRONK_HF_TOKEN
                      GITHUB_TOKEN  (not a flag; env var only)`})}),e.jsx("p",{children:"Environment variables are useful for:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Configuration in Docker/Kubernetes deployments"}),e.jsx("li",{children:"Setting defaults without repeating flags"}),e.jsx("li",{children:"Keeping secrets out of command history"})]}),e.jsx("h3",{id:"71-starting-the-server",children:"7.1 Starting the Server"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Install the CLI"})," (if not already installed)"]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"go install github.com/ardanlabs/kronk/cmd/kronk@latest"})}),e.jsx("p",{children:e.jsx("strong",{children:"Basic Start"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk server start"})}),e.jsxs("p",{children:["The server starts on ",e.jsx("code",{children:"http://localhost:8080"})," by default."]}),e.jsx("p",{children:e.jsx("strong",{children:"Background Mode"})}),e.jsx("p",{children:"Run the server as a background process:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk server start -d"})}),e.jsx("p",{children:e.jsx("strong",{children:"Custom Host/Port"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk server start --api-host=0.0.0.0:9000"})}),e.jsx("h3",{id:"72-stopping-the-server",children:"7.2 Stopping the Server"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk server stop"})}),e.jsx("h3",{id:"73-server-configuration",children:"7.3 Server Configuration"}),e.jsxs("p",{children:["Configuration can be set via command-line flags or environment variables. Every flag has a corresponding environment variable using the ",e.jsx("code",{children:"KRONK_"})," prefix with underscores replacing hyphens."]}),e.jsx("p",{children:e.jsx("strong",{children:"Web Settings"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Environment Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--api-host"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_WEB_API_HOST"})}),e.jsx("td",{children:e.jsx("code",{children:"localhost:8080"})}),e.jsx("td",{children:"API host address"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--debug-host"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_WEB_DEBUG_HOST"})}),e.jsx("td",{children:e.jsx("code",{children:"localhost:8090"})}),e.jsx("td",{children:"Debug/pprof host address"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--read-timeout"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_WEB_READ_TIMEOUT"})}),e.jsx("td",{children:e.jsx("code",{children:"30s"})}),e.jsx("td",{children:"HTTP read timeout"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--write-timeout"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_WEB_WRITE_TIMEOUT"})}),e.jsx("td",{children:e.jsx("code",{children:"15m"})}),e.jsx("td",{children:"HTTP write timeout"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--idle-timeout"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_WEB_IDLE_TIMEOUT"})}),e.jsx("td",{children:e.jsx("code",{children:"1m"})}),e.jsx("td",{children:"HTTP idle timeout"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--shutdown-timeout"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_WEB_SHUTDOWN_TIMEOUT"})}),e.jsx("td",{children:e.jsx("code",{children:"1m"})}),e.jsx("td",{children:"Graceful shutdown timeout"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--cors-allowed-origins"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_WEB_CORS_ALLOWED_ORIGINS"})}),e.jsx("td",{children:e.jsx("code",{children:"*"})}),e.jsx("td",{children:"Comma-separated CORS origins"})]})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Authentication Settings"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Environment Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--auth-host"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_AUTH_HOST"})}),e.jsx("td",{children:e.jsx("em",{children:"(empty)"})}),e.jsx("td",{children:"External auth service host. Leave empty to use local auth"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--auth-enabled"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_AUTH_LOCAL_ENABLED"})}),e.jsx("td",{children:e.jsx("code",{children:"false"})}),e.jsx("td",{children:"Enable local JWT authentication"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--auth-issuer"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_AUTH_LOCAL_ISSUER"})}),e.jsx("td",{children:e.jsx("code",{children:"kronk project"})}),e.jsx("td",{children:"Issuer name for local JWT tokens"})]})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Tracing Settings (Tempo)"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Environment Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--tempo-host"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_TEMPO_HOST"})}),e.jsx("td",{children:e.jsx("code",{children:"localhost:4317"})}),e.jsx("td",{children:"OpenTelemetry collector host"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--tempo-service-name"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_TEMPO_SERVICE_NAME"})}),e.jsx("td",{children:e.jsx("code",{children:"kronk"})}),e.jsx("td",{children:"Service name for traces"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--tempo-probability"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_TEMPO_PROBABILITY"})}),e.jsx("td",{children:e.jsx("code",{children:"0.25"})}),e.jsx("td",{children:"Trace sampling probability (0.0-1.0)"})]})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Catalog Settings"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Environment Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--catalog-github-repo"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_CATALOG_GITHUB_REPO"})}),e.jsx("td",{children:"GitHub API URL"}),e.jsx("td",{children:"GitHub repo URL for catalog files"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--model-config-file"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_CATALOG_MODEL_CONFIG_FILE"})}),e.jsx("td",{children:e.jsx("em",{children:"(empty)"})}),e.jsx("td",{children:"Path to model-specific config YAML file"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--catalog-repo-path"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_CATALOG_REPO_PATH"})}),e.jsx("td",{children:e.jsx("em",{children:"(empty)"})}),e.jsx("td",{children:"Path to cloned catalog repository for publishing edits"})]})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Template Settings"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Environment Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--templates-github-repo"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_TEMPLATES_GITHUB_REPO"})}),e.jsx("td",{children:"GitHub API URL"}),e.jsx("td",{children:"GitHub repo URL for template files"})]})})]}),e.jsx("p",{children:e.jsx("strong",{children:"Cache Settings"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Environment Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--models-in-cache"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_CACHE_MODELS_IN_CACHE"})}),e.jsx("td",{children:e.jsx("code",{children:"3"})}),e.jsx("td",{children:"Maximum models kept loaded in memory"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--cache-ttl"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_CACHE_TTL"})}),e.jsx("td",{children:e.jsx("code",{children:"20m"})}),e.jsx("td",{children:"How long unused models stay loaded"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--ignore-integrity-check"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_CACHE_IGNORE_INTEGRITY_CHECK"})}),e.jsx("td",{children:e.jsx("code",{children:"true"})}),e.jsx("td",{children:"Skip SHA256 integrity check on model load"})]})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Runtime Settings"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Flag"}),e.jsx("th",{children:"Environment Variable"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--base-path"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_BASE_PATH"})}),e.jsx("td",{children:e.jsx("code",{children:"~/.kronk"})}),e.jsx("td",{children:"Base directory for all Kronk data"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--lib-path"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_LIB_PATH"})}),e.jsx("td",{children:e.jsx("em",{children:"(empty)"})}),e.jsx("td",{children:"Path to llama library directory"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--lib-version"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_LIB_VERSION"})}),e.jsx("td",{children:e.jsx("em",{children:"(empty)"})}),e.jsx("td",{children:"Specific llama library version"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--arch"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_ARCH"})}),e.jsx("td",{children:e.jsx("em",{children:"(auto)"})}),e.jsxs("td",{children:["Architecture override (",e.jsx("code",{children:"amd64"}),", ",e.jsx("code",{children:"arm64"}),")"]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--os"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_OS"})}),e.jsx("td",{children:e.jsx("em",{children:"(auto)"})}),e.jsxs("td",{children:["OS override (",e.jsx("code",{children:"linux"}),", ",e.jsx("code",{children:"darwin"}),", ",e.jsx("code",{children:"windows"}),")"]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--processor"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_PROCESSOR"})}),e.jsx("td",{children:e.jsx("em",{children:"(auto)"})}),e.jsxs("td",{children:["Processor type (",e.jsx("code",{children:"cpu"}),", ",e.jsx("code",{children:"metal"}),", ",e.jsx("code",{children:"cuda"}),", ",e.jsx("code",{children:"rocm"}),", ",e.jsx("code",{children:"vulkan"}),")"]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--hf-token"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_HF_TOKEN"})}),e.jsx("td",{children:e.jsx("em",{children:"(empty)"})}),e.jsx("td",{children:"Hugging Face API token for gated models"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("em",{children:"(env var only)"})}),e.jsx("td",{children:e.jsx("code",{children:"GITHUB_TOKEN"})}),e.jsx("td",{children:e.jsx("em",{children:"(empty)"})}),e.jsx("td",{children:"GitHub token for higher catalog sync rate limits"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--allow-upgrade"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_ALLOW_UPGRADE"})}),e.jsx("td",{children:e.jsx("code",{children:"true"})}),e.jsx("td",{children:"Allow automatic library upgrades"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--llama-log"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_LLAMA_LOG"})}),e.jsx("td",{children:e.jsx("code",{children:"1"})}),e.jsx("td",{children:"Llama log level (0=off, 1=on)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"--insecure-logging"})}),e.jsx("td",{children:e.jsx("code",{children:"KRONK_INSECURE_LOGGING"})}),e.jsx("td",{children:e.jsx("code",{children:"false"})}),e.jsx("td",{children:"Log sensitive data (messages, model config)"})]})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Example"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`kronk server start \\
  --api-host=0.0.0.0:8080 \\
  --models-in-cache=5 \\
  --cache-ttl=30m \\
  --model-config-file=model-config.yaml \\
  --catalog-repo-path=~/code/kronk_catalogs \\
  --hf-token=hf_xxxxx`})}),e.jsx("h3",{id:"74-model-caching",children:"7.4 Model Caching"}),e.jsx("p",{children:"The server maintains a pool of loaded models to avoid reload latency."}),e.jsx("p",{children:e.jsx("strong",{children:"Configuration"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`kronk server start \\
  --models-in-cache=3 \\
  --cache-ttl=5m`})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"models-in-cache"})," - Maximum models kept loaded (default: 3)"]}),e.jsxs("li",{children:[e.jsx("code",{children:"cache-ttl"})," - How long unused models stay loaded (default: 5m)"]})]}),e.jsx("p",{children:"When a new model is requested and the cache is full, the least recently used model is unloaded."}),e.jsx("h3",{id:"75-model-config-files",children:"7.5 Model Config Files"}),e.jsx("p",{children:"Create a YAML file to configure model-specific settings:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`# model-config.yaml
models:
  Qwen3-8B-Q8_0:
    context_window: 32768
    n_seq_max: 4
    cache_type_k: q8_0
    cache_type_v: q8_0
    system_prompt_cache: true

  Llama-3.3-70B-Instruct-Q8_0:
    context_window: 8192
    n_gpu_layers: 0
    split_mode: row

  embeddinggemma-300m-qat-Q8_0:
    n_seq_max: 2`})}),e.jsx("p",{children:"Start with the config file:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk server start --model-config-file=model-config.yaml"})}),e.jsx("p",{children:"Or via environment variable:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`export KRONK_CATALOG_MODEL_CONFIG_FILE=/path/to/model-config.yaml
kronk server start`})}),e.jsx("p",{children:e.jsx("strong",{children:"Project Reference Configuration"})}),e.jsx("p",{children:"The Kronk repository includes a comprehensive reference configuration with recommended settings for various models and use cases:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`export KRONK_CATALOG_MODEL_CONFIG_FILE=<clone_path>/zarf/kms/model_config.yaml
kronk server start`})}),e.jsx("p",{children:"This file includes:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Optimized configurations for coding agents (Cline, OpenCode)"}),e.jsx("li",{children:"YaRN extended context examples"}),e.jsx("li",{children:"SPC and IMC variants for different caching strategies"}),e.jsx("li",{children:"Vision and audio model settings"}),e.jsx("li",{children:"Detailed comments explaining each configuration option"})]}),e.jsxs("p",{children:["Review ",e.jsx("code",{children:"zarf/kms/model_config.yaml"})," for examples of YAML anchors, cache configurations, and model-specific tuning."]}),e.jsx("h3",{id:"76-catalog-system",children:"7.6 Catalog System"}),e.jsx("p",{children:"The catalog provides a curated list of verified models with preconfigured settings."}),e.jsx("p",{children:e.jsx("strong",{children:"List Available Models"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk catalog list"})}),e.jsx("p",{children:"Output:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`CATALOG              MODEL ID                         PULLED  ENDPOINT
Audio-Text-to-Text   Qwen2-Audio-7B.Q8_0              no      chat_completion
Embedding            embeddinggemma-300m-qat-Q8_0     no      embeddings
Image-Text-to-Text   gemma-3-4b-it-q4_0               no      chat_completion
Text-Generation      Qwen3-8B-Q8_0                    yes     chat_completion
Text-Generation      Llama-3.3-70B-Instruct-Q8_0      no      chat_completion`})}),e.jsx("p",{children:e.jsx("strong",{children:"Filter by Category"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk catalog list --filter-category=Embedding"})}),e.jsx("p",{children:e.jsx("strong",{children:"Pull a Model"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk catalog pull Qwen3-8B-Q8_0"})}),e.jsx("p",{children:e.jsx("strong",{children:"Show Model Details"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk catalog show Qwen3-8B-Q8_0"})}),e.jsx("p",{children:e.jsx("strong",{children:"Update Catalog"})}),e.jsx("p",{children:e.jsx("em",{children:"Note: We don't have a server version of this yet."})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk catalog update --local"})}),e.jsx("h3",{id:"77-custom-catalog-repository",children:"7.7 Custom Catalog Repository"}),e.jsx("p",{children:"Use a custom catalog repository:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`kronk server start \\
  --catalog-github-repo=https://github.com/myorg/my-catalog`})}),e.jsx("h3",{id:"78-templates",children:"7.8 Templates"}),e.jsx("p",{children:"Templates define chat formatting (Jinja templates) for different models. Kronk downloads templates automatically from the offical templates repository."}),e.jsx("p",{children:"https://github.com/ardanlabs/kronk_catalogs"}),e.jsx("p",{children:"You don't need this unless you want to maintain your own repository."}),e.jsx("p",{children:e.jsx("strong",{children:"Custom Templates Repository"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`kronk server start \\
  --templates-github-repo=https://github.com/myorg/my-templates`})}),e.jsxs("p",{children:["Templates are cached in ",e.jsx("code",{children:"~/.kronk/templates/"})," by default."]}),e.jsx("h3",{id:"79-runtime-settings",children:"7.9 Runtime Settings"}),e.jsx("p",{children:e.jsx("strong",{children:"Processor Selection"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`kronk server start --processor=cuda    # NVIDIA GPU
kronk server start --processor=metal   # Apple Silicon
kronk server start --processor=vulkan  # Cross-platform GPU
kronk server start --processor=rocm    # AMD GPU (ROCm/HIP)
kronk server start --processor=cpu     # CPU only`})}),e.jsx("p",{children:e.jsx("strong",{children:"Library Path"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`kronk server start \\
  --lib-path=/custom/path/to/libraries \\
  --lib-version=b7406`})}),e.jsx("p",{children:e.jsx("strong",{children:"Hugging Face Token"})}),e.jsx("p",{children:"For gated models requiring authentication:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk server start --hf-token=hf_xxxxx"})}),e.jsx("p",{children:"Or via environment variable:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`export KRONK_HF_TOKEN=hf_xxxxx
kronk server start`})}),e.jsx("p",{children:"For higher GitHub API rate limits during catalog sync:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`export GITHUB_TOKEN=ghp_xxxxx
kronk server start`})}),e.jsx("p",{children:"Without a token, GitHub allows 60 requests/hour. With a token, the limit increases to 5,000 requests/hour. Kronk degrades gracefully when rate limited, falling back to local cache."}),e.jsx("h3",{id:"710-logging",children:"7.10 Logging"}),e.jsx("p",{children:e.jsx("strong",{children:"llama.cpp Logging"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`kronk server start --llama-log=1    # Enable llama.cpp logs
kronk server start --llama-log=0    # Disable (default)`})}),e.jsx("p",{children:e.jsx("strong",{children:"Insecure Logging"})}),e.jsx("p",{children:"Enable logging of message content (for debugging only):"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk server start --insecure-logging=true"})}),e.jsxs("p",{children:[e.jsx("strong",{children:"Warning:"})," This logs sensitive data. Never use in production."]}),e.jsx("p",{children:e.jsx("strong",{children:"View Server Logs"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk server logs"})}),e.jsx("h3",{id:"711-data-paths",children:"7.11 Data Paths"}),e.jsx("p",{children:"Default data locations:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`~/.kronk/
 libraries/     # llama.cpp libraries
 models/        # Downloaded models
 templates/     # Chat templates
 catalog/       # Catalog cache`})}),e.jsx("p",{children:e.jsx("strong",{children:"Custom Base Path"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk server start --base-path=/data/kronk"})}),e.jsx("h3",{id:"712-complete-example",children:"7.12 Complete Example"}),e.jsx("p",{children:"Production-ready server configuration:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`kronk server start \\
  --api-host=0.0.0.0:8080 \\
  --models-in-cache=2 \\
  --cache-ttl=10m \\
  --model-config-file=/etc/kronk/models.yaml \\
  --processor=cuda \\
  --auth-enabled=true \\
  -d`})}),e.jsx("p",{children:"With model config:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`# /etc/kronk/models.yaml
models:
  Qwen3-8B-Q8_0:
    context_window: 32768
    n_seq_max: 4
    cache_type_k: q8_0
    cache_type_v: q8_0
    incremental_cache: true`})}),e.jsx("hr",{}),e.jsx("h2",{id:"chapter-8-api-endpoints",children:"Chapter 8: API Endpoints"}),e.jsx("p",{children:"Kronk provides an OpenAI-compatible REST API. This chapter documents the available endpoints and their usage."}),e.jsx("h3",{id:"81-endpoint-overview",children:"8.1 Endpoint Overview"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Endpoint"}),e.jsx("th",{children:"Method"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"/v1/chat/completions"})}),e.jsx("td",{children:"POST"}),e.jsx("td",{children:"Chat completions (streaming/non-streaming)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"/v1/responses"})}),e.jsx("td",{children:"POST"}),e.jsx("td",{children:"OpenAI Responses API format"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"/v1/messages"})}),e.jsx("td",{children:"POST"}),e.jsx("td",{children:"Anthropic API format"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"/v1/embeddings"})}),e.jsx("td",{children:"POST"}),e.jsx("td",{children:"Generate embeddings"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"/v1/rerank"})}),e.jsx("td",{children:"POST"}),e.jsx("td",{children:"Rerank documents"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"/v1/tokenize"})}),e.jsx("td",{children:"POST"}),e.jsx("td",{children:"Tokenize text input"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"/v1/models"})}),e.jsx("td",{children:"GET"}),e.jsx("td",{children:"List available models"})]})]})]}),e.jsx("h3",{id:"82-chat-completions",children:"8.2 Chat Completions"}),e.jsx("p",{children:"Generate chat responses using the familiar OpenAI format."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Endpoint:"})," ",e.jsx("code",{children:"POST /v1/chat/completions"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Basic Request:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`curl http://localhost:8080/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "Qwen3-8B-Q8_0",
    "messages": [
      {"role": "system", "content": "You are a helpful assistant."},
      {"role": "user", "content": "What is the capital of France?"}
    ]
  }'`})}),e.jsx("p",{children:e.jsx("strong",{children:"Request Parameters:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "model": "Qwen3-8B-Q8_0",
  "messages": [
    { "role": "system", "content": "System prompt" },
    { "role": "user", "content": "User message" },
    { "role": "assistant", "content": "Previous response" },
    { "role": "user", "content": "Follow-up question" }
  ],
  "temperature": 0.8,
  "top_p": 0.9,
  "top_k": 40,
  "max_tokens": 2048,
  "stream": true
}`})}),e.jsx("p",{children:e.jsx("strong",{children:"Streaming Response:"})}),e.jsxs("p",{children:["With ",e.jsx("code",{children:'"stream": true'}),", responses are sent as Server-Sent Events:"]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`data: {"id":"chatcmpl-xxx","object":"chat.completion.chunk",...}

data: {"id":"chatcmpl-xxx","object":"chat.completion.chunk",...}

data: [DONE]`})}),e.jsx("p",{children:e.jsx("strong",{children:"Non-Streaming Response:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "id": "chatcmpl-xxx",
  "object": "chat.completion",
  "created": 1234567890,
  "model": "Qwen3-8B-Q8_0",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "The capital of France is Paris."
      },
      "finish_reason": "stop"
    }
  ],
  "usage": {
    "prompt_tokens": 25,
    "completion_tokens": 8,
    "total_tokens": 33
  }
}`})}),e.jsx("p",{children:e.jsx("strong",{children:"Reasoning Models:"})}),e.jsx("p",{children:"For models with thinking/reasoning support (like Qwen3):"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "model": "Qwen3-8B-Q8_0",
  "messages": [...],
  "enable_thinking": true
}`})}),e.jsxs("p",{children:["The response includes ",e.jsx("code",{children:"reasoning_content"})," in the message."]}),e.jsx("p",{children:"To disable thinking:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "enable_thinking": false
}`})}),e.jsx("h3",{id:"83-responses-api",children:"8.3 Responses API"}),e.jsx("p",{children:"OpenAI's newer Responses API format, used by some clients."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Endpoint:"})," ",e.jsx("code",{children:"POST /v1/responses"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Request:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`curl http://localhost:8080/v1/responses \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "Qwen3-8B-Q8_0",
    "input": "Explain quantum computing in simple terms."
  }'`})}),e.jsxs("p",{children:["The ",e.jsx("code",{children:"input"})," field can be a string or an array of message objects."]}),e.jsx("p",{children:e.jsx("strong",{children:"Streaming Events:"})}),e.jsx("p",{children:"The Responses API uses a different event format:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`event: response.created
data: {"type":"response.created",...}

event: response.output_text.delta
data: {"type":"response.output_text.delta","delta":"The",...}

event: response.output_text.delta
data: {"type":"response.output_text.delta","delta":" answer",...}

event: response.completed
data: {"type":"response.completed",...}`})}),e.jsx("h3",{id:"84-embeddings",children:"8.4 Embeddings"}),e.jsx("p",{children:"Generate vector embeddings for text."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Endpoint:"})," ",e.jsx("code",{children:"POST /v1/embeddings"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Request:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`curl http://localhost:8080/v1/embeddings \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "embeddinggemma-300m-qat-Q8_0",
    "input": "The quick brown fox jumps over the lazy dog."
  }'`})}),e.jsx("p",{children:e.jsx("strong",{children:"Multiple Inputs:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "model": "embeddinggemma-300m-qat-Q8_0",
  "input": [
    "First document to embed.",
    "Second document to embed.",
    "Third document to embed."
  ]
}`})}),e.jsx("p",{children:e.jsx("strong",{children:"Response:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "object": "list",
  "data": [
    {
      "object": "embedding",
      "index": 0,
      "embedding": [0.123, -0.456, 0.789, ...]
    }
  ],
  "model": "embeddinggemma-300m-qat-Q8_0",
  "usage": {
    "prompt_tokens": 10,
    "total_tokens": 10
  }
}`})}),e.jsx("h3",{id:"85-reranking",children:"8.5 Reranking"}),e.jsx("p",{children:"Score and reorder documents by relevance to a query."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Endpoint:"})," ",e.jsx("code",{children:"POST /v1/rerank"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Request:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`curl http://localhost:8080/v1/rerank \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "bge-reranker-v2-m3-Q8_0",
    "query": "What is machine learning?",
    "documents": [
      "Machine learning is a subset of artificial intelligence.",
      "The weather today is sunny.",
      "Deep learning uses neural networks.",
      "I like pizza."
    ],
    "top_n": 2
  }'`})}),e.jsx("p",{children:e.jsx("strong",{children:"Response:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "object": "list",
  "results": [
    {
      "index": 0,
      "relevance_score": 0.95,
      "document": "Machine learning is a subset of artificial intelligence."
    },
    {
      "index": 2,
      "relevance_score": 0.82,
      "document": "Deep learning uses neural networks."
    }
  ],
  "model": "bge-reranker-v2-m3-Q8_0",
  "usage": {
    "prompt_tokens": 45,
    "total_tokens": 45
  }
}`})}),e.jsx("h3",{id:"86-tokenize",children:"8.6 Tokenize"}),e.jsx("p",{children:"Get the token count for a text input. Works with any model type."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Endpoint:"})," ",e.jsx("code",{children:"POST /v1/tokenize"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Parameters:"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Field"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"model"})}),e.jsx("td",{children:e.jsx("code",{children:"string"})}),e.jsx("td",{children:"Yes"}),e.jsxs("td",{children:["Model ID (e.g., ",e.jsx("code",{children:"Qwen3-8B-Q8_0"}),"). Works with any model type."]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"input"})}),e.jsx("td",{children:e.jsx("code",{children:"string"})}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"The text to tokenize."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"apply_template"})}),e.jsx("td",{children:e.jsx("code",{children:"boolean"})}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"If true, wraps the input as a user message and applies the model's chat template before tokenizing. The count includes template overhead. Defaults to false."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"add_generation_prompt"})}),e.jsx("td",{children:e.jsx("code",{children:"boolean"})}),e.jsx("td",{children:"No"}),e.jsxs("td",{children:["When ",e.jsx("code",{children:"apply_template"})," is true, controls whether the assistant role prefix is appended to the prompt. Defaults to true."]})]})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Request (raw text):"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`curl http://localhost:8080/v1/tokenize \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "Qwen3-8B-Q8_0",
    "input": "The quick brown fox jumps over the lazy dog"
  }'`})}),e.jsx("p",{children:e.jsx("strong",{children:"Request (with template):"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`curl http://localhost:8080/v1/tokenize \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "Qwen3-8B-Q8_0",
    "input": "The quick brown fox jumps over the lazy dog",
    "apply_template": true
  }'`})}),e.jsx("p",{children:e.jsx("strong",{children:"Response:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "object": "tokenize",
  "created": 1738857600,
  "model": "Qwen3-8B-Q8_0",
  "tokens": 11
}`})}),e.jsxs("p",{children:["When ",e.jsx("code",{children:"apply_template"})," is true, the token count will be higher than raw text because it includes template overhead (role markers, separators, and the generation prompt)."]}),e.jsx("h3",{id:"87-tool-calling-function-calling",children:"8.7 Tool Calling (Function Calling)"}),e.jsx("p",{children:"Kronk supports OpenAI-compatible tool calling, allowing models to request function executions that you handle in your application."}),e.jsx("p",{children:e.jsx("strong",{children:"Request with Tools:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`curl http://localhost:8080/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "Qwen3-8B-Q8_0",
    "messages": [
      {"role": "user", "content": "What is the weather in Paris?"}
    ],
    "tools": [
      {
        "type": "function",
        "function": {
          "name": "get_weather",
          "description": "Get current weather for a location",
          "parameters": {
            "type": "object",
            "properties": {
              "location": {
                "type": "string",
                "description": "City name"
              }
            },
            "required": ["location"]
          }
        }
      }
    ],
    "tool_choice": "auto"
  }'`})}),e.jsx("p",{children:e.jsx("strong",{children:"Tool Choice Options:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:'"auto"'})," - Model decides whether to call tools (default)"]}),e.jsxs("li",{children:[e.jsx("code",{children:'"none"'})," - Never call tools"]}),e.jsxs("li",{children:[e.jsx("code",{children:'{"type": "function", "function": {"name": "get_weather"}}'})," - Force specific tool"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Response with Tool Calls:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "id": "chatcmpl-xxx",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": null,
        "tool_calls": [
          {
            "id": "call_abc123",
            "type": "function",
            "function": {
              "name": "get_weather",
              "arguments": "{\\"location\\": \\"Paris\\"}"
            }
          }
        ]
      },
      "finish_reason": "tool_calls"
    }
  ]
}`})}),e.jsx("p",{children:e.jsx("strong",{children:"Handling Tool Results:"})}),e.jsx("p",{children:"After executing the tool, send the result back:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "model": "Qwen3-8B-Q8_0",
  "messages": [
    { "role": "user", "content": "What is the weather in Paris?" },
    {
      "role": "assistant",
      "content": null,
      "tool_calls": [
        {
          "id": "call_abc123",
          "type": "function",
          "function": {
            "name": "get_weather",
            "arguments": "{\\"location\\": \\"Paris\\"}"
          }
        }
      ]
    },
    {
      "role": "tool",
      "tool_call_id": "call_abc123",
      "content": "{\\"temperature\\": 18, \\"condition\\": \\"sunny\\"}"
    }
  ]
}`})}),e.jsx("p",{children:e.jsx("strong",{children:"Streaming with Tool Calls:"})}),e.jsx("p",{children:"Tool call arguments stream incrementally:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`data: {"choices":[{"delta":{"tool_calls":[{"index":0,"function":{"arguments":"{\\"loc"}}]}}]}

data: {"choices":[{"delta":{"tool_calls":[{"index":0,"function":{"arguments":"ation\\":"}}]}}]}

data: {"choices":[{"delta":{"tool_calls":[{"index":0,"function":{"arguments":" \\"Paris\\"}"}}]}}]}`})}),e.jsx("h3",{id:"88-models-list",children:"8.8 Models List"}),e.jsx("p",{children:"Get available models."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Endpoint:"})," ",e.jsx("code",{children:"GET /v1/models"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Request:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"curl http://localhost:8080/v1/models"})}),e.jsx("p",{children:e.jsx("strong",{children:"Response:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "object": "list",
  "data": [
    {
      "id": "Qwen3-8B-Q8_0",
      "object": "model",
      "owned_by": "kronk"
    },
    {
      "id": "embeddinggemma-300m-qat-Q8_0",
      "object": "model",
      "owned_by": "kronk"
    }
  ]
}`})}),e.jsx("h3",{id:"89-authentication",children:"8.9 Authentication"}),e.jsx("p",{children:"When authentication is enabled, include the token in requests:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`curl http://localhost:8080/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -H "Authorization: Bearer your-token-here" \\
  -d '{...}'`})}),e.jsxs("p",{children:["See ",e.jsx("a",{href:"#chapter-11-security--authentication",children:"Chapter 11: Security & Authentication"})," for details on token management."]}),e.jsx("h3",{id:"810-error-responses",children:"8.10 Error Responses"}),e.jsx("p",{children:"Errors follow a standard format:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "error": {
    "code": "invalid_argument",
    "message": "missing model field"
  }
}`})}),e.jsx("p",{children:e.jsx("strong",{children:"Common Error Codes:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"invalid_argument"})," - Missing or invalid request parameters"]}),e.jsxs("li",{children:[e.jsx("code",{children:"not_found"})," - Model not found"]}),e.jsxs("li",{children:[e.jsx("code",{children:"internal"})," - Server error during processing"]}),e.jsxs("li",{children:[e.jsx("code",{children:"unauthenticated"})," - Missing or invalid authentication token"]})]}),e.jsx("hr",{}),e.jsx("h2",{id:"chapter-9-request-parameters",children:"Chapter 9: Request Parameters"}),e.jsx("p",{children:"This chapter documents the request parameters available for controlling model output through both the SDK and REST API."}),e.jsx("h3",{id:"91-sampling-parameters",children:"9.1 Sampling Parameters"}),e.jsx("p",{children:"These parameters control the randomness and diversity of generated text."}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Parameter"}),e.jsx("th",{children:"JSON Key"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Temperature"}),e.jsx("td",{children:e.jsx("code",{children:"temperature"})}),e.jsx("td",{children:"float32"}),e.jsx("td",{children:"0.8"}),e.jsx("td",{children:"Controls randomness of output. Higher values produce more varied text, lower values more deterministic."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Top-K"}),e.jsx("td",{children:e.jsx("code",{children:"top_k"})}),e.jsx("td",{children:"int32"}),e.jsx("td",{children:"40"}),e.jsx("td",{children:"Limits token pool to K most probable tokens before sampling."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Top-P"}),e.jsx("td",{children:e.jsx("code",{children:"top_p"})}),e.jsx("td",{children:"float32"}),e.jsx("td",{children:"0.9"}),e.jsx("td",{children:"Nucleus sampling threshold. Only tokens with cumulative probability  top_p are considered."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Min-P"}),e.jsx("td",{children:e.jsx("code",{children:"min_p"})}),e.jsx("td",{children:"float32"}),e.jsx("td",{children:"0.0"}),e.jsx("td",{children:"Dynamic sampling threshold. Tokens with probability < min_p  max_probability are excluded."})]})]})]}),e.jsx("h3",{id:"92-repetition-control",children:"9.2 Repetition Control"}),e.jsx("p",{children:"These parameters help prevent repetitive output."}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Parameter"}),e.jsx("th",{children:"JSON Key"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Repeat Penalty"}),e.jsx("td",{children:e.jsx("code",{children:"repeat_penalty"})}),e.jsx("td",{children:"float32"}),e.jsx("td",{children:"1.0"}),e.jsx("td",{children:"Penalty multiplier for repeated tokens. Values > 1.0 discourage repetition."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Repeat Last N"}),e.jsx("td",{children:e.jsx("code",{children:"repeat_last_n"})}),e.jsx("td",{children:"int32"}),e.jsx("td",{children:"64"}),e.jsx("td",{children:"Window size for repetition check. Only the last N tokens are considered."})]})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"DRY Parameters (Don't Repeat Yourself):"})}),e.jsx("p",{children:"DRY penalizes n-gram repetitions to prevent the model from repeating phrases."}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Parameter"}),e.jsx("th",{children:"JSON Key"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"DRY Multiplier"}),e.jsx("td",{children:e.jsx("code",{children:"dry_multiplier"})}),e.jsx("td",{children:"float32"}),e.jsx("td",{children:"1.05"}),e.jsx("td",{children:"N-gram repetition penalty strength. Higher values penalize repetition more."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"DRY Base"}),e.jsx("td",{children:e.jsx("code",{children:"dry_base"})}),e.jsx("td",{children:"float32"}),e.jsx("td",{children:"1.75"}),e.jsx("td",{children:"Exponential penalty base for longer n-grams."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"DRY Allowed Length"}),e.jsx("td",{children:e.jsx("code",{children:"dry_allowed_length"})}),e.jsx("td",{children:"int32"}),e.jsx("td",{children:"2"}),e.jsx("td",{children:"Minimum n-gram length to consider for penalties."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"DRY Penalty Last N"}),e.jsx("td",{children:e.jsx("code",{children:"dry_penalty_last_n"})}),e.jsx("td",{children:"int32"}),e.jsx("td",{children:"0"}),e.jsx("td",{children:"Number of recent tokens to consider for DRY. 0 means all tokens."})]})]})]}),e.jsx("h3",{id:"93-advanced-sampling",children:"9.3 Advanced Sampling"}),e.jsx("p",{children:e.jsx("strong",{children:"XTC (eXtreme Token Culling):"})}),e.jsx("p",{children:"XTC probabilistically removes high-probability tokens to increase diversity."}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Parameter"}),e.jsx("th",{children:"JSON Key"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"XTC Probability"}),e.jsx("td",{children:e.jsx("code",{children:"xtc_probability"})}),e.jsx("td",{children:"float32"}),e.jsx("td",{children:"0.0"}),e.jsx("td",{children:"Probability of activating XTC on each token. 0 disables XTC."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"XTC Threshold"}),e.jsx("td",{children:e.jsx("code",{children:"xtc_threshold"})}),e.jsx("td",{children:"float32"}),e.jsx("td",{children:"0.1"}),e.jsx("td",{children:"Probability threshold for token culling."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"XTC Min Keep"}),e.jsx("td",{children:e.jsx("code",{children:"xtc_min_keep"})}),e.jsx("td",{children:"uint32"}),e.jsx("td",{children:"1"}),e.jsx("td",{children:"Minimum number of tokens to keep after culling."})]})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Adaptive-P:"})}),e.jsx("p",{children:"Adaptive-P dynamically adjusts the sampling threshold based on output probability."}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Parameter"}),e.jsx("th",{children:"JSON Key"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Adaptive-P Target"}),e.jsx("td",{children:e.jsx("code",{children:"adaptive_p_target"})}),e.jsx("td",{children:"float32"}),e.jsx("td",{children:"0.0"}),e.jsx("td",{children:"Target probability threshold. 0 disables adaptive sampling."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Adaptive-P Decay"}),e.jsx("td",{children:e.jsx("code",{children:"adaptive_p_decay"})}),e.jsx("td",{children:"float32"}),e.jsx("td",{children:"0.0"}),e.jsx("td",{children:"Speed of threshold adjustment toward target."})]})]})]}),e.jsx("h3",{id:"94-generation-control",children:"9.4 Generation Control"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Parameter"}),e.jsx("th",{children:"JSON Key"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Max Tokens"}),e.jsx("td",{children:e.jsx("code",{children:"max_tokens"})}),e.jsx("td",{children:"int"}),e.jsx("td",{children:"4096"}),e.jsx("td",{children:"Maximum tokens to generate."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Enable Thinking"}),e.jsx("td",{children:e.jsx("code",{children:"enable_thinking"})}),e.jsx("td",{children:"string"}),e.jsx("td",{children:'"true"'}),e.jsx("td",{children:'Enable model thinking/reasoning mode. Set to "false" for direct responses.'})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Reasoning Effort"}),e.jsx("td",{children:e.jsx("code",{children:"reasoning_effort"})}),e.jsx("td",{children:"string"}),e.jsx("td",{children:'"medium"'}),e.jsx("td",{children:"GPT reasoning level: none, minimal, low, medium, high."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Stream"}),e.jsx("td",{children:e.jsx("code",{children:"stream"})}),e.jsx("td",{children:"bool"}),e.jsx("td",{children:"false"}),e.jsx("td",{children:"Stream response chunks via SSE."})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Include Usage"}),e.jsx("td",{children:e.jsx("code",{children:"include_usage"})}),e.jsx("td",{children:"bool"}),e.jsx("td",{children:"true"}),e.jsx("td",{children:"Include token usage statistics in streaming responses."})]})]})]}),e.jsx("h3",{id:"95-grammar-constrained-output",children:"9.5 Grammar Constrained Output"}),e.jsx("p",{children:"Grammars force the model to only produce tokens that match a specified pattern, guaranteeing structured output."}),e.jsx("p",{children:e.jsx("strong",{children:"Built-in Presets:"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Preset"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"GrammarJSON"})}),e.jsx("td",{children:"Valid JSON objects or arrays"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"GrammarJSONObject"})}),e.jsx("td",{children:"JSON objects only"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"GrammarJSONArray"})}),e.jsx("td",{children:"JSON arrays only"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"GrammarBoolean"})}),e.jsx("td",{children:'"true" or "false"'})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"GrammarYesNo"})}),e.jsx("td",{children:'"yes" or "no"'})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"GrammarInteger"})}),e.jsx("td",{children:"Integer values"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"GrammarNumber"})}),e.jsx("td",{children:"Numeric values (int or float)"})]})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Using Grammar Presets (SDK):"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-go",children:`d := model.D{
    "messages": model.DocumentArray(
        model.TextMessage(model.RoleUser, "List 3 languages in JSON"),
    ),
    "grammar": model.GrammarJSONObject,
}`})}),e.jsx("p",{children:e.jsx("strong",{children:"Using Grammar via API:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`curl http://localhost:8080/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "Qwen3-8B-Q8_0",
    "messages": [{"role": "user", "content": "List 3 languages in JSON"}],
    "grammar": "root ::= object\\nvalue ::= object | array | string | number | \\"true\\" | \\"false\\" | \\"null\\"\\nobject ::= \\"{\\" ws ( string \\":\\" ws value (\\",\\" ws string \\":\\" ws value)* )? ws \\"}\\"\\narray ::= \\"[\\" ws ( value (\\",\\" ws value)* )? ws \\"]\\"\\nstring ::= \\"\\\\\\"\\" ([^\\"\\\\\\\\] | \\"\\\\\\\\\\" [\\"\\\\\\\\bfnrt/] | \\"\\\\\\\\u\\" [0-9a-fA-F]{4})* \\"\\\\\\"\\"\\nnumber ::= \\"-\\"? (\\"0\\" | [1-9][0-9]*) (\\".\\" [0-9]+)? ([eE] [+-]? [0-9]+)?\\nws ::= [ \\\\t\\\\n\\\\r]*"
  }'`})}),e.jsx("p",{children:e.jsx("strong",{children:"JSON Schema Auto-Conversion:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-go",children:`schema := model.D{
    "type": "object",
    "properties": model.D{
        "name": model.D{"type": "string"},
        "year": model.D{"type": "integer"},
    },
    "required": []string{"name", "year"},
}

d := model.D{
    "messages": model.DocumentArray(...),
    "json_schema": schema,
    "enable_thinking": false,
}`})}),e.jsxs("p",{children:["Via API with ",e.jsx("code",{children:"json_schema"})," field:"]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "model": "Qwen3-8B-Q8_0",
  "messages": [...],
  "json_schema": {
    "type": "object",
    "properties": {
      "name": {"type": "string"},
      "year": {"type": "integer"}
    },
    "required": ["name", "year"]
  },
  "enable_thinking": false
}`})}),e.jsx("p",{children:e.jsx("strong",{children:"Custom GBNF Grammars:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-go",children:`sentimentGrammar := \`root ::= sentiment
sentiment ::= "positive" | "negative" | "neutral"\`

d := model.D{
    "messages": model.DocumentArray(...),
    "grammar": sentimentGrammar,
    "enable_thinking": false,
}`})}),e.jsxs("p",{children:[e.jsx("strong",{children:"Important:"})," When using grammar constraints, set ",e.jsx("code",{children:"enable_thinking: false"})," because the grammar applies from the first output token."]}),e.jsx("h3",{id:"96-logprobs-token-probabilities",children:"9.6 Logprobs (Token Probabilities)"}),e.jsx("p",{children:"Request log probabilities for generated tokens to understand model confidence or implement custom sampling strategies."}),e.jsx("p",{children:e.jsx("strong",{children:"Request Parameters:"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Parameter"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"logprobs"})}),e.jsx("td",{children:"bool"}),e.jsx("td",{children:"false"}),e.jsx("td",{children:"Return log probability for each token"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"top_logprobs"})}),e.jsx("td",{children:"int"}),e.jsx("td",{children:"0"}),e.jsx("td",{children:"Number of top alternatives (0-5)"})]})]})]}),e.jsxs("p",{children:["Setting ",e.jsx("code",{children:"top_logprobs > 0"})," implicitly enables ",e.jsx("code",{children:"logprobs"}),"."]}),e.jsx("p",{children:e.jsx("strong",{children:"Request:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`curl http://localhost:8080/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "Qwen3-8B-Q8_0",
    "messages": [
      {"role": "user", "content": "What is 2+2?"}
    ],
    "logprobs": true,
    "top_logprobs": 3,
    "max_tokens": 10
  }'`})}),e.jsx("p",{children:e.jsx("strong",{children:"Response with Logprobs:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "id": "chatcmpl-xxx",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "4"
      },
      "logprobs": {
        "content": [
          {
            "token": "4",
            "logprob": -0.0012,
            "bytes": [52],
            "top_logprobs": [
              { "token": "4", "logprob": -0.0012, "bytes": [52] },
              { "token": "The", "logprob": -6.82, "bytes": [84, 104, 101] },
              {
                "token": "Four",
                "logprob": -7.15,
                "bytes": [70, 111, 117, 114]
              }
            ]
          }
        ]
      },
      "finish_reason": "stop"
    }
  ]
}`})}),e.jsx("p",{children:e.jsx("strong",{children:"Response Structure:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"logprobs.content[]"})," - Array of per-token probability data"]}),e.jsxs("li",{children:[e.jsx("code",{children:"token"})," - The generated token string"]}),e.jsxs("li",{children:[e.jsx("code",{children:"logprob"})," - Log probability (always  0; closer to 0 = higher confidence)"]}),e.jsxs("li",{children:[e.jsx("code",{children:"bytes"})," - UTF-8 byte representation of the token"]}),e.jsxs("li",{children:[e.jsx("code",{children:"top_logprobs[]"})," - Alternative tokens with their probabilities"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Streaming Behavior:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Streaming"}),": Logprobs sent in each delta chunk"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Non-streaming"}),": All logprobs in final response"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Use Cases:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Confidence scoring for model outputs"}),e.jsx("li",{children:"Detecting hallucinations (low probability sequences)"}),e.jsx("li",{children:"Custom rejection sampling"}),e.jsx("li",{children:"Token-level analysis for debugging"})]}),e.jsx("h3",{id:"97-parameter-reference",children:"9.7 Parameter Reference"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Parameter"}),e.jsx("th",{children:"JSON Key"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Default"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Temperature"}),e.jsx("td",{children:e.jsx("code",{children:"temperature"})}),e.jsx("td",{children:"float32"}),e.jsx("td",{children:"0.8"}),e.jsx("td",{children:"Controls randomness of output"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Top-K"}),e.jsx("td",{children:e.jsx("code",{children:"top_k"})}),e.jsx("td",{children:"int32"}),e.jsx("td",{children:"40"}),e.jsx("td",{children:"Limits token pool to K most probable"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Top-P"}),e.jsx("td",{children:e.jsx("code",{children:"top_p"})}),e.jsx("td",{children:"float32"}),e.jsx("td",{children:"0.9"}),e.jsx("td",{children:"Nucleus sampling threshold"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Min-P"}),e.jsx("td",{children:e.jsx("code",{children:"min_p"})}),e.jsx("td",{children:"float32"}),e.jsx("td",{children:"0.0"}),e.jsx("td",{children:"Dynamic sampling threshold"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Max Tokens"}),e.jsx("td",{children:e.jsx("code",{children:"max_tokens"})}),e.jsx("td",{children:"int"}),e.jsx("td",{children:"4096"}),e.jsx("td",{children:"Maximum tokens to generate"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Repeat Penalty"}),e.jsx("td",{children:e.jsx("code",{children:"repeat_penalty"})}),e.jsx("td",{children:"float32"}),e.jsx("td",{children:"1.0"}),e.jsx("td",{children:"Penalty for repeated tokens"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Repeat Last N"}),e.jsx("td",{children:e.jsx("code",{children:"repeat_last_n"})}),e.jsx("td",{children:"int32"}),e.jsx("td",{children:"64"}),e.jsx("td",{children:"Window for repetition check"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"DRY Multiplier"}),e.jsx("td",{children:e.jsx("code",{children:"dry_multiplier"})}),e.jsx("td",{children:"float32"}),e.jsx("td",{children:"1.05"}),e.jsx("td",{children:"N-gram repetition penalty"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"DRY Base"}),e.jsx("td",{children:e.jsx("code",{children:"dry_base"})}),e.jsx("td",{children:"float32"}),e.jsx("td",{children:"1.75"}),e.jsx("td",{children:"Exponential penalty base"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"DRY Allowed Length"}),e.jsx("td",{children:e.jsx("code",{children:"dry_allowed_length"})}),e.jsx("td",{children:"int32"}),e.jsx("td",{children:"2"}),e.jsx("td",{children:"Min n-gram length for DRY"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"DRY Penalty Last N"}),e.jsx("td",{children:e.jsx("code",{children:"dry_penalty_last_n"})}),e.jsx("td",{children:"int32"}),e.jsx("td",{children:"0"}),e.jsx("td",{children:"Recent tokens for DRY (0=all)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"XTC Probability"}),e.jsx("td",{children:e.jsx("code",{children:"xtc_probability"})}),e.jsx("td",{children:"float32"}),e.jsx("td",{children:"0.0"}),e.jsx("td",{children:"XTC activation probability"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"XTC Threshold"}),e.jsx("td",{children:e.jsx("code",{children:"xtc_threshold"})}),e.jsx("td",{children:"float32"}),e.jsx("td",{children:"0.1"}),e.jsx("td",{children:"XTC probability threshold"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"XTC Min Keep"}),e.jsx("td",{children:e.jsx("code",{children:"xtc_min_keep"})}),e.jsx("td",{children:"uint32"}),e.jsx("td",{children:"1"}),e.jsx("td",{children:"Min tokens after XTC"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Adaptive-P Target"}),e.jsx("td",{children:e.jsx("code",{children:"adaptive_p_target"})}),e.jsx("td",{children:"float32"}),e.jsx("td",{children:"0.0"}),e.jsx("td",{children:"Adaptive sampling target"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Adaptive-P Decay"}),e.jsx("td",{children:e.jsx("code",{children:"adaptive_p_decay"})}),e.jsx("td",{children:"float32"}),e.jsx("td",{children:"0.0"}),e.jsx("td",{children:"Adaptive adjustment speed"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Enable Thinking"}),e.jsx("td",{children:e.jsx("code",{children:"enable_thinking"})}),e.jsx("td",{children:"string"}),e.jsx("td",{children:'"true"'}),e.jsx("td",{children:"Enable model thinking"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Reasoning Effort"}),e.jsx("td",{children:e.jsx("code",{children:"reasoning_effort"})}),e.jsx("td",{children:"string"}),e.jsx("td",{children:'"medium"'}),e.jsx("td",{children:"GPT reasoning level"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Grammar"}),e.jsx("td",{children:e.jsx("code",{children:"grammar"})}),e.jsx("td",{children:"string"}),e.jsx("td",{children:'""'}),e.jsx("td",{children:"GBNF grammar constraint"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Logprobs"}),e.jsx("td",{children:e.jsx("code",{children:"logprobs"})}),e.jsx("td",{children:"bool"}),e.jsx("td",{children:"false"}),e.jsx("td",{children:"Return token probabilities"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Top Logprobs"}),e.jsx("td",{children:e.jsx("code",{children:"top_logprobs"})}),e.jsx("td",{children:"int"}),e.jsx("td",{children:"0"}),e.jsx("td",{children:"Number of top alternatives"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Stream"}),e.jsx("td",{children:e.jsx("code",{children:"stream"})}),e.jsx("td",{children:"bool"}),e.jsx("td",{children:"false"}),e.jsx("td",{children:"Stream response"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Include Usage"}),e.jsx("td",{children:e.jsx("code",{children:"include_usage"})}),e.jsx("td",{children:"bool"}),e.jsx("td",{children:"true"}),e.jsx("td",{children:"Include usage in streaming"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Return Prompt"}),e.jsx("td",{children:e.jsx("code",{children:"return_prompt"})}),e.jsx("td",{children:"bool"}),e.jsx("td",{children:"false"}),e.jsx("td",{children:"Include prompt in response"})]})]})]}),e.jsx("hr",{}),e.jsx("h2",{id:"chapter-10-multi-modal-models",children:"Chapter 10: Multi-Modal Models"}),e.jsx("p",{children:"Kronk supports vision and audio models that can process images, video frames, and audio alongside text. This chapter covers how to use these models."}),e.jsx("h3",{id:"101-overview",children:"10.1 Overview"}),e.jsx("p",{children:"Multi-modal models combine a language model with a media projector that converts images or audio into tokens the model can understand."}),e.jsx("p",{children:e.jsx("strong",{children:"Supported Media Types:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Vision"}),": JPEG, PNG, GIF images"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Audio"}),": WAV audio files"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Available Models (from catalog):"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`kronk catalog list --filter-category=Image
kronk catalog list --filter-category=Audio`})}),e.jsx("p",{children:"Example models:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"Qwen2.5-VL-3B-Instruct-Q8_0"})," - Vision model"]}),e.jsxs("li",{children:[e.jsx("code",{children:"gemma-3-4b-it-q4_0"})," - Vision model"]}),e.jsxs("li",{children:[e.jsx("code",{children:"Qwen2-Audio-7B.Q8_0"})," - Audio model"]})]}),e.jsx("h3",{id:"102-vision-models",children:"10.2 Vision Models"}),e.jsx("p",{children:"Vision models analyze images and answer questions about their content."}),e.jsx("p",{children:e.jsx("strong",{children:"Download a Vision Model:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk catalog pull Qwen2.5-VL-3B-Instruct-Q8_0"})}),e.jsx("p",{children:e.jsx("strong",{children:"API Request with Image (OpenAI Format):"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`curl http://localhost:8080/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "Qwen2.5-VL-3B-Instruct-Q8_0",
    "messages": [
      {
        "role": "user",
        "content": [
          {
            "type": "text",
            "text": "What do you see in this image?"
          },
          {
            "type": "image_url",
            "image_url": {
              "url": "data:image/jpeg;base64,/9j/4AAQSkZJRg..."
            }
          }
        ]
      }
    ]
  }'`})}),e.jsx("p",{children:e.jsx("strong",{children:"Content Array Structure:"})}),e.jsxs("p",{children:["The ",e.jsx("code",{children:"content"})," field is an array of content parts:"]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "content": [
    { "type": "text", "text": "Describe this image" },
    {
      "type": "image_url",
      "image_url": { "url": "data:image/jpeg;base64,..." }
    }
  ]
}`})}),e.jsx("p",{children:e.jsx("strong",{children:"Supported image_url Formats:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Base64 data URL: ",e.jsx("code",{children:"data:image/jpeg;base64,/9j/4AAQSkZJRg..."})]}),e.jsxs("li",{children:["Base64 data URL: ",e.jsx("code",{children:"data:image/png;base64,iVBORw0KGgo..."})]})]}),e.jsx("h3",{id:"103-audio-models",children:"10.3 Audio Models"}),e.jsx("p",{children:"Audio models transcribe and understand spoken content."}),e.jsx("p",{children:e.jsx("strong",{children:"Download an Audio Model:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk catalog pull Qwen2-Audio-7B.Q8_0"})}),e.jsx("p",{children:e.jsx("strong",{children:"API Request with Audio:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`curl http://localhost:8080/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "Qwen2-Audio-7B.Q8_0",
    "messages": [
      {
        "role": "user",
        "content": [
          {
            "type": "text",
            "text": "Transcribe this audio and summarize what is said."
          },
          {
            "type": "input_audio",
            "input_audio": {
              "data": "UklGRi...",
              "format": "wav"
            }
          }
        ]
      }
    ]
  }'`})}),e.jsx("p",{children:e.jsx("strong",{children:"Audio Format:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"data"})," - Base64-encoded audio data"]}),e.jsxs("li",{children:[e.jsx("code",{children:"format"})," - Audio format (currently ",e.jsx("code",{children:"wav"})," supported)"]})]}),e.jsx("h3",{id:"104-plain-base64-format",children:"10.4 Plain Base64 Format"}),e.jsx("p",{children:"For simpler integrations, Kronk also accepts plain base64 as the message content (without the structured OpenAI format):"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "model": "Qwen2.5-VL-3B-Instruct-Q8_0",
  "messages": [
    {
      "role": "user",
      "content": "/9j/4AAQSkZJRgABAQEASABIAAD..."
    }
  ]
}`})}),e.jsx("p",{children:"Kronk auto-detects the media type from the binary header:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:["JPEG: starts with ",e.jsx("code",{children:"FF D8 FF"})]}),e.jsxs("li",{children:["PNG: starts with ",e.jsx("code",{children:"89 50 4E 47"})]}),e.jsxs("li",{children:["WAV: starts with ",e.jsx("code",{children:"RIFF"})]})]}),e.jsx("h3",{id:"105-configuration-for-multi-modal-models",children:"10.5 Configuration for Multi-Modal Models"}),e.jsx("p",{children:"Vision and audio models have specific configuration requirements:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  Qwen2.5-VL-3B-Instruct-Q8_0:
    n_ubatch: 2048 # Higher for image token processing
    n_seq_max: 2 # Process up to 2 requests concurrently
    context_window: 8192`})}),e.jsx("p",{children:e.jsx("strong",{children:"Key Considerations:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"n_ubatch"})," should be high (2048) for efficient image/audio token processing"]}),e.jsxs("li",{children:[e.jsx("code",{children:"n_seq_max"})," controls batch parallelism (multiple slots in shared context)"]}),e.jsx("li",{children:"Vision/audio models use the same batch engine as text models"})]}),e.jsx("h3",{id:"106-memory-requirements",children:"10.6 Memory Requirements"}),e.jsx("p",{children:"Vision and audio models require additional memory for the projector:"}),e.jsx("p",{children:e.jsx("strong",{children:"Vision Model Example (Qwen2.5-VL-3B):"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Model weights:     ~3.5 GB
Projector:         ~0.5 GB
KV cache (8K):     ~0.4 GB

Total:             ~4.4 GB`})}),e.jsx("p",{children:e.jsx("strong",{children:"Audio Model Example (Qwen2-Audio-7B):"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Model weights:     ~8 GB
Projector:         ~0.8 GB
KV cache (8K):     ~0.6 GB

Total:             ~9.4 GB`})}),e.jsx("h3",{id:"107-limitations",children:"10.7 Limitations"}),e.jsxs("ul",{children:[e.jsx("li",{children:"SPC is not supported for vision/audio requests"}),e.jsx("li",{children:"IMC fully caches media (images/audio) in the KV cache; text-only follow-ups"})]}),e.jsxs("p",{children:["extend the cache without re-encoding media (see ",e.jsx("a",{href:"#58-performance-and-limitations",children:"5.8"}),")"]}),e.jsx("ul",{children:e.jsx("li",{children:"Processing time varies with image resolution and audio duration"})}),e.jsx("h3",{id:"108-example-image-analysis",children:"10.8 Example: Image Analysis"}),e.jsx("p",{children:"Complete example analyzing an image:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`# Encode image to base64
IMAGE_B64=$(base64 -i photo.jpg)

# Send request
curl http://localhost:8080/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "Qwen2.5-VL-3B-Instruct-Q8_0",
    "messages": [
      {
        "role": "user",
        "content": [
          {"type": "text", "text": "Describe this image in detail."},
          {
            "type": "image_url",
            "image_url": {"url": "data:image/jpeg;base64,\${IMAGE_B64}"}
          }
        ]
      }
    ],
    "max_tokens": 1024
  }'`})}),e.jsx("h3",{id:"109-example-audio-transcription",children:"10.9 Example: Audio Transcription"}),e.jsx("p",{children:"Complete example transcribing audio:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`# Encode audio to base64
AUDIO_B64=$(base64 -i recording.wav)

# Send request
curl http://localhost:8080/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "Qwen2-Audio-7B.Q8_0",
    "messages": [
      {
        "role": "user",
        "content": [
          {"type": "text", "text": "Transcribe this audio."},
          {
            "type": "input_audio",
            "input_audio": {"data": "\${AUDIO_B64}", "format": "wav"}
          }
        ]
      }
    ],
    "max_tokens": 2048
  }'`})}),e.jsx("hr",{}),e.jsx("p",{children:e.jsx("em",{children:'Next: <a href="#chapter-11-security--authentication">Chapter 11: Security & Authentication</a>'})}),e.jsx("h2",{id:"chapter-11-security-authentication",children:"Chapter 11: Security & Authentication"}),e.jsx("p",{children:"Kronk provides JWT-based authentication and authorization with per-endpoint rate limiting. When enabled, all API requests require a valid token."}),e.jsx("h3",{id:"111-enabling-authentication",children:"11.1 Enabling Authentication"}),e.jsx("p",{children:e.jsx("strong",{children:"Start Server with Auth Enabled:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk server start --auth-enabled"})}),e.jsx("p",{children:"Or via environment variable:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`export KRONK_AUTH_ENABLED=true
kronk server start`})}),e.jsx("p",{children:e.jsx("strong",{children:"First-Time Setup:"})}),e.jsx("p",{children:"On first startup with authentication enabled, Kronk automatically:"}),e.jsxs("ol",{children:[e.jsxs("li",{children:["Creates a ",e.jsx("code",{children:"keys/"})," directory in ",e.jsx("code",{children:"~/.kronk/"})]}),e.jsxs("li",{children:["Generates a master private key (",e.jsx("code",{children:"master.pem"}),")"]}),e.jsxs("li",{children:["Creates an admin token (",e.jsx("code",{children:"master.jwt"}),") valid for 10 years"]}),e.jsx("li",{children:"Generates an additional signing key for user tokens"})]}),e.jsxs("p",{children:["The admin token is stored at ",e.jsx("code",{children:"~/.kronk/keys/master.jwt"}),"."]}),e.jsx("h3",{id:"112-using-the-admin-token",children:"11.2 Using the Admin Token"}),e.jsx("p",{children:"The admin token is required for all security management operations."}),e.jsx("p",{children:e.jsx("strong",{children:"Set the Token:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"export KRONK_TOKEN=$(cat ~/.kronk/keys/master.jwt)"})}),e.jsx("p",{children:e.jsx("strong",{children:"Admin Capabilities:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Create new tokens for users"}),e.jsx("li",{children:"Add and remove signing keys"}),e.jsx("li",{children:"Access all endpoints without rate limits"})]}),e.jsx("h3",{id:"113-key-management",children:"11.3 Key Management"}),e.jsx("p",{children:"Private keys sign JWT tokens. Multiple keys allow token rotation without invalidating all existing tokens."}),e.jsx("p",{children:e.jsx("strong",{children:"List Keys:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk security key list"})}),e.jsx("p",{children:"Output:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`KEY ID                                  CREATED
master                                  2024-01-15T10:30:00Z
a1b2c3d4-e5f6-7890-abcd-ef1234567890    2024-01-15T10:30:00Z`})}),e.jsx("p",{children:e.jsx("strong",{children:"Create a New Key:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk security key create"})}),e.jsx("p",{children:"This generates a new UUID-named key for signing tokens."}),e.jsx("p",{children:e.jsx("strong",{children:"Delete a Key:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk security key delete --keyid a1b2c3d4-e5f6-7890-abcd-ef1234567890"})}),e.jsxs("p",{children:[e.jsx("strong",{children:"Important:"})," The master key cannot be deleted. Deleting a key invalidates all tokens signed with that key."]}),e.jsx("p",{children:e.jsx("strong",{children:"Local Mode:"})}),e.jsxs("p",{children:["All key commands support ",e.jsx("code",{children:"--local"})," to operate without a running server:"]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`kronk security key list --local
kronk security key create --local
kronk security key delete --keyid <keyid> --local`})}),e.jsx("h3",{id:"114-creating-user-tokens",children:"11.4 Creating User Tokens"}),e.jsx("p",{children:"Create tokens with specific endpoint access and optional rate limits."}),e.jsx("p",{children:e.jsx("strong",{children:"Basic Syntax:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`kronk security token create \\
  --duration <duration> \\
  --endpoints <endpoint-list>`})}),e.jsx("p",{children:e.jsx("strong",{children:"Parameters:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"--duration"})," - Token lifetime (e.g., ",e.jsx("code",{children:"1h"}),", ",e.jsx("code",{children:"24h"}),", ",e.jsx("code",{children:"720h"}),", ",e.jsx("code",{children:"8760h"}),")"]}),e.jsxs("li",{children:[e.jsx("code",{children:"--endpoints"})," - Comma-separated list of endpoints with optional limits"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Endpoint Format:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"endpoint"})," - Unlimited access (default)"]}),e.jsxs("li",{children:[e.jsx("code",{children:"endpoint:unlimited"})," - Unlimited access (explicit)"]}),e.jsxs("li",{children:[e.jsx("code",{children:"endpoint:limit/window"})," - Rate limited"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Rate Limit Windows:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"day"})," - Resets daily"]}),e.jsxs("li",{children:[e.jsx("code",{children:"month"})," - Resets monthly"]}),e.jsxs("li",{children:[e.jsx("code",{children:"year"})," - Resets yearly"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Available Endpoints:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"chat-completions"})," - Chat completions API"]}),e.jsxs("li",{children:[e.jsx("code",{children:"responses"})," - Responses API"]}),e.jsxs("li",{children:[e.jsx("code",{children:"embeddings"})," - Embeddings API"]}),e.jsxs("li",{children:[e.jsx("code",{children:"rerank"})," - Reranking API"]}),e.jsxs("li",{children:[e.jsx("code",{children:"messages"})," - Anthropic Messages API"]})]}),e.jsx("h3",{id:"115-token-examples",children:"11.5 Token Examples"}),e.jsx("p",{children:e.jsx("strong",{children:"Unlimited Access to All Endpoints (24 hours):"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`kronk security token create \\
  --duration 24h \\
  --endpoints chat-completions,embeddings,rerank,responses,messages`})}),e.jsx("p",{children:e.jsx("strong",{children:"Rate-Limited Chat Token (30 days):"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`kronk security token create \\
  --duration 720h \\
  --endpoints "chat-completions:1000/day,embeddings:500/day"`})}),e.jsx("p",{children:e.jsx("strong",{children:"Monthly Quota Token:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`kronk security token create \\
  --duration 8760h \\
  --endpoints "chat-completions:10000/month,embeddings:50000/month"`})}),e.jsx("p",{children:e.jsx("strong",{children:"Mixed Limits:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`kronk security token create \\
  --duration 720h \\
  --endpoints "chat-completions:100/day,embeddings:unlimited"`})}),e.jsx("p",{children:e.jsx("strong",{children:"Output:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Token create
  Duration: 720h0m0s
  Endpoints: map[chat-completions:{1000 day} embeddings:{0 unlimited}]
TOKEN:
eyJhbGciOiJSUzI1NiIsImtpZCI6ImExYjJjM2Q0Li4uIiwidHlwIjoiSldUIn0...`})}),e.jsx("h3",{id:"116-using-tokens-in-api-requests",children:"11.6 Using Tokens in API Requests"}),e.jsxs("p",{children:["Pass the token in the ",e.jsx("code",{children:"Authorization"})," header with the ",e.jsx("code",{children:"Bearer"})," prefix."]}),e.jsx("p",{children:e.jsx("strong",{children:"curl Example:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`curl http://localhost:8080/v1/chat/completions \\
  -H "Authorization: Bearer eyJhbGciOiJS..." \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "Qwen3-8B-Q8_0",
    "messages": [{"role": "user", "content": "Hello"}]
  }'`})}),e.jsx("p",{children:e.jsx("strong",{children:"Environment Variable Pattern:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`export KRONK_TOKEN="eyJhbGciOiJS..."

curl http://localhost:8080/v1/chat/completions \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{...}'`})}),e.jsx("p",{children:e.jsx("strong",{children:"Python Example:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-python",children:`import openai

client = openai.OpenAI(
    base_url="http://localhost:8080/v1",
    api_key="eyJhbGciOiJS..."  # Your Kronk token
)

response = client.chat.completions.create(
    model="Qwen3-8B-Q8_0",
    messages=[{"role": "user", "content": "Hello"}]
)`})}),e.jsx("h3",{id:"117-authorization-flow",children:"11.7 Authorization Flow"}),e.jsx("p",{children:"When a request arrives:"}),e.jsxs("ol",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Token Extraction"})," - Bearer token parsed from Authorization header"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Signature Verification"})," - Token signature verified against known keys"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Expiration Check"})," - Token must not be expired"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Endpoint Authorization"})," - Token must include the requested endpoint"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Rate Limit Check"})," - Request counted against endpoint quota"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Request Processing"})," - If all checks pass, request proceeds"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Error Responses:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"401 Unauthorized"})," - Missing, invalid, or expired token"]}),e.jsxs("li",{children:[e.jsx("code",{children:"403 Forbidden"})," - Token lacks access to the endpoint"]}),e.jsxs("li",{children:[e.jsx("code",{children:"429 Too Many Requests"})," - Rate limit exceeded"]})]}),e.jsx("h3",{id:"118-rate-limiting",children:"11.8 Rate Limiting"}),e.jsx("p",{children:"Rate limits are enforced per token (identified by the token's subject claim)."}),e.jsx("p",{children:e.jsx("strong",{children:"How Limits Work:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Each token has a unique subject (UUID)"}),e.jsx("li",{children:"Requests are counted per endpoint per subject"}),e.jsx("li",{children:"Counters reset at window boundaries (day/month/year)"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Limit Storage:"})}),e.jsxs("p",{children:["Rate limit counters are stored in a BadgerDB database at ",e.jsx("code",{children:"~/.kronk/badger/"}),". Counters persist across server restarts."]}),e.jsx("p",{children:e.jsx("strong",{children:"Bypassing Rate Limits:"})}),e.jsxs("p",{children:["Admin tokens (like ",e.jsx("code",{children:"master.jwt"}),") bypass all rate limiting."]}),e.jsx("h3",{id:"119-configuration-reference",children:"11.9 Configuration Reference"}),e.jsx("p",{children:e.jsx("strong",{children:"Server Flags:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"--auth-enabled"})," - Enable authentication (env: ",e.jsx("code",{children:"KRONK_AUTH_ENABLED"}),")"]}),e.jsxs("li",{children:[e.jsx("code",{children:"--auth-issuer"})," - JWT issuer name (env: ",e.jsx("code",{children:"KRONK_AUTH_ISSUER"}),")"]}),e.jsxs("li",{children:[e.jsx("code",{children:"--auth-host"})," - External auth service host (env: ",e.jsx("code",{children:"KRONK_AUTH_HOST"}),")"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Environment Variables:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"KRONK_TOKEN"})," - Token for CLI commands and API requests"]}),e.jsxs("li",{children:[e.jsx("code",{children:"KRONK_WEB_API_HOST"})," - Server address for CLI web mode"]})]}),e.jsxs("p",{children:["(default: ",e.jsx("code",{children:"localhost:8080"}),")"]}),e.jsx("h3",{id:"1110-security-best-practices",children:"11.10 Security Best Practices"}),e.jsx("p",{children:e.jsx("strong",{children:"Token Management:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Store admin tokens securely; treat ",e.jsx("code",{children:"master.jwt"})," like a password"]}),e.jsx("li",{children:"Create separate tokens for different applications/users"}),e.jsx("li",{children:"Use short durations for development tokens"}),e.jsx("li",{children:"Rotate keys periodically for production deployments"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Rate Limiting:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Set appropriate limits based on expected usage"}),e.jsx("li",{children:"Use daily limits for interactive applications"}),e.jsx("li",{children:"Use monthly limits for batch processing"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Key Rotation:"})}),e.jsxs("ol",{children:[e.jsxs("li",{children:["Create a new key: ",e.jsx("code",{children:"kronk security key create"})]}),e.jsx("li",{children:"Issue new tokens using the new key"}),e.jsx("li",{children:"Wait for old tokens to expire"}),e.jsxs("li",{children:["Delete the old key: ",e.jsx("code",{children:"kronk security key delete --keyid <old-keyid>"})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Production Checklist:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Enable authentication: ",e.jsx("code",{children:"--auth-enabled"})]}),e.jsxs("li",{children:["Secure the ",e.jsx("code",{children:"~/.kronk/keys/"})," directory (mode 0700)"]}),e.jsxs("li",{children:["Back up ",e.jsx("code",{children:"master.pem"})," and ",e.jsx("code",{children:"master.jwt"})," securely"]}),e.jsx("li",{children:"Distribute user tokens, never the admin token"}),e.jsx("li",{children:"Monitor rate limit usage in logs"})]}),e.jsx("hr",{}),e.jsx("p",{children:e.jsx("em",{children:'Next: <a href="#chapter-12-browser-ui-bui">Chapter 12: Browser UI (BUI)</a>'})}),e.jsx("h2",{id:"chapter-12-browser-ui-bui",children:"Chapter 12: Browser UI (BUI)"}),e.jsx("p",{children:"Kronk includes a web-based interface for managing models, libraries, security, and server configuration without using the command line."}),e.jsx("h3",{id:"121-accessing-the-bui",children:"12.1 Accessing the BUI"}),e.jsx("p",{children:"The BUI is served from the same port as the API."}),e.jsx("p",{children:e.jsx("strong",{children:"Open in Browser:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"http://localhost:8080"})}),e.jsx("p",{children:"The BUI automatically loads when you navigate to the server root."}),e.jsx("h3",{id:"122-downloading-libraries",children:"12.2 Downloading Libraries"}),e.jsx("p",{children:"Before running inference, you need the llama.cpp libraries."}),e.jsx("p",{children:e.jsx("strong",{children:"Steps:"})}),e.jsxs("ol",{children:[e.jsxs("li",{children:["Navigate to the ",e.jsx("strong",{children:"Libraries"})," page from the menu"]}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Pull Libraries"})]}),e.jsx("li",{children:"Wait for the download to complete"})]}),e.jsxs("p",{children:["The BUI auto-detects your platform (OS, architecture, GPU) and downloads the appropriate binaries to ",e.jsx("code",{children:"~/.kronk/libraries/"}),"."]}),e.jsx("p",{children:e.jsx("strong",{children:"Override Detection:"})}),e.jsx("p",{children:"If auto-detection is incorrect, you can specify:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Processor type (CPU, CUDA, Metal, ROCm, Vulkan)"}),e.jsx("li",{children:"Architecture (amd64, arm64)"}),e.jsx("li",{children:"Operating system"})]}),e.jsx("h3",{id:"123-downloading-models",children:"12.3 Downloading Models"}),e.jsx("p",{children:e.jsx("strong",{children:"Browse the Catalog:"})}),e.jsxs("ol",{children:[e.jsxs("li",{children:["Navigate to the ",e.jsx("strong",{children:"Catalog"})," page"]}),e.jsxs("li",{children:["Browse available models by category:",e.jsxs("ul",{children:[e.jsx("li",{children:"Text-Generation"}),e.jsx("li",{children:"Image-Text-to-Text (Vision)"}),e.jsx("li",{children:"Audio-Text-to-Text"}),e.jsx("li",{children:"Embedding"}),e.jsx("li",{children:"Reranking"})]})]}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Pull"})," next to a model to download it"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Monitor Progress:"})}),e.jsx("p",{children:"The BUI shows real-time download progress including:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Download percentage"}),e.jsx("li",{children:"Transfer speed"}),e.jsx("li",{children:"Estimated time remaining"})]}),e.jsx("p",{children:e.jsx("strong",{children:"View Pulled Models:"})}),e.jsxs("p",{children:["Navigate to the ",e.jsx("strong",{children:"Models"})," page to see all downloaded models and their status."]}),e.jsx("h3",{id:"124-managing-keys-and-tokens",children:"12.4 Managing Keys and Tokens"}),e.jsx("p",{children:"When authentication is enabled, use the BUI to manage security."}),e.jsx("p",{children:e.jsx("strong",{children:"Keys Page:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"View all signing keys with their IDs and creation dates"}),e.jsx("li",{children:"Create new signing keys"}),e.jsx("li",{children:"Delete keys (except master key)"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Tokens Page:"})}),e.jsx("ul",{children:e.jsx("li",{children:"Generate new tokens with specific:"})}),e.jsx("p",{children:"- Duration (hours, days) - Endpoint access (chat-completions, embeddings, etc.) - Rate limits (requests per day/month/year)"}),e.jsx("ul",{children:e.jsx("li",{children:"Copy generated tokens to clipboard"})}),e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"})," You must provide an admin token in the BUI settings to access security management features."]}),e.jsx("h3",{id:"125-other-screens",children:"12.5 Other Screens"}),e.jsx("p",{children:e.jsx("strong",{children:"Dashboard:"})}),e.jsx("p",{children:"Overview of server status, loaded models, and system information."}),e.jsx("p",{children:e.jsx("strong",{children:"Documentation:"})}),e.jsx("p",{children:"Built-in SDK and CLI documentation accessible from the menu:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"SDK API reference"}),e.jsx("li",{children:"CLI command reference"}),e.jsx("li",{children:"Example code"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Settings:"})}),e.jsx("p",{children:"Configure BUI preferences:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"API token for authenticated requests"}),e.jsx("li",{children:"Theme preferences"})]}),e.jsx("h3",{id:"126-model-playground",children:"12.6 Model Playground"}),e.jsxs("p",{children:["The Model Playground is an interactive testing environment for evaluating models directly in the BUI. It supports two operating modes  ",e.jsx("strong",{children:"Automated"})," and ",e.jsx("strong",{children:"Manual"}),"  accessible from the sidebar."]}),e.jsx("p",{children:e.jsx("strong",{children:"Steps:"})}),e.jsxs("ol",{children:[e.jsxs("li",{children:["Navigate to the ",e.jsx("strong",{children:"Playground"})," page from the menu (or go to ",e.jsx("code",{children:"/playground"}),")"]}),e.jsxs("li",{children:["Select a model from the dropdown, or choose ",e.jsx("strong",{children:"New"})," to pull a GGUF file"]})]}),e.jsx("p",{children:"by HuggingFace URL (with optional projection URL for vision/audio models)"}),e.jsxs("ol",{children:[e.jsxs("li",{children:["Choose a ",e.jsx("strong",{children:"Template Mode"}),":",e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Builtin"}),"  select a chat template from the catalog (or leave as Auto)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Custom"}),"  paste a Jinja template script"]})]})]}),e.jsx("li",{children:"Configure model parameters: Context Window, NBatch, NUBatch, NSeqMax,"})]}),e.jsx("p",{children:"Flash Attention (auto/enabled/disabled), KV Cache Type (f16/q8_0/q4_0), and Cache Mode (None/SPC/IMC)"}),e.jsx("ol",{children:e.jsxs("li",{children:["Select ",e.jsx("strong",{children:"Automated Mode"})," or ",e.jsx("strong",{children:"Manual Mode"})]})}),e.jsx("h4",{id:"1261-automated-mode",children:"12.6.1 Automated Mode"}),e.jsx("p",{children:"Automated mode runs structured test suites against a model and scores the results. It is designed for benchmarking model quality and finding optimal configurations without manual interaction."}),e.jsx("p",{children:e.jsx("strong",{children:"Sweep Modes:"})}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Sampling Sweep"}),"  Varies sampling parameters (temperature, top_p, top_k,"]})}),e.jsx("p",{children:"min_p, and others including repetition, DRY/XTC controls, and reasoning settings) using user-defined value ranges while holding the model configuration fixed. Each parameter accepts comma-separated values; the first value is the baseline and additional values define the sweep range. When catalog defaults are available for the selected model, they are displayed next to the parameter name as a hint. Requires a loaded session."}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Config Sweep"}),"  Varies model configuration parameters (context window,"]})}),e.jsxs("p",{children:["nbatch, nubatch, nseq_max, flash attention, cache type, cache mode) as a full cross-product of user-selected values. Each candidate reloads the model with a new session, making it slower than sampling sweeps. Does ",e.jsx("strong",{children:"not"})," require a pre-loaded session."]}),e.jsxs("p",{children:[e.jsx("strong",{children:""})," Unload the current session before running config sweeps."]}),e.jsx("p",{children:e.jsx("strong",{children:"Scenarios:"})}),e.jsx("p",{children:"Two test scenarios can be enabled independently:"}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Chat Quality"}),"  Tests text generation with math problems, translations,"]})}),e.jsx("p",{children:"list formatting, and multi-turn conversations. Responses are scored using exact match (with partial credit for contained answers) and regex validation. Config sweeps additionally include code generation and instruction-following prompts for throughput measurement."}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Tool Calling"}),"  Tests function calling with 10 built-in tool definitions"]})}),e.jsxs("p",{children:["(",e.jsx("code",{children:"get_weather"}),", ",e.jsx("code",{children:"add"}),", ",e.jsx("code",{children:"search_products"}),", ",e.jsx("code",{children:"send_email"}),", ",e.jsx("code",{children:"get_stock_price"}),", ",e.jsx("code",{children:"convert_currency"}),", ",e.jsx("code",{children:"create_calendar_event"}),", ",e.jsx("code",{children:"translate_text"}),", ",e.jsx("code",{children:"get_directions"}),", ",e.jsx("code",{children:"set_reminder"}),"). Validates that the model emits tool calls with valid JSON arguments and required fields. Includes multi-turn tool calling scenarios."]}),e.jsx("p",{children:"If tool calling is enabled, automated mode probes the template for tool calling compatibility before running. If the probe fails, it falls back to chat-only tests automatically."}),e.jsx("p",{children:e.jsx("strong",{children:"Context Fill Testing:"})}),e.jsx("p",{children:"When chat scenarios are enabled, automated mode calibrates context fill prompts at 20%, 50%, and 80% of the context window. These prompts fill the conversation with background text to measure TPS degradation as the KV cache fills. The first prompt in each scenario is used as a warmup; TPS and TTFT averages exclude warmup results."}),e.jsx("p",{children:e.jsx("strong",{children:"Repeats:"})}),e.jsx("p",{children:"Each prompt can be run multiple times (configurable 120, default 3) with scores averaged for more stable results."}),e.jsx("p",{children:e.jsx("strong",{children:"Running Tests:"})}),e.jsxs("ol",{children:[e.jsxs("li",{children:["Select ",e.jsx("strong",{children:"Sampling Sweep"})," or ",e.jsx("strong",{children:"Config Sweep"})]}),e.jsx("li",{children:"Configure the sweep value ranges (sampling) or sweep value sets (config)."})]}),e.jsx("p",{children:"For sampling sweeps, enter comma-separated values for each parameter  the first value is the baseline and additional values form the sweep grid. Catalog defaults (shown as hints next to parameter names) are used as initial values when a model is selected"}),e.jsxs("ol",{children:[e.jsxs("li",{children:["Enable/disable ",e.jsx("strong",{children:"Chat Quality"})," and ",e.jsx("strong",{children:"Tool Calling"})," scenarios"]}),e.jsxs("li",{children:["Set the number of ",e.jsx("strong",{children:"Repeats Per Test Case"})]}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Run Automated Testing"})]}),e.jsxs("li",{children:["Use ",e.jsx("strong",{children:"Stop"})," to cancel a run in progress, or ",e.jsx("strong",{children:"Clear Results"})," after"]})]}),e.jsx("p",{children:"completion"}),e.jsx("p",{children:e.jsx("strong",{children:"Results:"})}),e.jsx("ul",{children:e.jsx("li",{children:"A progress bar shows trial progress with elapsed time and estimated"})}),e.jsx("p",{children:"remaining time"}),e.jsx("ul",{children:e.jsx("li",{children:"A sortable results table displays per-trial scores, TPS, TTFT, and context"})}),e.jsx("p",{children:"fill TPS at 20%/50%/80%"}),e.jsx("ul",{children:e.jsx("li",{children:"Each row is expandable to show per-scenario, per-prompt details including"})}),e.jsx("p",{children:"input, expected output, actual output, usage statistics, and scoring notes"}),e.jsx("ul",{children:e.jsxs("li",{children:["The ",e.jsx("strong",{children:"Best Configuration Found"})," section highlights the winning trial"]})}),e.jsx("p",{children:e.jsx("strong",{children:"Best Configuration Criteria:"})}),e.jsxs("p",{children:["After a run completes, adjust the weights used to rank configurations (Chat Score, Tool Score, Total Score, Avg TPS, Avg TTFT) and click ",e.jsx("strong",{children:"Reevaluate"})," to re-rank results without re-running the tests."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"})," When NSeqMax > 1 in config sweeps, prompts run concurrently to measure real parallel throughput."]}),e.jsx("h4",{id:"1262-manual-mode",children:"12.6.2 Manual Mode"}),e.jsx("p",{children:"Manual mode provides hands-on interaction with a loaded model through three tabs. A session must be created before using any tab."}),e.jsx("p",{children:e.jsx("strong",{children:"Steps:"})}),e.jsxs("ol",{children:[e.jsx("li",{children:"Configure the model parameters"}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Create Session"})," to load the model"]}),e.jsx("li",{children:"The effective configuration is displayed after creation"}),e.jsx("li",{children:"Use the tabs below for testing"}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Unload Session"})," to release the model when finished"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Basic Chat Tab:"})}),e.jsx("p",{children:"Interactive streaming chat with full control over generation parameters:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"System Prompt"}),"  Editable system message"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Generation"}),"  Temperature, Top P, Top K, Min P, Max Tokens"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Repetition Control"}),"  Repeat Penalty, Repeat Last N, Frequency Penalty,"]})]}),e.jsx("p",{children:"Presence Penalty"}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"DRY Sampler"}),"  DRY Multiplier, DRY Base, DRY Allowed Length, DRY Penalty"]})}),e.jsx("p",{children:"Last N"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"XTC Sampler"}),"  XTC Probability, XTC Threshold, XTC Min Keep"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Reasoning"}),"  Enable Thinking (on/off), Reasoning Effort"]})]}),e.jsx("p",{children:"(none/minimal/low/medium/high)"}),e.jsx("p",{children:"Messages stream in real-time with tokens-per-second displayed after each response. A warmup request runs before each message to ensure accurate TPS measurement."}),e.jsx("p",{children:e.jsx("strong",{children:"Tool Calling Test Tab:"})}),e.jsx("p",{children:"Test whether a model correctly emits tool calls:"}),e.jsxs("ol",{children:[e.jsxs("li",{children:["Edit the ",e.jsx("strong",{children:"Tool Definitions"})," JSON (pre-populated with 10 sample tools)"]}),e.jsxs("li",{children:["Enter a ",e.jsx("strong",{children:"Test Prompt"})]}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Run Test"})]}),e.jsxs("li",{children:["Results show ",e.jsx("strong",{children:"PASS"})," with the emitted tool calls (function names and"]})]}),e.jsxs("p",{children:["arguments) or ",e.jsx("strong",{children:"NO TOOL CALLS"})," with the model's text output"]}),e.jsx("p",{children:e.jsx("strong",{children:"Prompt Inspector Tab:"})}),e.jsx("p",{children:"Examine how the chat template renders messages into the prompt sent to the model:"}),e.jsxs("ol",{children:[e.jsxs("li",{children:["Enter a ",e.jsx("strong",{children:"Test Message"})]}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Render Prompt"})]}),e.jsx("li",{children:"The fully rendered prompt text (system prompt + test message) is displayed"})]}),e.jsxs("p",{children:["with a ",e.jsx("strong",{children:"Copy"})," button"]}),e.jsx("p",{children:"This is useful for debugging chat template formatting or verifying that system prompts are rendered correctly for a given template."}),e.jsx("p",{children:e.jsx("strong",{children:"Export to Catalog:"})}),e.jsxs("p",{children:["Click ",e.jsx("strong",{children:"Export to Catalog Editor"})," (in the header) to pre-fill a catalog entry with the playground's current model, template, and configuration settings."]}),e.jsx("hr",{}),e.jsx("p",{children:e.jsx("em",{children:'Next: <a href="#chapter-13-client-integration">Chapter 13: Client Integration</a>'})}),e.jsx("h2",{id:"chapter-13-client-integration",children:"Chapter 13: Client Integration"}),e.jsx("p",{children:"Kronk's OpenAI-compatible API works with popular AI clients and tools."}),e.jsx("h3",{id:"131-openwebui",children:"13.1 OpenWebUI"}),e.jsx("p",{children:"OpenWebUI is a self-hosted chat interface that works with Kronk."}),e.jsx("p",{children:e.jsx("strong",{children:"Configure OpenWebUI:"})}),e.jsxs("ol",{children:[e.jsx("li",{children:"Open OpenWebUI settings"}),e.jsx("li",{children:"Navigate to Connections  OpenAI API"}),e.jsx("li",{children:"Set the base URL:"})]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"http://localhost:8080/v1"})}),e.jsxs("ol",{children:[e.jsx("li",{children:"Set API key to your Kronk token (or any value (123) if auth is disabled)"}),e.jsx("li",{children:"Save and refresh models"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Features that work:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Chat completions with streaming"}),e.jsx("li",{children:"Model selection from available models"}),e.jsx("li",{children:"System prompts"}),e.jsx("li",{children:"Conversation history"})]}),e.jsx("h3",{id:"132-cline",children:"13.2 Cline"}),e.jsx("p",{children:"Cline is a VS Code extension for AI-assisted coding."}),e.jsx("p",{children:e.jsx("strong",{children:"Configure Cline for Kronk:"})}),e.jsxs("ol",{children:[e.jsx("li",{children:"Open VS Code settings"}),e.jsx("li",{children:'Search for "Cline"'}),e.jsx("li",{children:'Set API Provider to "OpenAI Compatible"'}),e.jsx("li",{children:"Configure:"})]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Base URL: http://localhost:8080/v1
API Key: <your-kronk-token> or 123 for anything
Model: Qwen_Qwen3.5-35B-A3B-Q8_0/IMC`})}),e.jsx("p",{children:e.jsx("strong",{children:"Recommended Model Settings:"})}),e.jsx("p",{children:"For coding tasks, configure your model with:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
    Qwen_Qwen3.5-35B-A3B-Q8_0:
    &base_Qwen_Qwen3.5-35B-A3B-Q8_0
    context-window: 131072
    nbatch: 2048
    nubatch: 512
    cache-type-k: q8_0
    cache-type-v: q8_0
    flash-attention: enabled
    nseq-max: 2
    insecure-logging: true
    sampling-parameters:
        temperature: 0.7
        top_p: 0.8
        top_k: 20

    Qwen_Qwen3.5-35B-A3B-Q8_0/IMC:
    <<: *base_Qwen_Qwen3.5-35B-A3B-Q8_0
    nseq-max: 1
    incremental-cache: true`})}),e.jsx("p",{children:"IMC is especially beneficial for Cline's iterative coding workflow."}),e.jsx("p",{children:e.jsx("em",{children:"Note: Don't use R1 Message formats when using KMS."})}),e.jsx("h3",{id:"134-python-openai-sdk",children:"13.4 Python OpenAI SDK"}),e.jsx("p",{children:"Use the official OpenAI Python library with Kronk."}),e.jsx("p",{children:e.jsx("strong",{children:"Installation:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"pip install openai"})}),e.jsx("p",{children:e.jsx("strong",{children:"Usage:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-python",children:`from openai import OpenAI

client = OpenAI(
    base_url="http://localhost:8080/v1",
    api_key="your-kronk-token"  # Or any string if auth disabled
)

response = client.chat.completions.create(
    model="Qwen_Qwen3.5-35B-A3B-Q8_0/IMC",
    messages=[
        {"role": "system", "content": "You are a helpful assistant."},
        {"role": "user", "content": "Hello!"}
    ],
    stream=True
)

for chunk in response:
    if chunk.choices[0].delta.content:
        print(chunk.choices[0].delta.content, end="")`})}),e.jsx("h3",{id:"135-curl-and-http-clients",children:"13.5 curl and HTTP Clients"}),e.jsx("p",{children:"Any HTTP client can call Kronk's REST API directly."}),e.jsx("p",{children:e.jsx("strong",{children:"Basic Request:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`curl http://localhost:8080/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -H "Authorization: Bearer $KRONK_TOKEN" \\
  -d '{
    "model": "Qwen_Qwen3.5-35B-A3B-Q8_0",
    "messages": [{"role": "user", "content": "Hello"}],
    "stream": true
  }'`})}),e.jsx("p",{children:e.jsx("strong",{children:"Streaming Response:"})}),e.jsx("p",{children:"Streaming responses use Server-Sent Events (SSE) format:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`data: {"id":"...","choices":[{"delta":{"content":"Hello"}}],...}

data: {"id":"...","choices":[{"delta":{"content":"!"}}],...}

data: [DONE]`})}),e.jsx("h3",{id:"136-langchain",children:"13.6 LangChain"}),e.jsx("p",{children:"Use LangChain with Kronk via the OpenAI integration."}),e.jsx("p",{children:e.jsx("strong",{children:"Installation:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"pip install langchain-openai"})}),e.jsx("p",{children:e.jsx("strong",{children:"Usage:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-python",children:`from langchain_openai import ChatOpenAI

llm = ChatOpenAI(
    base_url="http://localhost:8080/v1",
    api_key="your-kronk-token",
    model="Qwen_Qwen3.5-35B-A3B-Q8_0",
    streaming=True
)

response = llm.invoke("Explain quantum computing briefly.")
print(response.content)`})}),e.jsx("hr",{}),e.jsx("p",{children:e.jsx("em",{children:'Next: <a href="#chapter-14-observability">Chapter 14: Observability</a>'})}),e.jsx("h2",{id:"chapter-14-observability",children:"Chapter 14: Observability"}),e.jsx("p",{children:"Kronk provides comprehensive observability through distributed tracing, Prometheus metrics, pprof profiling, and real-time visualizations."}),e.jsx("h3",{id:"141-debug-server",children:"14.1 Debug Server"}),e.jsx("p",{children:"Kronk runs a separate debug server for observability endpoints, isolated from the main API for security."}),e.jsx("p",{children:e.jsx("strong",{children:"Default Ports:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Main API: ",e.jsx("code",{children:"localhost:8080"})]}),e.jsxs("li",{children:["Debug server: ",e.jsx("code",{children:"localhost:8090"})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Configure Debug Host:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk server start --debug-host localhost:9090"})}),e.jsx("p",{children:"Or via environment variable:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`export KRONK_DEBUG_HOST=localhost:9090
kronk server start`})}),e.jsx("h3",{id:"142-debug-endpoints",children:"14.2 Debug Endpoints"}),e.jsx("p",{children:"The debug server exposes these endpoints:"}),e.jsx("p",{children:e.jsx("strong",{children:"Prometheus Metrics:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"http://localhost:8090/metrics"})}),e.jsx("p",{children:e.jsx("strong",{children:"pprof Profiling:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"http://localhost:8090/debug/pprof/"})," - Index page"]}),e.jsxs("li",{children:[e.jsx("code",{children:"http://localhost:8090/debug/pprof/profile"})," - CPU profile"]}),e.jsxs("li",{children:[e.jsx("code",{children:"http://localhost:8090/debug/pprof/heap"})," - Heap profile"]}),e.jsxs("li",{children:[e.jsx("code",{children:"http://localhost:8090/debug/pprof/goroutine"})," - Goroutine stacks"]}),e.jsxs("li",{children:[e.jsx("code",{children:"http://localhost:8090/debug/pprof/trace"})," - Execution trace"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Statsviz (Real-time Visualizations):"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"http://localhost:8090/debug/statsviz"})}),e.jsx("p",{children:"Provides live charts for memory, goroutines, GC, and more."}),e.jsx("h3",{id:"143-health-check-endpoints",children:"14.3 Health Check Endpoints"}),e.jsx("p",{children:"Available on the main API port (no authentication required):"}),e.jsx("p",{children:e.jsx("strong",{children:"Liveness Check:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"curl http://localhost:8080/v1/liveness"})}),e.jsx("p",{children:"Response:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "status": "up",
  "build": "v1.0.0",
  "host": "hostname",
  "GOMAXPROCS": 8
}`})}),e.jsx("p",{children:e.jsx("strong",{children:"Readiness Check:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"curl http://localhost:8080/v1/readiness"})}),e.jsx("p",{children:"Returns 200 OK when the server is ready to accept requests."}),e.jsx("h3",{id:"144-prometheus-metrics",children:"14.4 Prometheus Metrics"}),e.jsx("p",{children:"Kronk exposes detailed inference metrics in Prometheus format."}),e.jsx("p",{children:e.jsx("strong",{children:"Fetch Metrics:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"curl http://localhost:8090/metrics"})}),e.jsx("p",{children:e.jsx("strong",{children:"Available Metrics:"})}),e.jsx("p",{children:"System metrics:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"goroutines"})," - Current goroutine count"]}),e.jsxs("li",{children:[e.jsx("code",{children:"requests"})," - Total request count"]}),e.jsxs("li",{children:[e.jsx("code",{children:"errors"})," - Total error count"]}),e.jsxs("li",{children:[e.jsx("code",{children:"panics"})," - Total panic count"]})]}),e.jsx("p",{children:"Model loading (in seconds):"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"model_load_avg"}),", ",e.jsx("code",{children:"model_load_min"}),", ",e.jsx("code",{children:"model_load_max"})]}),e.jsxs("li",{children:[e.jsx("code",{children:"model_load_proj_avg"}),", ",e.jsx("code",{children:"model_load_proj_min"}),", ",e.jsx("code",{children:"model_load_proj_max"})]})]}),e.jsx("p",{children:"Inference timing (in seconds):"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"model_prompt_creation_avg"}),", ",e.jsx("code",{children:"_min"}),", ",e.jsx("code",{children:"_max"})]}),e.jsxs("li",{children:[e.jsx("code",{children:"model_prefill_avg"}),", ",e.jsx("code",{children:"_min"}),", ",e.jsx("code",{children:"_max"})]}),e.jsxs("li",{children:[e.jsx("code",{children:"model_ttft_avg"}),", ",e.jsx("code",{children:"_min"}),", ",e.jsx("code",{children:"_max"})," (time to first token)"]})]}),e.jsx("p",{children:"Token usage:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"usage_prompt_tokens_avg"}),", ",e.jsx("code",{children:"_min"}),", ",e.jsx("code",{children:"_max"})]}),e.jsxs("li",{children:[e.jsx("code",{children:"usage_reasoning_tokens_avg"}),", ",e.jsx("code",{children:"_min"}),", ",e.jsx("code",{children:"_max"})]}),e.jsxs("li",{children:[e.jsx("code",{children:"usage_completion_tokens_avg"}),", ",e.jsx("code",{children:"_min"}),", ",e.jsx("code",{children:"_max"})]}),e.jsxs("li",{children:[e.jsx("code",{children:"usage_output_tokens_avg"}),", ",e.jsx("code",{children:"_min"}),", ",e.jsx("code",{children:"_max"})]}),e.jsxs("li",{children:[e.jsx("code",{children:"usage_total_tokens_avg"}),", ",e.jsx("code",{children:"_min"}),", ",e.jsx("code",{children:"_max"})]}),e.jsxs("li",{children:[e.jsx("code",{children:"usage_tokens_per_second_avg"}),", ",e.jsx("code",{children:"_min"}),", ",e.jsx("code",{children:"_max"})]})]}),e.jsx("h3",{id:"145-prometheus-integration",children:"14.5 Prometheus Integration"}),e.jsx("p",{children:e.jsx("strong",{children:"Example Prometheus Configuration:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`# prometheus.yml
scrape_configs:
  - job_name: "kronk"
    static_configs:
      - targets: ["localhost:8090"]
    scrape_interval: 15s`})}),e.jsx("p",{children:e.jsx("strong",{children:"Grafana Dashboard Query Examples:"})}),e.jsx("p",{children:"Time to first token:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-promql",children:"model_ttft_avg"})}),e.jsx("p",{children:"Tokens per second throughput:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-promql",children:"usage_tokens_per_second_avg"})}),e.jsx("p",{children:"Request rate:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-promql",children:"rate(requests[5m])"})}),e.jsx("p",{children:"Error rate:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-promql",children:"rate(errors[5m]) / rate(requests[5m])"})}),e.jsx("h3",{id:"146-distributed-tracing-with-tempo",children:"14.6 Distributed Tracing with Tempo"}),e.jsx("p",{children:"Kronk supports OpenTelemetry tracing with Grafana Tempo integration."}),e.jsx("p",{children:e.jsx("strong",{children:"Enable Tracing:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`kronk server start \\
  --tempo-host localhost:4317 \\
  --tempo-service-name kronk \\
  --tempo-probability 0.25`})}),e.jsx("p",{children:"Or via environment variables:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`export KRONK_TEMPO_HOST=localhost:4317
export KRONK_TEMPO_SERVICE_NAME=kronk
export KRONK_TEMPO_PROBABILITY=0.25
kronk server start`})}),e.jsx("p",{children:e.jsx("strong",{children:"Configuration Options:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"--tempo-host"})," - Tempo collector address (OTLP gRPC endpoint)"]}),e.jsxs("li",{children:[e.jsx("code",{children:"--tempo-service-name"})," - Service name in traces (default: ",e.jsx("code",{children:"kronk"}),")"]}),e.jsxs("li",{children:[e.jsx("code",{children:"--tempo-probability"})," - Sampling probability 0.0-1.0 (default: ",e.jsx("code",{children:"0.25"}),")"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Sampling Probability:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"1.0"})," - Trace every request (development only)"]}),e.jsxs("li",{children:[e.jsx("code",{children:"0.25"})," - Trace 25% of requests (recommended for production)"]}),e.jsxs("li",{children:[e.jsx("code",{children:"0.05"})," - Trace 5% of requests (high-traffic production)"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Excluded Routes:"})}),e.jsx("p",{children:"Health check endpoints are automatically excluded from tracing:"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("code",{children:"/v1/liveness"})}),e.jsx("li",{children:e.jsx("code",{children:"/v1/readiness"})})]}),e.jsx("h3",{id:"147-tracing-architecture",children:"14.7 Tracing Architecture"}),e.jsx("p",{children:e.jsx("strong",{children:"Request Flow with Tracing:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`Client Request
      
      

  Kronk Server               
    
   Inject Trace Context    
   (trace_id, span_id)     
    
                            
    
   Handler Span            
   (chat, embed, etc.)     
    
                            
    
   Inference Span          
   (model operations)      
    

      
      
   Tempo Collector (OTLP gRPC)
      
      
   Grafana (Visualization)`})}),e.jsx("p",{children:e.jsx("strong",{children:"What Gets Traced:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"HTTP request handling"}),e.jsx("li",{children:"Model acquisition from pool"}),e.jsx("li",{children:"Prefill and generation phases"}),e.jsx("li",{children:"Token streaming"})]}),e.jsx("h3",{id:"148-tempo-setup-with-docker",children:"14.8 Tempo Setup with Docker"}),e.jsx("p",{children:e.jsx("strong",{children:"Run Tempo Locally:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`docker run -d --name tempo \\
  -p 3200:3200 \\
  -p 4317:4317 \\
  grafana/tempo:latest \\
  -config.file=/etc/tempo/tempo.yaml`})}),e.jsx("p",{children:e.jsx("strong",{children:"Run Grafana:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`docker run -d --name grafana \\
  -p 3000:3000 \\
  grafana/grafana:latest`})}),e.jsx("p",{children:e.jsx("strong",{children:"Configure Grafana:"})}),e.jsxs("ol",{children:[e.jsx("li",{children:"Open http://localhost:3000 (admin/admin)"}),e.jsx("li",{children:"Add data source  Tempo"}),e.jsxs("li",{children:["Set URL: ",e.jsx("code",{children:"http://tempo:3200"})]}),e.jsx("li",{children:"Save and explore traces"})]}),e.jsx("h3",{id:"149-pprof-profiling",children:"14.9 pprof Profiling"}),e.jsx("p",{children:"Use Go's pprof tools for performance analysis."}),e.jsx("p",{children:e.jsx("strong",{children:"Capture CPU Profile (30 seconds):"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"go tool pprof http://localhost:8090/debug/pprof/profile?seconds=30"})}),e.jsx("p",{children:e.jsx("strong",{children:"Capture Heap Profile:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"go tool pprof http://localhost:8090/debug/pprof/heap"})}),e.jsx("p",{children:e.jsx("strong",{children:"View Goroutine Stacks:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"curl http://localhost:8090/debug/pprof/goroutine?debug=2"})}),e.jsx("p",{children:e.jsx("strong",{children:"Generate Flame Graph:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`go tool pprof -http=:8081 \\
  http://localhost:8090/debug/pprof/profile?seconds=30`})}),e.jsx("p",{children:"Opens interactive web UI with flame graph visualization."}),e.jsx("h3",{id:"1410-statsviz-real-time-monitoring",children:"14.10 Statsviz Real-Time Monitoring"}),e.jsx("p",{children:"Statsviz provides live runtime visualizations in your browser."}),e.jsx("p",{children:e.jsx("strong",{children:"Access Statsviz:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"http://localhost:8090/debug/statsviz"})}),e.jsx("p",{children:e.jsx("strong",{children:"Available Charts:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Heap size and allocations"}),e.jsx("li",{children:"Goroutine count"}),e.jsx("li",{children:"GC pause times"}),e.jsx("li",{children:"CPU scheduler latency"}),e.jsx("li",{children:"Memory by size class"})]}),e.jsx("p",{children:"Useful for real-time monitoring during load testing or debugging memory issues."}),e.jsx("h3",{id:"1411-logging",children:"14.11 Logging"}),e.jsx("p",{children:"Kronk logs structured JSON to stdout by default."}),e.jsx("p",{children:e.jsx("strong",{children:"Log Levels:"})}),e.jsx("p",{children:"Logs include context like trace IDs, request details, and timing."}),e.jsx("p",{children:e.jsx("strong",{children:"Insecure Logging:"})}),e.jsx("p",{children:"For debugging, enable verbose logging that includes message content:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk server start --insecure-logging"})}),e.jsxs("p",{children:[e.jsx("strong",{children:"Warning:"})," Insecure logging exposes user prompts and model responses. Never enable in production."]}),e.jsx("p",{children:e.jsx("strong",{children:"Environment Variable:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"export KRONK_INSECURE_LOGGING=true"})}),e.jsx("h3",{id:"1412-configuration-reference",children:"14.12 Configuration Reference"}),e.jsx("p",{children:e.jsx("strong",{children:"Debug Server:"})}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("code",{children:"--debug-host"})," - Debug server address (env: ",e.jsx("code",{children:"KRONK_DEBUG_HOST"}),","]})}),e.jsxs("p",{children:["default: ",e.jsx("code",{children:"localhost:8090"}),")"]}),e.jsx("p",{children:e.jsx("strong",{children:"Tracing:"})}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("code",{children:"--tempo-host"})," - Tempo collector address (env: ",e.jsx("code",{children:"KRONK_TEMPO_HOST"}),","]})}),e.jsxs("p",{children:["default: ",e.jsx("code",{children:"localhost:4317"}),")"]}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("code",{children:"--tempo-service-name"})," - Service name (env: ",e.jsx("code",{children:"KRONK_TEMPO_SERVICE_NAME"}),","]})}),e.jsxs("p",{children:["default: ",e.jsx("code",{children:"kronk"}),")"]}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("code",{children:"--tempo-probability"})," - Sampling rate 0.0-1.0"]})}),e.jsxs("p",{children:["(env: ",e.jsx("code",{children:"KRONK_TEMPO_PROBABILITY"}),", default: ",e.jsx("code",{children:"0.25"}),")"]}),e.jsx("p",{children:e.jsx("strong",{children:"Logging:"})}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("code",{children:"--insecure-logging"})," - Log message content"]})}),e.jsxs("p",{children:["(env: ",e.jsx("code",{children:"KRONK_INSECURE_LOGGING"}),", default: ",e.jsx("code",{children:"false"}),")"]}),e.jsx("ul",{children:e.jsxs("li",{children:[e.jsx("code",{children:"--llama-log"})," - llama.cpp log level, 0=off, 1=on"]})}),e.jsxs("p",{children:["(env: ",e.jsx("code",{children:"KRONK_LLAMA_LOG"}),", default: ",e.jsx("code",{children:"1"}),")"]}),e.jsx("hr",{}),e.jsx("p",{children:e.jsx("em",{children:'Next: <a href="#chapter-15-mcp-service">Chapter 15: MCP Service</a>'})}),e.jsx("h2",{id:"chapter-15-mcp-service",children:"Chapter 15: MCP Service"}),e.jsxs("p",{children:["Kronk includes a built-in ",e.jsx("a",{href:"https://modelcontextprotocol.io/",children:"Model Context Protocol (MCP)"})," service that exposes tools to MCP-compatible clients. The initial tool provided is ",e.jsx("code",{children:"web_search"}),", powered by the ",e.jsx("a",{href:"https://brave.com/search/api/",children:"Brave Search API"}),"."]}),e.jsx("p",{children:"MCP is an open standard that lets AI agents call external tools over a simple JSON-RPC protocol. By running the MCP service, any MCP-compatible client (Cline, Kilo Code, Cursor, etc.) can discover and invoke tools served by Kronk."}),e.jsx("h3",{id:"151-architecture",children:"15.1 Architecture"}),e.jsx("p",{children:"The MCP service can run in two modes:"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Embedded (default)"}),"  When the Kronk model server starts and no external MCP host is configured (",e.jsx("code",{children:"--mcp-host"})," is empty), it automatically starts an embedded MCP server on ",e.jsx("code",{children:"localhost:9000"}),". No extra process is needed."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Standalone"}),"  Run the MCP service as its own process for independent scaling or when you don't need the full model server:"]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"make mcp-server"})}),e.jsx("p",{children:"Or directly:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"go run cmd/server/api/services/mcp/main.go"})}),e.jsxs("p",{children:["Both modes serve the same MCP protocol on the same default port (",e.jsx("code",{children:"9000"}),")."]}),e.jsx("h3",{id:"152-prerequisites",children:"15.2 Prerequisites"}),e.jsxs("p",{children:["The ",e.jsx("code",{children:"web_search"})," tool requires a Brave Search API key. Get a free key at ",e.jsx("a",{href:"https://brave.com/search/api/",children:"https://brave.com/search/api/"}),"."]}),e.jsx("h3",{id:"153-configuration",children:"15.3 Configuration"}),e.jsx("p",{children:e.jsx("strong",{children:"Environment Variables:"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Variable"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Default"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"MCP_MCP_HOST"})}),e.jsx("td",{children:"MCP listen address (standalone mode)"}),e.jsx("td",{children:e.jsx("code",{children:"localhost:9000"})})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"MCP_MCP_BRAVEAPIKEY"})}),e.jsx("td",{children:"Brave Search API key (standalone mode)"}),e.jsx("td",{children:""})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_MCP_HOST"})}),e.jsx("td",{children:"External MCP host (empty = embedded mode)"}),e.jsx("td",{children:""})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"KRONK_MCP_BRAVEAPIKEY"})}),e.jsx("td",{children:"Brave Search API key (embedded mode)"}),e.jsx("td",{children:""})]})]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Embedded mode"}),"  Pass the Brave API key when starting the Kronk server:"]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`export KRONK_MCP_BRAVEAPIKEY=<your-brave-api-key>
kronk server start`})}),e.jsxs("p",{children:["The embedded MCP server will start automatically on ",e.jsx("code",{children:"localhost:9000"}),"."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Standalone mode"}),"  Start the MCP service as a separate process:"]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`export MCP_MCP_BRAVEAPIKEY=<your-brave-api-key>
make mcp-server`})}),e.jsx("h3",{id:"154-available-tools",children:"15.4 Available Tools"}),e.jsx("h4",{id:"web_search",children:"web_search"}),e.jsx("p",{children:"Performs a web search and returns a list of relevant web pages with titles, URLs, and descriptions."}),e.jsx("p",{children:e.jsx("strong",{children:"Parameters:"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Parameter"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Required"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"query"})}),e.jsx("td",{children:"string"}),e.jsx("td",{children:"Yes"}),e.jsx("td",{children:"Search query"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"count"})}),e.jsx("td",{children:"int"}),e.jsx("td",{children:"No"}),e.jsx("td",{children:"Number of results to return (default 10, max 20)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"country"})}),e.jsx("td",{children:"string"}),e.jsx("td",{children:"No"}),e.jsxs("td",{children:["Country code for search context (e.g. ",e.jsx("code",{children:"US"}),", ",e.jsx("code",{children:"GB"}),", ",e.jsx("code",{children:"DE"}),")"]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"freshness"})}),e.jsx("td",{children:"string"}),e.jsx("td",{children:"No"}),e.jsxs("td",{children:["Filter by freshness: ",e.jsx("code",{children:"pd"})," (past day), ",e.jsx("code",{children:"pw"})," (past week), ",e.jsx("code",{children:"pm"})," (past month), ",e.jsx("code",{children:"py"})," (past year)"]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"safesearch"})}),e.jsx("td",{children:"string"}),e.jsx("td",{children:"No"}),e.jsxs("td",{children:["Safe search filter: ",e.jsx("code",{children:"off"}),", ",e.jsx("code",{children:"moderate"}),", ",e.jsx("code",{children:"strict"})," (default ",e.jsx("code",{children:"moderate"}),")"]})]})]})]}),e.jsx("h3",{id:"155-client-configuration",children:"15.5 Client Configuration"}),e.jsxs("p",{children:["The MCP service uses the Streamable HTTP transport. Configure your MCP-compatible client to connect to ",e.jsx("code",{children:"http://localhost:9000/mcp"}),"."]}),e.jsx("h4",{id:"cline",children:"Cline"}),e.jsx("p",{children:"Add the following to your Cline MCP settings:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "mcpServers": {
    "Kronk": {
      "autoApprove": ["web_search"],
      "disabled": false,
      "timeout": 60,
      "type": "streamableHttp",
      "url": "http://localhost:9000/mcp"
    }
  }
}`})}),e.jsx("h4",{id:"kilo-code",children:"Kilo Code"}),e.jsx("p",{children:"Add the following to your Kilo Code MCP settings:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-json",children:`{
  "mcpServers": {
    "Kronk": {
      "type": "streamable-http",
      "url": "http://localhost:9000/mcp",
      "disabled": true,
      "alwaysAllow": ["web_search"],
      "timeout": 60
    }
  }
}`})}),e.jsx("h3",{id:"156-testing-with-curl",children:"15.6 Testing with curl"}),e.jsx("p",{children:"You can test the MCP service manually using curl. See the makefile targets for convenience commands."}),e.jsx("p",{children:e.jsx("strong",{children:"Initialize a session:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"make curl-mcp-init"})}),e.jsxs("p",{children:["This returns the ",e.jsx("code",{children:"Mcp-Session-Id"})," header needed for subsequent requests."]}),e.jsx("p",{children:e.jsx("strong",{children:"List available tools:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"make curl-mcp-tools-list SESSIONID=<session-id>"})}),e.jsx("p",{children:e.jsx("strong",{children:"Call web_search:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"make curl-mcp-web-search SESSIONID=<session-id>"})}),e.jsx("hr",{}),e.jsx("p",{children:e.jsx("em",{children:'Next: <a href="#chapter-16-troubleshooting">Chapter 16: Troubleshooting</a>'})}),e.jsx("h2",{id:"chapter-16-troubleshooting",children:"Chapter 16: Troubleshooting"}),e.jsx("p",{children:"This chapter covers common issues, their causes, and solutions."}),e.jsx("h3",{id:"161-library-issues",children:"16.1 Library Issues"}),e.jsx("p",{children:e.jsx("strong",{children:'Error: "unable to load library"'})}),e.jsx("p",{children:"The llama.cpp libraries are missing or incompatible."}),e.jsx("p",{children:e.jsx("strong",{children:"Solution:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk libs --local"})}),e.jsx("p",{children:"Or download via the BUI Libraries page."}),e.jsx("p",{children:e.jsx("strong",{children:'Error: "unknown device"'})}),e.jsx("p",{children:"The specified GPU device is not available."}),e.jsx("p",{children:e.jsx("strong",{children:"Causes:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Wrong ",e.jsx("code",{children:"--device"})," flag (e.g., ",e.jsx("code",{children:"cuda"})," on a Mac)"]}),e.jsx("li",{children:"GPU drivers not installed"}),e.jsx("li",{children:"Library mismatch (CPU library with GPU device setting)"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Solution:"})}),e.jsx("p",{children:"Check your hardware and install matching libraries:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`# For Mac with Apple Silicon
KRONK_PROCESSOR=metal kronk libs --local

# For NVIDIA GPU
KRONK_PROCESSOR=cuda kronk libs --local

# For CPU only
KRONK_PROCESSOR=cpu kronk libs --local

# For AMD GPU (ROCm)
KRONK_PROCESSOR=rocm kronk libs --local`})}),e.jsx("h3",{id:"162-model-loading-failures",children:"16.2 Model Loading Failures"}),e.jsx("p",{children:e.jsx("strong",{children:'Error: "unable to load model"'})}),e.jsx("p",{children:"The model file is missing, corrupted, or incompatible."}),e.jsx("p",{children:e.jsx("strong",{children:"Check model exists:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"ls ~/.kronk/models/"})}),e.jsx("p",{children:e.jsx("strong",{children:"Re-download the model:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk catalog pull <model-name> --local"})}),e.jsx("p",{children:e.jsx("strong",{children:"Verify model integrity:"})}),e.jsx("p",{children:"By default, Kronk skips integrity checks. To force verification:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk server start --ignore-integrity-check=false"})}),e.jsx("p",{children:e.jsx("strong",{children:'Error: "failed to retrieve model template"'})}),e.jsx("p",{children:"The model's chat template is missing."}),e.jsx("p",{children:e.jsx("strong",{children:"Solution:"})}),e.jsx("p",{children:"Ensure templates are downloaded:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk catalog pull-templates --local"})}),e.jsx("h3",{id:"163-memory-errors",children:"16.3 Memory Errors"}),e.jsx("p",{children:e.jsx("strong",{children:'Error: "unable to init context" or "unable to get memory"'})}),e.jsx("p",{children:"Insufficient memory for the model configuration."}),e.jsx("p",{children:e.jsx("strong",{children:"Causes:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Context window too large"}),e.jsx("li",{children:"Too many batch slots"}),e.jsx("li",{children:"Model too large for available RAM/VRAM"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Solutions:"})}),e.jsx("p",{children:"Reduce context window:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  Qwen3-8B-Q8_0:
    context_window: 8192 # Reduce from 32768`})}),e.jsx("p",{children:"Reduce batch parallelism:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  Qwen3-8B-Q8_0:
    n_seq_max: 1 # Single request at a time`})}),e.jsx("p",{children:"Use quantized KV cache:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  Qwen3-8B-Q8_0:
    cache-type-k: q8_0 # Saves ~50% KV cache memory
    cache-type-v: q8_0`})}),e.jsx("p",{children:e.jsx("strong",{children:'Error: "context window is full"'})}),e.jsx("p",{children:"The request plus context exceeds the configured context window."}),e.jsx("p",{children:e.jsx("strong",{children:"Solutions:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Reduce input size (fewer messages or shorter prompts)"}),e.jsxs("li",{children:["Increase ",e.jsx("code",{children:"context_window"})," in model config"]}),e.jsx("li",{children:"Enable YaRN for extended context (see Chapter 6)"})]}),e.jsx("h3",{id:"164-request-timeouts",children:"16.4 Request Timeouts"}),e.jsx("p",{children:e.jsx("strong",{children:'Error: "context deadline exceeded"'})}),e.jsx("p",{children:"The request took longer than the configured timeout."}),e.jsx("p",{children:e.jsx("strong",{children:"Causes:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Model too slow for the request size"}),e.jsx("li",{children:"Large prefill with many tokens"}),e.jsx("li",{children:"Server under heavy load"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Solutions:"})}),e.jsx("p",{children:"Increase HTTP timeouts:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`kronk server start \\
  --read-timeout 5m \\
  --write-timeout 30m`})}),e.jsx("p",{children:"Or via environment variables:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`export KRONK_READ_TIMEOUT=5m
export KRONK_WRITE_TIMEOUT=30m`})}),e.jsx("h3",{id:"165-authentication-errors",children:"16.5 Authentication Errors"}),e.jsx("p",{children:e.jsx("strong",{children:'Error: "unauthorized: no authorization header"'})}),e.jsx("p",{children:"Authentication is enabled but no token was provided."}),e.jsx("p",{children:e.jsx("strong",{children:"Solution:"})}),e.jsx("p",{children:"Include the Authorization header:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`curl http://localhost:8080/v1/chat/completions \\
  -H "Authorization: Bearer $(cat ~/.kronk/keys/master.jwt)" \\
  -H "Content-Type: application/json" \\
  -d '{...}'`})}),e.jsx("p",{children:e.jsx("strong",{children:'Error: "invalid token"'})}),e.jsx("p",{children:"The token is malformed, expired, or signed with an unknown key."}),e.jsx("p",{children:e.jsx("strong",{children:"Causes:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Token has expired (check ",e.jsx("code",{children:"--duration"})," when created)"]}),e.jsx("li",{children:"Signing key was deleted"}),e.jsx("li",{children:"Token is corrupted"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Solution:"})}),e.jsx("p",{children:"Create a new token:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`export KRONK_TOKEN=$(cat ~/.kronk/keys/master.jwt)
kronk security token create \\
  --duration 720h \\
  --endpoints chat-completions,embeddings`})}),e.jsx("p",{children:e.jsx("strong",{children:'Error: "endpoint not authorized"'})}),e.jsx("p",{children:"The token doesn't include the requested endpoint."}),e.jsx("p",{children:e.jsx("strong",{children:"Solution:"})}),e.jsx("p",{children:"Create a new token with the required endpoints:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`kronk security token create \\
  --duration 720h \\
  --endpoints chat-completions,embeddings,rerank,responses,messages`})}),e.jsx("p",{children:e.jsx("strong",{children:'Error: "rate limit exceeded"'})}),e.jsx("p",{children:"The token has exceeded its rate limit."}),e.jsx("p",{children:e.jsx("strong",{children:"Solution:"})}),e.jsx("p",{children:"Wait for the rate limit window to reset, or create a new token with higher limits:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`kronk security token create \\
  --duration 720h \\
  --endpoints "chat-completions:10000/day"`})}),e.jsx("h3",{id:"166-streaming-issues",children:"16.6 Streaming Issues"}),e.jsx("p",{children:e.jsx("strong",{children:"Problem: Streaming stops mid-response"})}),e.jsx("p",{children:e.jsx("strong",{children:"Causes:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Client disconnected"}),e.jsx("li",{children:"Request timeout"}),e.jsx("li",{children:"Model generated stop token"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Check server logs:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`# Look for errors in server output
kronk server start  # Run in foreground to see logs`})}),e.jsx("p",{children:e.jsx("strong",{children:"Problem: SSE events not parsing correctly"})}),e.jsx("p",{children:"Ensure your client handles Server-Sent Events format:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:'data: {"id":"...","choices":[...]}\\n\\n'})}),e.jsxs("p",{children:["Each event is prefixed with ",e.jsx("code",{children:"data: "})," and ends with two newlines."]}),e.jsx("h3",{id:"167-performance-issues",children:"16.7 Performance Issues"}),e.jsx("p",{children:e.jsx("strong",{children:"Problem: Slow time to first token (TTFT)"})}),e.jsx("p",{children:e.jsx("strong",{children:"Causes:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Large system prompt not cached"}),e.jsx("li",{children:"No message caching enabled"}),e.jsx("li",{children:"Cold model load"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Solutions:"})}),e.jsx("p",{children:"Enable system prompt caching:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  Qwen3-8B-Q8_0:
    system_prompt_cache: true`})}),e.jsx("p",{children:"Or enable incremental message cache for agents:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  Qwen3-8B-Q8_0:
    incremental_cache: true`})}),e.jsx("p",{children:e.jsx("strong",{children:"Problem: Slow token generation (tokens/second)"})}),e.jsx("p",{children:e.jsx("strong",{children:"Causes:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"CPU inference instead of GPU"}),e.jsx("li",{children:"Insufficient GPU layers"}),e.jsx("li",{children:"Large model for available hardware"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Solutions:"})}),e.jsx("p",{children:"Check GPU is being used:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`# On macOS, check Metal usage
sudo powermetrics --samplers gpu_power

# On Linux with NVIDIA
nvidia-smi`})}),e.jsx("p",{children:"Increase GPU layers:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-yaml",children:`models:
  Qwen3-8B-Q8_0:
    gpu_layers: 99 # Offload all layers to GPU`})}),e.jsx("h3",{id:"168-viewing-logs",children:"16.8 Viewing Logs"}),e.jsx("p",{children:e.jsx("strong",{children:"Run server in foreground:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk server start"})}),e.jsx("p",{children:"All logs print to stdout with structured JSON format."}),e.jsx("p",{children:e.jsx("strong",{children:"Enable verbose logging:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk server start --insecure-logging"})}),e.jsx("p",{children:"This logs full message content (never use in production)."}),e.jsx("p",{children:e.jsx("strong",{children:"Enable llama.cpp logging:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk server start --llama-log 1"})}),e.jsx("p",{children:"Shows low-level inference engine messages."}),e.jsx("p",{children:e.jsx("strong",{children:"Disable llama.cpp logging:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"kronk server start --llama-log 0"})}),e.jsx("h3",{id:"169-common-error-messages",children:"16.9 Common Error Messages"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Error"}),e.jsx("th",{children:"Cause"}),e.jsx("th",{children:"Solution"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"Init() not called"})}),e.jsx("td",{children:"Missing initialization"}),e.jsxs("td",{children:["Call ",e.jsx("code",{children:"kronk.Init()"})]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"unknown device"})}),e.jsx("td",{children:"Invalid GPU setting"}),e.jsxs("td",{children:["Check ",e.jsx("code",{children:"--device"})," flag"]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"context deadline"})}),e.jsx("td",{children:"Request timeout"}),e.jsx("td",{children:"Increase timeouts"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"unable to load model"})}),e.jsx("td",{children:"Missing/corrupt model"}),e.jsx("td",{children:"Re-download model"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"no authorization"})}),e.jsx("td",{children:"Missing token"}),e.jsx("td",{children:"Add Bearer token"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"rate limit exceeded"})}),e.jsx("td",{children:"Quota exhausted"}),e.jsx("td",{children:"Wait or increase limit"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"github rate limited"})}),e.jsx("td",{children:"GitHub API 403/429"}),e.jsxs("td",{children:["Set ",e.jsx("code",{children:"GITHUB_TOKEN"})]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"context window full"})}),e.jsx("td",{children:"Input too large"}),e.jsx("td",{children:"Reduce input size"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"NBatch overflow"})}),e.jsx("td",{children:"Batch too large"}),e.jsxs("td",{children:["Reduce ",e.jsx("code",{children:"n_batch"})]})]})]})]}),e.jsx("h3",{id:"1610-getting-help",children:"16.10 Getting Help"}),e.jsx("p",{children:e.jsx("strong",{children:"Check server status:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"curl http://localhost:8080/v1/liveness"})}),e.jsx("p",{children:e.jsx("strong",{children:"List loaded models:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"curl http://localhost:8080/v1/models"})}),e.jsx("p",{children:e.jsx("strong",{children:"Check metrics:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"curl http://localhost:8090/metrics"})}),e.jsx("p",{children:e.jsx("strong",{children:"View goroutine stacks (for hangs):"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"curl http://localhost:8090/debug/pprof/goroutine?debug=2"})}),e.jsx("p",{children:e.jsx("strong",{children:"Report issues:"})}),e.jsx("p",{children:"Include the following when reporting bugs:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Kronk version (",e.jsx("code",{children:"kronk --version"}),")"]}),e.jsx("li",{children:"Operating system and architecture"}),e.jsx("li",{children:"GPU type and driver version"}),e.jsx("li",{children:"Model name and configuration"}),e.jsx("li",{children:"Full error message and stack trace"}),e.jsx("li",{children:"Steps to reproduce"})]}),e.jsx("hr",{}),e.jsx("p",{children:e.jsx("em",{children:'Next: <a href="#chapter-17-developer-guide">Chapter 17: Developer Guide</a>'})}),e.jsx("h2",{id:"chapter-17-developer-guide",children:"Chapter 17: Developer Guide"}),e.jsx("p",{children:"This chapter covers development workflows, build commands, and code conventions for contributors to the Kronk project."}),e.jsx("h3",{id:"171-quick-reference",children:"17.1 Quick Reference"}),e.jsx("p",{children:"Here is a quick chart of some of the more imporant make commands."}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Task"}),e.jsx("th",{children:"Command"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Install CLI"}),e.jsxs("td",{children:[e.jsx("code",{children:"make install-kronk"}),"."]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Run all tests"}),e.jsx("td",{children:e.jsx("code",{children:"make test"})})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Single test"}),e.jsx("td",{children:e.jsx("code",{children:"go test -v -count=1 -run TestName ./sdk/kronk/..."})})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Run server"}),e.jsx("td",{children:e.jsx("code",{children:"make kronk-server"})})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Build BUI"}),e.jsx("td",{children:e.jsx("code",{children:"make bui-build"})})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Generate docs"}),e.jsx("td",{children:e.jsx("code",{children:"make kronk-docs"})})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Tidy modules"}),e.jsx("td",{children:e.jsx("code",{children:"make tidy"})})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Update deps"}),e.jsx("td",{children:e.jsx("code",{children:"make deps-upgrade"})})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Lint"}),e.jsx("td",{children:e.jsx("code",{children:"staticcheck ./..."})})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Developer setup"}),e.jsxs("td",{children:[e.jsx("code",{children:"make setup"})," (configures git hooks)"]})]})]})]}),e.jsx("h3",{id:"172-build-test-commands",children:"17.2 Build & Test Commands"}),e.jsx("p",{children:e.jsx("strong",{children:"Install CLI locally:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"go install ./cmd/kronk"})}),e.jsx("p",{children:e.jsx("strong",{children:"Run all tests:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"make test"})}),e.jsx("p",{children:"Tests require prerequisites and environment variables:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:`# Install dependencies first
make install-libraries install-models

# Set required environment variables
export RUN_IN_PARALLEL=yes
export GITHUB_WORKSPACE=/path/to/kronk  # project root

# Run from project root directory
make test`})}),e.jsx("p",{children:e.jsx("strong",{children:"Run a single test:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"go test -v -count=1 -run TestName ./sdk/kronk/..."})}),e.jsx("h3",{id:"173-developer-setup",children:"17.3 Developer Setup"}),e.jsx("p",{children:"Configure git hooks for automatic pre-commit checks:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"make setup"})}),e.jsx("p",{children:"This enables a pre-commit hook that automatically runs:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"make kronk-docs"})," - Regenerates documentation"]}),e.jsxs("li",{children:[e.jsx("code",{children:"make bui-build"})," - Rebuilds the BUI frontend"]})]}),e.jsx("h3",{id:"174-project-architecture",children:"17.4 Project Architecture"}),e.jsx("p",{children:e.jsx("strong",{children:"Directory Structure:"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Directory"}),e.jsx("th",{children:"Purpose"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"cmd/kronk/"})}),e.jsx("td",{children:"CLI tool (subcommands: catalog, libs, model, run, security, server)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"cmd/server/"})}),e.jsx("td",{children:"OpenAI-compatible model server (gRPC + HTTP) with BUI frontend"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"cmd/server/api/tooling/docs/"})}),e.jsx("td",{children:"Documentation generator for BUI (SDK and CLI docs)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"sdk/kronk/"})}),e.jsx("td",{children:"Core API: model loading, chat, embeddings, cache, metrics"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"sdk/kronk/model/"})}),e.jsx("td",{children:"Core inference and caching engine"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"sdk/kronk/observ/"})}),e.jsx("td",{children:"Observability packages (metrics/, otel/)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"sdk/tools/"})}),e.jsx("td",{children:"Support for libs, models, catalogs, templates, and defaults"})]})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Core Technology:"})}),e.jsxs("p",{children:["Kronk uses ",e.jsx("a",{href:"https://github.com/hybridgroup/yzma",children:"yzma"})," (llama.cpp Go bindings) for local inference with GGUF models."]}),e.jsx("h3",{id:"175-bui-frontend-development",children:"17.5 BUI Frontend Development"}),e.jsx("p",{children:"The Browser UI is a React application located at:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:"cmd/server/api/frontends/bui/src/"})}),e.jsx("p",{children:e.jsx("strong",{children:"Directory Structure:"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Directory/File"}),e.jsx("th",{children:"Purpose"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"components/"})}),e.jsx("td",{children:"React components (pages and UI elements)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"contexts/"})}),e.jsx("td",{children:"React context providers for shared state"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"services/"})}),e.jsxs("td",{children:["API client (",e.jsx("code",{children:"api.ts"}),")"]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"types/"})}),e.jsx("td",{children:"TypeScript type definitions"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"App.tsx"})}),e.jsx("td",{children:"Main app with routing configuration"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"index.css"})}),e.jsx("td",{children:"Global styles (CSS variables, component styles)"})]})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Routing:"})}),e.jsxs("p",{children:["Uses ",e.jsx("code",{children:"react-router-dom"})," with ",e.jsx("code",{children:"BrowserRouter"}),". Routes are defined in ",e.jsx("code",{children:"routeMap"})," in ",e.jsx("code",{children:"App.tsx"}),"."]}),e.jsx("p",{children:e.jsx("strong",{children:"Adding New Pages:"})}),e.jsxs("ol",{children:[e.jsxs("li",{children:["Create component in ",e.jsx("code",{children:"components/"})," (e.g., ",e.jsx("code",{children:"DocsSDKKronk.tsx"}),")"]}),e.jsxs("li",{children:["Add page type to ",e.jsx("code",{children:"Page"})," union in ",e.jsx("code",{children:"App.tsx"})]}),e.jsxs("li",{children:["Add route path to ",e.jsx("code",{children:"routeMap"})," in ",e.jsx("code",{children:"App.tsx"})]}),e.jsxs("li",{children:["Add ",e.jsx("code",{children:"<Route>"})," element in ",e.jsx("code",{children:"App.tsx"})]}),e.jsxs("li",{children:["Add ",e.jsx("code",{children:"<Link>"})," entry to menu in ",e.jsx("code",{children:"components/Layout.tsx"})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Menu Structure (<code>Layout.tsx</code>):"})}),e.jsxs("p",{children:["Uses ",e.jsx("code",{children:"MenuCategory[]"})," with properties:"]}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"id"})," - Unique identifier"]}),e.jsxs("li",{children:[e.jsx("code",{children:"label"})," - Display text"]}),e.jsxs("li",{children:[e.jsx("code",{children:"items"})," - Array of leaf pages"]}),e.jsxs("li",{children:[e.jsx("code",{children:"subcategories"})," - Nested menu categories"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"State Management:"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Context"}),e.jsx("th",{children:"Purpose"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"TokenContext"})}),e.jsxs("td",{children:["Stores API token in localStorage (key: ",e.jsx("code",{children:"kronk_token"}),")"]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"ModelListContext"})}),e.jsx("td",{children:"Caches model list data with invalidation support"})]})]})]}),e.jsxs("p",{children:["Access via hooks: ",e.jsx("code",{children:"useToken()"}),", ",e.jsx("code",{children:"useModelList()"})]}),e.jsx("p",{children:e.jsx("strong",{children:"API Service (<code>services/api.ts</code>):"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"ApiService"})," class with methods for all endpoints"]}),e.jsx("li",{children:"Streaming support for pull operations (models, catalog, libs)"}),e.jsx("li",{children:"Auth-required endpoints accept token parameter"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Styling Conventions:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:["CSS variables defined in ",e.jsx("code",{children:":root"})," (colors: ",e.jsx("code",{children:"--color-orange"}),", ",e.jsx("code",{children:"--color-blue"}),", etc.)"]}),e.jsxs("li",{children:["Common classes: ",e.jsx("code",{children:".card"}),", ",e.jsx("code",{children:".btn"}),", ",e.jsx("code",{children:".btn-primary"}),", ",e.jsx("code",{children:".form-group"}),", ",e.jsx("code",{children:".alert"}),", ",e.jsx("code",{children:".table-container"})]}),e.jsx("li",{children:"No CSS modules or styled-components; use global CSS classes"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Documentation Generation:"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Generator Location"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"SDK docs"}),e.jsxs("td",{children:[e.jsx("code",{children:"cmd/server/api/tooling/docs/sdk/"})," (uses ",e.jsx("code",{children:"go doc"})," output)"]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"CLI docs"}),e.jsxs("td",{children:[e.jsx("code",{children:"cmd/server/api/tooling/docs/cli/"})," (from command definitions)"]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Examples"}),e.jsxs("td",{children:["Auto-generated from ",e.jsx("code",{children:"examples/"})," directory"]})]})]})]}),e.jsx("p",{children:"Generate all documentation:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"go run ./cmd/server/api/tooling/docs -pkg=all"})}),e.jsx("h3",{id:"176-code-style-guidelines",children:"17.6 Code Style Guidelines"}),e.jsx("p",{children:e.jsx("strong",{children:"Package Comments:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-go",children:"// Package kronk provides the core inference API."})}),e.jsx("p",{children:e.jsx("strong",{children:"Error Handling:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-go",children:`// Wrap errors with lowercase context prefix
return fmt.Errorf("loading model: %w", err)

// Declare package-level sentinel errors
var ErrModelNotFound = errors.New("model not found")`})}),e.jsx("p",{children:e.jsx("strong",{children:"Struct Design:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Use unexported fields with exported types"}),e.jsxs("li",{children:["Use ",e.jsx("code",{children:"Config"})," pattern for constructors"]})]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-go",children:`type Config struct {
    Host string
    Port int
}

func New(cfg Config) *Server {
    // ...
}`})}),e.jsx("p",{children:e.jsx("strong",{children:"Testing:"})}),e.jsx("p",{children:"Disable CGO in tests:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-shell",children:"CGO_ENABLED=0 go test ./..."})}),e.jsx("p",{children:e.jsx("strong",{children:"Import Order (goimports):"})}),e.jsxs("ol",{children:[e.jsx("li",{children:"Standard library"}),e.jsx("li",{children:"External packages"}),e.jsx("li",{children:"Internal packages"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Control Flow:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Avoid ",e.jsx("code",{children:"else"})," and ",e.jsx("code",{children:"else if"})," clauses"]}),e.jsxs("li",{children:["Prefer ",e.jsx("code",{children:"switch"})," statements or early returns"]})]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-go",children:`// Preferred: early return
if err != nil {
    return err
}
// continue with main logic

// Preferred: switch over if-else chains
switch state {
case "active":
    // ...

case "pending":
    // ...

default:
    // ...
}`})}),e.jsx("h3",{id:"177-sdk-internals",children:"17.7 SDK Internals"}),e.jsx("p",{children:"This section documents implementation details for developers working on the Kronk SDK packages."}),e.jsx("h4",{id:"1771-package-structure",children:"17.7.1 Package Structure"}),e.jsxs("p",{children:[e.jsx("strong",{children:"sdk/kronk/"})," - Core API package:"]}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"File"}),e.jsx("th",{children:"Purpose"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"acquire.go"})}),e.jsx("td",{children:"Model pool acquire/release"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"chat.go"})}),e.jsx("td",{children:"Chat completion API"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"concurrency.go"})}),e.jsx("td",{children:"Generic streaming utilities"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"embedding.go"})}),e.jsx("td",{children:"Embedding API"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"init.go"})}),e.jsx("td",{children:"Initialization and configuration"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"kronk.go"})}),e.jsx("td",{children:"Main Kronk type, model pool management"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"rerank.go"})}),e.jsx("td",{children:"Reranking API"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"response.go"})}),e.jsx("td",{children:"OpenAI Responses API streaming"})]})]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"sdk/kronk/model/"})," - Low-level inference:"]}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"File"}),e.jsx("th",{children:"Purpose"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"batch.go"})}),e.jsx("td",{children:"Batch engine for parallel text inference"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"caching.go"})}),e.jsx("td",{children:"System prompt and IMC cache management"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"chat.go"})}),e.jsx("td",{children:"Chat inference loop, batch routing"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"config.go"})}),e.jsx("td",{children:"Model configuration (GPU, cache, batching)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"embed.go"})}),e.jsx("td",{children:"Embedding inference"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"logprobs.go"})}),e.jsx("td",{children:"Token log probability extraction"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"media.go"})}),e.jsx("td",{children:"Vision/audio media processing"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"model.go"})}),e.jsx("td",{children:"Model type, context management, lifecycle"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"models.go"})}),e.jsx("td",{children:"OpenAI-compatible types (ChatMessage, ToolCall, etc.)"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"params.go"})}),e.jsx("td",{children:"Sampling parameters"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"processor.go"})}),e.jsx("td",{children:"Template-specific token processors"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"prompts.go"})}),e.jsx("td",{children:"Prompt formatting"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"rerank.go"})}),e.jsx("td",{children:"Reranking inference"})]})]})]}),e.jsx("h4",{id:"1772-streaming-architecture",children:"17.7.2 Streaming Architecture"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Response Streaming Pattern"})," (",e.jsx("code",{children:"response.go"}),", ",e.jsx("code",{children:"concurrency.go"}),"):"]}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Uses ",e.jsx("code",{children:"streamingWith[T, U]"})," generic function for 1:N event transformation"]}),e.jsxs("li",{children:[e.jsx("code",{children:"streamProcessor"})," has three phases: ",e.jsx("code",{children:"Start()"}),", ",e.jsx("code",{children:"Process(chunk)"}),", ",e.jsx("code",{children:"Complete(lastChunk)"})]}),e.jsxs("li",{children:[e.jsx("code",{children:"streamState"})," struct maintains response ID, sequence numbers, aggregated usage"]}),e.jsxs("li",{children:["SSE format: ",e.jsx("code",{children:"event: <type>\\ndata: <json>\\n\\n"})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"FinishReason Handling:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"FinishReasonPtr *string"})," field with ",e.jsx("code",{children:"FinishReason()"})," accessor"]}),e.jsxs("li",{children:["Constants: ",e.jsx("code",{children:'FinishReasonStop="stop"'}),", ",e.jsx("code",{children:'FinishReasonTool="tool_calls"'}),", ",e.jsx("code",{children:'FinishReasonError="error"'})]}),e.jsxs("li",{children:["When ",e.jsx("code",{children:"FinishReasonPtr != nil"}),", skip text/reasoning deltas (they duplicate previous content)"]}),e.jsx("li",{children:"Always process tool calls even with FinishReason set (may only arrive in final chunk)"})]}),e.jsx("h4",{id:"1773-concurrency-strategy",children:"17.7.3 Concurrency Strategy"}),e.jsxs("p",{children:[e.jsx("code",{children:"NSeqMax"})," behaves differently depending on model type:"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Embedding and Reranking Models"}),":"]}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"NSeqMax"})," controls the internal context pool size"]}),e.jsx("li",{children:"Model weights are shared, only KV cache memory is multiplied"}),e.jsx("li",{children:"Inputs within a request are partitioned across pool contexts for parallel processing"}),e.jsxs("li",{children:["Semaphore capacity = ",e.jsx("code",{children:"NSeqMax"})]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Text Inference Models"})," (chat, completion, vision, audio):"]}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"NSeqMax"})," controls batch parallelism within the batch engine"]}),e.jsxs("li",{children:["Only one ",e.jsx("code",{children:"model.Model"})," instance is created with multiple slots"]}),e.jsxs("li",{children:["Semaphore capacity = ",e.jsx("code",{children:"NSeqMax * queueDepth"})," (default queueDepth=2)"]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Detection Logic"})," (",e.jsx("code",{children:"kronk.go"}),"):"]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-go",children:`switch {
case mi.IsEmbedModel || mi.IsRerankModel:
    semCapacity = max(cfg.NSeqMax, 1)
default:
    semCapacity = max(cfg.NSeqMax, 1) * o.queueDepth
}`})}),e.jsx("h4",{id:"1674-model-acquirerelease-cleanup",children:"16.7.4 Model Acquire/Release & Cleanup"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Acquisition"})," (",e.jsx("code",{children:"acquire.go"}),"):"]}),e.jsxs("ol",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Backpressure slot"}),": Acquire semaphore slot (limits total in-flight requests)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Return model"}),": Return the single model instance"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Cleanup Flow:"})}),e.jsxs("ol",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"streaming()"})," acquires model, defers ",e.jsx("code",{children:"releaseModel()"})," in wrapper goroutine"]}),e.jsxs("li",{children:[e.jsx("code",{children:"ChatStreaming"})," defers ",e.jsx("code",{children:"m.resetContext()"})," before any processing"]}),e.jsxs("li",{children:["When generation completes, ",e.jsx("code",{children:"resetContext()"})," runs first:",e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"llama.Synchronize(m.lctx)"})," - waits for GPU operations"]}),e.jsxs("li",{children:[e.jsx("code",{children:"llama.MemoryClear(mem, true)"})," - clears KV cache"]})]})]}),e.jsxs("li",{children:["Channel closes, wrapper exits, ",e.jsx("code",{children:"releaseModel()"})," runs"]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Key invariant:"})," ",e.jsx("code",{children:"resetContext()"})," always runs before model release due to defer ordering."]}),e.jsx("h4",{id:"1675-batch-engine-internals",children:"16.7.5 Batch Engine Internals"}),e.jsxs("p",{children:[e.jsx("strong",{children:"ChatStreaming Decision Logic"})," (",e.jsx("code",{children:"chat.go"}),"):"]}),e.jsxs("p",{children:["The ",e.jsx("code",{children:"submitToBatchEngine()"})," function decides the processing path:"]}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-go",children:`// submitToBatchEngine returns false if batch not available.
if m.batch == nil || object != ObjectChatText {
    return false
}
// Submit job to batch engine...
return true`})}),e.jsx("p",{children:"All chat requests (including vision/audio) are submitted to the batch engine:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-go",children:`m.submitToBatchEngine(...)
batching = true`})}),e.jsxs("p",{children:[e.jsx("strong",{children:"Batch Engine Architecture"})," (",e.jsx("code",{children:"batch.go"}),"):"]}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"batchEngine"})," manages ",e.jsx("code",{children:"nSlots"})," parallel ",e.jsx("code",{children:"slot"})," structs"]}),e.jsxs("li",{children:["Each slot tracks: ",e.jsx("code",{children:"seqID"}),", prompt tokens, decode state, sampler, response channel, logprobs, prefill state"]}),e.jsxs("li",{children:["Signal-based wake pattern: ",e.jsx("code",{children:"wakeCh chan struct{}"})," (buffered size 1) wakes immediately on new requests"]}),e.jsx("li",{children:"Polling intervals: 100s (active slots generating), 5ms (idle, no active slots)"})]}),e.jsx("p",{children:e.jsx("strong",{children:"Slots vs Sequences:"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"slot.id"})," = slot index (for logging)"]}),e.jsxs("li",{children:[e.jsx("code",{children:"slot.seqID"})," = llama.cpp sequence ID (determines KV cache partition)"]}),e.jsxs("li",{children:[e.jsx("code",{children:"slot.seqIDs"})," = pre-allocated slice for efficient ",e.jsx("code",{children:"batchAdd"})," calls"]})]}),e.jsx("p",{children:"Sequences are isolated partitions in the shared KV cache memory. Slot seqIDs always start at 0  no sequences are reserved for caching. SPC decodes saved tokens directly into slot sequences. IMC binds each slot's sequence to a conversation."}),e.jsx("h4",{id:"1676-context-pooling",children:"16.7.6 Context Pooling"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"llama.Context"})," is created once in ",e.jsx("code",{children:"NewModel"})," and reused across requests"]}),e.jsxs("li",{children:["Call ",e.jsx("code",{children:"resetContext()"})," between requests to clear KV cache"]}),e.jsx("li",{children:"Avoids Vulkan memory fragmentation from repeated context alloc/dealloc"})]}),e.jsx("h4",{id:"1677-imc-implementation-details",children:"16.7.7 IMC Implementation Details"}),e.jsx("p",{children:e.jsx("strong",{children:"Critical Implementation Details:"})}),e.jsx("ol",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Extension tokenization must use <code>special=true</code>"}),": Use ",e.jsx("code",{children:"llama.Tokenize(vocab, extension, false, true)"})," to ensure ChatML tokens like ",e.jsx("code",{children:"<|im_start|>"})," are recognized."]})}),e.jsx("ol",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"Prefix mismatch detection"}),": Use ",e.jsx("code",{children:"strings.HasPrefix(fullPrompt, prefixPrompt)"})," to detect Jinja template nondeterminism."]})}),e.jsx("ol",{children:e.jsxs("li",{children:[e.jsx("strong",{children:"<code>add_generation_prompt=false</code> for cached prefixes"}),": Creates valid prefix for extension. Generation prompt added only for final suffix."]})}),e.jsx("p",{children:e.jsx("strong",{children:"IMC Algorithm:"})}),e.jsxs("ol",{children:[e.jsxs("li",{children:["First request (cache empty): Cache ",e.jsx("code",{children:"messages[0:len-1]"}),", generate from last message"]}),e.jsxs("li",{children:["Subsequent requests (prefix match): Extend cache with ",e.jsx("code",{children:"messages[cachedCount:len-1]"})]}),e.jsx("li",{children:"New thread (prefix mismatch): Rebuild cache from scratch"})]}),e.jsx("p",{children:e.jsx("strong",{children:"IMC Session State:"})}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:"language-go",children:`type imcSession struct {
    hash      string      // Hash of all cached messages
    tokens    int         // Total tokens in cache
    msgCount  int         // Number of messages cached
    promptLen int         // Length of templated prefix
    seqID     llama.SeqId // Assigned cache sequence ID
    lastUsed  time.Time   // For future eviction
}`})}),e.jsx("h4",{id:"1678-tool-call-internals",children:"16.7.8 Tool Call Internals"}),e.jsxs("p",{children:[e.jsx("strong",{children:"chatMessage Unmarshaling"})," (",e.jsx("code",{children:"models.go"}),"):"]}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"Content"})," can be ",e.jsx("code",{children:"nil"})," for assistant messages with tool_calls"]}),e.jsxs("li",{children:["Handle ",e.jsx("code",{children:'len(app.Content) == 0 || string(app.Content) == "null"'})," as valid empty content"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"ToolCallArguments Type:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Custom type that marshals to JSON string (OpenAI spec)"}),e.jsx("li",{children:"Unmarshals from either string or object for non-compliant clients"})]}),e.jsx("h4",{id:"1679-logprobs-implementation",children:"16.7.9 Logprobs Implementation"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Implementation"})," (",e.jsx("code",{children:"logprobs.go"}),"):"]}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:"extractLogprobs()"}),": Retrieves logits via ",e.jsx("code",{children:"llama.GetLogitsIth()"})]}),e.jsxs("li",{children:[e.jsx("code",{children:"logSoftmax()"}),": Numerically stable log-softmax using log-sum-exp trick"]}),e.jsxs("li",{children:[e.jsx("code",{children:"getTopKLogprobs()"}),": Uses min-heap for efficient O(n log k) top-k extraction"]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Critical:"})," Logprobs must be extracted ",e.jsx("strong",{children:"before"})," ",e.jsx("code",{children:"llama.SamplerAccept()"})," is called."]}),e.jsx("h3",{id:"178-api-handler-notes",children:"17.8 API Handler Notes"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Input Format Conversion"})," (",e.jsx("code",{children:"cmd/server/app/domain/"}),"):"]}),e.jsxs("p",{children:["Both streaming and non-streaming Response APIs must call ",e.jsx("code",{children:"convertInputToMessages(d)"})," to handle the OpenAI Responses ",e.jsx("code",{children:"input"})," field format."]}),e.jsx("h3",{id:"179-goroutine-budget",children:"17.9 Goroutine Budget"}),e.jsx("p",{children:"A running Kronk server typically shows ~25 baseline goroutines before any requests arrive. When requests are active, expect roughly 3-5 additional goroutines per in-flight request. For example, 3 concurrent requests for the same model will show ~40 goroutines total. This is normal."}),e.jsx("p",{children:e.jsx("strong",{children:"Baseline goroutines (~25, always running):"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Source"}),e.jsx("th",{children:"Goroutines"}),e.jsx("th",{children:"Location"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Go runtime (GC, finalizer, netpoller, etc.)"}),e.jsx("td",{children:"~4-6"}),e.jsx("td",{children:"runtime internals"})]}),e.jsxs("tr",{children:[e.jsxs("td",{children:["API ",e.jsx("code",{children:"http.Server"})," (listener + idle conns)"]}),e.jsx("td",{children:"~3"}),e.jsx("td",{children:e.jsx("code",{children:"cmd/server/api/services/kronk/kronk.go"})})]}),e.jsxs("tr",{children:[e.jsxs("td",{children:["Debug ",e.jsx("code",{children:"http.Server"})," (pprof, metrics, statsviz)"]}),e.jsx("td",{children:"~3"}),e.jsx("td",{children:e.jsx("code",{children:"cmd/server/api/services/kronk/kronk.go"})})]}),e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("code",{children:"statsviz.Register"})," (websocket handler)"]}),e.jsx("td",{children:"~2"}),e.jsx("td",{children:e.jsx("code",{children:"cmd/server/app/sdk/debug/debug.go"})})]}),e.jsxs("tr",{children:[e.jsxs("td",{children:["gRPC auth server (",e.jsx("code",{children:"gs.Serve"}),")"]}),e.jsx("td",{children:"~2-3"}),e.jsx("td",{children:e.jsx("code",{children:"cmd/server/app/domain/authapp/start.go"})})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"OTEL background collector probe"}),e.jsx("td",{children:"1"}),e.jsx("td",{children:e.jsx("code",{children:"sdk/kronk/observ/otel/otel.go"})})]}),e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("code",{children:"otelhttp.NewHandler"})," internals"]}),e.jsx("td",{children:"~1-2"}),e.jsx("td",{children:e.jsx("code",{children:"cmd/server/foundation/web/web.go"})})]}),e.jsxs("tr",{children:[e.jsxs("td",{children:["Batch engine ",e.jsx("code",{children:"processLoop"})]}),e.jsx("td",{children:"1"}),e.jsx("td",{children:e.jsx("code",{children:"sdk/kronk/model/batch.go"})})]})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Per-request goroutines (~3-5 each):"})}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Source"}),e.jsx("th",{children:"Location"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("code",{children:"http.Server"})," connection handler"]}),e.jsx("td",{children:"Go stdlib"})]}),e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("code",{children:"ChatStreaming"})," request goroutine"]}),e.jsx("td",{children:e.jsx("code",{children:"sdk/kronk/model/chat.go"})})]}),e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("code",{children:"streaming()"})," wrapper goroutine"]}),e.jsx("td",{children:e.jsx("code",{children:"sdk/kronk/concurrency.go"})})]}),e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("code",{children:"wrapChannelForLogging"})," (only if ",e.jsx("code",{children:"InsecureLogging"})," is on)"]}),e.jsx("td",{children:e.jsx("code",{children:"sdk/kronk/model/chat.go"})})]})]})]}),e.jsxs("p",{children:["The goroutine metric is a point-in-time snapshot from ",e.jsx("code",{children:"runtime.NumGoroutine()"})," captured every 10th request by the metrics middleware. It includes everything in the process, including Go runtime internals. After active requests complete, the count drops back to the baseline."]}),e.jsx("h3",{id:"1710-request-tracing-spans",children:"17.10 Request Tracing Spans"}),e.jsx("p",{children:"Each chat completion request produces the following trace hierarchy:"}),e.jsx("pre",{className:"code-block",children:e.jsx("code",{children:`POST /v1/chat/completions
 prepare-request              Validation, caching, and prompt creation
    process-cache            Cache lookup/update (SPC or IMC, when enabled)
       cache-tokenize-*     Tokenization for cache (spc, imc-extend, imc-scratch)
    create-prompt            Jinja template application

         queue wait           Job sits in requestQ channel until batch engine picks it up

 process-request              Batch engine slot processing
     prefill                  Tokenization + KV cache fill (ends at first output token)
     token-generation         Decode loop producing output tokens`})}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phase 1: prepare-request"})," runs in the ",e.jsx("code",{children:"ChatStreaming"})," goroutine. It validates the document, processes caches (SPC/IMC), and creates the prompt via the Jinja template. When caching is enabled, ",e.jsx("code",{children:"process-cache"})," and its child ",e.jsx("code",{children:"cache-tokenize-*"})," spans appear here."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Queue wait"})," is the gap between ",e.jsx("code",{children:"prepare-request"})," ending and ",e.jsx("code",{children:"process-request"})," starting. The job has been submitted to the batch engine's ",e.jsx("code",{children:"requestQ"})," channel and is waiting for the ",e.jsx("code",{children:"processLoop"})," goroutine to wake up and assign it to a slot. The exact duration is recorded as a ",e.jsx("code",{children:"queue-wait"})," attribute on the ",e.jsx("code",{children:"process-request"})," span."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phase 2: process-request"})," runs in the batch engine's ",e.jsx("code",{children:"processLoop"})," goroutine. The ",e.jsx("code",{children:"prefill"})," span covers tokenization and KV cache filling. Time to first token (TTFT) is measured from prefill start to the first output token. The ",e.jsx("code",{children:"token-generation"})," span covers the decode loop that produces output tokens."]}),e.jsx("p",{children:"Additional spans that may appear at the top level:"}),e.jsxs("table",{className:"flags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Span"}),e.jsx("th",{children:"When"}),e.jsx("th",{children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"model-file-load-time"})}),e.jsx("td",{children:"First request for a model"}),e.jsx("td",{children:"Loading the GGUF model file"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:"proj-file-load-time"})}),e.jsx("td",{children:"Vision/audio requests"}),e.jsx("td",{children:"Loading the multimodal projection file"})]})]})]}),e.jsx("h3",{id:"1711-reference-threads",children:"17.11 Reference Threads"}),e.jsxs("p",{children:["See ",e.jsx("code",{children:"THREADS.md"})," for important past conversations and decisions worth preserving."]})]}),e.jsx("nav",{className:"doc-sidebar",children:e.jsxs("div",{className:"doc-sidebar-content",children:[e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#chapter-1-introduction",className:`doc-index-header ${t==="chapter-1-introduction"?"active":""}`,children:"Chapter 1: Introduction"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#11-what-is-kronk",className:t==="11-what-is-kronk"?"active":"",children:"1.1 What is Kronk"})}),e.jsx("li",{children:e.jsx("a",{href:"#12-key-features",className:t==="12-key-features"?"active":"",children:"1.2 Key Features"})}),e.jsx("li",{children:e.jsx("a",{href:"#13-supported-platforms-and-hardware",className:t==="13-supported-platforms-and-hardware"?"active":"",children:"1.3 Supported Platforms and Hardware"})}),e.jsx("li",{children:e.jsx("a",{href:"#14-architecture-overview",className:t==="14-architecture-overview"?"active":"",children:"1.4 Architecture Overview"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#chapter-2-installation-quick-start",className:`doc-index-header ${t==="chapter-2-installation-quick-start"?"active":""}`,children:"Chapter 2: Installation & Quick Start"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#21-prerequisites",className:t==="21-prerequisites"?"active":"",children:"2.1 Prerequisites"})}),e.jsx("li",{children:e.jsx("a",{href:"#22-installing-the-cli",className:t==="22-installing-the-cli"?"active":"",children:"2.2 Installing the CLI"})}),e.jsx("li",{children:e.jsx("a",{href:"#23-installing-libraries",className:t==="23-installing-libraries"?"active":"",children:"2.3 Installing Libraries"})}),e.jsx("li",{children:e.jsx("a",{href:"#24-downloading-your-first-model",className:t==="24-downloading-your-first-model"?"active":"",children:"2.4 Downloading Your First Model"})}),e.jsx("li",{children:e.jsx("a",{href:"#25-starting-the-server",className:t==="25-starting-the-server"?"active":"",children:"2.5 Starting the Server"})}),e.jsx("li",{children:e.jsx("a",{href:"#26-verifying-the-installation",className:t==="26-verifying-the-installation"?"active":"",children:"2.6 Verifying the Installation"})}),e.jsx("li",{children:e.jsx("a",{href:"#27-quick-start-summary",className:t==="27-quick-start-summary"?"active":"",children:"2.7 Quick Start Summary"})}),e.jsx("li",{children:e.jsx("a",{href:"#28-nixos-setup",className:t==="28-nixos-setup"?"active":"",children:"2.8 NixOS Setup"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#chapter-3-model-configuration",className:`doc-index-header ${t==="chapter-3-model-configuration"?"active":""}`,children:"Chapter 3: Model Configuration"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#31-basic-configuration",className:t==="31-basic-configuration"?"active":"",children:"3.1 Basic Configuration"})}),e.jsx("li",{children:e.jsx("a",{href:"#32-gpu-configuration",className:t==="32-gpu-configuration"?"active":"",children:"3.2 GPU Configuration"})}),e.jsx("li",{children:e.jsx("a",{href:"#33-kv-cache-quantization",className:t==="33-kv-cache-quantization"?"active":"",children:"3.3 KV Cache Quantization"})}),e.jsx("li",{children:e.jsx("a",{href:"#34-flash-attention",className:t==="34-flash-attention"?"active":"",children:"3.4 Flash Attention"})}),e.jsx("li",{children:e.jsx("a",{href:"#35-parallel-inference-nseqmax",className:t==="35-parallel-inference-nseqmax"?"active":"",children:"3.5 Parallel Inference (NSeqMax)"})}),e.jsx("li",{children:e.jsx("a",{href:"#36-understanding-gguf-quantization",className:t==="36-understanding-gguf-quantization"?"active":"",children:"3.6 Understanding GGUF Quantization"})}),e.jsx("li",{children:e.jsx("a",{href:"#37-vram-estimation",className:t==="37-vram-estimation"?"active":"",children:"3.7 VRAM Estimation"})}),e.jsx("li",{children:e.jsx("a",{href:"#38-model-specific-tuning",className:t==="38-model-specific-tuning"?"active":"",children:"3.8 Model-Specific Tuning"})}),e.jsx("li",{children:e.jsx("a",{href:"#39-speculative-decoding",className:t==="39-speculative-decoding"?"active":"",children:"3.9 Speculative Decoding"})}),e.jsx("li",{children:e.jsx("a",{href:"#310-sampling-parameters",className:t==="310-sampling-parameters"?"active":"",children:"3.10 Sampling Parameters"})}),e.jsx("li",{children:e.jsx("a",{href:"#311-model-config-file-example",className:t==="311-model-config-file-example"?"active":"",children:"3.11 Model Config File Example"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#chapter-4-batch-processing",className:`doc-index-header ${t==="chapter-4-batch-processing"?"active":""}`,children:"Chapter 4: Batch Processing"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#41-architecture-overview",className:t==="41-architecture-overview"?"active":"",children:"4.1 Architecture Overview"})}),e.jsx("li",{children:e.jsx("a",{href:"#42-slots-and-sequences",className:t==="42-slots-and-sequences"?"active":"",children:"4.2 Slots and Sequences"})}),e.jsx("li",{children:e.jsx("a",{href:"#43-request-flow",className:t==="43-request-flow"?"active":"",children:"4.3 Request Flow"})}),e.jsx("li",{children:e.jsx("a",{href:"#44-configuring-batch-processing",className:t==="44-configuring-batch-processing"?"active":"",children:"4.4 Configuring Batch Processing"})}),e.jsx("li",{children:e.jsx("a",{href:"#45-concurrency-by-model-type",className:t==="45-concurrency-by-model-type"?"active":"",children:"4.5 Concurrency by Model Type"})}),e.jsx("li",{children:e.jsx("a",{href:"#46-performance-tuning",className:t==="46-performance-tuning"?"active":"",children:"4.6 Performance Tuning"})}),e.jsx("li",{children:e.jsx("a",{href:"#47-example-configuration",className:t==="47-example-configuration"?"active":"",children:"4.7 Example Configuration"})}),e.jsx("li",{children:e.jsx("a",{href:"#48-imc-slot-scheduling",className:t==="48-imc-slot-scheduling"?"active":"",children:"4.8 IMC Slot Scheduling"})}),e.jsx("li",{children:e.jsx("a",{href:"#49-model-types-and-state-management",className:t==="49-model-types-and-state-management"?"active":"",children:"4.9 Model Types and State Management"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#chapter-5-message-caching",className:`doc-index-header ${t==="chapter-5-message-caching"?"active":""}`,children:"Chapter 5: Message Caching"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#51-overview",className:t==="51-overview"?"active":"",children:"5.1 Overview"})}),e.jsx("li",{children:e.jsx("a",{href:"#52-system-prompt-cache-spc",className:t==="52-system-prompt-cache-spc"?"active":"",children:"5.2 System Prompt Cache (SPC)"})}),e.jsx("li",{children:e.jsx("a",{href:"#53-incremental-message-cache-imc",className:t==="53-incremental-message-cache-imc"?"active":"",children:"5.3 Incremental Message Cache (IMC)"})}),e.jsx("li",{children:e.jsx("a",{href:"#54-single-user-caching",className:t==="54-single-user-caching"?"active":"",children:"5.4 Single-User Caching"})}),e.jsx("li",{children:e.jsx("a",{href:"#55-spc-vs-imc",className:t==="55-spc-vs-imc"?"active":"",children:"5.5 SPC vs IMC"})}),e.jsx("li",{children:e.jsx("a",{href:"#56-cache-invalidation",className:t==="56-cache-invalidation"?"active":"",children:"5.6 Cache Invalidation"})}),e.jsx("li",{children:e.jsx("a",{href:"#57-configuration-reference",className:t==="57-configuration-reference"?"active":"",children:"5.7 Configuration Reference"})}),e.jsx("li",{children:e.jsx("a",{href:"#58-performance-and-limitations",className:t==="58-performance-and-limitations"?"active":"",children:"5.8 Performance and Limitations"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#chapter-6-yarn-extended-context",className:`doc-index-header ${t==="chapter-6-yarn-extended-context"?"active":""}`,children:"Chapter 6: YaRN Extended Context"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#61-understanding-context-extension",className:t==="61-understanding-context-extension"?"active":"",children:"6.1 Understanding Context Extension"})}),e.jsx("li",{children:e.jsx("a",{href:"#62-when-to-use-yarn",className:t==="62-when-to-use-yarn"?"active":"",children:"6.2 When to Use YaRN"})}),e.jsx("li",{children:e.jsx("a",{href:"#63-configuration",className:t==="63-configuration"?"active":"",children:"6.3 Configuration"})}),e.jsx("li",{children:e.jsx("a",{href:"#64-scaling-types",className:t==="64-scaling-types"?"active":"",children:"6.4 Scaling Types"})}),e.jsx("li",{children:e.jsx("a",{href:"#65-parameter-reference",className:t==="65-parameter-reference"?"active":"",children:"6.5 Parameter Reference"})}),e.jsx("li",{children:e.jsx("a",{href:"#66-model-specific-examples",className:t==="66-model-specific-examples"?"active":"",children:"6.6 Model-Specific Examples"})}),e.jsx("li",{children:e.jsx("a",{href:"#67-memory-impact",className:t==="67-memory-impact"?"active":"",children:"6.7 Memory Impact"})}),e.jsx("li",{children:e.jsx("a",{href:"#68-quality-considerations",className:t==="68-quality-considerations"?"active":"",children:"6.8 Quality Considerations"})}),e.jsx("li",{children:e.jsx("a",{href:"#69-example-long-document-processing",className:t==="69-example-long-document-processing"?"active":"",children:"6.9 Example: Long Document Processing"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#chapter-7-model-server",className:`doc-index-header ${t==="chapter-7-model-server"?"active":""}`,children:"Chapter 7: Model Server"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#71-starting-the-server",className:t==="71-starting-the-server"?"active":"",children:"7.1 Starting the Server"})}),e.jsx("li",{children:e.jsx("a",{href:"#72-stopping-the-server",className:t==="72-stopping-the-server"?"active":"",children:"7.2 Stopping the Server"})}),e.jsx("li",{children:e.jsx("a",{href:"#73-server-configuration",className:t==="73-server-configuration"?"active":"",children:"7.3 Server Configuration"})}),e.jsx("li",{children:e.jsx("a",{href:"#74-model-caching",className:t==="74-model-caching"?"active":"",children:"7.4 Model Caching"})}),e.jsx("li",{children:e.jsx("a",{href:"#75-model-config-files",className:t==="75-model-config-files"?"active":"",children:"7.5 Model Config Files"})}),e.jsx("li",{children:e.jsx("a",{href:"#76-catalog-system",className:t==="76-catalog-system"?"active":"",children:"7.6 Catalog System"})}),e.jsx("li",{children:e.jsx("a",{href:"#77-custom-catalog-repository",className:t==="77-custom-catalog-repository"?"active":"",children:"7.7 Custom Catalog Repository"})}),e.jsx("li",{children:e.jsx("a",{href:"#78-templates",className:t==="78-templates"?"active":"",children:"7.8 Templates"})}),e.jsx("li",{children:e.jsx("a",{href:"#79-runtime-settings",className:t==="79-runtime-settings"?"active":"",children:"7.9 Runtime Settings"})}),e.jsx("li",{children:e.jsx("a",{href:"#710-logging",className:t==="710-logging"?"active":"",children:"7.10 Logging"})}),e.jsx("li",{children:e.jsx("a",{href:"#711-data-paths",className:t==="711-data-paths"?"active":"",children:"7.11 Data Paths"})}),e.jsx("li",{children:e.jsx("a",{href:"#712-complete-example",className:t==="712-complete-example"?"active":"",children:"7.12 Complete Example"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#chapter-8-api-endpoints",className:`doc-index-header ${t==="chapter-8-api-endpoints"?"active":""}`,children:"Chapter 8: API Endpoints"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#81-endpoint-overview",className:t==="81-endpoint-overview"?"active":"",children:"8.1 Endpoint Overview"})}),e.jsx("li",{children:e.jsx("a",{href:"#82-chat-completions",className:t==="82-chat-completions"?"active":"",children:"8.2 Chat Completions"})}),e.jsx("li",{children:e.jsx("a",{href:"#83-responses-api",className:t==="83-responses-api"?"active":"",children:"8.3 Responses API"})}),e.jsx("li",{children:e.jsx("a",{href:"#84-embeddings",className:t==="84-embeddings"?"active":"",children:"8.4 Embeddings"})}),e.jsx("li",{children:e.jsx("a",{href:"#85-reranking",className:t==="85-reranking"?"active":"",children:"8.5 Reranking"})}),e.jsx("li",{children:e.jsx("a",{href:"#86-tokenize",className:t==="86-tokenize"?"active":"",children:"8.6 Tokenize"})}),e.jsx("li",{children:e.jsx("a",{href:"#87-tool-calling-function-calling",className:t==="87-tool-calling-function-calling"?"active":"",children:"8.7 Tool Calling (Function Calling)"})}),e.jsx("li",{children:e.jsx("a",{href:"#88-models-list",className:t==="88-models-list"?"active":"",children:"8.8 Models List"})}),e.jsx("li",{children:e.jsx("a",{href:"#89-authentication",className:t==="89-authentication"?"active":"",children:"8.9 Authentication"})}),e.jsx("li",{children:e.jsx("a",{href:"#810-error-responses",className:t==="810-error-responses"?"active":"",children:"8.10 Error Responses"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#chapter-9-request-parameters",className:`doc-index-header ${t==="chapter-9-request-parameters"?"active":""}`,children:"Chapter 9: Request Parameters"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#91-sampling-parameters",className:t==="91-sampling-parameters"?"active":"",children:"9.1 Sampling Parameters"})}),e.jsx("li",{children:e.jsx("a",{href:"#92-repetition-control",className:t==="92-repetition-control"?"active":"",children:"9.2 Repetition Control"})}),e.jsx("li",{children:e.jsx("a",{href:"#93-advanced-sampling",className:t==="93-advanced-sampling"?"active":"",children:"9.3 Advanced Sampling"})}),e.jsx("li",{children:e.jsx("a",{href:"#94-generation-control",className:t==="94-generation-control"?"active":"",children:"9.4 Generation Control"})}),e.jsx("li",{children:e.jsx("a",{href:"#95-grammar-constrained-output",className:t==="95-grammar-constrained-output"?"active":"",children:"9.5 Grammar Constrained Output"})}),e.jsx("li",{children:e.jsx("a",{href:"#96-logprobs-token-probabilities",className:t==="96-logprobs-token-probabilities"?"active":"",children:"9.6 Logprobs (Token Probabilities)"})}),e.jsx("li",{children:e.jsx("a",{href:"#97-parameter-reference",className:t==="97-parameter-reference"?"active":"",children:"9.7 Parameter Reference"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#chapter-10-multi-modal-models",className:`doc-index-header ${t==="chapter-10-multi-modal-models"?"active":""}`,children:"Chapter 10: Multi-Modal Models"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#101-overview",className:t==="101-overview"?"active":"",children:"10.1 Overview"})}),e.jsx("li",{children:e.jsx("a",{href:"#102-vision-models",className:t==="102-vision-models"?"active":"",children:"10.2 Vision Models"})}),e.jsx("li",{children:e.jsx("a",{href:"#103-audio-models",className:t==="103-audio-models"?"active":"",children:"10.3 Audio Models"})}),e.jsx("li",{children:e.jsx("a",{href:"#104-plain-base64-format",className:t==="104-plain-base64-format"?"active":"",children:"10.4 Plain Base64 Format"})}),e.jsx("li",{children:e.jsx("a",{href:"#105-configuration-for-multi-modal-models",className:t==="105-configuration-for-multi-modal-models"?"active":"",children:"10.5 Configuration for Multi-Modal Models"})}),e.jsx("li",{children:e.jsx("a",{href:"#106-memory-requirements",className:t==="106-memory-requirements"?"active":"",children:"10.6 Memory Requirements"})}),e.jsx("li",{children:e.jsx("a",{href:"#107-limitations",className:t==="107-limitations"?"active":"",children:"10.7 Limitations"})}),e.jsx("li",{children:e.jsx("a",{href:"#108-example-image-analysis",className:t==="108-example-image-analysis"?"active":"",children:"10.8 Example: Image Analysis"})}),e.jsx("li",{children:e.jsx("a",{href:"#109-example-audio-transcription",className:t==="109-example-audio-transcription"?"active":"",children:"10.9 Example: Audio Transcription"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#chapter-11-security-authentication",className:`doc-index-header ${t==="chapter-11-security-authentication"?"active":""}`,children:"Chapter 11: Security & Authentication"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#111-enabling-authentication",className:t==="111-enabling-authentication"?"active":"",children:"11.1 Enabling Authentication"})}),e.jsx("li",{children:e.jsx("a",{href:"#112-using-the-admin-token",className:t==="112-using-the-admin-token"?"active":"",children:"11.2 Using the Admin Token"})}),e.jsx("li",{children:e.jsx("a",{href:"#113-key-management",className:t==="113-key-management"?"active":"",children:"11.3 Key Management"})}),e.jsx("li",{children:e.jsx("a",{href:"#114-creating-user-tokens",className:t==="114-creating-user-tokens"?"active":"",children:"11.4 Creating User Tokens"})}),e.jsx("li",{children:e.jsx("a",{href:"#115-token-examples",className:t==="115-token-examples"?"active":"",children:"11.5 Token Examples"})}),e.jsx("li",{children:e.jsx("a",{href:"#116-using-tokens-in-api-requests",className:t==="116-using-tokens-in-api-requests"?"active":"",children:"11.6 Using Tokens in API Requests"})}),e.jsx("li",{children:e.jsx("a",{href:"#117-authorization-flow",className:t==="117-authorization-flow"?"active":"",children:"11.7 Authorization Flow"})}),e.jsx("li",{children:e.jsx("a",{href:"#118-rate-limiting",className:t==="118-rate-limiting"?"active":"",children:"11.8 Rate Limiting"})}),e.jsx("li",{children:e.jsx("a",{href:"#119-configuration-reference",className:t==="119-configuration-reference"?"active":"",children:"11.9 Configuration Reference"})}),e.jsx("li",{children:e.jsx("a",{href:"#1110-security-best-practices",className:t==="1110-security-best-practices"?"active":"",children:"11.10 Security Best Practices"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#chapter-12-browser-ui-bui",className:`doc-index-header ${t==="chapter-12-browser-ui-bui"?"active":""}`,children:"Chapter 12: Browser UI (BUI)"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#121-accessing-the-bui",className:t==="121-accessing-the-bui"?"active":"",children:"12.1 Accessing the BUI"})}),e.jsx("li",{children:e.jsx("a",{href:"#122-downloading-libraries",className:t==="122-downloading-libraries"?"active":"",children:"12.2 Downloading Libraries"})}),e.jsx("li",{children:e.jsx("a",{href:"#123-downloading-models",className:t==="123-downloading-models"?"active":"",children:"12.3 Downloading Models"})}),e.jsx("li",{children:e.jsx("a",{href:"#124-managing-keys-and-tokens",className:t==="124-managing-keys-and-tokens"?"active":"",children:"12.4 Managing Keys and Tokens"})}),e.jsx("li",{children:e.jsx("a",{href:"#125-other-screens",className:t==="125-other-screens"?"active":"",children:"12.5 Other Screens"})}),e.jsx("li",{children:e.jsx("a",{href:"#126-model-playground",className:t==="126-model-playground"?"active":"",children:"12.6 Model Playground"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#chapter-13-client-integration",className:`doc-index-header ${t==="chapter-13-client-integration"?"active":""}`,children:"Chapter 13: Client Integration"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#131-openwebui",className:t==="131-openwebui"?"active":"",children:"13.1 OpenWebUI"})}),e.jsx("li",{children:e.jsx("a",{href:"#132-cline",className:t==="132-cline"?"active":"",children:"13.2 Cline"})}),e.jsx("li",{children:e.jsx("a",{href:"#134-python-openai-sdk",className:t==="134-python-openai-sdk"?"active":"",children:"13.4 Python OpenAI SDK"})}),e.jsx("li",{children:e.jsx("a",{href:"#135-curl-and-http-clients",className:t==="135-curl-and-http-clients"?"active":"",children:"13.5 curl and HTTP Clients"})}),e.jsx("li",{children:e.jsx("a",{href:"#136-langchain",className:t==="136-langchain"?"active":"",children:"13.6 LangChain"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#chapter-14-observability",className:`doc-index-header ${t==="chapter-14-observability"?"active":""}`,children:"Chapter 14: Observability"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#141-debug-server",className:t==="141-debug-server"?"active":"",children:"14.1 Debug Server"})}),e.jsx("li",{children:e.jsx("a",{href:"#142-debug-endpoints",className:t==="142-debug-endpoints"?"active":"",children:"14.2 Debug Endpoints"})}),e.jsx("li",{children:e.jsx("a",{href:"#143-health-check-endpoints",className:t==="143-health-check-endpoints"?"active":"",children:"14.3 Health Check Endpoints"})}),e.jsx("li",{children:e.jsx("a",{href:"#144-prometheus-metrics",className:t==="144-prometheus-metrics"?"active":"",children:"14.4 Prometheus Metrics"})}),e.jsx("li",{children:e.jsx("a",{href:"#145-prometheus-integration",className:t==="145-prometheus-integration"?"active":"",children:"14.5 Prometheus Integration"})}),e.jsx("li",{children:e.jsx("a",{href:"#146-distributed-tracing-with-tempo",className:t==="146-distributed-tracing-with-tempo"?"active":"",children:"14.6 Distributed Tracing with Tempo"})}),e.jsx("li",{children:e.jsx("a",{href:"#147-tracing-architecture",className:t==="147-tracing-architecture"?"active":"",children:"14.7 Tracing Architecture"})}),e.jsx("li",{children:e.jsx("a",{href:"#148-tempo-setup-with-docker",className:t==="148-tempo-setup-with-docker"?"active":"",children:"14.8 Tempo Setup with Docker"})}),e.jsx("li",{children:e.jsx("a",{href:"#149-pprof-profiling",className:t==="149-pprof-profiling"?"active":"",children:"14.9 pprof Profiling"})}),e.jsx("li",{children:e.jsx("a",{href:"#1410-statsviz-real-time-monitoring",className:t==="1410-statsviz-real-time-monitoring"?"active":"",children:"14.10 Statsviz Real-Time Monitoring"})}),e.jsx("li",{children:e.jsx("a",{href:"#1411-logging",className:t==="1411-logging"?"active":"",children:"14.11 Logging"})}),e.jsx("li",{children:e.jsx("a",{href:"#1412-configuration-reference",className:t==="1412-configuration-reference"?"active":"",children:"14.12 Configuration Reference"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#chapter-15-mcp-service",className:`doc-index-header ${t==="chapter-15-mcp-service"?"active":""}`,children:"Chapter 15: MCP Service"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#151-architecture",className:t==="151-architecture"?"active":"",children:"15.1 Architecture"})}),e.jsx("li",{children:e.jsx("a",{href:"#152-prerequisites",className:t==="152-prerequisites"?"active":"",children:"15.2 Prerequisites"})}),e.jsx("li",{children:e.jsx("a",{href:"#153-configuration",className:t==="153-configuration"?"active":"",children:"15.3 Configuration"})}),e.jsx("li",{children:e.jsx("a",{href:"#154-available-tools",className:t==="154-available-tools"?"active":"",children:"15.4 Available Tools"})}),e.jsx("li",{children:e.jsx("a",{href:"#155-client-configuration",className:t==="155-client-configuration"?"active":"",children:"15.5 Client Configuration"})}),e.jsx("li",{children:e.jsx("a",{href:"#156-testing-with-curl",className:t==="156-testing-with-curl"?"active":"",children:"15.6 Testing with curl"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#chapter-16-troubleshooting",className:`doc-index-header ${t==="chapter-16-troubleshooting"?"active":""}`,children:"Chapter 16: Troubleshooting"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#161-library-issues",className:t==="161-library-issues"?"active":"",children:"16.1 Library Issues"})}),e.jsx("li",{children:e.jsx("a",{href:"#162-model-loading-failures",className:t==="162-model-loading-failures"?"active":"",children:"16.2 Model Loading Failures"})}),e.jsx("li",{children:e.jsx("a",{href:"#163-memory-errors",className:t==="163-memory-errors"?"active":"",children:"16.3 Memory Errors"})}),e.jsx("li",{children:e.jsx("a",{href:"#164-request-timeouts",className:t==="164-request-timeouts"?"active":"",children:"16.4 Request Timeouts"})}),e.jsx("li",{children:e.jsx("a",{href:"#165-authentication-errors",className:t==="165-authentication-errors"?"active":"",children:"16.5 Authentication Errors"})}),e.jsx("li",{children:e.jsx("a",{href:"#166-streaming-issues",className:t==="166-streaming-issues"?"active":"",children:"16.6 Streaming Issues"})}),e.jsx("li",{children:e.jsx("a",{href:"#167-performance-issues",className:t==="167-performance-issues"?"active":"",children:"16.7 Performance Issues"})}),e.jsx("li",{children:e.jsx("a",{href:"#168-viewing-logs",className:t==="168-viewing-logs"?"active":"",children:"16.8 Viewing Logs"})}),e.jsx("li",{children:e.jsx("a",{href:"#169-common-error-messages",className:t==="169-common-error-messages"?"active":"",children:"16.9 Common Error Messages"})}),e.jsx("li",{children:e.jsx("a",{href:"#1610-getting-help",className:t==="1610-getting-help"?"active":"",children:"16.10 Getting Help"})})]})]}),e.jsxs("div",{className:"doc-index-section",children:[e.jsx("a",{href:"#chapter-17-developer-guide",className:`doc-index-header ${t==="chapter-17-developer-guide"?"active":""}`,children:"Chapter 17: Developer Guide"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:"#171-quick-reference",className:t==="171-quick-reference"?"active":"",children:"17.1 Quick Reference"})}),e.jsx("li",{children:e.jsx("a",{href:"#172-build-test-commands",className:t==="172-build-test-commands"?"active":"",children:"17.2 Build & Test Commands"})}),e.jsx("li",{children:e.jsx("a",{href:"#173-developer-setup",className:t==="173-developer-setup"?"active":"",children:"17.3 Developer Setup"})}),e.jsx("li",{children:e.jsx("a",{href:"#174-project-architecture",className:t==="174-project-architecture"?"active":"",children:"17.4 Project Architecture"})}),e.jsx("li",{children:e.jsx("a",{href:"#175-bui-frontend-development",className:t==="175-bui-frontend-development"?"active":"",children:"17.5 BUI Frontend Development"})}),e.jsx("li",{children:e.jsx("a",{href:"#176-code-style-guidelines",className:t==="176-code-style-guidelines"?"active":"",children:"17.6 Code Style Guidelines"})}),e.jsx("li",{children:e.jsx("a",{href:"#177-sdk-internals",className:t==="177-sdk-internals"?"active":"",children:"17.7 SDK Internals"})}),e.jsx("li",{children:e.jsx("a",{href:"#178-api-handler-notes",className:t==="178-api-handler-notes"?"active":"",children:"17.8 API Handler Notes"})}),e.jsx("li",{children:e.jsx("a",{href:"#179-goroutine-budget",className:t==="179-goroutine-budget"?"active":"",children:"17.9 Goroutine Budget"})}),e.jsx("li",{children:e.jsx("a",{href:"#1710-request-tracing-spans",className:t==="1710-request-tracing-spans"?"active":"",children:"17.10 Request Tracing Spans"})}),e.jsx("li",{children:e.jsx("a",{href:"#1711-reference-threads",className:t==="1711-reference-threads"?"active":"",children:"17.11 Reference Threads"})})]})]})]})})]})]})}const eE=`VRAM CALCULATION FORMULA

Total VRAM = Model Weights + KV Cache

Model weights are determined by the GGUF file size (e.g., ~8GB for a
7B Q8_0 model). The KV cache is the variable cost you control through
configuration.

==============================================================================
SLOTS AND SEQUENCES
==============================================================================

A slot is a processing unit that handles one request at a time. Each slot
is assigned a unique sequence ID that maps to an isolated partition in the
shared KV cache. The mapping is always 1:1:

  NSeqMax = 4 (set via n_seq_max in model config)

  Slot 0    Sequence 0    KV cache partition 0
  Slot 1    Sequence 1    KV cache partition 1
  Slot 2    Sequence 2    KV cache partition 2
  Slot 3    Sequence 3    KV cache partition 3

NSeqMax controls how many slots (and sequences) are created. More slots
means more concurrent requests, but each slot reserves its own KV cache
partition in VRAM whether or not it is actively used.

==============================================================================
WHAT AFFECTS KV CACHE MEMORY PER SEQUENCE
==============================================================================

Each sequence's KV cache partition size is determined by three factors:

  1. Context Window (n_ctx)
     The maximum number of tokens the sequence can hold. Larger context
     windows linearly increase memory. 32K context uses 4 the memory
     of 8K context.

  2. Number of Layers (block_count)
     Every transformer layer stores its own key and value tensors per
     token. More layers means more memory per token. A 70B model with
     80 layers uses ~2.5 more per-token memory than a 7B model with
     32 layers.

  3. KV Cache Precision (bytes_per_element)
     The data type used to store cached keys and values:
       f16  = 2 bytes per element (default, best quality)
       q8_0 = 1 byte per element  (50% VRAM savings, good quality)
     The head geometry (head_count_kv, key_length, value_length) is
     fixed by the model architecture and read from the GGUF header.

The formula:

  KV_Per_Token_Per_Layer = head_count_kv  (key_length + value_length)  bytes_per_element
  KV_Per_Sequence        = n_ctx  n_layers  KV_Per_Token_Per_Layer

==============================================================================
WHAT AFFECTS TOTAL KV CACHE (SLOT MEMORY)
==============================================================================

Total KV cache (Slot Memory) is simply the per-sequence cost multiplied
by the number of slots:

  Slot_Memory = NSeqMax  KV_Per_Sequence
  Total_VRAM  = Model_Weights + Slot_Memory

Memory is statically allocated upfront when the model loads. All slots
reserve their full KV cache partition regardless of whether they are
actively processing a request.

==============================================================================
EXAMPLE: REAL MODEL CALCULATION
==============================================================================

Model                   : Qwen3-Coder-30B-A3B-Instruct-UD-Q8_K_XL
Model Weights           : 36.0 GB
Context Window (n_ctx)  : 131,072 (128K)
Bytes Per Element       : 1 (q8_0)
block_count (n_layers)  : 48
attention.head_count_kv : 4
attention.key_length    : 128
attention.value_length  : 128

Step 1  Per-token-per-layer cost:

  KV_Per_Token_Per_Layer = 4  (128 + 128)  1 = 1,024 bytes

Step 2  Per-sequence cost:

  KV_Per_Sequence = 131,072  48  1,024 = ~6.4 GB

Step 3  Total KV cache (NSeqMax = 2):

  Slot_Memory = 2  6.4 GB = ~12.8 GB

Step 4  Total VRAM:

  Total_VRAM = 36.0 GB + 12.8 GB = ~48.8 GB`,tE=[{value:1024,label:"1K"},{value:2048,label:"2K"},{value:4096,label:"4K"},{value:8192,label:"8K"},{value:16384,label:"16K"},{value:32768,label:"32K"},{value:65536,label:"64K"},{value:98304,label:"96K"},{value:131072,label:"128K"},{value:262144,label:"256K"}],nE=[{value:4,label:"f32 (4 bytes)"},{value:2,label:"f16 / bf16 (2 bytes)"},{value:1,label:"q8_0 / q4_0 / q4_1 / q5_0 / q5_1 (1 byte)"}],rE=[1,2,3,4,5];function Li(t){if(t===0)return"0 B";const n=1e3,r=["B","KB","MB","GB","TB"],s=Math.floor(Math.log(t)/Math.log(n));return`${(t/Math.pow(n,s)).toFixed(2)} ${r[s]}`}function sE(){const{token:t}=hi(),[n,r]=y.useState(""),[s,i]=y.useState(8192),[l,o]=y.useState(1),[a,c]=y.useState(2),[d,u]=y.useState(!1),[h,m]=y.useState(null),[x,j]=y.useState(null),[b,N]=y.useState(!1),f=y.useRef(!1),p=y.useCallback(async(k=!0)=>{if(!n.trim()){m("Please enter a model URL");return}u(!0),m(null),k&&j(null);try{const S=await fe.calculateVRAM({model_url:n.trim(),context_window:s,bytes_per_element:l,slots:a},t||void 0);j(S),f.current=!0}catch(S){m(S instanceof Error?S.message:"Failed to calculate VRAM")}finally{u(!1)}},[n,s,l,a,t]);y.useEffect(()=>{f.current&&n.trim()&&p(!1)},[s,l,a]);const g=async k=>{k.preventDefault(),await p()};return e.jsxs("div",{className:"page",children:[e.jsxs("div",{className:"page-header-with-action",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"VRAM Calculator"}),e.jsx("p",{className:"page-description",children:"Calculate VRAM requirements for a model from HuggingFace. Only the model header is fetched, not the entire file."})]}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>N(!0),children:"Learn More"})]}),b&&e.jsx("div",{className:"modal-overlay",onClick:()=>N(!1),children:e.jsxs("div",{className:"modal-content modal-large",onClick:k=>k.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"VRAM Calculation Formula"}),e.jsx("button",{className:"modal-close",onClick:()=>N(!1),"aria-label":"Close",children:""})]}),e.jsx("div",{className:"modal-body",children:e.jsx("pre",{className:"vram-formula-content",children:eE})})]})}),e.jsxs("form",{onSubmit:g,className:"form-card",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"modelUrl",children:["Ex. https://huggingface.co/Qwen/Qwen3-8B-GGUF/resolve/main/Qwen3-8B-Q8_0.gguf",e.jsx("br",{}),"Ex. https://huggingface.co/unsloth/Qwen3-Coder-Next-GGUF/tree/main/UD-Q5_K_XL (split models)",e.jsx("br",{}),e.jsx("br",{}),"Model URL (download link, org/family/file, or folder for split models)"]}),e.jsx("input",{id:"modelUrl",type:"text",value:n,onChange:k=>r(k.target.value),placeholder:"https://huggingface.co/Qwen/Qwen3-8B-GGUF/resolve/main/Qwen3-8B-Q8_0.gguf",className:"form-input"}),e.jsx("small",{className:"form-hint",children:"Enter a HuggingFace URL to a GGUF model file, or a folder URL for split models"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"contextWindow",children:"Context Window"}),e.jsx("select",{id:"contextWindow",value:s,onChange:k=>i(Number(k.target.value)),className:"form-select",children:tE.map(k=>e.jsxs("option",{value:k.value,children:[k.label," (",k.value.toLocaleString()," tokens)"]},k.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"bytesPerElement",children:"Cache Type (Bytes Per Element)"}),e.jsx("select",{id:"bytesPerElement",value:l,onChange:k=>o(Number(k.target.value)),className:"form-select",children:nE.map(k=>e.jsx("option",{value:k.value,children:k.label},k.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"slots",children:"Slots (Concurrent Sequences)"}),e.jsx("select",{id:"slots",value:a,onChange:k=>c(Number(k.target.value)),className:"form-select",children:rE.map(k=>e.jsx("option",{value:k,children:k},k))})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:d,children:d?"Calculating...":"Calculate VRAM"})]}),h&&e.jsx("div",{className:"alert alert-error",children:h}),x&&e.jsxs("div",{className:"card vram-results",children:[e.jsx("h3",{children:"VRAM Calculation Results"}),e.jsxs("div",{className:"vram-results-grid",children:[e.jsxs("div",{className:"vram-result-item",children:[e.jsx("span",{className:"vram-result-label",children:"Total VRAM Required"}),e.jsx("span",{className:"vram-result-value vram-result-total",children:Li(x.total_vram)})]}),e.jsxs("div",{className:"vram-result-item",children:[e.jsx("span",{className:"vram-result-label",children:"Slot Memory (KV Cache)"}),e.jsx("span",{className:"vram-result-value",children:Li(x.slot_memory)})]}),e.jsxs("div",{className:"vram-result-item",children:[e.jsx("span",{className:"vram-result-label",children:"KV Per Slot"}),e.jsx("span",{className:"vram-result-value",children:Li(x.kv_per_slot)})]}),e.jsxs("div",{className:"vram-result-item",children:[e.jsx("span",{className:"vram-result-label",children:"KV Per Token Per Layer"}),e.jsx("span",{className:"vram-result-value",children:Li(x.kv_per_token_per_layer)})]}),e.jsxs("div",{className:"vram-result-item",children:[e.jsx("span",{className:"vram-result-label",children:"Context Window (Used)"}),e.jsxs("span",{className:"vram-result-value",children:[x.input.context_window.toLocaleString()," tokens"]})]})]}),e.jsx("h4",{style:{marginTop:"2rem"},children:"Model Metadata (from GGUF header)"}),e.jsxs("div",{className:"vram-results-grid",children:[e.jsxs("div",{className:"vram-result-item",children:[e.jsx("span",{className:"vram-result-label",children:"Model Size"}),e.jsx("span",{className:"vram-result-value",children:Li(x.input.model_size_bytes)})]}),e.jsxs("div",{className:"vram-result-item",children:[e.jsx("span",{className:"vram-result-label",children:"Block Count (Layers)"}),e.jsx("span",{className:"vram-result-value",children:x.input.block_count})]}),e.jsxs("div",{className:"vram-result-item",children:[e.jsx("span",{className:"vram-result-label",children:"Head Count KV"}),e.jsx("span",{className:"vram-result-value",children:x.input.head_count_kv})]}),e.jsxs("div",{className:"vram-result-item",children:[e.jsx("span",{className:"vram-result-label",children:"Key Length"}),e.jsx("span",{className:"vram-result-value",children:x.input.key_length})]}),e.jsxs("div",{className:"vram-result-item",children:[e.jsx("span",{className:"vram-result-label",children:"Value Length"}),e.jsx("span",{className:"vram-result-value",children:x.input.value_length})]})]})]})]})}const sy=y.createContext(null);function iE({children:t}){const[n,r]=y.useState(null),[s,i]=y.useState([]),[l,o]=y.useState(""),[a,c]=y.useState("automated"),[d,u]=y.useState("chat"),[h,m]=y.useState("You are a helpful assistant."),[x,j]=y.useState(null),[b,N]=y.useState("builtin"),[f,p]=y.useState(""),[g,k]=y.useState(""),[S,_]=y.useState(8192),[E,D]=y.useState(2048),[L,T]=y.useState(512),[P,I]=y.useState(1),[O,X]=y.useState("auto"),[J,re]=y.useState(""),[ne,A]=y.useState("none"),[B,v]=y.useState(""),F=y.useMemo(()=>({session:n,setSession:r,chatMessages:s,setChatMessages:i,selectedModel:l,setSelectedModel:o,playgroundMode:a,setPlaygroundMode:c,activeTab:d,setActiveTab:u,systemPrompt:h,setSystemPrompt:m,lastTPS:x,setLastTPS:j,templateMode:b,setTemplateMode:N,selectedTemplate:f,setSelectedTemplate:p,customScript:g,setCustomScript:k,contextWindow:S,setContextWindow:_,nBatch:E,setNBatch:D,nUBatch:L,setNUBatch:T,nSeqMax:P,setNSeqMax:I,flashAttention:O,setFlashAttention:X,cacheType:J,setCacheType:re,cacheMode:ne,setCacheMode:A,hydratedModelId:B,setHydratedModelId:v}),[n,s,l,a,d,h,x,b,f,g,S,E,L,P,O,J,ne,B]);return e.jsx(sy.Provider,{value:F,children:t})}function lE(){const t=y.useContext(sy);if(!t)throw new Error("usePlayground must be used within a PlaygroundProvider");return t}const oE=[{kind:"sampling",label:"Sampling Sweep"},{kind:"config",label:"Config Sweep"}];function gn(t){if(!Number.isFinite(t))return"";const n=Math.max(0,Math.round(t));if(n<1e3)return`${n}ms`;const r=Math.floor(n/36e5),s=Math.floor(n%36e5/6e4),i=Math.floor(n%6e4/1e3),l=n%1e3;return r>0?`${r}h ${s}m ${i}s ${l}ms`:s>0?`${s}m ${i}s ${l}ms`:`${i}s ${l}ms`}function _s(t){return t>=80?"#2e7d32":t>=50?"#f9a825":"#c62828"}function iy(t){return _s(t??0)}function nl(t){return t!==void 0&&Number.isFinite(t)?t.toFixed(1):""}function jr(t,n){var r;return(r=t.scenarioResults.find(s=>s.scenarioId===n))==null?void 0:r.score}function ex(t){var n;return(n=t.scenarioResults.find(r=>r.avgTPS!==void 0))==null?void 0:n.avgTPS}function aE(t){var n;return(n=t.scenarioResults.find(r=>r.avgTTFT!==void 0))==null?void 0:n.avgTTFT}function cE(t,n){var r,s;return(s=(r=t.scenarioResults.find(i=>{var l;return((l=i.avgTPSByFill)==null?void 0:l[n])!==void 0}))==null?void 0:r.avgTPSByFill)==null?void 0:s[n]}function dE(t,n){var r,s;return(s=(r=t.scenarioResults.find(i=>{var l;return((l=i.avgTTFTByFill)==null?void 0:l[n])!==void 0}))==null?void 0:r.avgTTFTByFill)==null?void 0:s[n]}function tx(t){const n=t.startedAt?Date.parse(t.startedAt):NaN;return Number.isFinite(n)?(t.finishedAt?Date.parse(t.finishedAt):Date.now())-n:void 0}function ly(t,n,r,s){return r?s?`Error: ${s}`:"Error":t.status==="failed"?"Failed":n.isInProgress?"Running":t.status==="skipped"?"Skipped":t.status==="queued"?"Queued":n.isPending?"":"OK"}function oy(t,n,r){return r?{color:"#c62828",fontSize:"0.85em"}:t.status==="failed"?{color:"#c62828",fontSize:"0.85em"}:n.isInProgress?{color:"#1565c0"}:t.status==="skipped"?{color:"#9e9e9e",fontStyle:"italic",fontSize:"0.85em"}:t.status==="queued"?{color:"#999"}:n.isPending?{color:"#666"}:{color:"#2e7d32"}}const si=["0%","20%","50%","80%"];function ay(){const t=si.map(r=>({id:`tps_${r.replace("%","")}`,title:`TPS @${r}`,sortable:!0,getValue:s=>{var i;return((i=s.avgTPSByFill)==null?void 0:i[r])??cE(s,r)},renderCell:(s,i)=>{var l,o;return i.isPending?"":((o=(l=s.avgTPSByFill)==null?void 0:l[r])==null?void 0:o.toFixed(1))??""}})),n=si.map(r=>({id:`ttft_${r.replace("%","")}`,title:`TTFT @${r}`,sortable:!0,getValue:s=>{var i;return((i=s.avgTTFTByFill)==null?void 0:i[r])??dE(s,r)},renderCell:(s,i)=>{var l;return i.isPending?"":((l=s.avgTTFTByFill)==null?void 0:l[r])!==void 0?gn(s.avgTTFTByFill[r]):""}}));return[{id:"avg_tps",title:"Avg TPS",sortable:!0,getValue:r=>r.avgTPS??ex(r),renderCell:(r,s)=>{var i;if(s.isPending){const l=ex(r);return l!==void 0?`~${l.toFixed(1)}`:""}return((i=r.avgTPS)==null?void 0:i.toFixed(1))??""}},{id:"avg_ttft",title:"Avg TTFT",sortable:!0,getValue:r=>r.avgTTFT??aE(r),renderCell:(r,s)=>s.isPending?"":r.avgTTFT!==void 0?gn(r.avgTTFT):""},...t,...n]}function hE(){return{id:"status",title:"Status",sortable:!0,getValue:t=>t.status,renderCell:(t,n)=>e.jsx("span",{style:oy(t,n,t.status==="failed"),children:ly(t,n,t.status==="failed")})}}function uE(){return{id:"status",title:"Status",sortable:!0,getValue:t=>t.error?"error":t.status,renderCell:(t,n)=>e.jsx("span",{style:oy(t,n,!!t.error),children:ly(t,n,!!t.error,t.error)})}}function cy(){return{id:"duration",title:"Duration",sortable:!0,getValue:t=>tx(t),renderCell:t=>{const n=tx(t);return n!==void 0?gn(n):""}}}function mE(){return[{id:"temperature",title:"Temperature",sortable:!0,getValue:t=>t.candidate.temperature,renderCell:t=>t.candidate.temperature??""},{id:"top_p",title:"Top P",sortable:!0,getValue:t=>t.candidate.top_p,renderCell:t=>t.candidate.top_p??""},{id:"top_k",title:"Top K",sortable:!0,getValue:t=>t.candidate.top_k,renderCell:t=>t.candidate.top_k??""},{id:"min_p",title:"Min P",sortable:!0,getValue:t=>t.candidate.min_p,renderCell:t=>t.candidate.min_p??""}]}function pE(){return[{id:"chat_score",title:"Chat Score",sortable:!0,getValue:t=>jr(t,"chat"),renderCell:(t,n)=>{const r=n.isInProgress?jr(t,"chat"):void 0;if(n.isPending)return r!==void 0?e.jsxs("span",{style:{color:_s(r),opacity:.7},children:["~",r.toFixed(1)]}):"";const s=jr(t,"chat");return e.jsx("span",{style:{color:_s(s??0)},children:(s==null?void 0:s.toFixed(1))??""})}},{id:"tool_score",title:"Tool Score",sortable:!0,getValue:t=>jr(t,"tool_call"),renderCell:(t,n)=>{const r=n.isInProgress?jr(t,"tool_call"):void 0;if(n.isPending)return r!==void 0?e.jsxs("span",{style:{color:_s(r),opacity:.7},children:["~",r.toFixed(1)]}):"";const s=jr(t,"tool_call");return e.jsx("span",{style:{color:_s(s??0)},children:(s==null?void 0:s.toFixed(1))??""})}},{id:"total_score",title:"Total Score",sortable:!0,getValue:t=>t.totalScore,renderCell:(t,n)=>{var r;return n.isPending?"":e.jsx("span",{style:{color:_s(t.totalScore??0)},children:((r=t.totalScore)==null?void 0:r.toFixed(1))??""})}}]}function xE(){return[{id:"context_window",title:"Context Window",sortable:!0,getValue:t=>{var n;return(n=t.config)==null?void 0:n.context_window},renderCell:t=>{var n;return((n=t.config)==null?void 0:n.context_window)??""}},{id:"nbatch",title:"NBatch",sortable:!0,getValue:t=>{var n;return(n=t.config)==null?void 0:n.nbatch},renderCell:t=>{var n;return((n=t.config)==null?void 0:n.nbatch)??""}},{id:"nubatch",title:"NUBatch",sortable:!0,getValue:t=>{var n;return(n=t.config)==null?void 0:n.nubatch},renderCell:t=>{var n;return((n=t.config)==null?void 0:n.nubatch)??""}},{id:"nseq_max",title:"NSeqMax",sortable:!0,getValue:t=>{var n;return(n=t.config)==null?void 0:n.nseq_max},renderCell:t=>{var n;return((n=t.config)==null?void 0:n.nseq_max)??""}},{id:"flash_attention",title:"Flash Attn",sortable:!0,getValue:t=>{var n;return(n=t.config)==null?void 0:n.flash_attention},renderCell:t=>{var n;return((n=t.config)==null?void 0:n.flash_attention)??""}},{id:"cache_type",title:"KV Cache",sortable:!0,getValue:t=>{var n;return(n=t.config)==null?void 0:n.cache_type},renderCell:t=>{var n;return((n=t.config)==null?void 0:n.cache_type)??""}},{id:"cache_mode",title:"Cache",sortable:!0,getValue:t=>{var n;return(n=t.config)==null?void 0:n.cache_mode},renderCell:t=>{var r;const n=(r=t.config)==null?void 0:r.cache_mode;return n?n==="none"?"None":n.toUpperCase():""}}]}function dy(){return[...mE(),hE(),cy(),...pE(),...ay()]}function hy(){return[...xE(),uE(),cy(),...ay()]}const ql={temperature:{validMin:0,validMax:2,defaultStep:.1},top_p:{validMin:0,validMax:1,defaultStep:.1},top_k:{validMin:0,validMax:200,defaultStep:10},min_p:{validMin:0,validMax:1,defaultStep:.05},repeat_penalty:{validMin:0,validMax:3,defaultStep:.1},repeat_last_n:{validMin:0,validMax:2048,defaultStep:64},frequency_penalty:{validMin:-2,validMax:2,defaultStep:.1},presence_penalty:{validMin:-2,validMax:2,defaultStep:.1},dry_multiplier:{validMin:0,validMax:5,defaultStep:.1},dry_base:{validMin:1,validMax:3,defaultStep:.25},dry_allowed_length:{validMin:0,validMax:100,defaultStep:1},dry_penalty_last_n:{validMin:0,validMax:2048,defaultStep:64},xtc_probability:{validMin:0,validMax:1,defaultStep:.1},xtc_threshold:{validMin:0,validMax:1,defaultStep:.1},xtc_min_keep:{validMin:1,validMax:100,defaultStep:1},max_tokens:{validMin:1,validMax:131072,defaultStep:512}};function jo({title:t,entries:n,sweepInputs:r,setSweepInputs:s,commitTriple:i,catalogSampling:l,isRunning:o}){return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"playground-sweep-group-title",children:t}),n.map(([a,c])=>{const d=ql[a],u=r[a];return e.jsxs("div",{className:"playground-sweep-param",children:[e.jsxs("label",{className:"playground-sweep-param-toggle",children:[c,ye[a]&&e.jsx(be,{text:ye[a]}),l&&l[a]!==void 0&&e.jsxs("span",{className:"sweep-catalog-hint",title:"Default catalog value",children:["(default: ",l[a],")"]})]}),e.jsxs("div",{className:"playground-sweep-param-range",children:[e.jsxs("div",{className:"playground-sweep-param-range-field",children:[e.jsxs("span",{className:"playground-sweep-param-range-label",children:["Min (",d.validMin,")"]}),e.jsx("input",{type:"number",value:u.min,min:d.validMin,max:d.validMax,step:d.defaultStep,onChange:h=>s(m=>({...m,[a]:{...m[a],min:h.target.value}})),onBlur:()=>i(a),onKeyDown:h=>h.key==="Enter"&&h.currentTarget.blur(),disabled:o})]}),e.jsxs("div",{className:"playground-sweep-param-range-field",children:[e.jsxs("span",{className:"playground-sweep-param-range-label",children:["Max (",d.validMax,")"]}),e.jsx("input",{type:"number",value:u.max,min:d.validMin,max:d.validMax,step:d.defaultStep,onChange:h=>s(m=>({...m,[a]:{...m[a],max:h.target.value}})),onBlur:()=>i(a),onKeyDown:h=>h.key==="Enter"&&h.currentTarget.blur(),disabled:o})]}),e.jsxs("div",{className:"playground-sweep-param-range-field",children:[e.jsxs("span",{className:"playground-sweep-param-range-label",children:["Step (",d.defaultStep,")"]}),e.jsx("input",{type:"number",value:u.step,min:0,step:d.defaultStep,onChange:h=>s(m=>({...m,[a]:{...m[a],step:h.target.value}})),onBlur:()=>i(a),onKeyDown:h=>h.key==="Enter"&&h.currentTarget.blur(),disabled:o})]})]})]},a)})]})}function fE({sweepDef:t,setSweepDef:n,sweepInputs:r,setSweepInputs:s,commitTriple:i,setSweepDirty:l,catalogSampling:o,isRunning:a,trialCount:c}){return e.jsxs("div",{className:"playground-autotest-section",children:[e.jsx("h4",{children:"Sampling Sweep Parameters"}),e.jsx("p",{style:{fontSize:12,color:"var(--color-gray-600)",marginBottom:8},children:"Set min, max, and step values to define the sweep range. Set min = max for no sweep."}),e.jsxs("div",{className:"playground-sweep-params",children:[e.jsx(jo,{title:"Generation",entries:[["temperature","Temperature"],["top_p","Top P"],["top_k","Top K"],["min_p","Min P"]],sweepInputs:r,setSweepInputs:s,commitTriple:i,catalogSampling:o,isRunning:a}),e.jsx(jo,{title:"Repetition Control",entries:[["repeat_penalty","Repeat Penalty"],["repeat_last_n","Repeat Last N"],["frequency_penalty","Frequency Penalty"],["presence_penalty","Presence Penalty"]],sweepInputs:r,setSweepInputs:s,commitTriple:i,catalogSampling:o,isRunning:a}),e.jsx(jo,{title:"DRY Sampler",entries:[["dry_multiplier","DRY Multiplier"],["dry_base","DRY Base"],["dry_allowed_length","DRY Allowed Length"],["dry_penalty_last_n","DRY Penalty Last N"]],sweepInputs:r,setSweepInputs:s,commitTriple:i,catalogSampling:o,isRunning:a}),e.jsx(jo,{title:"XTC Sampler",entries:[["xtc_probability","XTC Probability"],["xtc_threshold","XTC Threshold"],["xtc_min_keep","XTC Min Keep"]],sweepInputs:r,setSweepInputs:s,commitTriple:i,catalogSampling:o,isRunning:a}),e.jsx("div",{className:"playground-sweep-group-title",children:"Reasoning"}),e.jsxs("div",{className:"playground-sweep-param",children:[e.jsxs("label",{className:"playground-sweep-param-toggle",children:["Enable Thinking",e.jsx(be,{text:ye.enable_thinking}),(o==null?void 0:o.enable_thinking)&&e.jsxs("span",{className:"sweep-catalog-hint",title:"Default catalog value",children:[" ",o.enable_thinking==="true"?"Enabled":"Disabled"]})]}),e.jsx("div",{className:"playground-sweep-option-checks",children:["true","false"].map(d=>e.jsxs("label",{className:"playground-sweep-option-label",children:[e.jsx("input",{type:"checkbox",checked:t.enable_thinking.includes(d),onChange:u=>{n(h=>{const m=h.enable_thinking,x=u.target.checked?[...m,d]:m.filter(j=>j!==d);return{...h,enable_thinking:x.length>0?x:m}}),l(!0)},disabled:a}),d==="true"?"Enabled":"Disabled"]},d))})]}),e.jsxs("div",{className:"playground-sweep-param",children:[e.jsxs("label",{className:"playground-sweep-param-toggle",children:["Reasoning Effort",e.jsx(be,{text:ye.reasoning_effort}),(o==null?void 0:o.reasoning_effort)&&e.jsxs("span",{className:"sweep-catalog-hint",title:"Default catalog value",children:[" ",o.reasoning_effort]})]}),e.jsx("div",{className:"playground-sweep-option-checks",children:["none","minimal","low","medium","high"].map(d=>e.jsxs("label",{className:"playground-sweep-option-label",children:[e.jsx("input",{type:"checkbox",checked:t.reasoning_effort.includes(d),onChange:u=>{n(h=>{const m=h.reasoning_effort,x=u.target.checked?[...m,d]:m.filter(j=>j!==d);return{...h,reasoning_effort:x.length>0?x:m}}),l(!0)},disabled:a}),d.charAt(0).toUpperCase()+d.slice(1)]},d))})]})]}),e.jsxs("p",{style:{fontSize:12,color:"var(--color-gray-600)",marginTop:8},children:["Trials: ",c]})]})}function gE({configSweepDef:t,setConfigSweepDef:n,rawNBatch:r,setRawNBatch:s,rawNUBatch:i,setRawNUBatch:l,rawContextWindow:o,setRawContextWindow:a,rawNSeqMax:c,setRawNSeqMax:d,commitNumericSweep:u,isRunning:h,trialCount:m}){return e.jsxs("div",{className:"playground-autotest-section",children:[e.jsx("h4",{children:"Config Parameters"}),e.jsx("p",{style:{fontSize:12,color:"var(--color-warning-text)",marginBottom:8},children:" Each candidate reloads the model. This is slower than sampling sweeps."}),e.jsxs("div",{className:"playground-sweep-params",children:[e.jsxs("div",{className:"playground-sweep-param",children:[e.jsxs("label",{className:"playground-sweep-param-toggle",children:["NBatch",e.jsx(be,{text:ye.nbatch})]}),e.jsx("input",{type:"text",className:"playground-sweep-param-values",value:r,onChange:x=>s(x.target.value),onBlur:()=>u(r,"nbatch",s),onKeyDown:x=>x.key==="Enter"&&x.currentTarget.blur(),placeholder:"512, 1024, 2048, 4096",disabled:h})]}),e.jsxs("div",{className:"playground-sweep-param",children:[e.jsxs("label",{className:"playground-sweep-param-toggle",children:["NUBatch",e.jsx(be,{text:ye.nubatch})]}),e.jsx("input",{type:"text",className:"playground-sweep-param-values",value:i,onChange:x=>l(x.target.value),onBlur:()=>u(i,"nubatch",l),onKeyDown:x=>x.key==="Enter"&&x.currentTarget.blur(),placeholder:"128, 256, 512, 1024, 2048",disabled:h})]}),e.jsxs("div",{className:"playground-sweep-param",children:[e.jsxs("label",{className:"playground-sweep-param-toggle",children:["Context Window",e.jsx(be,{text:ye.contextWindow})]}),e.jsx("input",{type:"text",className:"playground-sweep-param-values",value:o,onChange:x=>a(x.target.value),onBlur:()=>u(o,"contextWindow",a),onKeyDown:x=>x.key==="Enter"&&x.currentTarget.blur(),placeholder:"2048, 4096, 8192, 16384, 32768",disabled:h})]}),e.jsxs("div",{className:"playground-sweep-param",children:[e.jsxs("label",{className:"playground-sweep-param-toggle",children:["NSeqMax",e.jsx(be,{text:ye.nSeqMax})]}),e.jsx("input",{type:"text",className:"playground-sweep-param-values",value:c,onChange:x=>d(x.target.value),onBlur:()=>u(c,"nSeqMax",d),onKeyDown:x=>x.key==="Enter"&&x.currentTarget.blur(),placeholder:"1, 2, 4, 8",disabled:h})]}),e.jsxs("div",{className:"playground-sweep-param",children:[e.jsxs("label",{className:"playground-sweep-param-toggle",children:["Flash Attention",e.jsx(be,{text:ye.flashAttention})]}),e.jsx("div",{className:"playground-sweep-option-checks",children:["enabled","disabled"].map(x=>e.jsxs("label",{className:"playground-sweep-option-label",children:[e.jsx("input",{type:"checkbox",checked:t.flashAttention.values.includes(x),onChange:j=>{n(b=>{const N=b.flashAttention.values,f=j.target.checked?[...N,x]:N.filter(p=>p!==x);return{...b,flashAttention:{...b.flashAttention,values:f}}})},disabled:h}),x]},x))})]}),e.jsxs("div",{className:"playground-sweep-param",children:[e.jsxs("label",{className:"playground-sweep-param-toggle",children:["Cache Type",e.jsx(be,{text:ye.cacheType})]}),e.jsx("div",{className:"playground-sweep-option-checks",children:["f16","q8_0","q4_0"].map(x=>e.jsxs("label",{className:"playground-sweep-option-label",children:[e.jsx("input",{type:"checkbox",checked:t.cacheType.values.includes(x),onChange:j=>{n(b=>{const N=b.cacheType.values,f=j.target.checked?[...N,x]:N.filter(p=>p!==x);return{...b,cacheType:{...b.cacheType,values:f}}})},disabled:h}),x]},x))})]}),e.jsxs("div",{className:"playground-sweep-param",children:[e.jsxs("label",{className:"playground-sweep-param-toggle",children:["Cache Mode",e.jsx(be,{text:ye.cacheMode})]}),e.jsx("div",{className:"playground-sweep-option-checks",children:["none","spc","imc"].map(x=>e.jsxs("label",{className:"playground-sweep-option-label",children:[e.jsx("input",{type:"checkbox",checked:t.cacheMode.values.includes(x),onChange:j=>{n(b=>{const N=b.cacheMode.values,f=j.target.checked?[...N,x]:N.filter(p=>p!==x);return{...b,cacheMode:{...b.cacheMode,values:f}}})},disabled:h}),x==="none"?"None":x.toUpperCase()]},x))})]})]}),e.jsxs("p",{style:{fontSize:12,color:"var(--color-gray-600)",marginTop:8},children:["Trials: ",m]})]})}function ua(t){return t===null?"asc":t==="asc"?"desc":null}function uy(t,n){return n.column!==t||n.direction===null?"":n.direction==="asc"?" ":" "}function my(t,n,r){if(!n.column||!n.direction)return t;const s=n.direction==="asc"?1:-1;return[...t].sort((i,l)=>{const o=r(i,n.column),a=r(l,n.column),c=o??void 0,d=a??void 0;return c===void 0&&d===void 0?0:c===void 0?1:d===void 0?-1:typeof c=="number"&&typeof d=="number"?(c-d)*s:String(c).localeCompare(String(d))*s})}function jE(t){if(!t)return;const n=t.output_tokens,r=t.tokens_per_second;if(!Number.isFinite(n)||!Number.isFinite(r)||r<=0)return;const s=t.time_to_first_token_ms??0,l=n/r*1e3+s;if(!(!Number.isFinite(l)||l<0))return l}function nx(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})}function rx(t,n){var l,o,a;const r=((l=n[t.scenarioId])==null?void 0:l.name)??t.scenarioId,s=(a=(o=n[t.scenarioId])==null?void 0:o.prompts)==null?void 0:a.length;let i=`${r}  Prompt ${t.promptIndex+1}${s?`/${s}`:""}`;return t.repeats&&t.repeats>1&&t.repeatIndex!=null&&(i+=`  Repeat ${t.repeatIndex}/${t.repeats}`),i}function py({trial:t,showScores:n}){var r;return e.jsxs(e.Fragment,{children:[n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Chat Score:"})," ",nl(jr(t,"chat"))]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Tool Score:"})," ",nl(jr(t,"tool_call"))]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Total Score:"})," ",nl(t.totalScore)]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Avg TPS:"})," ",((r=t.avgTPS)==null?void 0:r.toFixed(1))??""]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Avg TTFT:"})," ",t.avgTTFT!==void 0?gn(t.avgTTFT):""]}),t.avgTPSByFill&&si.map(s=>{var i;return e.jsxs("div",{children:[e.jsxs("strong",{children:["TPS @",s,":"]})," ",((i=t.avgTPSByFill[s])==null?void 0:i.toFixed(1))??""]},`tps-${s}`)}),t.avgTTFTByFill&&si.map(s=>e.jsxs("div",{children:[e.jsxs("strong",{children:["TTFT @",s,":"]})," ",t.avgTTFTByFill[s]!==void 0?gn(t.avgTTFTByFill[s]):""]},`ttft-${s}`))]})}function sx({sr:t,scenarioName:n,hideScores:r}){return e.jsxs("div",{className:"autotest-detail-scenario-header",children:[e.jsx("span",{className:"autotest-detail-scenario-name",children:n}),!r&&e.jsxs("span",{className:"autotest-detail-scenario-score",style:{color:iy(t.score)},children:["Score: ",nl(t.score)]}),t.avgTPS!==void 0&&e.jsxs("span",{children:["TPS: ",t.avgTPS.toFixed(1)]}),t.avgTTFT!==void 0&&e.jsxs("span",{children:["TTFT: ",gn(t.avgTTFT)]}),t.avgTPSByFill&&Object.keys(t.avgTPSByFill).length>0&&e.jsxs("span",{style:{marginLeft:8,opacity:.85},children:["Context Fill TPS:",si.map(s=>t.avgTPSByFill[s]!==void 0?` @${s}: ${t.avgTPSByFill[s].toFixed(1)}`:null)]}),t.avgTTFTByFill&&Object.keys(t.avgTTFTByFill).length>0&&e.jsxs("span",{style:{marginLeft:8,opacity:.85},children:["Context Fill TTFT:",si.map(s=>t.avgTTFTByFill[s]!==void 0?` @${s}: ${gn(t.avgTTFTByFill[s])}`:null)]})]})}function xy({trial:t,scenarioLookup:n,hideScores:r}){var x;const[s,i]=y.useState(()=>new Set),l=y.useCallback(j=>{i(b=>{const N=new Set(b);return N.has(j)?N.delete(j):N.add(j),N})},[]),o=y.useRef(null),[a,c]=y.useState(!1),[d,u]=y.useState(!1),h=t.status==="running"&&t.activePrompts&&t.activePrompts.length>0,m=t.logEntries&&t.logEntries.length>0;return y.useEffect(()=>{const j=o.current;if(!j||!a||t.status!=="running")return;j.scrollHeight-j.scrollTop-j.clientHeight<40&&(j.scrollTop=j.scrollHeight)},[(x=t.logEntries)==null?void 0:x.length,t.status,a]),t.scenarioResults.length===0&&!h&&!m?e.jsx("div",{className:"autotest-detail-empty",children:"No scenario results yet."}):e.jsxs("div",{className:"autotest-detail-content",children:[h&&e.jsxs("div",{className:"autotest-detail-active",children:[e.jsxs("div",{className:"autotest-detail-active-header",children:[e.jsx("span",{className:"playground-autotest-spinner-inline"})," Currently Running"]}),t.activePrompts.map(j=>{var b;return e.jsxs("div",{className:"autotest-detail-active-prompt",children:[e.jsx("span",{className:"autotest-detail-active-scenario",children:((b=n[j.scenarioId])==null?void 0:b.name)??j.scenarioId}),e.jsx("span",{className:"autotest-detail-active-id",children:j.promptId}),j.repeats&&j.repeats>1&&j.repeatIndex&&e.jsxs("span",{className:"autotest-detail-active-repeat",children:["Repeat ",j.repeatIndex,"/",j.repeats]}),j.preview&&e.jsx("div",{className:"autotest-detail-active-preview",children:j.preview})]},`${j.scenarioId}-${j.promptIndex}`)})]}),m&&e.jsxs("div",{className:"autotest-detail-log",children:[e.jsxs("button",{type:"button",className:"autotest-detail-log-header","aria-expanded":a,onClick:j=>{j.stopPropagation(),c(b=>!b)},children:[t.status==="running"&&e.jsx("span",{className:"playground-autotest-spinner-inline"}),e.jsxs("span",{children:[a?"":""," Activity Log"]})]}),e.jsx("div",{className:"autotest-detail-log-body",ref:o,children:a?t.logEntries.map((j,b)=>e.jsxs("div",{className:"autotest-detail-log-entry",children:[e.jsx("span",{className:"autotest-detail-log-time",children:nx(j.timestamp)}),e.jsx("span",{className:"autotest-detail-log-msg",children:j.message})]},b)):(()=>{const j=t.logEntries[t.logEntries.length-1];return e.jsxs("div",{className:"autotest-detail-log-entry",children:[e.jsx("span",{className:"autotest-detail-log-time",children:nx(j.timestamp)}),e.jsx("span",{className:"autotest-detail-log-msg",children:j.message})]})})()})]}),(t.scenarioResults.length>0||t.status==="running"&&t.activePrompts&&t.activePrompts.length>0)&&e.jsxs("div",{className:"autotest-detail-scenarios-section",children:[e.jsx("button",{type:"button",className:"autotest-detail-log-header","aria-expanded":d,onClick:j=>{j.stopPropagation(),u(b=>!b)},children:e.jsxs("span",{children:[d?"":""," Performance"]})}),d?(()=>{const j=new Set(t.scenarioResults.map(f=>f.scenarioId)),b={};if(t.status==="running"&&t.activePrompts)for(const f of t.activePrompts)b[f.scenarioId]||(b[f.scenarioId]=[]),b[f.scenarioId].push(f);const N=[...j];for(const f of Object.keys(b)){const p=f;j.has(p)||N.push(p)}return N.map(f=>{const p=t.scenarioResults.find(S=>S.scenarioId===f),g=n[f],k=b[f]??[];return!p&&k.length===0?null:e.jsxs("div",{className:"autotest-detail-scenario",children:[p?e.jsx(sx,{sr:p,scenarioName:(g==null?void 0:g.name)??f,hideScores:r}):e.jsx("div",{className:"autotest-detail-scenario-header",children:e.jsx("span",{className:"autotest-detail-scenario-name",children:(g==null?void 0:g.name)??f})}),k.length>0&&e.jsxs("div",{className:"autotest-detail-running-indicator autotest-detail-running-indicator--expanded",children:[e.jsx("span",{className:"playground-autotest-spinner-inline"})," ","Running: ",rx(k[0],n)]}),p&&e.jsx("div",{className:"autotest-detail-prompts",children:p.promptResults.map(S=>{var J,re,ne,A,B;const _=`${p.scenarioId}:${S.promptId}`,E=s.has(_),D=S.promptId.startsWith("ctxfill-"),L=g==null?void 0:g.prompts.find(v=>v.id===S.promptId),T=L==null?void 0:L.messages.filter(v=>v.role==="user").pop(),P=D?`Context fill test (${S.promptId.replace("ctxfill-","")}% fill)  ${((J=S.usage)==null?void 0:J.prompt_tokens)??"?"} prompt tokens`:typeof(T==null?void 0:T.content)=="string"?T.content:((re=T==null?void 0:T.content)==null?void 0:re.map(v=>"text"in v?v.text:"").join(""))??"",I=D?"Performance metric only":L!=null&&L.expected?L.expected.type==="tool_call"?"Tool call":L.expected.type==="no_tool_call"?"No tool call"+(L.expected.value?` (text: ${L.expected.value})`:""):L.expected.type==="exact"?`Exact: "${L.expected.value}"`:`Regex: ${L.expected.value}`:"",O=jE(S.usage),X=O!==void 0?gn(O):"";return e.jsxs("div",{className:`autotest-detail-prompt ${E?"expanded":"collapsed"}`,children:[e.jsxs("div",{className:"autotest-detail-prompt-header autotest-detail-prompt-header--clickable",role:"button",tabIndex:0,"aria-expanded":E,onClick:()=>l(_),onKeyDown:v=>{(v.key==="Enter"||v.key===" ")&&(v.preventDefault(),l(_))},children:[e.jsxs("div",{className:"autotest-detail-prompt-summary",children:[e.jsx("span",{className:"autotest-detail-prompt-toggle",children:E?"":""}),e.jsx("span",{className:"autotest-detail-prompt-id",children:D?`Context Fill @${S.promptId.replace("ctxfill-","")}%`:S.promptId}),e.jsxs("span",{className:"autotest-detail-prompt-duration",children:["Duration: ",X]}),e.jsxs("span",{className:"autotest-detail-prompt-usage-inline",children:[e.jsxs("span",{children:["In: ",((ne=S.usage)==null?void 0:ne.prompt_tokens)??""]}),e.jsxs("span",{children:["Out: ",((A=S.usage)==null?void 0:A.output_tokens)??""]}),e.jsxs("span",{children:["TPS: ",((B=S.usage)==null?void 0:B.tokens_per_second)!==void 0?S.usage.tokens_per_second.toFixed(1):""]})]})]}),!r&&e.jsx("span",{className:"autotest-detail-prompt-score",style:{color:iy(S.score)},children:nl(S.score)})]}),E&&e.jsxs("div",{className:"autotest-detail-prompt-grid",children:[e.jsxs("div",{className:"autotest-detail-field",children:[e.jsx("div",{className:"autotest-detail-label",children:"Input"}),e.jsx("div",{className:"autotest-detail-value",children:P||""})]}),e.jsxs("div",{className:"autotest-detail-field",children:[e.jsx("div",{className:"autotest-detail-label",children:"Expected"}),e.jsx("div",{className:"autotest-detail-value",children:I})]}),e.jsxs("div",{className:"autotest-detail-field",children:[e.jsx("div",{className:"autotest-detail-label",children:"Output"}),e.jsx("div",{className:"autotest-detail-value",children:S.toolCalls.length>0?S.toolCalls.map((v,F)=>e.jsx("div",{className:"autotest-detail-toolcall",children:e.jsxs("code",{children:[v.function.name,"(",v.function.arguments,")"]})},F)):S.assistantText||"(empty)"})]}),S.usage&&e.jsxs("div",{className:"autotest-detail-field",children:[e.jsx("div",{className:"autotest-detail-label",children:"Usage"}),e.jsxs("div",{className:"autotest-detail-value autotest-detail-usage",children:[e.jsxs("span",{children:["In: ",S.usage.prompt_tokens]}),e.jsxs("span",{children:["Out: ",S.usage.output_tokens]}),e.jsxs("span",{children:["TPS: ",S.usage.tokens_per_second.toFixed(1)]}),S.usage.time_to_first_token_ms!==void 0&&e.jsxs("span",{children:["TTFT: ",gn(S.usage.time_to_first_token_ms)]})]})]}),S.notes&&S.notes.length>0&&e.jsxs("div",{className:"autotest-detail-field",children:[e.jsx("div",{className:"autotest-detail-label",children:"Notes"}),e.jsx("div",{className:"autotest-detail-value autotest-detail-notes",children:S.notes.map((v,F)=>e.jsx("div",{children:v},F))})]})]})]},S.promptId)})})]},f)})})():e.jsxs("div",{className:"autotest-detail-scenarios-summary",children:[t.status==="running"&&t.activePrompts&&t.activePrompts.length>0&&e.jsxs("div",{className:"autotest-detail-running-indicator",children:[e.jsx("span",{className:"playground-autotest-spinner-inline"})," ","Running: ",rx(t.activePrompts[0],n)]}),t.scenarioResults.map(j=>{var b;return e.jsx(sx,{sr:j,scenarioName:((b=n[j.scenarioId])==null?void 0:b.name)??j.scenarioId,hideScores:r},j.scenarioId)})]})]})]})}function ix(t,n,r){return Math.min(r,Math.max(n,t))}function lx(t,n){const r=ql[t],s=Number(n.min),i=Number(n.max),l=Number(n.step);let o=Number.isFinite(s)?ix(s,r.validMin,r.validMax):r.validMin,a=Number.isFinite(i)?ix(i,r.validMin,r.validMax):o;o>a&&(a=o);const c=Number.isFinite(l)&&l>0?Math.max(l,1e-6):r.defaultStep;return{min:o,max:a,step:c}}function ox(t,n,r){if(r<=0||t===n)return[t];const s=[],i=r*.001;for(let l=t;l<=n+i;){const o=Math.round(l*1e6)/1e6;if(o<=n+1e-9&&s.push(o),s.length>=200)break;const a=l+r;if(a===l)break;l=a}return s.length>0?s:[t]}function yE(t,n){const r=ql[t];if(!n||n.length===0)return{min:String(r.validMin),max:String(r.validMin),step:String(r.defaultStep)};if(n.length===1)return{min:String(n[0]),max:String(n[0]),step:String(r.defaultStep)};const s=n[0],i=n[n.length-1],l=n[1]-n[0];let o=l>0;for(let c=2;c<n.length&&o;c++)Math.abs(n[c]-n[c-1]-l)>1e-6&&(o=!1);const a=o&&l>0?Math.round(l*1e6)/1e6:r.defaultStep;return{min:String(s),max:String(i),step:String(a)}}function Bc(t){const n={};for(const r of Object.keys(ql))n[r]=yE(r,t[r]);return n}function bE(t){const n=new Date,r=t.getDate()===n.getDate()&&t.getMonth()===n.getMonth()&&t.getFullYear()===n.getFullYear(),s=t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return r?s:t.toLocaleDateString([],{month:"short",day:"numeric"})+", "+s}function kE(t,n,r,s){const[,i]=y.useState(0),l=n.filter(j=>j==null?void 0:j.finishedAt).length,o=s&&l<r;y.useEffect(()=>{if(!o)return;const j=setInterval(()=>i(b=>b+1),1e3);return()=>clearInterval(j)},[o]);const a=t?Date.parse(t):NaN,c=n.map(j=>j!=null&&j.startedAt?Date.parse(j.startedAt):NaN).filter(Number.isFinite),d=Number.isFinite(a)?a:c.length?Math.min(...c):NaN,u=Number.isFinite(d)?Math.max(0,Date.now()-d):0,h=Number.isFinite(d)?gn(u):null;let m=null,x=null;if(l>0&&l<r){const j=n.filter(b=>(b==null?void 0:b.startedAt)&&(b==null?void 0:b.finishedAt)).map(b=>Date.parse(b.finishedAt)-Date.parse(b.startedAt)).filter(b=>Number.isFinite(b)&&b>0);if(j.length>0){const b=j.reduce((g,k)=>g+k,0)/j.length,N=Math.max(0,r-l),f=l>0?N:Math.max(0,N-1),p=b*N+Dg*f;m=gn(p),l>=3&&(x=bE(new Date(Date.now()+p)))}}return{elapsed:h,estimate:m,estimatedCompletion:x}}function vE({totalTrials:t,trials:n,running:r,runStartedAt:s}){const{elapsed:i,estimate:l,estimatedCompletion:o}=kE(s,n,t,r),a=n.filter(b=>b==null?void 0:b.finishedAt).length,c=!!n.find(b=>(b==null?void 0:b.status)==="running"),d=Math.min(100,t>0?(a+(c?.5:0))/t*100:0),u=n.find(b=>(b==null?void 0:b.status)==="running");let h=null;if(u){const b=u.scenarioResults.reduce((N,f)=>N+f.promptResults.length,0);h=b>0?`Prompt ${b} completed`:"Starting"}const m=Math.min(a+(c?1:0),t),x=`${i??"0s"}${l?`  ~${l} left`:""}${o?`  ETA ${o}`:""}`,j=d>=50;return e.jsxs("div",{className:"playground-autotest-progress",children:[e.jsxs("div",{className:"playground-autotest-progress-text",children:[e.jsxs("span",{children:["Trial ",m," / ",t]}),h&&e.jsxs("span",{className:"playground-autotest-prompt-progress",children:["  ",h]})]}),e.jsxs("div",{className:"playground-autotest-progress-bar",children:[e.jsx("div",{className:"playground-autotest-progress-fill",style:{width:`${d}%`},children:j&&e.jsx("span",{className:"playground-autotest-progress-label",children:x})}),!j&&e.jsx("span",{className:"playground-autotest-progress-label-outside",children:x})]})]})}function wE({session:t,sessionSeed:n,catalogSampling:r}){const{run:s,isRunning:i,startSamplingRun:l,startConfigRun:o,stopRun:a,clearRun:c,reevaluateBestTrial:d,reorderQueuedTrial:u,skipTrial:h,unskipTrial:m,stopTrial:x,rerunTrial:j}=zg(),b=(s==null?void 0:s.kind)==="sampling"?s.sweepDef:pw,N=(s==null?void 0:s.kind)==="config"?s.configSweepDef:xw,f=(s==null?void 0:s.weights)??((s==null?void 0:s.kind)==="config"?Od:Hs),[p,g]=y.useState(()=>(s==null?void 0:s.kind)??"sampling"),[k,S]=y.useState(()=>(s==null?void 0:s.enabledScenarios)??{chat:!0,tool_call:!0}),[_,E]=y.useState(()=>structuredClone(b)),[D,L]=y.useState(()=>Bc(b)),T=y.useRef(D);y.useEffect(()=>{T.current=D},[D]);const[P,I]=y.useState(!!s),[O,X]=y.useState(null),J=1/0,[re,ne]=y.useState(()=>structuredClone(N)),[A,B]=y.useState(()=>({...f})),[v,F]=y.useState(!1),z=y.useRef({...f});y.useEffect(()=>{if(!i&&!s){const V=p==="config"?Od:Hs;B(V),z.current={...V},F(!1)}},[p,i,s]);const[w,Z]=y.useState(!1),[K,Q]=y.useState(new Set),[Y,ee]=y.useState(()=>(s==null?void 0:s.repeats)??1),[C,R]=y.useState({column:null,direction:null}),$=i&&(s==null?void 0:s.status)==="running_trials"&&C.column===null,[ie,ce]=y.useState(null),[q,H]=y.useState(null),le=y.useCallback((V,pe)=>{ce(pe),V.dataTransfer.effectAllowed="move",V.dataTransfer.setData("text/plain",pe)},[]),me=y.useCallback((V,pe)=>{V.preventDefault(),V.dataTransfer.dropEffect="move",H(pe)},[]),ge=y.useCallback(()=>{H(null)},[]),ve=y.useCallback((V,pe)=>{V.preventDefault();const Ce=V.dataTransfer.getData("text/plain");Ce&&Ce!==pe&&u({trialId:Ce,targetId:pe}),ce(null),H(null)},[u]),Se=y.useCallback(()=>{ce(null),H(null)},[]),[,Re]=y.useState(0);y.useEffect(()=>{if(!i)return;const V=setInterval(()=>Re(pe=>pe+1),1e3);return()=>clearInterval(V)},[i]);const qe=y.useMemo(()=>{const V={chat:p==="config"?la:ia};return p!=="config"&&(V.tool_call=vl),V},[p]),Ke=y.useCallback(V=>{R(pe=>({column:pe.column===V&&ua(pe.direction)===null?null:V,direction:pe.column===V?ua(pe.direction):"asc"}))},[]),et=y.useCallback(V=>{Q(pe=>{const Ce=new Set(pe);return Ce.has(V)?Ce.delete(V):Ce.add(V),Ce})},[]),[ze,G]=y.useState(()=>N.nbatch.values.join(", ")),[se,he]=y.useState(()=>N.nubatch.values.join(", ")),[je,Ne]=y.useState(()=>N.contextWindow.values.join(", ")),[tt,Nt]=y.useState(()=>N.nSeqMax.values.join(", ")),jt=y.useRef(s==null?void 0:s.runId);y.useEffect(()=>{!s||s.runId===jt.current||(jt.current=s.runId,g(s.kind),S(s.enabledScenarios),ee(s.repeats),B({...s.weights}),z.current={...s.weights},F(!1),s.kind==="sampling"?(E(structuredClone(s.sweepDef)),L(Bc(s.sweepDef)),I(!0)):(ne(structuredClone(s.configSweepDef)),G(s.configSweepDef.nbatch.values.join(", ")),he(s.configSweepDef.nubatch.values.join(", ")),Ne(s.configSweepDef.contextWindow.values.join(", ")),Nt(s.configSweepDef.nSeqMax.values.join(", "))))},[s==null?void 0:s.runId]);const Vt=y.useRef(s);y.useEffect(()=>{Vt.current&&!s&&(I(!1),jt.current=void 0),Vt.current=s},[s]);const on=y.useCallback((V,pe,Ce)=>{const nt=V.split(",").map(Ge=>Math.floor(Number(Ge.trim()))).filter(Ge=>Number.isFinite(Ge)&&Ge>0);if(nt.length===0){ne(Ge=>(Ce(Ge[pe].values.join(", ")),Ge));return}ne(Ge=>({...Ge,[pe]:{...Ge[pe],enabled:!0,values:nt}})),Ce(nt.join(", "))},[]),st=y.useCallback(V=>{const{min:pe,max:Ce,step:nt}=lx(V,T.current[V]),Ge=ox(pe,Ce,nt);L(kt=>({...kt,[V]:{min:String(pe),max:String(Ce),step:String(nt)}})),E(kt=>({...kt,[V]:Ge})),I(!0)},[]);y.useEffect(()=>{if(s||!r||r===O||(X(r),P))return;const V=r,pe={temperature:[V.temperature??.8],top_p:[V.top_p??.9],top_k:[V.top_k??40],min_p:[V.min_p??0],repeat_penalty:[V.repeat_penalty??1],repeat_last_n:[V.repeat_last_n??64],frequency_penalty:[V.frequency_penalty??0],presence_penalty:[V.presence_penalty??0],dry_multiplier:[V.dry_multiplier??1.05],dry_base:[V.dry_base??1.75],dry_allowed_length:[V.dry_allowed_length??2],dry_penalty_last_n:[V.dry_penalty_last_n??0],xtc_probability:[V.xtc_probability??0],xtc_threshold:[V.xtc_threshold??.1],xtc_min_keep:[V.xtc_min_keep??1],max_tokens:[V.max_tokens??4096],enable_thinking:[V.enable_thinking||"true"],reasoning_effort:[V.reasoning_effort||"medium"]};E(pe),L(Bc(pe))},[r,O,P,s]);const mt=(s==null?void 0:s.status)??"idle",yt=(s==null?void 0:s.errorMessage)??"",M=(s==null?void 0:s.templateRepairStatus)??"",de=(s==null?void 0:s.calibrationStatus)??"",xe=(s==null?void 0:s.totalTrials)??0,we=(s==null?void 0:s.kind)==="sampling"?s.trials:[],bt=(s==null?void 0:s.kind)==="config"?s.trials:[],at=(s==null?void 0:s.kind)==="sampling"&&s.bestTrialId?s.trials.find(V=>V.id===s.bestTrialId)??null:null,Ue=(s==null?void 0:s.kind)==="config"&&s.bestTrialId?s.trials.find(V=>V.id===s.bestTrialId)??null:null,Ct=s?s.kind:p,dr=s==null?void 0:s.kind;y.useEffect(()=>{dr&&g(dr)},[dr]);const Pt=Ct==="config"?bt:we,Bn=y.useMemo(()=>Ct==="config"?hy():dy(),[Ct]),Yn=y.useMemo(()=>Object.fromEntries(Bn.map(V=>[V.id,V])),[Bn]),Ur=y.useCallback((V,pe)=>{var Ce;return(Ce=Yn[pe])==null?void 0:Ce.getValue(V)},[Yn]),$e=y.useMemo(()=>my(Pt,C,Ur),[Pt,C,Ur]),hr=k.chat||k.tool_call,ht=y.useMemo(()=>{const V=Object.keys(ql),pe=Object.fromEntries(V.map(Ce=>{const{min:nt,max:Ge,step:kt}=lx(Ce,D[Ce]);return[Ce,ox(nt,Ge,kt)]}));return{..._,...pe}},[D,_]),Tn=y.useMemo(()=>Lg(ht,J).length,[ht,J]),Cn=y.useMemo(()=>n?Fg(n.base_config,re).length:1,[n,re]),Kr=y.useRef(0);y.useEffect(()=>{Pt.length>0&&Kr.current===0&&!w&&Z(!0),Kr.current=Pt.length},[Pt.length,w]);const Bl=y.useCallback(()=>{if(p==="sampling"){if(!t&&!(n!=null&&n.model_id))return;l({sessionId:t==null?void 0:t.session_id,sessionSeed:t?void 0:n??void 0,enabledScenarios:k,sweepDef:ht,maxTrials:J,weights:A,repeats:Y,effectiveConfig:t==null?void 0:t.effective_config})}else{if(!(n!=null&&n.model_id)||t)return;o({sessionSeed:n,enabledScenarios:k,configSweepDef:re,weights:A,repeats:Y})}z.current={...A},F(!1)},[p,t,n,k,ht,J,re,A,Y,l,o]),zr=y.useCallback((V,pe)=>{B(Ce=>{const nt={...Ce,[V]:pe},Ge=z.current,kt=Object.keys(nt).some(Lt=>nt[Lt]!==Ge[Lt]);return F(kt),nt})},[]),Gr=y.useCallback(()=>{d(A),z.current={...A},F(!1)},[A,d]),js=y.useCallback(V=>{const pe=(s==null?void 0:s.kind)??p,Ce=Og(V,pe);B(Ce),z.current={...Ce},F(!1),d(Ce)},[s,p,d]),ur=y.useCallback(()=>{a()},[a]),mr=y.useCallback(()=>{c()},[c]),Dt=p==="sampling"?!!((t||n!=null&&n.model_id)&&!i&&hr):!!(n!=null&&n.model_id&&!t&&!i&&hr);return e.jsxs("div",{className:"playground-autotest-container",children:[e.jsxs("div",{className:"playground-autotest-section",style:{display:"flex",gap:32,alignItems:"flex-start"},children:[e.jsxs("div",{style:{width:"50%"},children:[e.jsx("h4",{children:"Sweep Mode"}),e.jsx("div",{className:"playground-inline-options",style:{paddingBottom:"20px"},children:oE.map(V=>e.jsxs("label",{className:"playground-inline-option",children:[e.jsx("input",{type:"radio",name:"sweepMode",value:V.kind,checked:p===V.kind,onChange:()=>g(V.kind),disabled:i}),V.label]},V.kind))}),p==="sampling"&&e.jsxs("div",{className:"playground-autotest-section",children:[e.jsx("h4",{children:"Scenario Selection"}),e.jsxs("div",{className:"playground-inline-options",children:[e.jsxs("label",{className:"playground-inline-option",children:[e.jsx("input",{type:"checkbox",checked:k.chat,onChange:V=>S(pe=>({...pe,chat:V.target.checked})),disabled:i}),"Chat Quality"]}),e.jsxs("label",{className:"playground-inline-option",children:[e.jsx("input",{type:"checkbox",checked:k.tool_call,onChange:V=>S(pe=>({...pe,tool_call:V.target.checked})),disabled:i}),"Tool Calling"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"Repeats Per Test Case"}),e.jsx("p",{style:{fontSize:12,color:"var(--color-gray-600)",marginBottom:8},children:"Each prompt is run this many times and scores are averaged for more stable results."}),e.jsx("input",{type:"number",value:Y,onChange:V=>{const pe=Math.floor(Number(V.target.value));Number.isFinite(pe)&&pe>=1&&ee(pe)},min:1,max:20,style:{width:60},disabled:i})]})]}),p==="config"&&e.jsx(gE,{configSweepDef:re,setConfigSweepDef:ne,rawNBatch:ze,setRawNBatch:G,rawNUBatch:se,setRawNUBatch:he,rawContextWindow:je,setRawContextWindow:Ne,rawNSeqMax:tt,setRawNSeqMax:Nt,commitNumericSweep:on,isRunning:i,trialCount:Cn}),p==="sampling"&&e.jsx(fE,{sweepDef:_,setSweepDef:E,sweepInputs:D,setSweepInputs:L,commitTriple:st,setSweepDirty:I,catalogSampling:r,isRunning:i,trialCount:Tn}),e.jsxs("div",{className:"playground-autotest-actions",children:[e.jsx("button",{className:"btn btn-primary",onClick:Bl,disabled:!Dt,children:"Run Automated Testing"}),i&&e.jsx("button",{className:"btn btn-danger",onClick:ur,children:"Stop"}),Pt.length>0&&!i&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:mr,children:"Clear Results"})]}),p==="config"&&t&&!i&&e.jsx("div",{className:"playground-error",children:"Unload the current session before running config sweeps"}),M&&i&&mt!=="running_trials"&&e.jsxs("div",{className:"playground-autotest-status",children:[e.jsx("span",{className:"playground-autotest-spinner"})," ",M]}),de&&i&&mt!=="running_trials"&&e.jsxs("div",{className:"playground-autotest-status",children:[e.jsx("span",{className:"playground-autotest-spinner"})," ",de]}),yt&&e.jsx("div",{className:"playground-error",children:yt}),mt==="running_trials"&&(s==null?void 0:s.initialDelayUntil)&&e.jsxs("div",{className:"playground-autotest-status",children:[e.jsx("span",{className:"playground-autotest-spinner"})," Starting first test in ",Math.max(0,Math.ceil((Date.parse(s.initialDelayUntil)-Date.now())/1e3)),"s"]}),mt==="running_trials"&&e.jsx(vE,{totalTrials:xe,trials:Pt,running:i,runStartedAt:s==null?void 0:s.runStartedAt}),mt==="completed"&&(()=>{var pe,Ce,nt,Ge,kt,Lt,Vr;const V=!!(Ct==="config"?Ue:at);return e.jsxs("div",{className:"playground-autotest-best",children:[V?e.jsxs(e.Fragment,{children:[e.jsx("h4",{children:"Best Configuration Found"}),e.jsxs("div",{className:"playground-autotest-best-details",children:[Ct==="config"&&Ue?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Context Window:"})," ",((pe=Ue.config)==null?void 0:pe.context_window)??""]}),e.jsxs("div",{children:[e.jsx("strong",{children:"NBatch:"})," ",((Ce=Ue.config)==null?void 0:Ce.nbatch)??""]}),e.jsxs("div",{children:[e.jsx("strong",{children:"NUBatch:"})," ",((nt=Ue.config)==null?void 0:nt.nubatch)??""]}),e.jsxs("div",{children:[e.jsx("strong",{children:"NSeqMax:"})," ",((Ge=Ue.config)==null?void 0:Ge.nseq_max)??""]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Flash Attention:"})," ",((kt=Ue.config)==null?void 0:kt.flash_attention)??""]}),e.jsxs("div",{children:[e.jsx("strong",{children:"KV Cache Type:"})," ",((Lt=Ue.config)==null?void 0:Lt.cache_type)??""]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Cache Mode:"})," ",(Vr=Ue.config)!=null&&Vr.cache_mode?Ue.config.cache_mode==="none"?"None":Ue.config.cache_mode.toUpperCase():""]})]}):at?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Temperature:"})," ",at.candidate.temperature]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Top P:"})," ",at.candidate.top_p]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Top K:"})," ",at.candidate.top_k]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Min P:"})," ",at.candidate.min_p]})]}):null,(()=>{const an=Ct==="config"?Ue:at;return an?e.jsx(py,{trial:an,showScores:Ct!=="config"}):null})()]})]}):e.jsx("div",{style:{fontSize:12,color:"var(--color-gray-700)"},children:"No best configuration could be selected. Adjust weights and reevaluate."}),e.jsxs("details",{className:"playground-sampling-params",style:{marginTop:V?12:0},children:[e.jsx("summary",{children:"Best Configuration Criteria"}),e.jsx("p",{style:{fontSize:12,color:"var(--color-gray-600)",marginBottom:8},children:"Weights control how the best configuration is chosen. Higher weight = more influence."}),e.jsxs("div",{style:{display:"flex",gap:6,marginBottom:10},children:[e.jsx("button",{type:"button",className:"btn btn-small",onClick:()=>js("overall"),children:"Best overall"}),e.jsx("button",{type:"button",className:"btn btn-small",onClick:()=>js("0pct"),children:"Best at 0% context"}),e.jsx("button",{type:"button",className:"btn btn-small",onClick:()=>js("80pct"),children:"Best at 80% context"})]}),e.jsx("div",{className:"playground-sweep-params",children:[...Ct!=="config"?[["chatScore","Chat Score"],["toolScore","Tool Score"],["totalScore","Total Score"]]:[],["avgTPS","Avg TPS"],["avgTTFT","Avg TTFT (lower is better)"],["tps0","TPS @0% Fill"],["tps20","TPS @20% Fill"],["tps50","TPS @50% Fill"],["tps80","TPS @80% Fill"],["ttft0","TTFT @0% Fill (lower is better)"],["ttft20","TTFT @20% Fill (lower is better)"],["ttft50","TTFT @50% Fill (lower is better)"],["ttft80","TTFT @80% Fill (lower is better)"]].map(([an,Pn])=>e.jsxs("div",{className:"playground-sweep-param",children:[e.jsx("label",{className:"playground-sweep-param-toggle",htmlFor:`best-config-weight-${an}`,children:Pn}),e.jsx("input",{id:`best-config-weight-${an}`,type:"number",className:"playground-sweep-param-values",value:A[an],onChange:ys=>{const Et=Number(ys.target.value);Number.isFinite(Et)&&Et>=0&&zr(an,Et)},step:.1,min:0})]},an))}),A.totalScore>0&&(A.chatScore>0||A.toolScore>0)&&e.jsx("p",{style:{fontSize:11,color:"var(--color-warning-text)",marginTop:6},children:" Total Score is derived from Chat/Tool weights. Weighting Total Score alongside Chat or Tool Score will double-count quality."}),e.jsx("button",{className:"btn btn-primary btn-small",style:{marginTop:8},onClick:Gr,disabled:!v,children:"Reevaluate"})]})]})})(),Pt.length>0&&e.jsxs("details",{className:"playground-autotest-results",open:w,onToggle:V=>Z(V.currentTarget.open),children:[e.jsxs("summary",{style:{cursor:"pointer",fontWeight:600,fontSize:13,color:"var(--color-gray-700)",marginBottom:8},children:["Results (",Pt.length," trials)",(mt==="completed"||mt==="cancelled")&&(()=>{const V=s!=null&&s.runStartedAt?Date.parse(s.runStartedAt):NaN,pe=Pt.map(Lt=>Lt!=null&&Lt.finishedAt?Date.parse(Lt.finishedAt):NaN).filter(Number.isFinite),Ce=pe.length>0?Math.max(...pe):NaN;if(!Number.isFinite(V)||!Number.isFinite(Ce))return null;const nt=gn(Math.max(0,Ce-V)),Ge=new Date(Ce),kt=Ge.toLocaleDateString([],{month:"short",day:"numeric",year:"numeric"})+", "+Ge.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",second:"2-digit"});return e.jsxs("span",{style:{fontWeight:400,fontSize:12,color:"var(--color-gray-500)",marginLeft:8},children:[" ",nt," total  finished ",kt]})})()]}),e.jsx("div",{className:"playground-autotest-table-scroll",children:e.jsxs("table",{className:"playground-autotest-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),(i||s)&&e.jsx("th",{children:"Actions"}),Bn.map(V=>e.jsxs("th",{className:V.sortable!==!1?"sortable-th":void 0,onClick:V.sortable!==!1?()=>Ke(V.id):void 0,children:[V.title,uy(V.id,C)]},V.id))]})}),e.jsx("tbody",{children:$e.map((V,pe)=>{const Ce=(V.totalScore===void 0||V.totalScore===null)&&V.status!=="skipped",nt=Ce&&V.status==="running",Ge=Ct==="config"?Ue:at,kt=Ge&&V===Ge&&mt==="completed",Lt=K.has(V.id),Vr=ie===V.id,an=q===V.id&&ie!==V.id,Pn=$&&V.status==="queued",ys={isPending:Ce,isInProgress:nt,isBest:!!kt,index:pe};return e.jsxs(xa.Fragment,{children:[e.jsxs("tr",{className:`autotest-trial-row${kt?" autotest-best-row":""}${nt?" autotest-running-row":""}${V.status==="skipped"?" autotest-skipped-row":""}${Vr?" autotest-dragging-row":""}${an?" autotest-dragover-row":""}`,style:{cursor:"pointer"},onClick:()=>et(V.id),draggable:Pn,onDragStart:Pn?Et=>le(Et,V.id):void 0,onDragOver:Pn?Et=>me(Et,V.id):void 0,onDragLeave:Pn?ge:void 0,onDrop:Pn?Et=>ve(Et,V.id):void 0,onDragEnd:Pn?Se:void 0,children:[e.jsxs("td",{children:[Lt?"":""," ",nt&&e.jsx("span",{className:"playground-autotest-spinner-inline"}),pe+1]}),(i||s)&&e.jsxs("td",{className:"autotest-actions-cell",onClick:Et=>Et.stopPropagation(),children:[V.status==="queued"&&e.jsxs("span",{className:"autotest-queue-controls",children:[e.jsx("span",{className:`autotest-drag-handle${$?"":" disabled"}`,title:$?"Drag to reorder":"Clear column sorting to reorder",children:""}),e.jsx("button",{className:"btn btn-small autotest-skip-btn",onClick:()=>h({trialId:V.id}),title:"Skip this trial",children:"Skip"})]}),V.status==="skipped"&&e.jsx("button",{className:"btn btn-small autotest-unskip-btn",onClick:()=>m({trialId:V.id}),title:"Restore this trial to the queue",children:"Unskip"}),V.status==="running"&&e.jsx("button",{className:"btn btn-small btn-danger",onClick:()=>x(),title:"Stop this trial",children:"Stop"}),(V.status==="completed"||V.status==="cancelled"||V.status==="failed")&&e.jsx("button",{className:"btn btn-small",onClick:()=>j({trialId:V.id}),title:"Rerun this trial (moves to top of queue)",children:"Rerun"})]}),Bn.map(Et=>e.jsx("td",{children:Et.renderCell(V,ys)},Et.id))]}),Lt&&e.jsx("tr",{className:"autotest-detail-row",children:e.jsx("td",{colSpan:Bn.length+(i||s?2:1),children:e.jsx(xy,{trial:V,scenarioLookup:qe,hideScores:Ct==="config"})})})]},V.id)})})]})})]})]})}function NE(){var Y,ee,C,R,$,ie,ce;const[t,n]=y.useState([]),[r,s]=y.useState(!0),[i,l]=y.useState(null),[o,a]=y.useState(new Set),[c,d]=y.useState({column:null,direction:null}),[u,h]=y.useState(new Set),[m,x]=y.useState(()=>({...Hs})),[j,b]=y.useState(!1),[N,f]=y.useState(null),p=y.useRef({...Hs}),g=y.useRef(null),k=y.useRef(null);y.useEffect(()=>{let q=!0;return Kd().then(H=>{q&&(n(H),s(!1))}),()=>{q=!1}},[]),y.useEffect(()=>{const q=()=>{Kd().then(n)},H=le=>{le instanceof StorageEvent&&le.key!=="playground:autoTestHistory:updatedAt"||q()};return window.addEventListener("autotest-history-updated",q),window.addEventListener("storage",H),()=>{window.removeEventListener("autotest-history-updated",q),window.removeEventListener("storage",H)}},[]),y.useEffect(()=>{if(!N)return;const q=setTimeout(()=>f(null),4e3);return()=>clearTimeout(q)},[N]),y.useEffect(()=>{const q=new Set(t.map(H=>H.id));a(H=>{let le=!1;for(const ge of H)if(!q.has(ge)){le=!0;break}if(!le)return H;const me=new Set;for(const ge of H)q.has(ge)&&me.add(ge);return me})},[t]),y.useEffect(()=>{if(!k.current)return;const q=o.size,H=t.length;k.current.indeterminate=q>0&&q<H},[o,t.length]);const S=y.useMemo(()=>t.find(q=>q.id===i)??null,[t,i]),_=y.useCallback(q=>{var ge,ve;const H=t.find(Se=>Se.id===q);l(q),a(new Set),d({column:null,direction:null}),h(new Set);const me={...((ge=H==null?void 0:H.run)==null?void 0:ge.kind)==="config"?Od:Hs,...((ve=H==null?void 0:H.run)==null?void 0:ve.weights)??{}};x({...me}),p.current={...me},b(!1)},[t]),E=y.useCallback(q=>{Aw(q),i===q&&l(null)},[i]),D=y.useCallback(()=>{if(o.size===0)return;const q=Array.from(o);Dw(q),i&&o.has(i)&&l(null),a(new Set)},[o,i]),L=y.useCallback(async()=>{const q=await Lw(),H=URL.createObjectURL(q),le=document.createElement("a"),me=new Date().toISOString().slice(0,10);le.href=H,le.download=`autotest-history-${me}.json`,document.body.appendChild(le),le.click(),document.body.removeChild(le),URL.revokeObjectURL(H)},[]),T=y.useCallback(async q=>{try{const H=await q.text(),le=await Fw(H);f(`Imported ${le.imported} entr${le.imported!==1?"ies":"y"}${le.skipped>0?` (${le.skipped} skipped)`:""}`)}catch(H){f(`Import failed: ${H instanceof Error?H.message:"unknown error"}`)}},[]),P=y.useCallback((q,H)=>{x(le=>{const me={...le,[q]:H},ge=p.current,ve=Object.keys(me).some(Se=>me[Se]!==ge[Se]);return b(ve),me})},[]),I=y.useCallback(q=>{var Se;if(!S)return;const H=(Se=S.run)==null?void 0:Se.trials;if(!Array.isArray(H))return;const le=H;let me=null,ge=-1/0,ve=-1/0;for(const Re of le){if(Re.status!=="completed")continue;const qe=Jh(Re,q);(qe>ge||qe===ge&&(Re.avgTPS??0)>ve)&&(ge=qe,ve=Re.avgTPS??0,me=Re.id)}Iw(S.id,Re=>({...Re,run:{...Re.run,bestTrialId:me??void 0,weights:{...q}}})),p.current={...q},b(!1)},[S]),O=y.useCallback(()=>{I(m)},[m,I]),X=y.useCallback(q=>{if(!S)return;const H=S.run.kind,le=Og(q,H);x(le),I(le)},[S,I]),J=y.useCallback(q=>{d(H=>({column:H.column===q&&ua(H.direction)===null?null:q,direction:H.column===q?ua(H.direction):"asc"}))},[]),re=y.useCallback(q=>{h(H=>{const le=new Set(H);return le.has(q)?le.delete(q):le.add(q),le})},[]),ne=S?S.run.kind:null,A=y.useMemo(()=>ne==="config"?hy():dy(),[ne]),B=y.useMemo(()=>Object.fromEntries(A.map(q=>[q.id,q])),[A]),v=y.useCallback((q,H)=>{var le;return(le=B[H])==null?void 0:le.getValue(q)},[B]),F=S?S.run.trials:[],z=y.useMemo(()=>my(F,c,v),[F,c,v]),w=(S==null?void 0:S.run.bestTrialId)??null,Z=ne==="sampling"&&w?F.find(q=>q.id===w)??null:null,K=ne==="config"&&w?F.find(q=>q.id===w)??null:null,Q=y.useMemo(()=>{const q={},H=ne==="config"?la:ia;return q[H.id]=H,ne!=="config"&&(q[vl.id]=vl),q},[ne]);if(S){const q=!!(ne==="config"?K:Z);return e.jsxs("div",{className:"playground-history-container",children:[e.jsx("button",{className:"btn btn-small btn-secondary",style:{marginBottom:12},onClick:()=>l(null),children:" Back to list"}),e.jsxs("div",{style:{fontSize:13,color:"var(--color-gray-700)",marginBottom:12},children:[e.jsx("strong",{children:S.modelId||"Unknown model"}),"  ",S.sweepMode==="config"?"Config Sweep":"Sampling Sweep","  ",S.completedAt?new Date(S.completedAt).toLocaleDateString([],{month:"short",day:"numeric",year:"numeric"})+", "+new Date(S.completedAt).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}):""]}),e.jsxs("div",{className:"playground-autotest-best",children:[q?e.jsxs(e.Fragment,{children:[e.jsx("h4",{children:"Best Configuration Found"}),e.jsxs("div",{className:"playground-autotest-best-details",children:[ne==="config"&&K?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Context Window:"})," ",((Y=K.config)==null?void 0:Y.context_window)??""]}),e.jsxs("div",{children:[e.jsx("strong",{children:"NBatch:"})," ",((ee=K.config)==null?void 0:ee.nbatch)??""]}),e.jsxs("div",{children:[e.jsx("strong",{children:"NUBatch:"})," ",((C=K.config)==null?void 0:C.nubatch)??""]}),e.jsxs("div",{children:[e.jsx("strong",{children:"NSeqMax:"})," ",((R=K.config)==null?void 0:R.nseq_max)??""]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Flash Attention:"})," ",(($=K.config)==null?void 0:$.flash_attention)??""]}),e.jsxs("div",{children:[e.jsx("strong",{children:"KV Cache Type:"})," ",((ie=K.config)==null?void 0:ie.cache_type)??""]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Cache Mode:"})," ",(ce=K.config)!=null&&ce.cache_mode?K.config.cache_mode==="none"?"None":K.config.cache_mode.toUpperCase():""]})]}):Z?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Temperature:"})," ",Z.candidate.temperature]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Top P:"})," ",Z.candidate.top_p]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Top K:"})," ",Z.candidate.top_k]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Min P:"})," ",Z.candidate.min_p]})]}):null,(()=>{const H=ne==="config"?K:Z;return H?e.jsx(py,{trial:H,showScores:ne!=="config"}):null})()]})]}):e.jsx("div",{style:{fontSize:12,color:"var(--color-gray-700)"},children:"No best configuration could be selected. Adjust weights and reevaluate."}),e.jsxs("details",{className:"playground-sampling-params",style:{marginTop:q?12:0},children:[e.jsx("summary",{children:"Best Configuration Criteria"}),e.jsx("p",{style:{fontSize:12,color:"var(--color-gray-600)",marginBottom:8},children:"Weights control how the best configuration is chosen. Higher weight = more influence."}),e.jsxs("div",{style:{display:"flex",gap:6,marginBottom:10},children:[e.jsx("button",{type:"button",className:"btn btn-small",onClick:()=>X("overall"),children:"Best overall"}),e.jsx("button",{type:"button",className:"btn btn-small",onClick:()=>X("0pct"),children:"Best at 0% context"}),e.jsx("button",{type:"button",className:"btn btn-small",onClick:()=>X("80pct"),children:"Best at 80% context"})]}),e.jsx("div",{className:"playground-sweep-params",children:[...ne!=="config"?[["chatScore","Chat Score"],["toolScore","Tool Score"],["totalScore","Total Score"]]:[],["avgTPS","Avg TPS"],["avgTTFT","Avg TTFT (lower is better)"],["tps0","TPS @0% Fill"],["tps20","TPS @20% Fill"],["tps50","TPS @50% Fill"],["tps80","TPS @80% Fill"],["ttft0","TTFT @0% Fill (lower is better)"],["ttft20","TTFT @20% Fill (lower is better)"],["ttft50","TTFT @50% Fill (lower is better)"],["ttft80","TTFT @80% Fill (lower is better)"]].map(([H,le])=>e.jsxs("div",{className:"playground-sweep-param",children:[e.jsx("label",{className:"playground-sweep-param-toggle",htmlFor:`history-weight-${H}`,children:le}),e.jsx("input",{id:`history-weight-${H}`,type:"number",className:"playground-sweep-param-values",value:m[H],onChange:me=>{const ge=Number(me.target.value);Number.isFinite(ge)&&ge>=0&&P(H,ge)},step:.1,min:0})]},H))}),m.totalScore>0&&(m.chatScore>0||m.toolScore>0)&&e.jsx("p",{style:{fontSize:11,color:"var(--color-warning-text)",marginTop:6},children:" Total Score is derived from Chat/Tool weights. Weighting Total Score alongside Chat or Tool Score will double-count quality."}),e.jsx("button",{className:"btn btn-primary btn-small",style:{marginTop:8},onClick:O,disabled:!j,children:"Reevaluate"})]})]}),F.length>0&&e.jsxs("details",{className:"playground-autotest-results",open:!0,children:[e.jsxs("summary",{style:{cursor:"pointer",fontWeight:600,fontSize:13,color:"var(--color-gray-700)",marginBottom:8},children:["Results (",F.length," trials)",(()=>{const H=S.run.runStartedAt?Date.parse(S.run.runStartedAt):NaN,le=F.map(Re=>Re!=null&&Re.finishedAt?Date.parse(Re.finishedAt):NaN).filter(Number.isFinite),me=le.length>0?Math.max(...le):NaN;if(!Number.isFinite(H)||!Number.isFinite(me))return null;const ge=gn(Math.max(0,me-H)),ve=new Date(me),Se=ve.toLocaleDateString([],{month:"short",day:"numeric",year:"numeric"})+", "+ve.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",second:"2-digit"});return e.jsxs("span",{style:{fontWeight:400,fontSize:12,color:"var(--color-gray-500)",marginLeft:8},children:[" ",ge," total  finished ",Se]})})()]}),e.jsx("div",{className:"playground-autotest-table-scroll",children:e.jsxs("table",{className:"playground-autotest-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),A.map(H=>e.jsxs("th",{className:H.sortable!==!1?"sortable-th":void 0,onClick:H.sortable!==!1?()=>J(H.id):void 0,children:[H.title,uy(H.id,c)]},H.id))]})}),e.jsx("tbody",{children:z.map((H,le)=>{const me=H.status==="queued"||H.status==="running",ge=!1,ve=ne==="config"?K:Z,Se=ve&&H===ve,Re=u.has(H.id),qe={isPending:me,isInProgress:ge,isBest:!!Se,index:le};return e.jsxs(xa.Fragment,{children:[e.jsxs("tr",{className:`autotest-trial-row${Se?" autotest-best-row":""}${H.status==="skipped"?" autotest-skipped-row":""}`,style:{cursor:"pointer"},onClick:()=>re(H.id),children:[e.jsxs("td",{children:[Re?"":""," ",le+1]}),A.map(Ke=>e.jsx("td",{children:Ke.renderCell(H,qe)},Ke.id))]}),Re&&e.jsx("tr",{className:"autotest-detail-row",children:e.jsx("td",{colSpan:A.length+1,children:e.jsx(xy,{trial:H,scenarioLookup:Q,hideScores:ne==="config"})})})]},H.id)})})]})})]})]})}return r?e.jsx("div",{className:"playground-history-container",children:e.jsx("div",{style:{fontSize:13,color:"var(--color-gray-500)",padding:16},children:"Loading history"})}):e.jsx("div",{className:"playground-history-container",children:e.jsxs("div",{className:"playground-history-list",children:[e.jsxs("div",{className:"playground-history-header",children:[e.jsx("h3",{children:"Test Run History"}),t.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:k,type:"checkbox",checked:o.size===t.length&&t.length>0,onChange:()=>{o.size===t.length?a(new Set):a(new Set(t.map(q=>q.id)))},style:{marginLeft:8}}),e.jsxs("span",{style:{fontSize:12,color:"var(--color-gray-500)"},children:[t.length," run",t.length!==1?"s":""]})]}),o.size>0&&e.jsxs("button",{className:"btn btn-small btn-danger",style:{marginLeft:8},onClick:D,children:["Delete Selected (",o.size,")"]}),e.jsx("button",{className:"btn btn-small btn-secondary",style:{marginLeft:8},onClick:()=>{L()},children:"Export"}),e.jsx("button",{className:"btn btn-small btn-secondary",style:{marginLeft:4},onClick:()=>{var q;return(q=g.current)==null?void 0:q.click()},children:"Import"}),e.jsx("input",{ref:g,type:"file",accept:".json",style:{display:"none"},onChange:q=>{var le;const H=(le=q.target.files)==null?void 0:le[0];H&&T(H),q.target.value=""}}),N&&e.jsx("span",{style:{fontSize:12,color:"var(--color-gray-600)",marginLeft:8},children:N})]}),t.length===0?e.jsx("div",{className:"playground-history-empty",children:"No test runs saved yet. Complete an automated test run and it will appear here."}):t.map(q=>{var H;return e.jsxs("div",{className:`playground-history-item ${i===q.id?"active":""}`,onClick:()=>_(q.id),children:[e.jsx("input",{type:"checkbox",checked:o.has(q.id),onClick:le=>le.stopPropagation(),onChange:()=>{a(le=>{const me=new Set(le);return me.has(q.id)?me.delete(q.id):me.add(q.id),me})}}),e.jsxs("div",{className:"playground-history-item-content",children:[e.jsx("div",{className:"playground-history-item-model",children:q.modelId||"Unknown model"}),e.jsxs("div",{className:"playground-history-item-meta",children:[e.jsx("span",{className:"playground-history-item-mode",children:q.sweepMode==="config"?"Config Sweep":"Sampling Sweep"}),e.jsx("span",{className:"playground-history-item-date",children:q.completedAt?new Date(q.completedAt).toLocaleDateString([],{month:"short",day:"numeric",year:"numeric"})+", "+new Date(q.completedAt).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}):""})]}),e.jsxs("div",{className:"playground-history-item-stats",children:[((H=q.run.trials)==null?void 0:H.length)??0," trials"]})]}),e.jsx("button",{className:"btn btn-small btn-danger playground-history-delete",onClick:le=>{le.stopPropagation(),E(q.id)},children:"Delete"})]},q.id)})]})})}const yo="__new__",SE=JSON.stringify(te,null,2);function _E(){var Nu;const t=Ml(),{models:n,loadModels:r}=Ma(),{download:s,isDownloading:i,startDownload:l,cancelDownload:o,clearDownload:a}=Ia(),c=y.useRef(null),d=y.useRef(""),u=y.useRef(null),h=y.useRef(0),m=y.useRef(0),x=y.useRef([]),{session:j,setSession:b,chatMessages:N,setChatMessages:f,selectedModel:p,setSelectedModel:g,playgroundMode:k,setPlaygroundMode:S,activeTab:_,setActiveTab:E,systemPrompt:D,setSystemPrompt:L,lastTPS:T,setLastTPS:P,templateMode:I,setTemplateMode:O,selectedTemplate:X,setSelectedTemplate:J,customScript:re,setCustomScript:ne,contextWindow:A,setContextWindow:B,nBatch:v,setNBatch:F,nUBatch:z,setNUBatch:w,nSeqMax:Z,setNSeqMax:K,flashAttention:Q,setFlashAttention:Y,cacheType:ee,setCacheType:C,cacheMode:R,setCacheMode:$,hydratedModelId:ie,setHydratedModelId:ce}=lE(),[q,H]=y.useState([]),[le,me]=y.useState(.8),[ge,ve]=y.useState(.9),[Se,Re]=y.useState(40),[qe,Ke]=y.useState(0),[et,ze]=y.useState(4096),[G,se]=y.useState(1),[he,je]=y.useState(64),[Ne,tt]=y.useState(0),[Nt,jt]=y.useState(0),[Vt,on]=y.useState(1.05),[st,mt]=y.useState(1.75),[yt,M]=y.useState(2),[de,xe]=y.useState(0),[we,bt]=y.useState(0),[at,Ue]=y.useState(.1),[Ct,dr]=y.useState(1),[Pt,Bn]=y.useState("true"),[Yn,Ur]=y.useState("medium"),[$e,hr]=y.useState(null),[ht,Tn]=y.useState(!1),[Cn,Kr]=y.useState(!1),[Bl,zr]=y.useState(""),[Gr,js]=y.useState(""),[ur,mr]=y.useState(!1),Dt=y.useRef(null),V=y.useRef(null),pe=y.useRef(null),Ce=y.useRef(j);Ce.current=j;const[nt,Ge]=y.useState(!1),[kt,Lt]=y.useState(""),[Vr,an]=y.useState(""),[Pn,ys]=y.useState(!1),Et=y.useRef(new Set),Ul=y.useRef(!1),yu=y.useRef(""),[Ua,fy]=y.useState(SE),[Ka,gy]=y.useState("What's the weather in Boston? Use the get_weather tool."),[bu,Kl]=y.useState(""),[xi,za]=y.useState([]),[zl,fi]=y.useState(!1),[Ga,jy]=y.useState("Hello, how are you?"),[Va,Ha]=y.useState(""),[Gl,$a]=y.useState(!1),ku=y.useCallback(async()=>{try{const U=await fe.listPlaygroundTemplates();H(U)}catch{}},[]);y.useEffect(()=>{r(),ku()},[r,ku]),y.useEffect(()=>{if(!p||p===yo){hr(null);return}if(ie===p)return;let U=!1;return Tn(!0),fe.showModel(p).then(Ee=>{if(U)return;const Te=Ee.model_config;Te&&(hr(Te),B(Te["context-window"]||8192),F(Te.nbatch||2048),w(Te.nubatch||512),K(Te["nseq-max"]||1),Y(Te["flash-attention"]||"enabled"),C(Te["cache-type-k"]||Te["cache-type-v"]||""),$(Te["incremental-cache"]?"imc":Te["system-prompt-cache"]?"spc":"none")),ce(p)}).catch(Ee=>{U||zr(Ee.message||"Failed to load model config")}).finally(()=>{U||Tn(!1)}),()=>{U=!0}},[p,ie]),y.useEffect(()=>{var U;(U=c.current)==null||U.scrollIntoView({behavior:ur?"auto":"smooth"})},[N,ur]),y.useEffect(()=>()=>{var U,Ee,Te;(U=Dt.current)==null||U.call(Dt),(Ee=V.current)==null||Ee.call(V),(Te=pe.current)==null||Te.call(pe),u.current&&clearTimeout(u.current)},[]);const yy=()=>{var Ee;const U=kt.trim();!U||i||j||(Et.current=new Set(((Ee=n==null?void 0:n.data)==null?void 0:Ee.map(Te=>Te.id))||[]),yu.current=U.split("/").pop()||"",Ul.current=!0,l(U,Vr.trim()||void 0))};y.useEffect(()=>{if(!Ul.current)return;if((s==null?void 0:s.status)==="error"){Ul.current=!1;return}if((s==null?void 0:s.status)!=="complete")return;const U=Et.current,Ee=(n==null?void 0:n.data)??[],Te=Ee.filter(Rt=>!U.has(Rt.id)),St=yu.current,Ft=Te.find(Rt=>St&&Rt.id.includes(St))??Te.find(Rt=>!Rt.id.includes("mmproj")&&!Rt.id.includes("proj"))??Te[0]??Ee.find(Rt=>St&&Rt.id.includes(St));Ul.current=!1,Ft&&(g(Ft.id),Ge(!1),Lt(""),an(""),ys(!1)),a()},[n,s==null?void 0:s.status]);const by=async()=>{if(p){if(z>v){zr(`nubatch (${z}) must not exceed nbatch (${v})`);return}Kr(!0),zr("");try{const U={};(!$e||A!==($e["context-window"]||8192))&&(U.context_window=A),(!$e||v!==($e.nbatch||2048))&&(U.nbatch=v),(!$e||z!==($e.nubatch||512))&&(U.nubatch=z),(!$e||Z!==($e["nseq-max"]||1))&&(U.nseq_max=Z),(!$e||Q!==($e["flash-attention"]||"enabled"))&&(U.flash_attention=Q),(!$e||ee!==($e["cache-type-k"]||""))&&(U.cache_type_k=ee||"f16",U.cache_type_v=ee||"f16");const Ee=$e!=null&&$e["incremental-cache"]?"imc":$e!=null&&$e["system-prompt-cache"]?"spc":"none";(!$e||R!==Ee)&&(U.system_prompt_cache=R==="spc",U.incremental_cache=R==="imc");const Te=await fe.createPlaygroundSession({model_id:p,template_mode:I,template_name:I==="builtin"?X:void 0,template_script:I==="custom"?re:void 0,config:U});b(Te),f([])}catch(U){zr(U.message||"Failed to create session")}finally{Kr(!1)}}},ky=async()=>{var U,Ee,Te;if(j){(U=Dt.current)==null||U.call(Dt),Dt.current=null,(Ee=V.current)==null||Ee.call(V),V.current=null,(Te=pe.current)==null||Te.call(pe),pe.current=null,fi(!1),u.current&&(clearTimeout(u.current),u.current=null),mr(!1);try{await fe.deletePlaygroundSession(j.session_id),b(null),f([])}catch(St){zr(St.message||"Failed to unload session")}}},vu=y.useCallback(U=>new Promise((Ee,Te)=>{const St=[{role:"user",content:"hello, model!"}],Ft=fe.streamPlaygroundChat({session_id:U,messages:St,stream:!0,max_tokens:32,temperature:le,top_p:ge,top_k:Se,min_p:qe},()=>{},Rt=>{V.current=null,Te(new Error(Rt))},()=>{V.current=null,Ee()});V.current=Ft}),[le,ge,Se,qe]),wu=y.useCallback(async()=>{var gi;if(!j||!Gr.trim()||ur)return;const U=Gr.trim(),Ee=N,Te=j.session_id,St=++h.current;if(js(""),mr(!0),P(null),f(pt=>[...pt,{role:"user",content:U},{role:"assistant",content:R==="imc"?"":" Warming up model..."}]),R!=="imc"){(gi=V.current)==null||gi.call(V),V.current=null;try{await vu(Te)}catch{}await new Promise(pt=>setTimeout(pt,1e3))}if(!Ce.current||Ce.current.session_id!==Te||h.current!==St){mr(!1);return}const Ft=[];D.trim()&&Ft.push({role:"system",content:D});for(const pt of Ee)Ft.push({role:pt.role,content:pt.content});Ft.push({role:"user",content:U}),f(pt=>{const Ht=[...pt];return Ht[Ht.length-1]={role:"assistant",content:""},Ht}),d.current="",u.current&&(clearTimeout(u.current),u.current=null);let Rt="";const cn=fe.streamPlaygroundChat({session_id:Te,messages:Ft,stream:!0,stream_options:{include_usage:!0},temperature:le,top_p:ge,top_k:Se,min_p:qe,max_tokens:et,repeat_penalty:G,repeat_last_n:he,frequency_penalty:Ne,presence_penalty:Nt,dry_multiplier:Vt,dry_base:st,dry_allowed_length:yt,dry_penalty_last_n:de,xtc_probability:we,xtc_threshold:at,xtc_min_keep:Ct,enable_thinking:Pt,reasoning_effort:Yn},pt=>{var dn,ji,yi;const Ht=(ji=(dn=pt.choices)==null?void 0:dn[0])==null?void 0:ji.delta;Ht!=null&&Ht.content&&(Rt+=Ht.content,d.current=Rt,u.current||(u.current=setTimeout(()=>{u.current=null;const Vl=d.current;f(Ot=>{const En=[...Ot];return En[En.length-1]={role:"assistant",content:Vl},En})},50))),(yi=pt.usage)!=null&&yi.tokens_per_second&&P(pt.usage.tokens_per_second)},pt=>{u.current&&(clearTimeout(u.current),u.current=null),f(Ht=>{const dn=[...Ht];return dn[dn.length-1]={role:"assistant",content:`Error: ${pt}`},dn}),Dt.current=null,mr(!1)},()=>{u.current&&(clearTimeout(u.current),u.current=null);const pt=d.current;pt&&f(Ht=>{const dn=[...Ht];return dn[dn.length-1]={role:"assistant",content:pt},dn}),Dt.current=null,mr(!1)});Dt.current=cn},[j,Gr,ur,D,N,R,le,ge,Se,qe,et,G,he,Ne,Nt,Vt,st,yt,de,we,at,Ct,Pt,Yn,vu]),vy=()=>{var Ee,Te;h.current++,(Ee=Dt.current)==null||Ee.call(Dt),Dt.current=null,(Te=V.current)==null||Te.call(V),V.current=null,u.current&&(clearTimeout(u.current),u.current=null);const U=d.current;U&&f(St=>{const Ft=[...St];return Ft.length>0&&(Ft[Ft.length-1]={role:"assistant",content:U}),Ft}),mr(!1)},wy=y.useCallback(()=>{if(!j||zl)return;fi(!0),Kl(""),za([]);let U;try{U=JSON.parse(Ua)}catch{Kl("Invalid JSON in tool definitions"),fi(!1);return}const Ee=[{role:"user",content:Ka}];let Te="",St=[];const Ft=fe.streamPlaygroundChat({session_id:j.session_id,messages:Ee,tools:U,stream:!0},Rt=>{var gi,pt,Ht,dn,ji,yi,Vl;const cn=(gi=Rt.choices)==null?void 0:gi[0];if((pt=cn==null?void 0:cn.delta)!=null&&pt.content&&(Te+=cn.delta.content),(Ht=cn==null?void 0:cn.delta)!=null&&Ht.tool_calls)for(const Ot of cn.delta.tool_calls){const En=St.find(Ty=>Ty.index===Ot.index);En?(Ot.id&&!En.id&&(En.id=Ot.id),Ot.type&&(En.type=Ot.type),(dn=Ot.function)!=null&&dn.name&&!En.function.name&&(En.function.name=Ot.function.name),(ji=Ot.function)!=null&&ji.arguments&&(En.function.arguments+=Ot.function.arguments)):St.push({id:Ot.id||"",index:Ot.index,type:Ot.type||"function",function:{name:((yi=Ot.function)==null?void 0:yi.name)||"",arguments:((Vl=Ot.function)==null?void 0:Vl.arguments)||""}})}(cn==null?void 0:cn.finish_reason)==="tool_calls"&&za([...St])},Rt=>{pe.current=null,Kl(`Error: ${Rt}`),fi(!1)},()=>{pe.current=null,Kl(Te),St.length>0&&za([...St]),fi(!1)});pe.current=Ft},[j,zl,Ua,Ka]),Ny=y.useCallback(()=>{if(!j||Gl)return;$a(!0),Ha("");const U=[{role:"user",content:Ga}];D.trim()&&U.unshift({role:"system",content:D});let Ee="";fe.streamPlaygroundChat({session_id:j.session_id,messages:U,stream:!0,return_prompt:!0,max_tokens:1},Te=>{Te.prompt&&(Ee=Te.prompt)},Te=>{Ha(`Error: ${Te}`),$a(!1)},()=>{Ha(Ee||"(No prompt returned  prompt may appear in final response)"),$a(!1)})},[j,Gl,Ga,D]),Sy=()=>{if(!j)return;const U={id:p,template:I==="builtin"?X:"",template_script:I==="custom"?re:"",config:{"context-window":A,nbatch:v,nubatch:z,"nseq-max":Z,"flash-attention":Q,"cache-type-k":ee,"cache-type-v":ee,"system-prompt-cache":R==="spc","incremental-cache":R==="imc"},capabilities:{streaming:!0,tooling:xi.length>0}};sessionStorage.setItem("kronk_catalog_draft",JSON.stringify(U)),t("/catalog/editor?source=playground")},_y=U=>{U.key==="Enter"&&!U.shiftKey&&(U.preventDefault(),wu())};for(;x.current.length<N.length;)x.current.push(++m.current);return x.current.length=N.length,e.jsxs("div",{className:"playground-container",children:[e.jsxs("div",{className:"playground-header",children:[e.jsx("h2",{children:"Model Playground"}),j&&e.jsx("button",{className:"btn btn-secondary",onClick:Sy,children:"Export to Catalog Editor"})]}),e.jsxs("div",{className:"playground-layout",children:[e.jsxs("div",{className:"playground-mode-selector",children:[e.jsxs("div",{className:"playground-model-config",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"pg-model",children:"Model"}),e.jsxs("select",{id:"pg-model",value:nt?yo:p,onChange:U=>{const Ee=U.target.value;Ee===yo?(g(""),Ge(!0)):(g(Ee),Ge(!1))},disabled:!!j,children:[e.jsx("option",{value:"",children:"Select a model..."}),(Nu=n==null?void 0:n.data)==null?void 0:Nu.map(U=>e.jsx("option",{value:U.id,children:U.id},U.id)),e.jsx("option",{value:yo,children:"New"})]})]}),nt&&!j&&e.jsxs("div",{className:"playground-pull-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"HuggingFace Model URL or Shorthand"}),e.jsx("input",{type:"text",value:kt,onChange:U=>Lt(U.target.value),placeholder:"owner/repo:Q4_K_M or org/repo/model.gguf",disabled:i})]}),e.jsx("button",{type:"button",className:"btn btn-secondary btn-small playground-pull-toggle",onClick:()=>ys(U=>!U),disabled:i,children:Pn?" Hide projection URL":"+ Projection URL (optional)"}),Pn&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Projection URL (vision/audio models)"}),e.jsx("input",{type:"text",value:Vr,onChange:U=>an(U.target.value),placeholder:"org/repo/mmproj.gguf",disabled:i})]}),e.jsxs("div",{className:"playground-pull-actions",children:[e.jsx("button",{className:"btn btn-primary",type:"button",onClick:yy,disabled:i||!kt.trim(),children:i?"Pulling":"Pull"}),i&&e.jsx("button",{className:"btn btn-danger",type:"button",onClick:o,children:"Cancel"}),s&&s.status!=="downloading"&&e.jsx("button",{className:"btn",type:"button",onClick:a,children:"Clear"})]}),s&&s.messages.length>0&&e.jsx("div",{className:"status-box playground-pull-status",children:s.messages.map((U,Ee)=>e.jsx("div",{className:`status-line ${U.type}`,children:U.text},Ee))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"pg-template-mode",children:"Template Mode"}),e.jsxs("select",{id:"pg-template-mode",value:I,onChange:U=>O(U.target.value),disabled:!!j,children:[e.jsx("option",{value:"builtin",children:"Builtin"}),e.jsx("option",{value:"custom",children:"Custom"})]})]}),I==="builtin"?e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"pg-template",children:"Template"}),e.jsxs("select",{id:"pg-template",value:X,onChange:U=>J(U.target.value),disabled:!!j,children:[e.jsx("option",{value:"",children:"Auto (from catalog)"}),q.map(U=>e.jsx("option",{value:U.name,children:U.name},U.name))]})]}):e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"pg-template-script",children:"Template Script"}),e.jsx("textarea",{id:"pg-template-script",value:re,onChange:U=>ne(U.target.value),disabled:!!j,rows:8,className:"playground-textarea",placeholder:"Paste Jinja template..."})]})]}),e.jsx("button",{className:`playground-mode-btn ${k==="automated"?"active":""}`,onClick:()=>S("automated"),children:"Automated Mode"}),e.jsx("button",{className:`playground-mode-btn ${k==="manual"?"active":""}`,onClick:()=>S("manual"),children:"Manual Mode"}),e.jsx("button",{className:`playground-mode-btn ${k==="history"?"active":""}`,onClick:()=>S("history"),children:"History"})]}),k==="automated"&&e.jsx("div",{className:"playground-test",style:{flex:1},children:e.jsx("div",{className:"playground-tab-content",children:e.jsx(wE,{session:j,catalogSampling:($e==null?void 0:$e["sampling-parameters"])??null,sessionSeed:{model_id:p,template_mode:I,template_name:I==="builtin"?X:void 0,template_script:I==="custom"?re:void 0,base_config:{context_window:A,nbatch:v,nubatch:z,nseq_max:Z,flash_attention:Q,cache_type_k:ee||void 0,cache_type_v:ee||void 0,system_prompt_cache:R==="spc",incremental_cache:R==="imc"}}})})}),k==="history"&&e.jsx("div",{className:"playground-test",style:{flex:1},children:e.jsx("div",{className:"playground-tab-content",children:e.jsx(NE,{})})}),k==="manual"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"playground-setup",children:[e.jsx("h3",{children:"Setup"}),e.jsx("h4",{children:"Configuration"}),e.jsxs("div",{className:"playground-config-grid-fluid",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"pg-context-window",children:["Context Window",e.jsx(be,{text:ye.contextWindow})]}),e.jsx("input",{id:"pg-context-window",type:"number",value:A,onChange:U=>B(Number(U.target.value)),disabled:!!j})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"pg-nbatch",children:["NBatch",e.jsx(be,{text:ye.nbatch})]}),e.jsx("input",{id:"pg-nbatch",type:"number",value:v,onChange:U=>F(Number(U.target.value)),disabled:!!j})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"pg-nubatch",children:["NUBatch",e.jsx(be,{text:ye.nubatch})]}),e.jsx("input",{id:"pg-nubatch",type:"number",value:z,onChange:U=>w(Number(U.target.value)),disabled:!!j})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"pg-nseqmax",children:["NSeqMax",e.jsx(be,{text:ye.nSeqMax})]}),e.jsx("input",{id:"pg-nseqmax",type:"number",value:Z,onChange:U=>K(Number(U.target.value)),min:1,disabled:!!j})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"pg-flash-attn",children:["Flash Attention",e.jsx(be,{text:ye.flashAttention})]}),e.jsxs("select",{id:"pg-flash-attn",value:Q,onChange:U=>Y(U.target.value),disabled:!!j,children:[e.jsx("option",{value:"auto",children:"Auto"}),e.jsx("option",{value:"enabled",children:"Enabled"}),e.jsx("option",{value:"disabled",children:"Disabled"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"pg-cache-type",children:["KV Cache Type",e.jsx(be,{text:ye.cacheType})]}),e.jsxs("select",{id:"pg-cache-type",value:ee,onChange:U=>C(U.target.value),disabled:!!j,children:[e.jsx("option",{value:"",children:"Default (f16)"}),e.jsx("option",{value:"f16",children:"f16"}),e.jsx("option",{value:"q8_0",children:"q8_0"}),e.jsx("option",{value:"q4_0",children:"q4_0"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Cache Mode",e.jsx(be,{text:ye.cacheMode})]}),e.jsxs("select",{value:R,onChange:U=>$(U.target.value),disabled:!!j,children:[e.jsx("option",{value:"none",children:"None"}),e.jsx("option",{value:"spc",children:"SPC (System Prompt)"}),e.jsx("option",{value:"imc",children:"IMC (Incremental)"})]})]})]}),e.jsx("div",{className:"playground-session-controls",children:j?e.jsx("button",{className:"btn btn-danger",onClick:ky,children:"Unload Session"}):e.jsx("button",{className:"btn btn-primary",onClick:by,disabled:!p||Cn||ht,children:Cn?"Loading Model...":ht?"Loading Config...":"Create Session"})}),Bl&&e.jsx("div",{className:"playground-error",children:Bl}),j&&e.jsxs("div",{className:"playground-session-info",children:[e.jsx("strong",{children:"Session:"})," ",j.session_id,e.jsx("br",{}),e.jsx("strong",{children:"Status:"})," ",j.status,j.effective_config&&e.jsxs("div",{className:"playground-effective-config",children:[e.jsx("strong",{children:"Effective Config:"}),e.jsx("div",{className:"playground-config-grid",children:Object.entries(j.effective_config).map(([U,Ee])=>e.jsxs("div",{className:"playground-config-item",children:[e.jsxs("span",{className:"playground-config-key",children:[U,":"]})," ",e.jsx("span",{className:"playground-config-value",children:String(Ee)})]},U))})]})]})]}),e.jsxs("div",{className:"playground-test",children:[e.jsxs("div",{className:"playground-tabs",role:"tablist",children:[e.jsx("button",{role:"tab",id:"tab-chat","aria-selected":_==="chat","aria-controls":"tabpanel-chat",className:`playground-tab ${_==="chat"?"active":""}`,onClick:()=>E("chat"),children:"Basic Chat"}),e.jsx("button",{role:"tab",id:"tab-tools","aria-selected":_==="tools","aria-controls":"tabpanel-tools",className:`playground-tab ${_==="tools"?"active":""}`,onClick:()=>E("tools"),children:"Tool Calling Test"}),e.jsx("button",{role:"tab",id:"tab-inspector","aria-selected":_==="inspector","aria-controls":"tabpanel-inspector",className:`playground-tab ${_==="inspector"?"active":""}`,onClick:()=>E("inspector"),children:"Prompt Inspector"})]}),e.jsxs("div",{className:"playground-tab-content",children:[_==="chat"&&e.jsxs("div",{role:"tabpanel",id:"tabpanel-chat","aria-labelledby":"tab-chat",className:"playground-chat",children:[e.jsxs("details",{className:"playground-sampling-params",children:[e.jsx("summary",{children:"Chat Parameters"}),e.jsx("h5",{className:"playground-param-group-title",children:"System Prompt"}),e.jsx("div",{className:"form-group",children:e.jsx("textarea",{value:D,onChange:U=>L(U.target.value),rows:2,className:"playground-textarea"})}),e.jsx("h5",{className:"playground-param-group-title",children:"Generation"}),e.jsxs("div",{className:"playground-config-grid-fluid",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"pg-temperature",children:["Temperature",e.jsx(be,{text:ye.temperature})]}),e.jsx("input",{id:"pg-temperature",type:"number",value:le,onChange:U=>me(Number(U.target.value)),step:.1,min:0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"pg-top-p",children:["Top P",e.jsx(be,{text:ye.top_p})]}),e.jsx("input",{id:"pg-top-p",type:"number",value:ge,onChange:U=>ve(Number(U.target.value)),step:.05,min:0,max:1})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"pg-top-k",children:["Top K",e.jsx(be,{text:ye.top_k})]}),e.jsx("input",{id:"pg-top-k",type:"number",value:Se,onChange:U=>Re(Math.floor(Number(U.target.value))),step:1,min:0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"pg-min-p",children:["Min P",e.jsx(be,{text:ye.min_p})]}),e.jsx("input",{id:"pg-min-p",type:"number",value:qe,onChange:U=>Ke(Number(U.target.value)),step:.01,min:0,max:1})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"pg-max-tokens",children:["Max Tokens",e.jsx(be,{text:ye.max_tokens})]}),e.jsx("input",{id:"pg-max-tokens",type:"number",value:et,onChange:U=>ze(Math.floor(Number(U.target.value))),step:256,min:1})]})]}),e.jsx("h5",{className:"playground-param-group-title",children:"Repetition Control"}),e.jsxs("div",{className:"playground-config-grid-fluid",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Repeat Penalty",e.jsx(be,{text:ye.repeat_penalty})]}),e.jsx("input",{type:"number",value:G,onChange:U=>se(Number(U.target.value)),step:.1,min:0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Repeat Last N",e.jsx(be,{text:ye.repeat_last_n})]}),e.jsx("input",{type:"number",value:he,onChange:U=>je(Math.floor(Number(U.target.value))),step:1,min:0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Frequency Penalty",e.jsx(be,{text:ye.frequency_penalty})]}),e.jsx("input",{type:"number",value:Ne,onChange:U=>tt(Number(U.target.value)),step:.1,min:0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Presence Penalty",e.jsx(be,{text:ye.presence_penalty})]}),e.jsx("input",{type:"number",value:Nt,onChange:U=>jt(Number(U.target.value)),step:.1,min:0})]})]}),e.jsx("h5",{className:"playground-param-group-title",children:"DRY Sampler"}),e.jsxs("div",{className:"playground-config-grid-fluid",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["DRY Multiplier",e.jsx(be,{text:ye.dry_multiplier})]}),e.jsx("input",{type:"number",value:Vt,onChange:U=>on(Number(U.target.value)),step:.05,min:0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["DRY Base",e.jsx(be,{text:ye.dry_base})]}),e.jsx("input",{type:"number",value:st,onChange:U=>mt(Number(U.target.value)),step:.05,min:0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["DRY Allowed Length",e.jsx(be,{text:ye.dry_allowed_length})]}),e.jsx("input",{type:"number",value:yt,onChange:U=>M(Math.floor(Number(U.target.value))),step:1,min:0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["DRY Penalty Last N",e.jsx(be,{text:ye.dry_penalty_last_n})]}),e.jsx("input",{type:"number",value:de,onChange:U=>xe(Math.floor(Number(U.target.value))),step:1,min:0})]})]}),e.jsx("h5",{className:"playground-param-group-title",children:"XTC Sampler"}),e.jsxs("div",{className:"playground-config-grid-fluid",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["XTC Probability",e.jsx(be,{text:ye.xtc_probability})]}),e.jsx("input",{type:"number",value:we,onChange:U=>bt(Number(U.target.value)),step:.01,min:0,max:1})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["XTC Threshold",e.jsx(be,{text:ye.xtc_threshold})]}),e.jsx("input",{type:"number",value:at,onChange:U=>Ue(Number(U.target.value)),step:.01,min:0,max:1})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["XTC Min Keep",e.jsx(be,{text:ye.xtc_min_keep})]}),e.jsx("input",{type:"number",value:Ct,onChange:U=>dr(Math.floor(Number(U.target.value))),step:1,min:1})]})]}),e.jsx("h5",{className:"playground-param-group-title",children:"Reasoning"}),e.jsxs("div",{className:"playground-config-grid-fluid",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"pg-enable-thinking",children:["Enable Thinking",e.jsx(be,{text:ye.enable_thinking})]}),e.jsxs("select",{id:"pg-enable-thinking",value:Pt,onChange:U=>Bn(U.target.value),children:[e.jsx("option",{value:"true",children:"Enabled"}),e.jsx("option",{value:"false",children:"Disabled"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"pg-reasoning-effort",children:["Reasoning Effort",e.jsx(be,{text:ye.reasoning_effort})]}),e.jsxs("select",{id:"pg-reasoning-effort",value:Yn,onChange:U=>Ur(U.target.value),children:[e.jsx("option",{value:"none",children:"None"}),e.jsx("option",{value:"minimal",children:"Minimal"}),e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]})]})]}),e.jsxs("div",{className:"playground-messages",children:[N.map((U,Ee)=>e.jsxs("div",{className:`playground-message playground-message-${U.role}`,children:[e.jsx("div",{className:"playground-message-role",children:U.role}),e.jsx("div",{className:"playground-message-content",children:U.content})]},x.current[Ee])),e.jsx("div",{ref:c})]}),e.jsxs("div",{className:"playground-input-row",children:[e.jsx("textarea",{value:Gr,onChange:U=>js(U.target.value),onKeyDown:_y,placeholder:j?"Type a message...":"Create a session first",disabled:!j||ur,rows:2,className:"playground-textarea"}),ur?e.jsx("button",{className:"btn btn-danger",onClick:vy,children:"Stop"}):e.jsx("button",{className:"btn btn-primary",onClick:wu,disabled:!j||!Gr.trim(),children:"Send"}),T!==null&&e.jsxs("span",{style:{fontSize:12,opacity:.7,marginLeft:8,whiteSpace:"nowrap"},children:[T.toFixed(1)," TPS"]})]})]}),_==="tools"&&e.jsxs("div",{role:"tabpanel",id:"tabpanel-tools","aria-labelledby":"tab-tools",className:"playground-tools",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Tool Definitions (JSON)"}),e.jsx("textarea",{value:Ua,onChange:U=>fy(U.target.value),rows:12,className:"playground-textarea monospace"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Test Prompt"}),e.jsx("input",{type:"text",value:Ka,onChange:U=>gy(U.target.value)})]}),e.jsx("button",{className:"btn btn-primary",onClick:wy,disabled:!j||zl,children:zl?"Running...":"Run Test"}),(xi.length>0||bu)&&e.jsxs("div",{className:"playground-tool-results",children:[e.jsx("h4",{children:"Results"}),xi.length>0?e.jsxs("div",{className:"playground-tool-pass",children:[e.jsx("span",{className:"playground-badge success",children:"PASS"}),"Model emitted ",xi.length," tool call(s)",xi.map((U,Ee)=>e.jsxs("div",{className:"playground-tool-call",children:[e.jsx("strong",{children:U.function.name}),e.jsx("pre",{children:U.function.arguments}),U.id&&e.jsxs("small",{children:["ID: ",U.id]})]},Ee))]}):e.jsxs("div",{className:"playground-tool-fail",children:[e.jsx("span",{className:"playground-badge fail",children:"NO TOOL CALLS"}),e.jsx("pre",{children:bu})]})]})]}),_==="inspector"&&e.jsxs("div",{role:"tabpanel",id:"tabpanel-inspector","aria-labelledby":"tab-inspector",className:"playground-inspector",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Test Message"}),e.jsx("input",{type:"text",value:Ga,onChange:U=>jy(U.target.value)})]}),e.jsx("button",{className:"btn btn-primary",onClick:Ny,disabled:!j||Gl,children:Gl?"Rendering...":"Render Prompt"}),Va&&e.jsxs("div",{className:"playground-rendered-prompt",children:[e.jsxs("div",{className:"playground-prompt-header",children:[e.jsx("h4",{children:"Rendered Prompt"}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>navigator.clipboard.writeText(Va),children:"Copy"})]}),e.jsx("pre",{className:"playground-prompt-text",children:Va})]})]})]})]})]})]})]})}const Ki={home:"/",chat:"/chat","vram-calculator":"/vram-calculator",playground:"/playground","model-list":"/models","model-ps":"/models/running","model-pull":"/models/pull","catalog-list":"/catalog","catalog-editor":"/catalog/editor","libs-pull":"/libs/pull","security-key-list":"/security/keys","security-key-create":"/security/keys/create","security-key-delete":"/security/keys/delete","security-token-create":"/security/tokens/create",settings:"/settings","docs-sdk":"/docs/sdk","docs-sdk-kronk":"/docs/sdk/kronk","docs-sdk-model":"/docs/sdk/model","docs-sdk-examples":"/docs/sdk/examples","docs-cli-catalog":"/docs/cli/catalog","docs-cli-libs":"/docs/cli/libs","docs-cli-model":"/docs/cli/model","docs-cli-run":"/docs/cli/run","docs-cli-security":"/docs/cli/security","docs-cli-server":"/docs/cli/server","docs-api-chat":"/docs/api/chat","docs-api-messages":"/docs/api/messages","docs-api-responses":"/docs/api/responses","docs-api-embeddings":"/docs/api/embeddings","docs-api-rerank":"/docs/api/rerank","docs-api-tokenize":"/docs/api/tokenize","docs-api-tools":"/docs/api/tools","docs-manual":"/docs/manual"},TE=Object.fromEntries(Object.entries(Ki).map(([t,n])=>[n,t]));function CE(){return e.jsxs("div",{className:"home-page",children:[e.jsxs("div",{className:"hero-section",children:[e.jsx("img",{src:"https://raw.githubusercontent.com/ardanlabs/kronk/refs/heads/main/images/project/kronk_banner.jpg",alt:"Kronk Banner",className:"hero-banner"}),e.jsx("p",{className:"hero-tagline",children:"Hardware-accelerated local inference with llama.cpp directly integrated into your Go applications"})]}),e.jsxs("div",{className:"features-grid",children:[e.jsxs("div",{className:"feature-card",children:[e.jsx("div",{className:"feature-icon",children:""}),e.jsx("h3",{children:"High-Level Go API"}),e.jsx("p",{children:"Feels similar to using an OpenAI compatible API, but runs entirely on your hardware"})]}),e.jsxs("div",{className:"feature-card",children:[e.jsx("div",{className:"feature-icon",children:""}),e.jsx("h3",{children:"OpenAI Compatible Server"}),e.jsx("p",{children:"Model server for chat completions and embeddings, compatible with OpenWebUI"})]}),e.jsxs("div",{className:"feature-card",children:[e.jsx("div",{className:"feature-icon",children:""}),e.jsx("h3",{children:"Multimodal Support"}),e.jsx("p",{children:"Text, vision, and audio models with full hardware acceleration"})]}),e.jsxs("div",{className:"feature-card",children:[e.jsx("div",{className:"feature-icon",children:""}),e.jsx("h3",{children:"GPU Acceleration"}),e.jsx("p",{children:"Metal on macOS, CUDA/Vulkan/ROCm on Linux, CUDA/Vulkan on Windows"})]})]}),e.jsx("div",{className:"home-cta",children:e.jsx("p",{children:"Use the sidebar to manage models, browse the catalog, or explore the SDK documentation."})})]})}function PE(){return e.jsx(rw,{children:e.jsx(qw,{children:e.jsx(Zw,{children:e.jsx(dw,{children:e.jsx(hw,{children:e.jsx(Ow,{children:e.jsx(iE,{children:e.jsx(hP,{children:e.jsx(bP,{children:e.jsx(mP,{children:e.jsx(Uw,{children:e.jsxs(Qv,{children:[e.jsx(Ae,{path:"/",element:e.jsx(CE,{})}),e.jsx(Ae,{path:"/chat",element:e.jsx(TP,{})}),e.jsx(Ae,{path:"/vram-calculator",element:e.jsx(sE,{})}),e.jsx(Ae,{path:"/playground",element:e.jsx(_E,{})}),e.jsx(Ae,{path:"/models",element:e.jsx(Gw,{})}),e.jsx(Ae,{path:"/models/running",element:e.jsx(Hw,{})}),e.jsx(Ae,{path:"/models/pull",element:e.jsx($w,{})}),e.jsx(Ae,{path:"/catalog",element:e.jsx(Qw,{})}),e.jsx(Ae,{path:"/catalog/editor",element:e.jsx(Xw,{})}),e.jsx(Ae,{path:"/libs/pull",element:e.jsx(Jw,{})}),e.jsx(Ae,{path:"/security/keys",element:e.jsx(e0,{})}),e.jsx(Ae,{path:"/security/keys/create",element:e.jsx(t0,{})}),e.jsx(Ae,{path:"/security/keys/delete",element:e.jsx(n0,{})}),e.jsx(Ae,{path:"/security/tokens/create",element:e.jsx(i0,{})}),e.jsx(Ae,{path:"/settings",element:e.jsx(l0,{})}),e.jsx(Ae,{path:"/docs/sdk",element:e.jsx(CP,{})}),e.jsx(Ae,{path:"/docs/sdk/kronk",element:e.jsx(PP,{})}),e.jsx(Ae,{path:"/docs/sdk/model",element:e.jsx(EP,{})}),e.jsx(Ae,{path:"/docs/sdk/examples",element:e.jsx(qP,{})}),e.jsx(Ae,{path:"/docs/cli/catalog",element:e.jsx(BP,{})}),e.jsx(Ae,{path:"/docs/cli/libs",element:e.jsx(UP,{})}),e.jsx(Ae,{path:"/docs/cli/model",element:e.jsx(KP,{})}),e.jsx(Ae,{path:"/docs/cli/run",element:e.jsx(zP,{})}),e.jsx(Ae,{path:"/docs/cli/security",element:e.jsx(GP,{})}),e.jsx(Ae,{path:"/docs/cli/server",element:e.jsx(VP,{})}),e.jsx(Ae,{path:"/docs/api/chat",element:e.jsx(HP,{})}),e.jsx(Ae,{path:"/docs/api/messages",element:e.jsx($P,{})}),e.jsx(Ae,{path:"/docs/api/responses",element:e.jsx(WP,{})}),e.jsx(Ae,{path:"/docs/api/embeddings",element:e.jsx(QP,{})}),e.jsx(Ae,{path:"/docs/api/rerank",element:e.jsx(YP,{})}),e.jsx(Ae,{path:"/docs/api/tokenize",element:e.jsx(XP,{})}),e.jsx(Ae,{path:"/docs/api/tools",element:e.jsx(JP,{})}),e.jsx(Ae,{path:"/docs/manual",element:e.jsx(ZP,{})})]})})})})})})})})})})})})}Uc.createRoot(document.getElementById("root")).render(e.jsx(xa.StrictMode,{children:e.jsx(PE,{})}));
